<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon.ico">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"qixinbo.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="开篇说明 原生ImageJ仅支持JS脚本，而ImageJ的衍生版本Fiji支持Python脚本编程，所以这里的ImageJ实际是Fiji。 本文是对这个Tutorial的翻译。 Fiji官方的Jython指南在这里。  上手 有两种方式可以打开脚本编辑器：   * 通过File-New-Script打开。  * 使用Command finder：具体就是按字母“l”，然后输入script，然后选择">
<meta property="og:type" content="article">
<meta property="og:title" content="ImageJ的Python脚本编程">
<meta property="og:url" content="http://qixinbo.github.io/2018/09/15/imagej-python/index.html">
<meta property="og:site_name" content="数字旗手">
<meta property="og:description" content="开篇说明 原生ImageJ仅支持JS脚本，而ImageJ的衍生版本Fiji支持Python脚本编程，所以这里的ImageJ实际是Fiji。 本文是对这个Tutorial的翻译。 Fiji官方的Jython指南在这里。  上手 有两种方式可以打开脚本编辑器：   * 通过File-New-Script打开。  * 使用Command finder：具体就是按字母“l”，然后输入script，然后选择">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2018-09-14T16:00:00.000Z">
<meta property="article:modified_time" content="2021-03-26T07:43:02.289Z">
<meta property="article:author" content="Xin-Bo Qi(亓欣波)">
<meta property="article:tag" content="ImageJ">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://qixinbo.github.io/2018/09/15/imagej-python/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>ImageJ的Python脚本编程 | 数字旗手</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="数字旗手" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">数字旗手</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">电气化、自动化、数字化、智能化、智慧化</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-scholar">

    <a href="/scholar/" rel="section"><i class="fa fa-chart-bar fa-fw"></i>scholar</a>

  </li>
        <li class="menu-item menu-item-sources">

    <a href="/sources/" rel="section"><i class="fa fa-rss fa-fw"></i>sources</a>

  </li>
        <li class="menu-item menu-item-gallery">

    <a href="/gallery/" rel="section"><i class="fa fa-file-image fa-fw"></i>gallery</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-commonweal">

    <a href="/404.html" rel="section"><i class="fa fa-heartbeat fa-fw"></i>Commonweal 404</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://qixinbo.github.io/2018/09/15/imagej-python/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Xin-Bo Qi(亓欣波)">
      <meta itemprop="description" content="Digitize everything to realize Digitalization!">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="数字旗手">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          ImageJ的Python脚本编程
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-09-15 00:00:00" itemprop="dateCreated datePublished" datetime="2018-09-15T00:00:00+08:00">2018-09-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-03-26 15:43:02" itemprop="dateModified" datetime="2021-03-26T15:43:02+08:00">2021-03-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/computer-vision/" itemprop="url" rel="index"><span itemprop="name">computer vision</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2018/09/15/imagej-python/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2018/09/15/imagej-python/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="开篇说明"><a href="#开篇说明" class="headerlink" title="开篇说明"></a>开篇说明</h1><p>原生ImageJ仅支持JS脚本，而ImageJ的衍生版本Fiji支持Python脚本编程，所以这里的ImageJ实际是Fiji。<br>本文是对这个<a target="_blank" rel="noopener" href="http://www.ini.uzh.ch/~acardona/fiji-tutorial/">Tutorial</a>的翻译。<br>Fiji官方的Jython指南在<a target="_blank" rel="noopener" href="https://imagej.net/Jython_Scripting">这里</a>。</p>
<h1 id="上手"><a href="#上手" class="headerlink" title="上手"></a>上手</h1><p>有两种方式可以打开脚本编辑器：</p>
<ul>
<li>通过File-New-Script打开。</li>
<li>使用Command finder：具体就是按字母“l”，然后输入script，然后选择下面的script。</li>
</ul>
<p>打开编辑器后，选择Language为Python。</p>
<h1 id="你的第一个Fiji脚本"><a href="#你的第一个Fiji脚本" class="headerlink" title="你的第一个Fiji脚本"></a>你的第一个Fiji脚本</h1><p>首先随便打开一个图片。</p>
<h2 id="获取打开的图片"><a href="#获取打开的图片" class="headerlink" title="获取打开的图片"></a>获取打开的图片</h2><p>在编辑器中输入以下代码：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> ij <span class="keyword">import</span> IJ</span><br><span class="line"></span><br><span class="line">imp = IJ.getImage()</span><br><span class="line"><span class="built_in">print</span> imp</span><br></pre></td></tr></table></figure><br>然后点击“Run”，或者使用快捷键“Ctrl+R”，这样程序就会运行，且在下方的窗口中打印出结果。<br>值得一提的是，imp是一个常用的名字，用来表示ImagePlus类的一个实例。ImagePlus是ImageJ表示一张图片的抽象，实际上在ImageJ中打开的每一个图像都是一个ImagePlus的实例。</p>
<p>注意：从下面可以看到，也可以通过IJ.openImage直接在脚本中获取某个未打开的图像。</p>
<h2 id="通过一个文件对话框保存图像"><a href="#通过一个文件对话框保存图像" class="headerlink" title="通过一个文件对话框保存图像"></a>通过一个文件对话框保存图像</h2><p>这里在图像上的第一个操作是“保存”它。<br>在编辑器中增加以下代码：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> ij.io <span class="keyword">import</span> FileSaver</span><br><span class="line">fs = FileSaver(imp)</span><br><span class="line">fs.save()</span><br></pre></td></tr></table></figure><br>这部分代码是导入FileSaver这个命名空间，然后创建一个参数为上面imp的FileSaver的实例，然后调用它的save函数。</p>
<h2 id="将图像直接写入文件"><a href="#将图像直接写入文件" class="headerlink" title="将图像直接写入文件"></a>将图像直接写入文件</h2><p>编写脚本的一个目的是避免与人交互，因此这里直接将图像写入文件中：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">folder = <span class="string">&quot;/home/qixinbo/temp/&quot;</span></span><br><span class="line">filepath = folder + <span class="string">&quot;boats.tif&quot;</span></span><br><span class="line">fs.saveAsTiff(filepath)</span><br></pre></td></tr></table></figure><br>这里指定了文件保存路径，然后调用FileSaver的saveAsTiff方法，同理还有saveAsPng、saveAsJpeg等。</p>
<h2 id="保存文件时事先检查路径和文件"><a href="#保存文件时事先检查路径和文件" class="headerlink" title="保存文件时事先检查路径和文件"></a>保存文件时事先检查路径和文件</h2><p>FileSaver将会覆盖给定路径下的文件，因此需要事先检查一下，防止误操作。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">folder = <span class="string">&quot;/home/qixinbo/temp/&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> os <span class="keyword">import</span> path</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> path.exists(folder) <span class="keyword">and</span> path.isdir(folder):</span><br><span class="line">	<span class="built_in">print</span> <span class="string">&quot;folder exists:&quot;</span>, folder</span><br><span class="line">	filepath = path.join(folder, <span class="string">&quot;boats.tif&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> path.exists(filepath):</span><br><span class="line">		<span class="built_in">print</span> <span class="string">&quot;File exists! Not saving the image, would overwrite a file!&quot;</span></span><br><span class="line">	<span class="keyword">elif</span> fs.saveAsTiff(filepath):</span><br><span class="line">		<span class="built_in">print</span> <span class="string">&quot;File saved successfully at &quot;</span>, filepath	</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">	<span class="built_in">print</span> <span class="string">&quot;Folder does not exist or it&#x27;s not a folder!&quot;</span></span><br></pre></td></tr></table></figure><br>首先检查上面的folder是否存在及它是否是一个路径；然后检查该路径下是否有与要写入的文件有相同名字的文件，如果有，则提示，且不覆盖；最后检查FileSaver的saveAsTiff函数是否工作正常，如果该方法工作正常，将会返回true，因此这里会打印成功提示，否则则报错。</p>
<h1 id="探究图像的属性和像素"><a href="#探究图像的属性和像素" class="headerlink" title="探究图像的属性和像素"></a>探究图像的属性和像素</h1><p>如前所述，ImageJ或Fiji中的一张图像实际是ImagePlus类的一个实例。</p>
<h2 id="输出图片基本信息"><a href="#输出图片基本信息" class="headerlink" title="输出图片基本信息"></a>输出图片基本信息</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> ij <span class="keyword">import</span> IJ, ImagePlus</span><br><span class="line"></span><br><span class="line">imp = IJ.getImage()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;title:&quot;</span>, imp.title</span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;width:&quot;</span>, imp.width</span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;height:&quot;</span>, imp.height</span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;number of pixels:&quot;</span>, imp.width*imp.height</span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;number of slices:&quot;</span>, imp.getNSlices()</span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;number of channels:&quot;</span>, imp.getNChannels()</span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;number of time frames:&quot;</span>, imp.getNFrames()</span><br><span class="line"></span><br><span class="line">types = &#123;ImagePlus.COLOR_RGB: <span class="string">&quot;RGB&quot;</span>,</span><br><span class="line">	ImagePlus.GRAY8: <span class="string">&quot;8-bit&quot;</span>,</span><br><span class="line">	ImagePlus.GRAY16: <span class="string">&quot;16-bit&quot;</span>,</span><br><span class="line">	ImagePlus.GRAY32: <span class="string">&quot;32-bit&quot;</span>,</span><br><span class="line">	ImagePlus.COLOR_256: <span class="string">&quot;8-bit color&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;image type:&quot;</span>, types[imp.<span class="built_in">type</span>]</span><br></pre></td></tr></table></figure>
<p>ImagePlus包含诸如图像标题、尺寸（宽度、高度、slices数目、时间帧数目、通道数目），以及像素（被包装在ImageProcessor实例中）。这些数据都是ImagePlus的field，可以通过点号来获取，如img.title就能得到图像标题，如果没有发现某些fields，可以通过get方法得到，如getNChannels得到通道数。<br>对于image的type，上述代码是定义了一个types字典，这样就通过键值对的方式更加直观地显示image的type。</p>
<h2 id="获得图像的像素统计"><a href="#获得图像的像素统计" class="headerlink" title="获得图像的像素统计"></a>获得图像的像素统计</h2><p>ImageJ/Fiji提供了ImageStatistics类做像素统计，其中又使用了这个类的getStatistics的静态方法。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> ij <span class="keyword">import</span> IJ</span><br><span class="line"><span class="keyword">from</span> ij.process <span class="keyword">import</span> ImageStatistics <span class="keyword">as</span> IS</span><br><span class="line"></span><br><span class="line">imp = IJ.getImage()</span><br><span class="line"></span><br><span class="line">ip = imp.getProcessor()</span><br><span class="line"></span><br><span class="line">options = IS.MEAN | IS.MEDIAN | IS.MIN_MAX</span><br><span class="line">stats = IS.getStatistics(ip, options, imp.getCalibration())</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;Image statistics for&quot;</span>, imp.title</span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;Mean:&quot;</span>, stats.mean</span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;Median:&quot;</span>, stats.median</span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;Min and max:&quot;</span>, stats.<span class="built_in">min</span>, <span class="string">&quot;-&quot;</span>, stats.<span class="built_in">max</span></span><br></pre></td></tr></table></figure><br>注意，用getProcessor得到像素信息。如果图像是stacks，那么使用StackStatistics。</p>
<p>如果是很多图片，该怎样做统计？可以像下面这样写一个函数：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">from</span> ij <span class="keyword">import</span> IJ</span><br><span class="line"><span class="keyword">from</span> ij.process <span class="keyword">import</span> ImageStatistics <span class="keyword">as</span> IS</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">options = IS.MEAN | IS.MEDIAN | IS.MIN_MAX</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getStatistics</span>(<span class="params">imp</span>):</span></span><br><span class="line">	<span class="string">&quot;&quot;&quot; Return statistics for the given ImagePlus &quot;&quot;&quot;</span></span><br><span class="line">	<span class="keyword">global</span> options</span><br><span class="line">	ip = imp.getProcessor()	</span><br><span class="line">	stats = IS.getStatistics(ip, options, imp.getCalibration())	</span><br><span class="line">	<span class="keyword">return</span> stats.mean, stats.median, stats.<span class="built_in">min</span>, stats.<span class="built_in">max</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">folder = <span class="string">&quot;/home/qixinbo/temp/&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> filename <span class="keyword">in</span> os.listdir(folder):</span><br><span class="line">	<span class="keyword">if</span> filename.endswith(<span class="string">&quot;.png&quot;</span>):</span><br><span class="line">		<span class="built_in">print</span> <span class="string">&quot;Processing&quot;</span>, filename</span><br><span class="line">		imp = IJ.openImage(os.path.join(folder, filename))</span><br><span class="line">		<span class="keyword">if</span> imp <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">			<span class="built_in">print</span> <span class="string">&quot;Could not open image from file:&quot;</span>, filename</span><br><span class="line">			<span class="keyword">continue</span></span><br><span class="line">		mean, median, <span class="built_in">min</span>, <span class="built_in">max</span> = getStatistics(imp)</span><br><span class="line">		<span class="built_in">print</span> <span class="string">&quot;Image statistics for&quot;</span>, imp.title</span><br><span class="line">		<span class="built_in">print</span> <span class="string">&quot;Mean:&quot;</span>, mean</span><br><span class="line">		<span class="built_in">print</span> <span class="string">&quot;Median:&quot;</span>, median</span><br><span class="line">		<span class="built_in">print</span> <span class="string">&quot;Min and max:&quot;</span>, <span class="built_in">min</span>, <span class="string">&quot;-&quot;</span>, <span class="built_in">max</span></span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		<span class="built_in">print</span> <span class="string">&quot;Ignoring&quot;</span>, filename</span><br></pre></td></tr></table></figure></p>
<h2 id="像素迭代"><a href="#像素迭代" class="headerlink" title="像素迭代"></a>像素迭代</h2><p>像素迭代是一个低层操作，很少用到。但如果真需要用到，下面提供了三种迭代方式：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> java.lang <span class="keyword">import</span> Float</span><br><span class="line"><span class="keyword">from</span> ij <span class="keyword">import</span> IJ</span><br><span class="line"></span><br><span class="line">imp = IJ.getImage()</span><br><span class="line"></span><br><span class="line">ip = imp.getProcessor().convertToFloat()</span><br><span class="line">pixels = ip.getPixels()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;Image is&quot;</span>, imp.title, <span class="string">&quot;of type&quot;</span>, imp.<span class="built_in">type</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Method 1: the for loop, C style</span></span><br><span class="line">minimum = Float.MAX_VALUE</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="built_in">len</span>(pixels)):</span><br><span class="line">	<span class="keyword">if</span> pixels[i] &lt; minimum:</span><br><span class="line">		minimum = pixels[i]</span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;1. Minimum is:&quot;</span>, minimum</span><br><span class="line"></span><br><span class="line"><span class="comment"># Method 2: iterate pixels as a list</span></span><br><span class="line">minimum = Float.MAX_VALUE</span><br><span class="line"><span class="keyword">for</span> pix <span class="keyword">in</span> pixels:</span><br><span class="line">	<span class="keyword">if</span> pix &lt; minimum:</span><br><span class="line">		minimum = pix</span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;2. Minimum is:&quot;</span>, minimum</span><br><span class="line"></span><br><span class="line"><span class="comment"># Method 3: apply the built-in min function</span></span><br><span class="line"><span class="comment"># to the first pair of pixels,</span></span><br><span class="line"><span class="comment"># and then to the result of that and the next pixel, etc.</span></span><br><span class="line">minimum = reduce(<span class="built_in">min</span>, pixels)</span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;3. Minium is:&quot;</span>, minimum</span><br></pre></td></tr></table></figure><br>对于上面的pixels，根据不同类型的图像，可以有不同的形式，具体可以打印出来看一下。对于RGB图像，可以调用getBrightness来看看哪个像素最亮，可以通过ip.toFloat(0,None)来获得第一个通道。<br>上面使用了三种风格来处理像素列表，一种是C风格的形式，第二种是列表形式，第三种是函数式编程风格。</p>
<h2 id="对列表或集合的迭代或循环操作"><a href="#对列表或集合的迭代或循环操作" class="headerlink" title="对列表或集合的迭代或循环操作"></a>对列表或集合的迭代或循环操作</h2><p>对于上面三种处理列表的风格，前两种都使用了for循环来进行迭代，好处是特别容易理解，坏处是性能上会有点弱，且不简洁；第三种采用reduce这种函数式编程的风格，其他还有map、filter等操作，好处是性能好且形式简洁，但坏处是较难理解。<br>下面通过几个例子更详细地介绍这几种风格的对比。</p>
<h3 id="map操作"><a href="#map操作" class="headerlink" title="map操作"></a>map操作</h3><p>map操作接收一个长度为N的列表，然后施加一个函数，返回一个长度也为N的列表。比如，你想得到Fiji中打开的一系列的图片，如果用for循环，需要先显式创建一个列表，然后一个一个地把图片附加进去。<br>如果使用python的列表解析的语法糖，列表可以直接创建，然后在中括号里直接写上for循环的逻辑。因此，本质上它仍然是个序列化的循环，无法并行操作。<br>通过使用map，则可直接在ID列表中对每个ID进行WM.getImage作用。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> ij <span class="keyword">import</span> WindowManager <span class="keyword">as</span> WM</span><br><span class="line"></span><br><span class="line"><span class="comment"># Method 1: with a for loop</span></span><br><span class="line">images = []</span><br><span class="line"><span class="keyword">for</span> <span class="built_in">id</span> <span class="keyword">in</span> WM.getIDList():</span><br><span class="line">	images.append(WM.getImage(<span class="built_in">id</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># Method 2: with list comprehension</span></span><br><span class="line">images = [WM.getImage(<span class="built_in">id</span>) <span class="keyword">for</span> <span class="built_in">id</span> <span class="keyword">in</span> WM.getIDList()]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Method 3: with a map openration</span></span><br><span class="line">images = <span class="built_in">map</span>(WM.getImage, WM.getIDList())</span><br></pre></td></tr></table></figure></p>
<h3 id="filter操作"><a href="#filter操作" class="headerlink" title="filter操作"></a>filter操作</h3><p>filter操作接收一个长度为N的列表，然后返回一个更短的列表，只有通过特定条件的元素才能进入到新列表中。比如下面这个列子就是找到Fiji打开的图片中标题中有特定字符串的图片。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> ij <span class="keyword">import</span> WindowManager <span class="keyword">as</span> WM</span><br><span class="line"></span><br><span class="line">imps = <span class="built_in">map</span>(WM.getImage, WM.getIDList())</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">match</span>(<span class="params">imp</span>):</span></span><br><span class="line">	<span class="string">&quot;&quot;&quot; Returns true if the image title contains the word &#x27;boat&#x27; &quot;&quot;&quot;</span></span><br><span class="line">	<span class="keyword">return</span> imp.title.find(<span class="string">&quot;boat&quot;</span>) &gt; -<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Method 1: with a for loop</span></span><br><span class="line">matching = []</span><br><span class="line"><span class="keyword">for</span> imp <span class="keyword">in</span> imps:</span><br><span class="line">	<span class="keyword">if</span> match(imp):</span><br><span class="line">		matching.append(imp)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Method 2: with list comprehension</span></span><br><span class="line">matching = [imp <span class="keyword">for</span> imp <span class="keyword">in</span> imps <span class="keyword">if</span> match(imp)]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Method 3: with a filter operation</span></span><br><span class="line">matching = <span class="built_in">filter</span>(match, imps)</span><br></pre></td></tr></table></figure></p>
<h3 id="reduce操作"><a href="#reduce操作" class="headerlink" title="reduce操作"></a>reduce操作</h3><p>reduce操作接收一个长度为N的列表，然后返回一个单值。比如你想找到Fiji当前打开的图片中面积最大的那个。如果使用for循环，需要设置临时变量，以及判断列表中是否有至少一个元素等，而使用reduce则不需要临时变量，只需要一个辅助函数（其实甚至这里只需要一个匿名lambda函数，但这里显式定义，从而更好理解及可用性更好）。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> ij <span class="keyword">import</span> IJ</span><br><span class="line"><span class="keyword">from</span> ij <span class="keyword">import</span> WindowManager <span class="keyword">as</span> WM</span><br><span class="line"></span><br><span class="line">imps = <span class="built_in">map</span>(WM.getImage, WM.getIDList())</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">area</span>(<span class="params">imp</span>):</span></span><br><span class="line">	<span class="keyword">return</span> imp.width * imp.height</span><br><span class="line"></span><br><span class="line"><span class="comment"># Method 1: with a for loop</span></span><br><span class="line">largest = <span class="literal">None</span></span><br><span class="line">largestArea = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> imp <span class="keyword">in</span> imps:</span><br><span class="line">	<span class="keyword">if</span> largest <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">		largest = imp</span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		a = area(imp)</span><br><span class="line">		<span class="keyword">if</span> a &gt; largestArea:</span><br><span class="line">			largest = imp</span><br><span class="line">			largestArea = a</span><br><span class="line"></span><br><span class="line"><span class="comment"># Method 2: with a reduce operation</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">largestImage</span>(<span class="params">imp1, imp2</span>):</span></span><br><span class="line">	<span class="keyword">return</span> imp1 <span class="keyword">if</span> area(imp1) &gt; area(imp2) <span class="keyword">else</span> imp2</span><br><span class="line"></span><br><span class="line">largest = reduce(largestImage, imps)</span><br></pre></td></tr></table></figure></p>
<h2 id="对每一个像素减去最小值"><a href="#对每一个像素减去最小值" class="headerlink" title="对每一个像素减去最小值"></a>对每一个像素减去最小值</h2><p>首先使用上面的reduce方法得到最小的像素值，然后使用下面两种方法对每个像素减去该最小值：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> ij <span class="keyword">import</span> IJ, ImagePlus</span><br><span class="line"><span class="keyword">from</span> ij.process <span class="keyword">import</span> FloatProcessor</span><br><span class="line"></span><br><span class="line">imp = IJ.getImage()</span><br><span class="line">ip = imp.getProcessor().convertToFloat()</span><br><span class="line">pixels = ip.getPixels()</span><br><span class="line"></span><br><span class="line">minimum = reduce(<span class="built_in">min</span>, pixels)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Method 1: subtract the minimum from every pixel</span></span><br><span class="line"><span class="comment"># in place, modifying the pixels array</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="built_in">len</span>(pixels)):</span><br><span class="line">	pixels[i] -= minimum</span><br><span class="line"></span><br><span class="line">imp2 = ImagePlus(imp.title, ip)</span><br><span class="line">imp2.show()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Method 2: subtract the minimum from every pixel</span></span><br><span class="line"><span class="comment"># and store the result in a new array</span></span><br><span class="line">pixels3= <span class="built_in">map</span>(<span class="keyword">lambda</span> x: x-minimum, pixels)</span><br><span class="line">ip3 = FloatProcessor(ip.width, ip.height, pixels3, <span class="literal">None</span>)</span><br><span class="line">imp3 = ImagePlus(imp.title, ip3)</span><br><span class="line">imp3.show()</span><br></pre></td></tr></table></figure></p>
<h2 id="将像素列表概括为单值"><a href="#将像素列表概括为单值" class="headerlink" title="将像素列表概括为单值"></a>将像素列表概括为单值</h2><h3 id="统计在阈值以上的像素个数"><a href="#统计在阈值以上的像素个数" class="headerlink" title="统计在阈值以上的像素个数"></a>统计在阈值以上的像素个数</h3><p>本例将计算有多少像素在特定阈值之上，使用reduce函数。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> ij <span class="keyword">import</span> IJ</span><br><span class="line"></span><br><span class="line">imp = IJ.getImage()</span><br><span class="line">ip = imp.getProcessor().convertToFloat()</span><br><span class="line">pixels = ip.getPixels()</span><br><span class="line"></span><br><span class="line">mean = <span class="built_in">sum</span>(pixels) / <span class="built_in">len</span>(pixels)</span><br><span class="line"></span><br><span class="line">n_pix_above = reduce(<span class="keyword">lambda</span> count, a: count+<span class="number">1</span> <span class="keyword">if</span> a &gt; mean <span class="keyword">else</span> count, pixels, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;Mean value&quot;</span>, mean</span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;% pixels above mean:&quot;</span>, n_pix_above / <span class="built_in">float</span>(<span class="built_in">len</span>(pixels)) * <span class="number">100</span></span><br></pre></td></tr></table></figure></p>
<h3 id="统计在阈值以上的所有像素的坐标，并计算重心"><a href="#统计在阈值以上的所有像素的坐标，并计算重心" class="headerlink" title="统计在阈值以上的所有像素的坐标，并计算重心"></a>统计在阈值以上的所有像素的坐标，并计算重心</h3><p>所有像素值在阈值（这里是均值）以上的坐标点都通过filter函数收集在一个列表中。注意，在ImageJ中，一张图像的所有像素都存储在一个线性数组中，数组的长度是width与height的乘积。因此，某个像素的索引除以width的余数（即模）是该像素的X坐标，索引除以width的商是该像素的Y坐标。<br>同时，给出了四种计算中心的方法，第一种是使用for循环，第二种是使用map和sum，第三种是使用reduce，第四种是对第三种的简化，使用了functools包中的partial函数。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> ij <span class="keyword">import</span> IJ</span><br><span class="line"></span><br><span class="line">imp = IJ.getImage()</span><br><span class="line">ip = imp.getProcessor().convertToFloat()</span><br><span class="line">pixels = ip.getPixels()</span><br><span class="line"></span><br><span class="line">mean = <span class="built_in">sum</span>(pixels) / <span class="built_in">len</span>(pixels)</span><br><span class="line"></span><br><span class="line">above = <span class="built_in">filter</span>(<span class="keyword">lambda</span> i: pixels[i] &gt; mean, xrange(<span class="built_in">len</span>(pixels)))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;Number of pixels above mean value:&quot;</span>, <span class="built_in">len</span>(above)</span><br><span class="line"></span><br><span class="line">width = imp.width</span><br><span class="line"></span><br><span class="line"><span class="comment"># Method 1: with a for loop</span></span><br><span class="line">xc = <span class="number">0</span></span><br><span class="line">yc = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> above:</span><br><span class="line">	xc += i % width</span><br><span class="line">	yc += i / width</span><br><span class="line">xc = xc / <span class="built_in">len</span>(above)</span><br><span class="line">yc = yc / <span class="built_in">len</span>(above)</span><br><span class="line"><span class="built_in">print</span> xc, yc</span><br><span class="line"></span><br><span class="line"><span class="comment"># Method 2: with sum and map</span></span><br><span class="line">xc = <span class="built_in">sum</span>(<span class="built_in">map</span>(<span class="keyword">lambda</span> i: i % width, above)) / <span class="built_in">len</span>(above)</span><br><span class="line">yc = <span class="built_in">sum</span>(<span class="built_in">map</span>(<span class="keyword">lambda</span> i: i / width, above)) / <span class="built_in">len</span>(above)</span><br><span class="line"><span class="built_in">print</span> xc, yc</span><br><span class="line"></span><br><span class="line"><span class="comment"># Method 3: iterating the list &quot;above&quot; just once</span></span><br><span class="line">xc, yc = [d / <span class="built_in">len</span>(above) <span class="keyword">for</span> d <span class="keyword">in</span> </span><br><span class="line">		reduce(<span class="keyword">lambda</span> c, i: [c[<span class="number">0</span>] + i%width, c[<span class="number">1</span>] + i/width], above, [<span class="number">0</span>,<span class="number">0</span>])]</span><br><span class="line"><span class="built_in">print</span> xc, yc</span><br><span class="line"></span><br><span class="line"><span class="comment"># Method 4: iterating the list &quot;above&quot; just once, more clearly and performant</span></span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> partial</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">accum</span>(<span class="params">width, c, i</span>):</span></span><br><span class="line">	c[<span class="number">0</span>] += i % width</span><br><span class="line">	c[<span class="number">1</span>] += i / width</span><br><span class="line">	<span class="keyword">return</span> c</span><br><span class="line">xc, yc = [d/<span class="built_in">len</span>(above) <span class="keyword">for</span> d <span class="keyword">in</span> reduce(partial(accum, width), above, [<span class="number">0</span>,<span class="number">0</span>])]</span><br><span class="line"><span class="built_in">print</span> xc, yc</span><br></pre></td></tr></table></figure></p>
<h1 id="运行ImageJ-Fiji插件"><a href="#运行ImageJ-Fiji插件" class="headerlink" title="运行ImageJ/Fiji插件"></a>运行ImageJ/Fiji插件</h1><p>下面是一个对当前图片施加中值滤波的例子：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> ij <span class="keyword">import</span> IJ, ImagePlus</span><br><span class="line"><span class="keyword">from</span> ij.plugin.<span class="built_in">filter</span> <span class="keyword">import</span> RankFilters</span><br><span class="line"></span><br><span class="line">imp = IJ.getImage()</span><br><span class="line">ip = imp.getProcessor().convertToFloat()</span><br><span class="line"></span><br><span class="line">radius = <span class="number">2</span></span><br><span class="line">RankFilters().rank(ip, radius, RankFilters.MEDIAN)</span><br><span class="line"></span><br><span class="line">imp2 = ImagePlus(imp.title + <span class="string">&quot; median filtered&quot;</span>, ip)</span><br><span class="line">imp2.show()</span><br></pre></td></tr></table></figure></p>
<h2 id="查找哪个类用了哪个插件"><a href="#查找哪个类用了哪个插件" class="headerlink" title="查找哪个类用了哪个插件"></a>查找哪个类用了哪个插件</h2><p>现在的问题是怎样知道上面的中值滤波在RankFilters中。可以通过Command Finder来查找。</p>
<h2 id="查找插件所需要的参数"><a href="#查找插件所需要的参数" class="headerlink" title="查找插件所需要的参数"></a>查找插件所需要的参数</h2><p>可以通过Macro Recorder来查看一个插件必要的参数。</p>
<ul>
<li>打开Plugins-Macros-Record</li>
<li>运行命令，比如上面的Process-Filters-Median。此时会出现一个对话框，要求输入半径，点击OK</li>
<li>查看Recorder窗口中的显示：run(“Median…”, “radius=2”);</li>
</ul>
<p>这说明中值滤波的一个必要参数就是radius。</p>
<h2 id="运行命令command"><a href="#运行命令command" class="headerlink" title="运行命令command"></a>运行命令command</h2><p>上面的插件plugin其实可以通过刚才录制的宏命令来替代：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IJ.run(imp, <span class="string">&quot;Median...&quot;</span>, <span class="string">&quot;radius=2&quot;</span>)</span><br></pre></td></tr></table></figure></p>
<h1 id="创建图像及其ROI"><a href="#创建图像及其ROI" class="headerlink" title="创建图像及其ROI"></a>创建图像及其ROI</h1><h2 id="从零开始创建一张图像"><a href="#从零开始创建一张图像" class="headerlink" title="从零开始创建一张图像"></a>从零开始创建一张图像</h2><p>一张ImageJ/Fiji图像至少包含三个部分：</p>
<ul>
<li>像素数组：一个含有原始类型数据的数组，数据类型可以是byte、short、int或float</li>
<li>ImageProcessor子类实例：用来承载像素数组</li>
<li>ImagePlus实例：用来承载ImageProcessor实例</li>
</ul>
<p>下面的例子中创建了一个空的float型数组，然后用随机的浮点数填充，然后把它传给FloatProcessor，最后传给ImagePlus：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> ij <span class="keyword">import</span> ImagePlus</span><br><span class="line"><span class="keyword">from</span> ij.process <span class="keyword">import</span> FloatProcessor</span><br><span class="line"><span class="keyword">from</span> array <span class="keyword">import</span> zeros</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line">width = <span class="number">1024</span></span><br><span class="line">height = <span class="number">1024</span></span><br><span class="line">pixels = zeros(<span class="string">&#x27;f&#x27;</span>, width * height)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="built_in">len</span>(pixels)):</span><br><span class="line">	pixels[i] = random()</span><br><span class="line"></span><br><span class="line">fp = FloatProcessor(width, height, pixels, <span class="literal">None</span>)</span><br><span class="line">imp = ImagePlus(<span class="string">&quot;White noise&quot;</span>, fp)</span><br><span class="line"></span><br><span class="line">imp.show()</span><br></pre></td></tr></table></figure></p>
<h2 id="用给定值填充一个ROI"><a href="#用给定值填充一个ROI" class="headerlink" title="用给定值填充一个ROI"></a>用给定值填充一个ROI</h2><p>为了填充一个ROI，我们可以对像素进行迭代，知道在ROI内部的像素，然后将它们的值设为指定值。但这个过程是繁杂且容易出错。更有效的方式是创建一个Roi类的实例或它的子类PolygonRoi、OvalRoi、ShapeRoi等的实例，然后告诉ImageProcessor来填充这个区域。<br>下面的例子使用了上面创建的白噪声图像，然后在其中定义了一个矩形区域，然后用2填充。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> ij.gui <span class="keyword">import</span> Roi, PolygonRoi</span><br><span class="line"></span><br><span class="line">roi = Roi(<span class="number">400</span>, <span class="number">200</span>, <span class="number">400</span>, <span class="number">300</span>)</span><br><span class="line">fp.setRoi(roi)</span><br><span class="line">fp.setValue(<span class="number">2.0</span>)</span><br><span class="line">fp.fill()</span><br><span class="line"></span><br><span class="line">imp.show()</span><br></pre></td></tr></table></figure><br>因为原来的白噪声的值是0到1的随机数，现在加上的值是2，是新的最大值，所以看起来是白色的。<br>在上面的代码基础上再增加一个新的多边形区域，用-3填充：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">xs = [<span class="number">234</span>, <span class="number">174</span>, <span class="number">162</span>, <span class="number">102</span>, <span class="number">120</span>, <span class="number">123</span>, <span class="number">153</span>, <span class="number">177</span>, <span class="number">171</span>,  </span><br><span class="line">      <span class="number">60</span>, <span class="number">0</span>, <span class="number">18</span>, <span class="number">63</span>, <span class="number">132</span>, <span class="number">84</span>, <span class="number">129</span>, <span class="number">69</span>, <span class="number">174</span>, <span class="number">150</span>,  </span><br><span class="line">      <span class="number">183</span>, <span class="number">207</span>, <span class="number">198</span>, <span class="number">303</span>, <span class="number">231</span>, <span class="number">258</span>, <span class="number">234</span>, <span class="number">276</span>, <span class="number">327</span>,  </span><br><span class="line">      <span class="number">378</span>, <span class="number">312</span>, <span class="number">228</span>, <span class="number">225</span>, <span class="number">246</span>, <span class="number">282</span>, <span class="number">261</span>, <span class="number">252</span>]  </span><br><span class="line">ys = [<span class="number">48</span>, <span class="number">0</span>, <span class="number">60</span>, <span class="number">18</span>, <span class="number">78</span>, <span class="number">156</span>, <span class="number">201</span>, <span class="number">213</span>, <span class="number">270</span>, <span class="number">279</span>,  </span><br><span class="line">      <span class="number">336</span>, <span class="number">405</span>, <span class="number">345</span>, <span class="number">348</span>, <span class="number">483</span>, <span class="number">615</span>, <span class="number">654</span>, <span class="number">639</span>, <span class="number">495</span>,  </span><br><span class="line">      <span class="number">444</span>, <span class="number">480</span>, <span class="number">648</span>, <span class="number">651</span>, <span class="number">609</span>, <span class="number">456</span>, <span class="number">327</span>, <span class="number">330</span>, <span class="number">432</span>,  </span><br><span class="line">      <span class="number">408</span>, <span class="number">273</span>, <span class="number">273</span>, <span class="number">204</span>, <span class="number">189</span>, <span class="number">126</span>, <span class="number">57</span>, <span class="number">6</span>]</span><br><span class="line">proi = PolygonRoi(xs, ys, <span class="built_in">len</span>(xs), Roi.POLYGON)</span><br><span class="line">fp.setRoi(proi)</span><br><span class="line">fp.setValue(-<span class="number">3</span>)</span><br><span class="line">fp.fill(proi.getMask()) <span class="comment"># Attention here!</span></span><br><span class="line"></span><br><span class="line">imp.show()</span><br></pre></td></tr></table></figure></p>
<h1 id="创建和操作图像的stacks和hyperstacks"><a href="#创建和操作图像的stacks和hyperstacks" class="headerlink" title="创建和操作图像的stacks和hyperstacks"></a>创建和操作图像的stacks和hyperstacks</h1><h2 id="加载一张多彩图像stack并提取绿色通道"><a href="#加载一张多彩图像stack并提取绿色通道" class="headerlink" title="加载一张多彩图像stack并提取绿色通道"></a>加载一张多彩图像stack并提取绿色通道</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> ij <span class="keyword">import</span> IJ, ImagePlus, ImageStack</span><br><span class="line"></span><br><span class="line">imp = IJ.openImage(<span class="string">&quot;/home/qixinbo/temp/flybrain.zip&quot;</span>)</span><br><span class="line">stack = imp.getImageStack()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;Number of slices:&quot;</span>, imp.getNSlices()</span><br><span class="line"></span><br><span class="line">greens = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">1</span>, imp.getNSlices()+<span class="number">1</span>):</span><br><span class="line">	cp = stack.getProcessor(i) <span class="comment"># Get the ColorProcessor slice at index i</span></span><br><span class="line">	fp = cp.toFloat(<span class="number">1</span>, <span class="literal">None</span>) <span class="comment"># Get its green channel as a FloatProcessor</span></span><br><span class="line">	greens.append(fp) <span class="comment"># store it in a list</span></span><br><span class="line"></span><br><span class="line">stack2 = ImageStack(imp.width, imp.height) <span class="comment"># Create a new stack with only the green channel</span></span><br><span class="line"><span class="keyword">for</span> fp <span class="keyword">in</span> greens:</span><br><span class="line">	stack2.addSlice(<span class="literal">None</span>, fp)</span><br><span class="line"></span><br><span class="line">imp2 = ImagePlus(<span class="string">&quot;Green channel&quot;</span>, stack2) <span class="comment"># Create a new image with stack of green channel slices</span></span><br><span class="line">IJ.run(imp2, <span class="string">&quot;Green&quot;</span>, <span class="string">&quot;&quot;</span>) <span class="comment"># Set a green look-up table</span></span><br><span class="line">imp2.show()</span><br></pre></td></tr></table></figure>
<p>首先加载名为”Fly Brain”的样例。然后对它的slices进行迭代。每个slices都是一个ColorProcessor，它有一个toFloat的方法，可以得到一个特定颜色通道的FloatProcessor。将颜色通道用浮点数表示是最方便的处理像素值的方法，它不像字节类型那样会溢出。最后一个创建绿色的LUT命令，可以通过录制宏命令的形式得到具体的写法。如果不加这个绿色的LUT，整个图像虽然是绿色通道的像素值，但是以灰度图呈现的。</p>
<h2 id="将一个RGB-stack转换为双通道的32-bit-hyperstack"><a href="#将一个RGB-stack转换为双通道的32-bit-hyperstack" class="headerlink" title="将一个RGB stack转换为双通道的32-bit hyperstack"></a>将一个RGB stack转换为双通道的32-bit hyperstack</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> ij <span class="keyword">import</span> IJ, ImagePlus, ImageStack, CompositeImage</span><br><span class="line"></span><br><span class="line">imp = IJ.openImage(<span class="string">&quot;/home/qixinbo/temp/flybrain.zip&quot;</span>)</span><br><span class="line">stack = imp.getImageStack()</span><br><span class="line"></span><br><span class="line">stack2 = ImageStack(imp.width, imp.height) <span class="comment"># Create a new stack with only the green channel</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">1</span>, imp.getNSlices()+<span class="number">1</span>):</span><br><span class="line">	cp = stack.getProcessor(i) <span class="comment"># Get the ColorProcessor slice at index i</span></span><br><span class="line">	red = cp.toFloat(<span class="number">0</span>, <span class="literal">None</span>) <span class="comment"># Get the red channel as a FloatProcessor</span></span><br><span class="line">	green = cp.toFloat(<span class="number">1</span>, <span class="literal">None</span>) <span class="comment"># Get its green channel as a FloatProcessor</span></span><br><span class="line">	stack2.addSlice(<span class="literal">None</span>, red)</span><br><span class="line">	stack2.addSlice(<span class="literal">None</span>, green)</span><br><span class="line"></span><br><span class="line">imp2 = ImagePlus(<span class="string">&quot;32-bit 2-channel composite&quot;</span>, stack2)</span><br><span class="line">imp2.setCalibration(imp.getCalibration().copy())</span><br><span class="line"></span><br><span class="line">nChannels = <span class="number">2</span></span><br><span class="line">nSlices = stack.getSize()</span><br><span class="line">nFrames = <span class="number">1</span></span><br><span class="line">imp2.setDimensions(nChannels, nSlices, nFrames)</span><br><span class="line">comp = CompositeImage(imp2, CompositeImage.COLOR)</span><br><span class="line">comp.show()</span><br></pre></td></tr></table></figure>
<p>其中比较重要的是告诉hyperstack怎样解释它的图像，即setDimensions中的参数，即有多少个通道、多少个slices和多少个时间帧。</p>
<h1 id="人机交互：文件和选项对话框、消息、进度条"><a href="#人机交互：文件和选项对话框、消息、进度条" class="headerlink" title="人机交互：文件和选项对话框、消息、进度条"></a>人机交互：文件和选项对话框、消息、进度条</h1><h2 id="询问打开文件夹"><a href="#询问打开文件夹" class="headerlink" title="询问打开文件夹"></a>询问打开文件夹</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> ij.io <span class="keyword">import</span> DirectoryChooser</span><br><span class="line"></span><br><span class="line">dc = DirectoryChooser(<span class="string">&quot;Choose a folder&quot;</span>)</span><br><span class="line">folder = dc.getDirectory()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> folder <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">	<span class="built_in">print</span> <span class="string">&quot;User cancelled the dialog!&quot;</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">	<span class="built_in">print</span> <span class="string">&quot;Selected folder:&quot;</span>, folder</span><br></pre></td></tr></table></figure>
<h2 id="询问打开文件"><a href="#询问打开文件" class="headerlink" title="询问打开文件"></a>询问打开文件</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> ij.io <span class="keyword">import</span> OpenDialog</span><br><span class="line"></span><br><span class="line">od = OpenDialog(<span class="string">&quot;Choose a file&quot;</span>, <span class="literal">None</span>)</span><br><span class="line">filename = od.getFileName()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> filename <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">	<span class="built_in">print</span> <span class="string">&quot;User canceled the dialog!&quot;</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">	directory = od.getDirectory()</span><br><span class="line">	filepath = directory + filename</span><br><span class="line">	<span class="built_in">print</span> <span class="string">&quot;Selected file path:&quot;</span>, filepath</span><br></pre></td></tr></table></figure>
<h2 id="询问输入参数"><a href="#询问输入参数" class="headerlink" title="询问输入参数"></a>询问输入参数</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> ij.gui <span class="keyword">import</span> GenericDialog</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getOptions</span>():</span></span><br><span class="line">	gd = GenericDialog(<span class="string">&quot;Options&quot;</span>)</span><br><span class="line">	gd.addStringField(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;Untitled&quot;</span>)</span><br><span class="line">	gd.addNumericField(<span class="string">&quot;alpha&quot;</span>, <span class="number">0.25</span>, <span class="number">2</span>)</span><br><span class="line">	gd.addCheckbox(<span class="string">&quot;Optimize&quot;</span>, <span class="literal">True</span>)</span><br><span class="line">	types = [<span class="string">&quot;8-bit&quot;</span>, <span class="string">&quot;16-bit&quot;</span>, <span class="string">&quot;32-bit&quot;</span>]</span><br><span class="line">	gd.addChoice(<span class="string">&quot;Output as&quot;</span>, types, types[<span class="number">2</span>])</span><br><span class="line">	gd.addSlider(<span class="string">&quot;Scale&quot;</span>, <span class="number">1</span>, <span class="number">100</span>, <span class="number">100</span>)</span><br><span class="line">	gd.showDialog()</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> gd.wasCanceled():</span><br><span class="line">		<span class="built_in">print</span> <span class="string">&quot;User canceled dialog!&quot;</span></span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">	name = gd.getNextString()</span><br><span class="line">	alpha = gd.getNextNumber()</span><br><span class="line">	optimize = gd.getNextBoolean()</span><br><span class="line">	output = gd.getNextChoice()</span><br><span class="line">	scale = gd.getNextNumber()</span><br><span class="line">	<span class="keyword">return</span> name, alpha, optimize, output, scale</span><br><span class="line"></span><br><span class="line">options = getOptions()</span><br><span class="line"><span class="keyword">if</span> options <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">	name, alpha, optimize, output, scale = options</span><br><span class="line">	<span class="built_in">print</span> name, alpha, optimize, output, scale</span><br></pre></td></tr></table></figure>
<h2 id="显示进度条"><a href="#显示进度条" class="headerlink" title="显示进度条"></a>显示进度条</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> ij <span class="keyword">import</span> IJ</span><br><span class="line"></span><br><span class="line">imp = IJ.getImage()</span><br><span class="line">stack = imp.getImageStack()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">1</span>, stack.getSize()+<span class="number">1</span>):</span><br><span class="line">	IJ.showProgress(i, stack.getSize()+<span class="number">1</span>)</span><br><span class="line">	ip = stack.getProcessor(i)</span><br><span class="line"></span><br><span class="line">IJ.showProgress(<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<h1 id="将脚本转换为插件"><a href="#将脚本转换为插件" class="headerlink" title="将脚本转换为插件"></a>将脚本转换为插件</h1><p>将脚本存储在Fiji插件文件夹或其子文件夹下，注意：</p>
<ul>
<li>文件名中要有一个下划线</li>
<li>后缀是.py</li>
</ul>
<p>比如”my_script.py”。然后运行“Help-Update Menus”，或者重启Fiji。<br>脚本就会作为”Plugins”中的菜单命令出现，也可以使用Command Finder找到。<br>插件文件夹在哪呢：对于Ubuntu和Windows系统，在Fiji.app文件夹中。</p>
<h1 id="列表、原生数组及与Java类的交互"><a href="#列表、原生数组及与Java类的交互" class="headerlink" title="列表、原生数组及与Java类的交互"></a>列表、原生数组及与Java类的交互</h1><h2 id="Jython列表以只读数组的形式传给Java类"><a href="#Jython列表以只读数组的形式传给Java类" class="headerlink" title="Jython列表以只读数组的形式传给Java类"></a>Jython列表以只读数组的形式传给Java类</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> java.awt.geom <span class="keyword">import</span> AffineTransform</span><br><span class="line"><span class="keyword">from</span> array <span class="keyword">import</span> array</span><br><span class="line"></span><br><span class="line">x = <span class="number">10</span></span><br><span class="line">y = <span class="number">40</span></span><br><span class="line"></span><br><span class="line">aff = AffineTransform(<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">45</span>, <span class="number">56</span>)</span><br><span class="line"></span><br><span class="line">p = [x, y]</span><br><span class="line">aff.transform(p, <span class="number">0</span>, p, <span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span> p</span><br><span class="line"></span><br><span class="line">q = array(<span class="string">&#x27;f&#x27;</span>, [x, y])</span><br><span class="line">aff.transform(q, <span class="number">0</span>, q, <span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span> q</span><br></pre></td></tr></table></figure>
<p>上面的p没有被更新，而q被更新了，所以Jython列表只是可读，而array类型可写。</p>
<h2 id="创建原生数组"><a href="#创建原生数组" class="headerlink" title="创建原生数组"></a>创建原生数组</h2><p>array包有两个函数：</p>
<ul>
<li>zeros：创建空的原生数组</li>
<li>array：从列表或另一个相同类型的array中创建数组</li>
</ul>
<p>array的第一个参数是type。对于原生类型，如char、short、int、float、long和double，可以使用带引号的单个字母。下面的例子中创建了ImagePlus类型的array。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> ij <span class="keyword">import</span> IJ</span><br><span class="line"><span class="keyword">from</span> array <span class="keyword">import</span> array, zeros</span><br><span class="line"><span class="keyword">from</span> ij <span class="keyword">import</span> ImagePlus</span><br><span class="line"></span><br><span class="line">a = zeros(<span class="string">&#x27;f&#x27;</span>, <span class="number">5</span>)</span><br><span class="line"><span class="built_in">print</span> a</span><br><span class="line"></span><br><span class="line">b = array(<span class="string">&#x27;f&#x27;</span>, [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>])</span><br><span class="line"><span class="built_in">print</span> b</span><br><span class="line"></span><br><span class="line">imps = zeros(ImagePlus, <span class="number">5</span>) <span class="comment"># An empty native ImagePlus array of length 5</span></span><br><span class="line"><span class="built_in">print</span> imps</span><br><span class="line"></span><br><span class="line">imps[<span class="number">0</span>] = IJ.getImage() <span class="comment"># Assign the current image to the first element of the array</span></span><br><span class="line"><span class="built_in">print</span> imps</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;length:&quot;</span>, <span class="built_in">len</span>(imps)</span><br></pre></td></tr></table></figure></p>
<h1 id="可作用于任意类型图像的通用算法：ImgLib库"><a href="#可作用于任意类型图像的通用算法：ImgLib库" class="headerlink" title="可作用于任意类型图像的通用算法：ImgLib库"></a>可作用于任意类型图像的通用算法：ImgLib库</h1><p>Imglib是一个处理n维数据的通用库，主要是面向图像处理。用Imglib编程能够极大地简化在不同类型图片上的操作。</p>
<h2 id="对图片进行数学操作"><a href="#对图片进行数学操作" class="headerlink" title="对图片进行数学操作"></a>对图片进行数学操作</h2><p>主要有以下几类的操作：</p>
<ul>
<li>script.imglib.math：提供操作每一个像素的函数。这些函数是可组合的，即某个函数的输出可作为另一个的输入。</li>
<li>script.imglib.color：提供创建和操纵彩色图片的函数，比如在RGB色彩空间中提取特定的色彩通道。</li>
<li>script.imglib.algorithm：提供诸如Gauss、Scale3D、Affine3D、Resample、Downsample等函数，一次对多个像素进行操作，而不是逐个像素的操作。一些函数可能改变图像的尺寸。这些算法全部都返回图像，换句话说，是对原始图像施加这些算法后得到的新图像。</li>
<li>script.imglib.analysis：提供提取或测量图像或者评价图像的函数。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> script.imglib.math <span class="keyword">import</span> Compute, Subtract</span><br><span class="line"><span class="keyword">from</span> script.imglib.color <span class="keyword">import</span> Red, Green, Blue, RGBA</span><br><span class="line"><span class="keyword">from</span> script.imglib <span class="keyword">import</span> ImgLib</span><br><span class="line"><span class="keyword">from</span> ij <span class="keyword">import</span> IJ</span><br><span class="line"></span><br><span class="line">imp = IJ.openImage(<span class="string">&quot;/home/qixinbo/temp/flybrain.zip&quot;</span>)</span><br><span class="line"></span><br><span class="line">img = ImgLib.wrap(imp) <span class="comment"># Wrap it as an Imglib image</span></span><br><span class="line"></span><br><span class="line">sub = Compute.inFloats(Subtract(Green(img), Red(img)))</span><br><span class="line"></span><br><span class="line">ImgLib.wrap(sub).show()</span><br><span class="line"></span><br><span class="line">rgb = RGBA(Red(img), Subtract(Green(img), Red(img)), Blue(img)).asImage()</span><br><span class="line"></span><br><span class="line">ImgLib.wrap(rgb).show()</span><br></pre></td></tr></table></figure>
<h2 id="使用图像数学进行平场校正"><a href="#使用图像数学进行平场校正" class="headerlink" title="使用图像数学进行平场校正"></a>使用图像数学进行平场校正</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> script.imglib.math <span class="keyword">import</span> Compute, Subtract, Divide, Multiply</span><br><span class="line"><span class="keyword">from</span> script.imglib.algorithm <span class="keyword">import</span> Gauss, Scale2D, Resample</span><br><span class="line"><span class="keyword">from</span> script.imglib <span class="keyword">import</span> ImgLib</span><br><span class="line"><span class="keyword">from</span> ij <span class="keyword">import</span> IJ</span><br><span class="line"></span><br><span class="line">img = ImgLib.wrap(IJ.openImage(<span class="string">&quot;/home/qixinbo/temp/bridge.gif&quot;</span>))</span><br><span class="line"></span><br><span class="line">brightfield = Resample(Gauss(Scale2D(img, <span class="number">0.25</span>), <span class="number">20</span>), img.getDimensions())  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># 3. Simulate a perfect darkfield  </span></span><br><span class="line">darkfield = <span class="number">0</span>  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># 4. Compute the mean pixel intensity value of the image  </span></span><br><span class="line">mean = reduce(<span class="keyword">lambda</span> s, t: s + t.get(), img, <span class="number">0</span>) / img.size()  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># 5. Correct the illumination  </span></span><br><span class="line">corrected = Compute.inFloats(Multiply(Divide(Subtract(img, brightfield),  </span><br><span class="line">                                             Subtract(brightfield, darkfield)), mean))  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># 6. ... and show it in ImageJ  </span></span><br><span class="line">ImgLib.wrap(corrected).show() </span><br></pre></td></tr></table></figure>
<h2 id="提取和操纵图像色彩通道：RGBA和HSB"><a href="#提取和操纵图像色彩通道：RGBA和HSB" class="headerlink" title="提取和操纵图像色彩通道：RGBA和HSB"></a>提取和操纵图像色彩通道：RGBA和HSB</h2><p>下面的代码是对RGBA色彩空间的操作：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> script.imglib.math <span class="keyword">import</span> Compute, Subtract, Multiply  </span><br><span class="line"><span class="keyword">from</span> script.imglib.color <span class="keyword">import</span> Red, Blue, RGBA  </span><br><span class="line"><span class="keyword">from</span> script.imglib.algorithm <span class="keyword">import</span> Gauss, Dither</span><br><span class="line"><span class="keyword">from</span> script.imglib <span class="keyword">import</span> ImgLib</span><br><span class="line"><span class="keyword">from</span> ij <span class="keyword">import</span> IJ  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># Obtain a color image from the ImageJ samples    </span></span><br><span class="line">clown = ImgLib.wrap(IJ.openImage(<span class="string">&quot;https://imagej.nih.gov/ij/images/clown.jpg&quot;</span>))  </span><br><span class="line">    </span><br><span class="line"><span class="comment"># Example 1: compose a new image manipulating the color channels of the clown image:    </span></span><br><span class="line">img = RGBA(Gauss(Red(clown), <span class="number">10</span>), <span class="number">40</span>, Multiply(<span class="number">255</span>, Dither(Blue(clown)))).asImage()    </span><br><span class="line">    </span><br><span class="line">ImgLib.wrap(img).show()</span><br></pre></td></tr></table></figure><br>下面的代码是对HSB色彩空间的操作：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> script.imglib.math <span class="keyword">import</span> Compute, Add, Subtract  </span><br><span class="line"><span class="keyword">from</span> script.imglib.color <span class="keyword">import</span> HSB, Hue, Saturation, Brightness  </span><br><span class="line"><span class="keyword">from</span> script.imglib <span class="keyword">import</span> ImgLib  </span><br><span class="line"><span class="keyword">from</span> ij <span class="keyword">import</span> IJ  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># Obtain an image  </span></span><br><span class="line">img = ImgLib.wrap(IJ.openImage(<span class="string">&quot;https://imagej.nih.gov/ij/images/clown.jpg&quot;</span>))  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># Obtain a new clown, whose hue has been shifted by half  </span></span><br><span class="line"><span class="comment"># with the same saturation and brightness of the original  </span></span><br><span class="line">bluey = Compute.inRGBA(HSB(Add(Hue(img), <span class="number">0.5</span>), Saturation(img), Brightness(img)))  </span><br><span class="line">  </span><br><span class="line">ImgLib.wrap(bluey).show()  </span><br></pre></td></tr></table></figure><br>下面的代码是对一个RGB confocal stack进行伽马校正：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Correct gamma  </span></span><br><span class="line"><span class="keyword">from</span> script.imglib.math <span class="keyword">import</span> Min, Max, Exp, Multiply, Divide, Log  </span><br><span class="line"><span class="keyword">from</span> script.imglib.color <span class="keyword">import</span> RGBA, Red, Green, Blue  </span><br><span class="line"><span class="keyword">from</span> script.imglib <span class="keyword">import</span> ImgLib</span><br><span class="line"><span class="keyword">from</span> ij <span class="keyword">import</span> IJ  </span><br><span class="line">  </span><br><span class="line">gamma = <span class="number">0.5</span>  </span><br><span class="line">img = ImgLib.wrap(IJ.openImage(<span class="string">&quot;/home/qixinbo/temp/flybrain.zip&quot;</span>))  </span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">g</span>(<span class="params">channel, gamma</span>):</span>  </span><br><span class="line">  <span class="string">&quot;&quot;&quot; Return a function that, when evaluated, computes the gamma </span></span><br><span class="line"><span class="string">        of the given color channel. </span></span><br><span class="line"><span class="string">      If &#x27;i&#x27; was the pixel value, then this function would do: </span></span><br><span class="line"><span class="string">      double v = Math.exp(Math.log(i/255.0) * gamma) * 255.0); </span></span><br><span class="line"><span class="string">      if (v &lt; 0) v = 0; </span></span><br><span class="line"><span class="string">      if (v &gt;255) v = 255; </span></span><br><span class="line"><span class="string">  &quot;&quot;&quot;</span>  </span><br><span class="line">  <span class="keyword">return</span> Min(<span class="number">255</span>, Max(<span class="number">0</span>, Multiply(Exp(Multiply(gamma, Log(Divide(channel, <span class="number">255</span>)))), <span class="number">255</span>)))  </span><br><span class="line">  </span><br><span class="line">corrected = RGBA(g(Red(img), gamma), g(Green(img), gamma), g(Blue(img), gamma)).asImage()  </span><br><span class="line">  </span><br><span class="line">ImgLib.wrap(corrected).show()</span><br></pre></td></tr></table></figure></p>
<h2 id="通过高斯差寻找、计数和显示三维stack中的cell"><a href="#通过高斯差寻找、计数和显示三维stack中的cell" class="headerlink" title="通过高斯差寻找、计数和显示三维stack中的cell"></a>通过高斯差寻找、计数和显示三维stack中的cell</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Load an image of the Drosophila larval fly brain and segment  </span></span><br><span class="line"><span class="comment"># the 5-micron diameter cells present in the red channel.  </span></span><br><span class="line">  </span><br><span class="line"><span class="keyword">from</span> script.imglib.analysis <span class="keyword">import</span> DoGPeaks  </span><br><span class="line"><span class="keyword">from</span> script.imglib.color <span class="keyword">import</span> Red  </span><br><span class="line"><span class="keyword">from</span> script.imglib.algorithm <span class="keyword">import</span> Scale2D  </span><br><span class="line"><span class="keyword">from</span> script.imglib.math <span class="keyword">import</span> Compute  </span><br><span class="line"><span class="keyword">from</span> script.imglib <span class="keyword">import</span> ImgLib  </span><br><span class="line"><span class="keyword">from</span> ij3d <span class="keyword">import</span> Image3DUniverse  </span><br><span class="line"><span class="keyword">from</span> javax.vecmath <span class="keyword">import</span> Color3f, Point3f  </span><br><span class="line"><span class="keyword">from</span> ij <span class="keyword">import</span> IJ  </span><br><span class="line">  </span><br><span class="line">cell_diameter = <span class="number">5</span>  <span class="comment"># in microns  </span></span><br><span class="line">minPeak = <span class="number">40</span> <span class="comment"># The minimum intensity for a peak to be considered so.  </span></span><br><span class="line">imp = IJ.openImage(<span class="string">&quot;http://samples.fiji.sc/first-instar-brain.zip&quot;</span>)  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># Scale the X,Y axis down to isotropy with the Z axis  </span></span><br><span class="line">cal = imp.getCalibration()  </span><br><span class="line">scale2D = cal.pixelWidth / cal.pixelDepth  </span><br><span class="line">iso = Compute.inFloats(Scale2D(Red(ImgLib.wrap(imp)), scale2D))  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># Find peaks by difference of Gaussian  </span></span><br><span class="line">sigma = (cell_diameter  / cal.pixelWidth) * scale2D  </span><br><span class="line">peaks = DoGPeaks(iso, sigma, sigma * <span class="number">0.5</span>, minPeak, <span class="number">1</span>)  </span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;Found&quot;</span>, <span class="built_in">len</span>(peaks), <span class="string">&quot;peaks&quot;</span>  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># Convert the peaks into points in calibrated image space  </span></span><br><span class="line">ps = []  </span><br><span class="line"><span class="keyword">for</span> peak <span class="keyword">in</span> peaks:  </span><br><span class="line">  p = Point3f(peak)  </span><br><span class="line">  p.scale(cal.pixelWidth * <span class="number">1</span>/scale2D)  </span><br><span class="line">  ps.append(p)  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># Show the peaks as spheres in 3D, along with orthoslices:  </span></span><br><span class="line">univ = Image3DUniverse(<span class="number">512</span>, <span class="number">512</span>)  </span><br><span class="line">univ.addIcospheres(ps, Color3f(<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>), <span class="number">2</span>, cell_diameter/<span class="number">2</span>, <span class="string">&quot;Cells&quot;</span>).setLocked(<span class="literal">True</span>)  </span><br><span class="line">univ.addOrthoslice(imp).setLocked(<span class="literal">True</span>)  </span><br><span class="line">univ.show()  </span><br></pre></td></tr></table></figure>
<h1 id="ImgLib2：编写通用且高性能的图像处理程序"><a href="#ImgLib2：编写通用且高性能的图像处理程序" class="headerlink" title="ImgLib2：编写通用且高性能的图像处理程序"></a>ImgLib2：编写通用且高性能的图像处理程序</h1><p>ImgLib2是一个非常强大的图像处理库：</p>
<ul>
<li>它的介绍在<a target="_blank" rel="noopener" href="https://academic.oup.com/bioinformatics/article/28/22/3009/240540">这篇论文</a>中</li>
<li>GitHub库在<a target="_blank" rel="noopener" href="https://github.com/imglib/imglib2">这里</a></li>
<li>ImageJ官网上关于ImgLib2的<a target="_blank" rel="noopener" href="https://imagej.net/ImgLib2_Examples">教学例子</a></li>
</ul>
<h2 id="ImgLib2对于图像的Views"><a href="#ImgLib2对于图像的Views" class="headerlink" title="ImgLib2对于图像的Views"></a>ImgLib2对于图像的Views</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> ij <span class="keyword">import</span> IJ  </span><br><span class="line"><span class="keyword">from</span> net.imglib2.img.display.imagej <span class="keyword">import</span> ImageJFunctions <span class="keyword">as</span> IL  </span><br><span class="line"><span class="keyword">from</span> net.imglib2.view <span class="keyword">import</span> Views  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># Load an image (of any dimensions) such as the clown sample image  </span></span><br><span class="line">imp = IJ.getImage()  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># Convert to 8-bit if it isn&#x27;t yet, using macros  </span></span><br><span class="line">IJ.run(imp, <span class="string">&quot;8-bit&quot;</span>, <span class="string">&quot;&quot;</span>)  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># Access its pixel data from an ImgLib2 RandomAccessibleInterval  </span></span><br><span class="line">img = IL.wrapReal(imp)  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># View as an infinite image, with a value of zero beyond the image edges  </span></span><br><span class="line">imgE = Views.extendZero(img)  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># Limit the infinite image with an interval twice as large as the original,  </span></span><br><span class="line"><span class="comment"># so that the original image remains at the center.  </span></span><br><span class="line"><span class="comment"># It starts at minus half the image width, and ends at 1.5x the image width.  </span></span><br><span class="line">minC = [<span class="built_in">int</span>(-<span class="number">0.5</span> * img.dimension(i)) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(img.numDimensions())]  </span><br><span class="line">maxC = [<span class="built_in">int</span>( <span class="number">1.5</span> * img.dimension(i)) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(img.numDimensions())]  </span><br><span class="line">imgL = Views.interval(imgE, minC, maxC)  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># Visualize the enlarged canvas, so to speak  </span></span><br><span class="line">imp2 = IL.wrap(imgL, imp.getTitle() + <span class="string">&quot; - enlarged canvas&quot;</span>) <span class="comment"># an ImagePlus  </span></span><br><span class="line">imp2.show()</span><br></pre></td></tr></table></figure>
<p>对上面的图片的边缘进行填充：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">imgE = Views.extendMirrorSingle(img)  </span><br><span class="line">imgL = Views.interval(imgE, minC, maxC)  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># Visualize the enlarged canvas, so to speak  </span></span><br><span class="line">imp2 = IL.wrap(imgL, imp.getTitle() + <span class="string">&quot; - enlarged canvas&quot;</span>) <span class="comment"># an ImagePlus  </span></span><br><span class="line">imp2.show()  </span><br></pre></td></tr></table></figure></p>
<h2 id="ImgLib2的高斯差分检测"><a href="#ImgLib2的高斯差分检测" class="headerlink" title="ImgLib2的高斯差分检测"></a>ImgLib2的高斯差分检测</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">from ij <span class="keyword">import</span> IJ  </span><br><span class="line">from ij.gui <span class="keyword">import</span> PointRoi  </span><br><span class="line">from ij.measure <span class="keyword">import</span> ResultsTable  </span><br><span class="line">from net.imglib2.img.display.imagej <span class="keyword">import</span> ImageJFunctions as IL  </span><br><span class="line">from net.imglib2.view <span class="keyword">import</span> Views  </span><br><span class="line">from net.imglib2.algorithm.dog <span class="keyword">import</span> DogDetection  </span><br><span class="line">from jarray <span class="keyword">import</span> zeros  </span><br><span class="line">  </span><br><span class="line"># Load a greyscale single-channel image: the <span class="string">&quot;Embryos&quot;</span> sample image  </span><br><span class="line">imp = IJ.<span class="built_in">openImage</span>(<span class="string">&quot;https://imagej.nih.gov/ij/images/embryos.jpg&quot;</span>)  </span><br><span class="line"># Convert it to <span class="number">8</span>-bit  </span><br><span class="line">IJ.<span class="built_in">run</span>(imp, <span class="string">&quot;8-bit&quot;</span>, <span class="string">&quot;&quot;</span>)  </span><br><span class="line">  </span><br><span class="line"># Access its pixel data from an ImgLib2 data structure: a RandomAccessibleInterval  </span><br><span class="line">img = IL.<span class="built_in">wrapReal</span>(imp)  </span><br><span class="line">  </span><br><span class="line"># View as an infinite image, mirrored at the edges which is ideal <span class="keyword">for</span> Gaussians  </span><br><span class="line">imgE = Views.<span class="built_in">extendMirrorSingle</span>(img)  </span><br><span class="line">  </span><br><span class="line"># Parameters <span class="keyword">for</span> a Difference of Gaussian to detect embryo positions  </span><br><span class="line">calibration = [<span class="number">1.0</span> <span class="keyword">for</span> i in <span class="built_in">range</span>(img.<span class="built_in">numDimensions</span>())] <span class="meta"># no calibration: identity  </span></span><br><span class="line">sigmaSmaller = <span class="number">15</span> <span class="meta"># in pixels: a quarter of the radius of an embryo  </span></span><br><span class="line">sigmaLarger = <span class="number">30</span>  <span class="meta"># pixels: half the radius of an embryo  </span></span><br><span class="line">extremaType = DogDetection.ExtremaType.MAXIMA  </span><br><span class="line">minPeakValue = <span class="number">10</span>  </span><br><span class="line">normalizedMinPeakValue = False  </span><br><span class="line">  </span><br><span class="line"># In the differece of gaussian peak detection, the img acts as the interval  </span><br><span class="line"><span class="meta"># within which to look for peaks. The processing is done on the infinite imgE.  </span></span><br><span class="line">dog = <span class="built_in">DogDetection</span>(imgE, img, calibration, sigmaSmaller, sigmaLarger,  </span><br><span class="line">  extremaType, minPeakValue, normalizedMinPeakValue)  </span><br><span class="line">  </span><br><span class="line">peaks = dog.<span class="built_in">getPeaks</span>()  </span><br><span class="line">  </span><br><span class="line"># Create a PointRoi from the DoG peaks, <span class="keyword">for</span> visualization  </span><br><span class="line">roi = <span class="built_in">PointRoi</span>(<span class="number">0</span>, <span class="number">0</span>)  </span><br><span class="line"># A temporary array of integers, one per dimension the image has  </span><br><span class="line">p = <span class="built_in">zeros</span>(img.<span class="built_in">numDimensions</span>(), <span class="string">&#x27;i&#x27;</span>)  </span><br><span class="line"># Load every peak as a point in the PointRoi  </span><br><span class="line"><span class="keyword">for</span> peak in peaks:  </span><br><span class="line">  # Read peak coordinates into an array of integers  </span><br><span class="line">  peak.<span class="built_in">localize</span>(p)  </span><br><span class="line">  roi.<span class="built_in">addPoint</span>(imp, p[<span class="number">0</span>], p[<span class="number">1</span>])  </span><br><span class="line">  </span><br><span class="line">imp.<span class="built_in">setRoi</span>(roi)  </span><br><span class="line">  </span><br><span class="line"># Now, iterate each peak, defining a small interval centered at each peak,  </span><br><span class="line"><span class="meta"># and measure the sum of total pixel intensity,  </span></span><br><span class="line"><span class="meta"># and display the results in an ImageJ ResultTable.  </span></span><br><span class="line">table = <span class="built_in">ResultsTable</span>()  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">for</span> peak in peaks:  </span><br><span class="line">  # Read peak coordinates into an array of integers  </span><br><span class="line">  peak.<span class="built_in">localize</span>(p)  </span><br><span class="line">  # Define limits of the interval around the peak:  </span><br><span class="line">  # (sigmaSmaller is half the radius of the embryo)  </span><br><span class="line">  minC = [p[i] - sigmaSmaller <span class="keyword">for</span> i in <span class="built_in">range</span>(img.<span class="built_in">numDimensions</span>())]  </span><br><span class="line">  maxC = [p[i] + sigmaSmaller <span class="keyword">for</span> i in <span class="built_in">range</span>(img.<span class="built_in">numDimensions</span>())]  </span><br><span class="line">  # View the interval around the peak, as a flat <span class="built_in">iterable</span> (like an array)  </span><br><span class="line">  fov = Views.<span class="built_in">interval</span>(img, minC, maxC)  </span><br><span class="line">  # Compute sum of pixel intensity values of the interval  </span><br><span class="line">  # (The t is the Type that mediates access to the pixels, via its get* methods)  </span><br><span class="line">  s = <span class="built_in">sum</span>(t.<span class="built_in">getInteger</span>() <span class="keyword">for</span> t in fov)  </span><br><span class="line">  # Add to results table  </span><br><span class="line">  table.<span class="built_in">incrementCounter</span>()  </span><br><span class="line">  table.<span class="built_in">addValue</span>(<span class="string">&quot;x&quot;</span>, p[<span class="number">0</span>])  </span><br><span class="line">  table.<span class="built_in">addValue</span>(<span class="string">&quot;y&quot;</span>, p[<span class="number">1</span>])  </span><br><span class="line">  table.<span class="built_in">addValue</span>(<span class="string">&quot;sum&quot;</span>, s)  </span><br><span class="line">  </span><br><span class="line">table.<span class="built_in">show</span>(<span class="string">&quot;Embryo intensities at peaks&quot;</span>)  </span><br></pre></td></tr></table></figure>
<p>此时会得到一个table。有两种方法来将table中的data存入一个CSV文件中：<br>第一种是直接在Table窗口中，点击File-Save，这是最简单的方式了。<br>第二种是使用python内置的csv库，在上面的代码中加入以下代码：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> with_statement  </span><br><span class="line"><span class="comment"># IMPORTANT: imports from __future__ must go at the top of the file.  </span></span><br><span class="line">  </span><br><span class="line"><span class="comment">#  </span></span><br><span class="line"><span class="comment"># ... same code as above here to obtain the peaks  </span></span><br><span class="line"><span class="comment">#  </span></span><br><span class="line">  </span><br><span class="line"><span class="keyword">from</span> operator <span class="keyword">import</span> add  </span><br><span class="line"><span class="keyword">import</span> csv  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># The minumum and maximum coordinates, for each image dimension,  </span></span><br><span class="line"><span class="comment"># defining an interval within which pixel values will be summed.  </span></span><br><span class="line">minC = [-sigmaSmaller <span class="keyword">for</span> i <span class="keyword">in</span> xrange(img.numDimensions())]  </span><br><span class="line">maxC = [ sigmaSmaller <span class="keyword">for</span> i <span class="keyword">in</span> xrange(img.numDimensions())]  </span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">centerAt</span>(<span class="params">p, minC, maxC</span>):</span>  </span><br><span class="line">  <span class="string">&quot;&quot;&quot; Translate the minC, maxC coordinate bounds to the peak. &quot;&quot;&quot;</span>  </span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">map</span>(add, p, minC), <span class="built_in">map</span>(add, p, maxC)  </span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">peakData</span>(<span class="params">peaks, p, minC, maxC</span>):</span>  </span><br><span class="line">  <span class="string">&quot;&quot;&quot; A generator function that returns all peaks and their pixel sum, </span></span><br><span class="line"><span class="string">      one at a time. &quot;&quot;&quot;</span>  </span><br><span class="line">  <span class="keyword">for</span> peak <span class="keyword">in</span> peaks:  </span><br><span class="line">    peak.localize(p)  </span><br><span class="line">    minCoords, maxCoords = centerAt(p, minC, maxC)  </span><br><span class="line">    fov = Views.interval(img, minCoords, maxCoords)  </span><br><span class="line">    s = <span class="built_in">sum</span>(t.getInteger() <span class="keyword">for</span> t <span class="keyword">in</span> fov)  </span><br><span class="line">    <span class="keyword">yield</span> p, s  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># Save as CSV file  </span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;/tmp/peaks.csv&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> csvfile:  </span><br><span class="line">  w = csv.writer(csvfile, delimiter=<span class="string">&#x27;,&#x27;</span>, quotechar=<span class="string">&#x27;&quot;&#x27;</span><span class="string">&#x27;&quot;&#x27;</span>, quoting=csv.QUOTE_NONNUMERIC) </span><br><span class="line">  w.writerow([<span class="string">&#x27;x&#x27;</span>, <span class="string">&#x27;y&#x27;</span>, <span class="string">&#x27;sum&#x27;</span>]) </span><br><span class="line">  <span class="keyword">for</span> p, s <span class="keyword">in</span> peakData(peaks, p, minC, maxC): </span><br><span class="line">    w.writerow([p[<span class="number">0</span>], p[<span class="number">1</span>], s]) </span><br><span class="line"> </span><br><span class="line"><span class="comment"># Read the CSV file into an ROI </span></span><br><span class="line">roi = PointRoi(<span class="number">0</span>, <span class="number">0</span>) </span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;/tmp/peaks.csv&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> csvfile: </span><br><span class="line">  reader = csv.reader(csvfile, delimiter=<span class="string">&#x27;,&#x27;</span>, quotechar=<span class="string">&#x27;&quot;&#x27;</span>)  </span><br><span class="line">  header = reader.<span class="built_in">next</span>() <span class="comment"># advance reader by one line  </span></span><br><span class="line">  <span class="keyword">for</span> x, y, s <span class="keyword">in</span> reader:  </span><br><span class="line">    roi.addPoint(imp, <span class="built_in">float</span>(x), <span class="built_in">float</span>(y))  </span><br><span class="line">  </span><br><span class="line">imp.show()  </span><br><span class="line">imp.setRoi(roi)  </span><br></pre></td></tr></table></figure></p>
<h2 id="使用ImgLib2进行图像变换"><a href="#使用ImgLib2进行图像变换" class="headerlink" title="使用ImgLib2进行图像变换"></a>使用ImgLib2进行图像变换</h2><p>以下是使用ImgLib2进行图像变换，如平移、旋转、缩放等。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> net.imglib2.realtransform <span class="keyword">import</span> RealViews <span class="keyword">as</span> RV  </span><br><span class="line"><span class="keyword">from</span> net.imglib2.img.display.imagej <span class="keyword">import</span> ImageJFunctions <span class="keyword">as</span> IL  </span><br><span class="line"><span class="keyword">from</span> net.imglib2.realtransform <span class="keyword">import</span> Scale  </span><br><span class="line"><span class="keyword">from</span> net.imglib2.view <span class="keyword">import</span> Views  </span><br><span class="line"><span class="keyword">from</span> net.imglib2.interpolation.randomaccess <span class="keyword">import</span> NLinearInterpolatorFactory  </span><br><span class="line"><span class="keyword">from</span> ij <span class="keyword">import</span> IJ  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># Load an image (of any dimensions)  </span></span><br><span class="line">imp = IJ.getImage()  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># Access its pixel data as an ImgLib2 RandomAccessibleInterval  </span></span><br><span class="line">img = IL.wrapReal(imp)  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># View as an infinite image, with a value of zero beyond the image edges  </span></span><br><span class="line">imgE = Views.extendZero(img)  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># View the pixel data as a RealRandomAccessible  </span></span><br><span class="line"><span class="comment"># (that is, accessible with sub-pixel precision)  </span></span><br><span class="line"><span class="comment"># by using an interpolator  </span></span><br><span class="line">imgR = Views.interpolate(imgE, NLinearInterpolatorFactory())  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># Obtain a view of the 2D image twice as big  </span></span><br><span class="line">s = [<span class="number">2.0</span> <span class="keyword">for</span> d <span class="keyword">in</span> <span class="built_in">range</span>(img.numDimensions())] <span class="comment"># as many 2.0 as image dimensions  </span></span><br><span class="line">bigger = RV.transform(imgR, Scale(s))  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># Define the interval we want to see: the original image, enlarged by 2X  </span></span><br><span class="line"><span class="comment"># E.g. from 0 to 2*width, from 0 to 2*height, etc. for every dimension  </span></span><br><span class="line">minC = [<span class="number">0</span> <span class="keyword">for</span> d <span class="keyword">in</span> <span class="built_in">range</span>(img.numDimensions())]  </span><br><span class="line">maxC = [<span class="built_in">int</span>(img.dimension(i) * scale) <span class="keyword">for</span> i, scale <span class="keyword">in</span> <span class="built_in">enumerate</span>(s)]  </span><br><span class="line">imgI = Views.interval(bigger, minC, maxC)  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># Visualize the bigger view  </span></span><br><span class="line">imp2x = IL.wrap(imgI, imp.getTitle() + <span class="string">&quot; - 2X&quot;</span>) <span class="comment"># an ImagePlus  </span></span><br><span class="line">imp2x.show()  </span><br></pre></td></tr></table></figure></p>
<h2 id="使用ImgLib2旋转图片"><a href="#使用ImgLib2旋转图片" class="headerlink" title="使用ImgLib2旋转图片"></a>使用ImgLib2旋转图片</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> net.imglib2.realtransform <span class="keyword">import</span> RealViews <span class="keyword">as</span> RV  </span><br><span class="line"><span class="keyword">from</span> net.imglib2.realtransform <span class="keyword">import</span> AffineTransform  </span><br><span class="line"><span class="keyword">from</span> net.imglib2.img.display.imagej <span class="keyword">import</span> ImageJFunctions <span class="keyword">as</span> IL  </span><br><span class="line"><span class="keyword">from</span> ij <span class="keyword">import</span> IJ  </span><br><span class="line"><span class="keyword">from</span> net.imglib2.view <span class="keyword">import</span> Views  </span><br><span class="line"><span class="keyword">from</span> net.imglib2.interpolation.randomaccess <span class="keyword">import</span> NLinearInterpolatorFactory  </span><br><span class="line"><span class="keyword">from</span> java.awt.geom <span class="keyword">import</span> AffineTransform <span class="keyword">as</span> Affine2D  </span><br><span class="line"><span class="keyword">from</span> java.awt <span class="keyword">import</span> Rectangle  </span><br><span class="line"><span class="keyword">from</span> Jama <span class="keyword">import</span> Matrix  </span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> radians  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># Load an image (of any dimensions)  </span></span><br><span class="line">imp = IJ.getImage()  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># Access its pixel data as an ImgLib2 RandomAccessibleInterval  </span></span><br><span class="line">img = IL.wrapReal(imp)  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># View as an infinite image, with value zero beyond the image edges  </span></span><br><span class="line">imgE = Views.extendZero(img)  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># View the pixel data as a RealRandomAccessible  </span></span><br><span class="line"><span class="comment"># (that is, accessible with sub-pixel precision)  </span></span><br><span class="line"><span class="comment"># by using an interpolator  </span></span><br><span class="line">imgR = Views.interpolate(imgE, NLinearInterpolatorFactory())  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># Define a rotation by +30 degrees relative to the image center in the XY axes  </span></span><br><span class="line"><span class="comment"># (not explicitly XY but the first two dimensions)  </span></span><br><span class="line"><span class="comment"># by filling in a rotation matrix with values taken  </span></span><br><span class="line"><span class="comment"># from a java.awt.geom.AffineTransform (aliased as Affine2D)  </span></span><br><span class="line"><span class="comment"># and by filling in the rest of the diagonal with 1.0  </span></span><br><span class="line"><span class="comment"># (for the case where the image has more than 2 dimensions)  </span></span><br><span class="line">angle = radians(<span class="number">30</span>)  </span><br><span class="line">rot2d = Affine2D.getRotateInstance(  </span><br><span class="line">  angle, img.dimension(<span class="number">0</span>) / <span class="number">2</span>, img.dimension(<span class="number">1</span>) / <span class="number">2</span>)  </span><br><span class="line">ndims = img.numDimensions()  </span><br><span class="line">matrix = Matrix(ndims, ndims + <span class="number">1</span>)  </span><br><span class="line">matrix.<span class="built_in">set</span>(<span class="number">0</span>, <span class="number">0</span>, rot2d.getScaleX())  </span><br><span class="line">matrix.<span class="built_in">set</span>(<span class="number">0</span>, <span class="number">1</span>, rot2d.getShearX())  </span><br><span class="line">matrix.<span class="built_in">set</span>(<span class="number">0</span>, ndims, rot2d.getTranslateX())  </span><br><span class="line">matrix.<span class="built_in">set</span>(<span class="number">1</span>, <span class="number">0</span>, rot2d.getShearY())  </span><br><span class="line">matrix.<span class="built_in">set</span>(<span class="number">1</span>, <span class="number">1</span>, rot2d.getScaleY())  </span><br><span class="line">matrix.<span class="built_in">set</span>(<span class="number">1</span>, ndims, rot2d.getTranslateY())  </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>, img.numDimensions()):  </span><br><span class="line">  matrix.<span class="built_in">set</span>(i, i, <span class="number">1.0</span>)  </span><br><span class="line">  </span><br><span class="line"><span class="built_in">print</span> matrix.getArray()  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># Define a rotated view of the image  </span></span><br><span class="line">rotated = RV.transform(imgR, AffineTransform(matrix))  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># View the image rotated, without enlarging the canvas  </span></span><br><span class="line"><span class="comment"># so we define the interval as the original image dimensions.  </span></span><br><span class="line"><span class="comment"># (Notice the -1 on the max coordinate: the interval is inclusive)  </span></span><br><span class="line">minC = [<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(img.numDimensions())]  </span><br><span class="line">maxC = [img.dimension(i) -<span class="number">1</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(img.numDimensions())]  </span><br><span class="line">imgRot2d = IL.wrap(Views.interval(rotated, minC, maxC),  </span><br><span class="line">  imp.getTitle() + <span class="string">&quot; - rot2d&quot;</span>)  </span><br><span class="line">imgRot2d.show()  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># View the image rotated, enlarging the interval to fit it.  </span></span><br><span class="line"><span class="comment"># (This is akin to enlarging the canvas.)  </span></span><br><span class="line"><span class="comment"># We compute the bounds of the enlarged canvas by transforming a rectangle,  </span></span><br><span class="line"><span class="comment"># then define the interval min and max coordinates by subtracting  </span></span><br><span class="line"><span class="comment"># and adding as appropriate to exactly capture the complete rotated image.  </span></span><br><span class="line"><span class="comment"># Notice the min coordinates have negative values, as the rotated image  </span></span><br><span class="line"><span class="comment"># has pixels now somewhere to the left and up from the top-left 0,0 origin  </span></span><br><span class="line"><span class="comment"># of coordinates.  </span></span><br><span class="line">bounds = rot2d.createTransformedShape(  </span><br><span class="line">  Rectangle(img.dimension(<span class="number">0</span>), img.dimension(<span class="number">1</span>))).getBounds()  </span><br><span class="line">minC[<span class="number">0</span>] = (img.dimension(<span class="number">0</span>) - bounds.width) / <span class="number">2</span>  </span><br><span class="line">minC[<span class="number">1</span>] = (img.dimension(<span class="number">1</span>) - bounds.height) / <span class="number">2</span>  </span><br><span class="line">maxC[<span class="number">0</span>] += <span class="built_in">abs</span>(minC[<span class="number">0</span>]) -<span class="number">1</span> <span class="comment"># -1 because its inclusive  </span></span><br><span class="line">maxC[<span class="number">1</span>] += <span class="built_in">abs</span>(minC[<span class="number">1</span>]) -<span class="number">1</span>  </span><br><span class="line">imgRot2dFit = IL.wrap(Views.interval(rotated, minC, maxC),  </span><br><span class="line">  imp.getTitle() + <span class="string">&quot; - rot2dFit&quot;</span>)  </span><br><span class="line">imgRot2dFit.show()  </span><br></pre></td></tr></table></figure>
<h2 id="使用ImgLib2处理RGB和ARGB图片"><a href="#使用ImgLib2处理RGB和ARGB图片" class="headerlink" title="使用ImgLib2处理RGB和ARGB图片"></a>使用ImgLib2处理RGB和ARGB图片</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> net.imglib2.converter <span class="keyword">import</span> Converters  </span><br><span class="line"><span class="keyword">from</span> net.imglib2.view <span class="keyword">import</span> Views  </span><br><span class="line"><span class="keyword">from</span> net.imglib2.img.display.imagej <span class="keyword">import</span> ImageJFunctions <span class="keyword">as</span> IL  </span><br><span class="line"><span class="keyword">from</span> ij <span class="keyword">import</span> IJ  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># # Load an RGB or ARGB image  </span></span><br><span class="line">imp = IJ.getImage()  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># Access its pixel data from an ImgLib2 data structure:  </span></span><br><span class="line"><span class="comment"># a RandomAccessibleInterval&lt;argbtype&gt;  </span></span><br><span class="line">img = IL.wrapRGBA(imp)  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># Convert an ARGB image to a stack of 4 channels: a RandomAccessibleInterval&lt;unsignedbyte&gt;  </span></span><br><span class="line"><span class="comment"># with one more dimension that before.  </span></span><br><span class="line"><span class="comment"># The order of channels in the stack can be changed by changing their indices.  </span></span><br><span class="line">channels = Converters.argbChannels(img, [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># Equivalent to ImageJ&#x27;s CompositeImage: channels are separate  </span></span><br><span class="line">impChannels = IL.wrap(channels, imp.getTitle() + <span class="string">&quot; channels&quot;</span>)  </span><br><span class="line">impChannels.show()  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># Read out a single channel directly  </span></span><br><span class="line">red = Converters.argbChannel(img, <span class="number">1</span>)  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># Alternatively, pick a view of the red channel in the channels stack.  </span></span><br><span class="line"><span class="comment"># Takes the last dimension, which are the channels,  </span></span><br><span class="line"><span class="comment"># and fixes it to just one: that of the red channel (1) in the stack.  </span></span><br><span class="line">red = Views.hyperSlice(channels, channels.numDimensions() -<span class="number">1</span>, <span class="number">1</span>)  </span><br><span class="line">  </span><br><span class="line">impRed = IL.wrap(red, imp.getTitle() + <span class="string">&quot; red channel&quot;</span>)  </span><br><span class="line">impRed.show()</span><br></pre></td></tr></table></figure>
<h2 id="Image-Calculator：在两张或多张图片间进行逐像素操作"><a href="#Image-Calculator：在两张或多张图片间进行逐像素操作" class="headerlink" title="Image Calculator：在两张或多张图片间进行逐像素操作"></a>Image Calculator：在两张或多张图片间进行逐像素操作</h2><p>ImageJ有一个内置的命令，叫Image Calculator，在Process- Image Calculator下，可以对两张图片进行数学操作，比如从一张图片中减去另一张。</p>

    </div>

    
    
    
        <div class="reward-container">
  <div></div>
  <button onclick="var qr = document.getElementById('qr'); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    Donate
  </button>
  <div id="qr" style="display: none;">
      
      <div style="display: inline-block;">
        <img src="/images/wechat_reward.png" alt="Xin-Bo Qi(亓欣波) WeChat Pay">
        <p>WeChat Pay</p>
      </div>

  </div>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/ImageJ/" rel="tag"># ImageJ</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2018/09/11/imagej-ui-menu-window-help/" rel="prev" title="ImageJ 用户指南 -- 11. 菜单栏之Window和Help">
      <i class="fa fa-chevron-left"></i> ImageJ 用户指南 -- 11. 菜单栏之Window和Help
    </a></div>
      <div class="post-nav-item">
    <a href="/2018/09/18/skopt/" rel="next" title="使用skopt贝叶斯搜索寻找scikit-learn中算法的最优超参数">
      使用skopt贝叶斯搜索寻找scikit-learn中算法的最优超参数 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    
  <div class="comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
    </div>
  </div>
  

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%BC%80%E7%AF%87%E8%AF%B4%E6%98%8E"><span class="nav-number">1.</span> <span class="nav-text">开篇说明</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%8A%E6%89%8B"><span class="nav-number">2.</span> <span class="nav-text">上手</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BD%A0%E7%9A%84%E7%AC%AC%E4%B8%80%E4%B8%AAFiji%E8%84%9A%E6%9C%AC"><span class="nav-number">3.</span> <span class="nav-text">你的第一个Fiji脚本</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E6%89%93%E5%BC%80%E7%9A%84%E5%9B%BE%E7%89%87"><span class="nav-number">3.1.</span> <span class="nav-text">获取打开的图片</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%80%9A%E8%BF%87%E4%B8%80%E4%B8%AA%E6%96%87%E4%BB%B6%E5%AF%B9%E8%AF%9D%E6%A1%86%E4%BF%9D%E5%AD%98%E5%9B%BE%E5%83%8F"><span class="nav-number">3.2.</span> <span class="nav-text">通过一个文件对话框保存图像</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B0%86%E5%9B%BE%E5%83%8F%E7%9B%B4%E6%8E%A5%E5%86%99%E5%85%A5%E6%96%87%E4%BB%B6"><span class="nav-number">3.3.</span> <span class="nav-text">将图像直接写入文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BF%9D%E5%AD%98%E6%96%87%E4%BB%B6%E6%97%B6%E4%BA%8B%E5%85%88%E6%A3%80%E6%9F%A5%E8%B7%AF%E5%BE%84%E5%92%8C%E6%96%87%E4%BB%B6"><span class="nav-number">3.4.</span> <span class="nav-text">保存文件时事先检查路径和文件</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%8E%A2%E7%A9%B6%E5%9B%BE%E5%83%8F%E7%9A%84%E5%B1%9E%E6%80%A7%E5%92%8C%E5%83%8F%E7%B4%A0"><span class="nav-number">4.</span> <span class="nav-text">探究图像的属性和像素</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BE%93%E5%87%BA%E5%9B%BE%E7%89%87%E5%9F%BA%E6%9C%AC%E4%BF%A1%E6%81%AF"><span class="nav-number">4.1.</span> <span class="nav-text">输出图片基本信息</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%8E%B7%E5%BE%97%E5%9B%BE%E5%83%8F%E7%9A%84%E5%83%8F%E7%B4%A0%E7%BB%9F%E8%AE%A1"><span class="nav-number">4.2.</span> <span class="nav-text">获得图像的像素统计</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%83%8F%E7%B4%A0%E8%BF%AD%E4%BB%A3"><span class="nav-number">4.3.</span> <span class="nav-text">像素迭代</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AF%B9%E5%88%97%E8%A1%A8%E6%88%96%E9%9B%86%E5%90%88%E7%9A%84%E8%BF%AD%E4%BB%A3%E6%88%96%E5%BE%AA%E7%8E%AF%E6%93%8D%E4%BD%9C"><span class="nav-number">4.4.</span> <span class="nav-text">对列表或集合的迭代或循环操作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#map%E6%93%8D%E4%BD%9C"><span class="nav-number">4.4.1.</span> <span class="nav-text">map操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#filter%E6%93%8D%E4%BD%9C"><span class="nav-number">4.4.2.</span> <span class="nav-text">filter操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#reduce%E6%93%8D%E4%BD%9C"><span class="nav-number">4.4.3.</span> <span class="nav-text">reduce操作</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AF%B9%E6%AF%8F%E4%B8%80%E4%B8%AA%E5%83%8F%E7%B4%A0%E5%87%8F%E5%8E%BB%E6%9C%80%E5%B0%8F%E5%80%BC"><span class="nav-number">4.5.</span> <span class="nav-text">对每一个像素减去最小值</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B0%86%E5%83%8F%E7%B4%A0%E5%88%97%E8%A1%A8%E6%A6%82%E6%8B%AC%E4%B8%BA%E5%8D%95%E5%80%BC"><span class="nav-number">4.6.</span> <span class="nav-text">将像素列表概括为单值</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%9F%E8%AE%A1%E5%9C%A8%E9%98%88%E5%80%BC%E4%BB%A5%E4%B8%8A%E7%9A%84%E5%83%8F%E7%B4%A0%E4%B8%AA%E6%95%B0"><span class="nav-number">4.6.1.</span> <span class="nav-text">统计在阈值以上的像素个数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%9F%E8%AE%A1%E5%9C%A8%E9%98%88%E5%80%BC%E4%BB%A5%E4%B8%8A%E7%9A%84%E6%89%80%E6%9C%89%E5%83%8F%E7%B4%A0%E7%9A%84%E5%9D%90%E6%A0%87%EF%BC%8C%E5%B9%B6%E8%AE%A1%E7%AE%97%E9%87%8D%E5%BF%83"><span class="nav-number">4.6.2.</span> <span class="nav-text">统计在阈值以上的所有像素的坐标，并计算重心</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%BF%90%E8%A1%8CImageJ-Fiji%E6%8F%92%E4%BB%B6"><span class="nav-number">5.</span> <span class="nav-text">运行ImageJ&#x2F;Fiji插件</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9F%A5%E6%89%BE%E5%93%AA%E4%B8%AA%E7%B1%BB%E7%94%A8%E4%BA%86%E5%93%AA%E4%B8%AA%E6%8F%92%E4%BB%B6"><span class="nav-number">5.1.</span> <span class="nav-text">查找哪个类用了哪个插件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9F%A5%E6%89%BE%E6%8F%92%E4%BB%B6%E6%89%80%E9%9C%80%E8%A6%81%E7%9A%84%E5%8F%82%E6%95%B0"><span class="nav-number">5.2.</span> <span class="nav-text">查找插件所需要的参数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BF%90%E8%A1%8C%E5%91%BD%E4%BB%A4command"><span class="nav-number">5.3.</span> <span class="nav-text">运行命令command</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E5%9B%BE%E5%83%8F%E5%8F%8A%E5%85%B6ROI"><span class="nav-number">6.</span> <span class="nav-text">创建图像及其ROI</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E5%88%9B%E5%BB%BA%E4%B8%80%E5%BC%A0%E5%9B%BE%E5%83%8F"><span class="nav-number">6.1.</span> <span class="nav-text">从零开始创建一张图像</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%94%A8%E7%BB%99%E5%AE%9A%E5%80%BC%E5%A1%AB%E5%85%85%E4%B8%80%E4%B8%AAROI"><span class="nav-number">6.2.</span> <span class="nav-text">用给定值填充一个ROI</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E5%92%8C%E6%93%8D%E4%BD%9C%E5%9B%BE%E5%83%8F%E7%9A%84stacks%E5%92%8Chyperstacks"><span class="nav-number">7.</span> <span class="nav-text">创建和操作图像的stacks和hyperstacks</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8A%A0%E8%BD%BD%E4%B8%80%E5%BC%A0%E5%A4%9A%E5%BD%A9%E5%9B%BE%E5%83%8Fstack%E5%B9%B6%E6%8F%90%E5%8F%96%E7%BB%BF%E8%89%B2%E9%80%9A%E9%81%93"><span class="nav-number">7.1.</span> <span class="nav-text">加载一张多彩图像stack并提取绿色通道</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B0%86%E4%B8%80%E4%B8%AARGB-stack%E8%BD%AC%E6%8D%A2%E4%B8%BA%E5%8F%8C%E9%80%9A%E9%81%93%E7%9A%8432-bit-hyperstack"><span class="nav-number">7.2.</span> <span class="nav-text">将一个RGB stack转换为双通道的32-bit hyperstack</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BA%BA%E6%9C%BA%E4%BA%A4%E4%BA%92%EF%BC%9A%E6%96%87%E4%BB%B6%E5%92%8C%E9%80%89%E9%A1%B9%E5%AF%B9%E8%AF%9D%E6%A1%86%E3%80%81%E6%B6%88%E6%81%AF%E3%80%81%E8%BF%9B%E5%BA%A6%E6%9D%A1"><span class="nav-number">8.</span> <span class="nav-text">人机交互：文件和选项对话框、消息、进度条</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AF%A2%E9%97%AE%E6%89%93%E5%BC%80%E6%96%87%E4%BB%B6%E5%A4%B9"><span class="nav-number">8.1.</span> <span class="nav-text">询问打开文件夹</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AF%A2%E9%97%AE%E6%89%93%E5%BC%80%E6%96%87%E4%BB%B6"><span class="nav-number">8.2.</span> <span class="nav-text">询问打开文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AF%A2%E9%97%AE%E8%BE%93%E5%85%A5%E5%8F%82%E6%95%B0"><span class="nav-number">8.3.</span> <span class="nav-text">询问输入参数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%98%BE%E7%A4%BA%E8%BF%9B%E5%BA%A6%E6%9D%A1"><span class="nav-number">8.4.</span> <span class="nav-text">显示进度条</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%B0%86%E8%84%9A%E6%9C%AC%E8%BD%AC%E6%8D%A2%E4%B8%BA%E6%8F%92%E4%BB%B6"><span class="nav-number">9.</span> <span class="nav-text">将脚本转换为插件</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%88%97%E8%A1%A8%E3%80%81%E5%8E%9F%E7%94%9F%E6%95%B0%E7%BB%84%E5%8F%8A%E4%B8%8EJava%E7%B1%BB%E7%9A%84%E4%BA%A4%E4%BA%92"><span class="nav-number">10.</span> <span class="nav-text">列表、原生数组及与Java类的交互</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Jython%E5%88%97%E8%A1%A8%E4%BB%A5%E5%8F%AA%E8%AF%BB%E6%95%B0%E7%BB%84%E7%9A%84%E5%BD%A2%E5%BC%8F%E4%BC%A0%E7%BB%99Java%E7%B1%BB"><span class="nav-number">10.1.</span> <span class="nav-text">Jython列表以只读数组的形式传给Java类</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E5%8E%9F%E7%94%9F%E6%95%B0%E7%BB%84"><span class="nav-number">10.2.</span> <span class="nav-text">创建原生数组</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8F%AF%E4%BD%9C%E7%94%A8%E4%BA%8E%E4%BB%BB%E6%84%8F%E7%B1%BB%E5%9E%8B%E5%9B%BE%E5%83%8F%E7%9A%84%E9%80%9A%E7%94%A8%E7%AE%97%E6%B3%95%EF%BC%9AImgLib%E5%BA%93"><span class="nav-number">11.</span> <span class="nav-text">可作用于任意类型图像的通用算法：ImgLib库</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AF%B9%E5%9B%BE%E7%89%87%E8%BF%9B%E8%A1%8C%E6%95%B0%E5%AD%A6%E6%93%8D%E4%BD%9C"><span class="nav-number">11.1.</span> <span class="nav-text">对图片进行数学操作</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E5%9B%BE%E5%83%8F%E6%95%B0%E5%AD%A6%E8%BF%9B%E8%A1%8C%E5%B9%B3%E5%9C%BA%E6%A0%A1%E6%AD%A3"><span class="nav-number">11.2.</span> <span class="nav-text">使用图像数学进行平场校正</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8F%90%E5%8F%96%E5%92%8C%E6%93%8D%E7%BA%B5%E5%9B%BE%E5%83%8F%E8%89%B2%E5%BD%A9%E9%80%9A%E9%81%93%EF%BC%9ARGBA%E5%92%8CHSB"><span class="nav-number">11.3.</span> <span class="nav-text">提取和操纵图像色彩通道：RGBA和HSB</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%80%9A%E8%BF%87%E9%AB%98%E6%96%AF%E5%B7%AE%E5%AF%BB%E6%89%BE%E3%80%81%E8%AE%A1%E6%95%B0%E5%92%8C%E6%98%BE%E7%A4%BA%E4%B8%89%E7%BB%B4stack%E4%B8%AD%E7%9A%84cell"><span class="nav-number">11.4.</span> <span class="nav-text">通过高斯差寻找、计数和显示三维stack中的cell</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ImgLib2%EF%BC%9A%E7%BC%96%E5%86%99%E9%80%9A%E7%94%A8%E4%B8%94%E9%AB%98%E6%80%A7%E8%83%BD%E7%9A%84%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86%E7%A8%8B%E5%BA%8F"><span class="nav-number">12.</span> <span class="nav-text">ImgLib2：编写通用且高性能的图像处理程序</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#ImgLib2%E5%AF%B9%E4%BA%8E%E5%9B%BE%E5%83%8F%E7%9A%84Views"><span class="nav-number">12.1.</span> <span class="nav-text">ImgLib2对于图像的Views</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ImgLib2%E7%9A%84%E9%AB%98%E6%96%AF%E5%B7%AE%E5%88%86%E6%A3%80%E6%B5%8B"><span class="nav-number">12.2.</span> <span class="nav-text">ImgLib2的高斯差分检测</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8ImgLib2%E8%BF%9B%E8%A1%8C%E5%9B%BE%E5%83%8F%E5%8F%98%E6%8D%A2"><span class="nav-number">12.3.</span> <span class="nav-text">使用ImgLib2进行图像变换</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8ImgLib2%E6%97%8B%E8%BD%AC%E5%9B%BE%E7%89%87"><span class="nav-number">12.4.</span> <span class="nav-text">使用ImgLib2旋转图片</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8ImgLib2%E5%A4%84%E7%90%86RGB%E5%92%8CARGB%E5%9B%BE%E7%89%87"><span class="nav-number">12.5.</span> <span class="nav-text">使用ImgLib2处理RGB和ARGB图片</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Image-Calculator%EF%BC%9A%E5%9C%A8%E4%B8%A4%E5%BC%A0%E6%88%96%E5%A4%9A%E5%BC%A0%E5%9B%BE%E7%89%87%E9%97%B4%E8%BF%9B%E8%A1%8C%E9%80%90%E5%83%8F%E7%B4%A0%E6%93%8D%E4%BD%9C"><span class="nav-number">12.6.</span> <span class="nav-text">Image Calculator：在两张或多张图片间进行逐像素操作</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Xin-Bo Qi(亓欣波)"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">Xin-Bo Qi(亓欣波)</p>
  <div class="site-description" itemprop="description">Digitize everything to realize Digitalization!</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">146</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">49</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/qixinbo" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;qixinbo" rel="noopener" target="_blank"><i class="github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:qixinbo@gmail.com" title="E-Mail → mailto:qixinbo@gmail.com" rel="noopener" target="_blank"><i class="envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/qixinbo" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;qixinbo" rel="noopener" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
      <span class="links-of-author-item">
        <a href="/atom.xml" title="RSS → &#x2F;atom.xml"><i class="fas fa-rss fa-fw"></i>RSS</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://www.tsinghua.edu.cn/" title="https:&#x2F;&#x2F;www.tsinghua.edu.cn" rel="noopener" target="_blank">THU</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://www.imr.cas.cn/" title="http:&#x2F;&#x2F;www.imr.cas.cn" rel="noopener" target="_blank">IMR</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://www.sdu.edu.cn/" title="http:&#x2F;&#x2F;www.sdu.edu.cn" rel="noopener" target="_blank">SDU</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://liam0205.me/" title="http:&#x2F;&#x2F;liam0205.me&#x2F;" rel="noopener" target="_blank">黄晨成</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Xin-Bo Qi(亓欣波)</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  

<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://qixinbo.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script>
<script>
  var disqus_config = function() {
    this.page.url = "http://qixinbo.github.io/2018/09/15/imagej-python/";
    this.page.identifier = "2018/09/15/imagej-python/";
    this.page.title = "ImageJ的Python脚本编程";
    };
  NexT.utils.loadComments(document.querySelector('#disqus_thread'), () => {
    if (window.DISQUS) {
      DISQUS.reset({
        reload: true,
        config: disqus_config
      });
    } else {
      var d = document, s = d.createElement('script');
      s.src = 'https://qixinbo.disqus.com/embed.js';
      s.setAttribute('data-timestamp', '' + +new Date());
      (d.head || d.body).appendChild(s);
    }
  });
</script>

</body>
</html>
