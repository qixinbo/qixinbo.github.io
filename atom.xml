<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>æ•°å­—æ——æ‰‹</title>
  
  <subtitle>ç”µæ°”åŒ–ã€è‡ªåŠ¨åŒ–ã€æ•°å­—åŒ–ã€æ™ºèƒ½åŒ–ã€æ™ºæ…§åŒ–</subtitle>
  <link href="http://qixinbo.github.io/atom.xml" rel="self"/>
  
  <link href="http://qixinbo.github.io/"/>
  <updated>2022-03-08T03:27:07.540Z</updated>
  <id>http://qixinbo.github.io/</id>
  
  <author>
    <name>Xin-Bo Qi(äº“æ¬£æ³¢)</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>ç”¨Pythonå¼€å‘webåº”ç”¨â€”â€”Streamlitæ¡†æ¶è§£æï¼š1 -- ä¸Šæ‰‹</title>
    <link href="http://qixinbo.github.io/2022/03/08/streamlit_1/"/>
    <id>http://qixinbo.github.io/2022/03/08/streamlit_1/</id>
    <published>2022-03-07T16:00:00.000Z</published>
    <updated>2022-03-08T03:27:07.540Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><p><a href="https://streamlit.io/">Streamlit</a>æ˜¯ä¸€ä¸ªå¼€æºPythonåº“ï¼Œå…¶æ—¨åœ¨ä¸ºæœºå™¨å­¦ä¹ å’Œæ•°æ®ç§‘å­¦é¢†åŸŸç®€å•å¿«é€Ÿåœ°åˆ›å»ºå’Œåˆ†äº«ç¾è§‚çš„ã€å®šåˆ¶åŒ–çš„webåº”ç”¨ã€‚ä½¿ç”¨Streamlitï¼Œç”¨æˆ·ä»…ä»…å‡ åˆ†é’Ÿå³å¯åˆ›å»ºå’Œéƒ¨ç½²å¼ºå¤§çš„æ•°æ®åº”ç”¨ã€‚<br>æˆªå‡ å¼ èŒƒä¾‹çš„ç•Œé¢å›¾ï¼š<br><img src="https://user-images.githubusercontent.com/6218739/157160066-1781000e-b957-4fac-b0df-01d23b3c7f67.png" alt="gallery1"><br><img src="https://user-images.githubusercontent.com/6218739/157160339-5e34e7fc-8886-4bd9-bc18-3e94fff749ce.png" alt="g2"><br><img src="https://user-images.githubusercontent.com/6218739/157160476-7d64aa1a-4c92-4f80-8dd3-5e449fcc56be.png" alt="g3"></p><h1 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h1><p>ä½¿ç”¨pipå®‰è£…ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install streamlit</span><br></pre></td></tr></table></figure></p><p>æµ‹è¯•ä¸€ä¸‹ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">streamlit hello</span><br></pre></td></tr></table></figure><br>æ­¤æ—¶æµè§ˆå™¨ä¼šæ‰“å¼€<code>http://localhost:8501/</code>ï¼Œç„¶åå‡ºç°streamlitå…³äºåŠ¨ç”»ã€åŠ¨æ€ç»˜å›¾ã€åœ°å›¾ã€pandasç»˜å›¾çš„å››ä¸ªdemoã€‚</p><h1 id="æ ¸å¿ƒæ¦‚å¿µ"><a href="#æ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="æ ¸å¿ƒæ¦‚å¿µ"></a>æ ¸å¿ƒæ¦‚å¿µ</h1><h2 id="è¿è¡Œæ–¹å¼"><a href="#è¿è¡Œæ–¹å¼" class="headerlink" title="è¿è¡Œæ–¹å¼"></a>è¿è¡Œæ–¹å¼</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">streamlit run your_script.py [-- script args]</span><br></pre></td></tr></table></figure><p>å¦å¤–ä¸€ç§è¿è¡Œæ–¹å¼æ˜¯é€šè¿‡Pythonæ¨¡å—è¿è¡Œï¼ˆè¿™å¯¹äºä½¿ç”¨IDEå¦‚pycharmæœ‰ç”¨ï¼‰ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Running</span></span><br><span class="line">$ python -m streamlit your_script.py</span><br><span class="line"></span><br><span class="line"><span class="comment"># is equivalent to:</span></span><br><span class="line">$ streamlit run your_script.py</span><br></pre></td></tr></table></figure></p><h2 id="å¼€å¯å¼€å‘æ¨¡å¼"><a href="#å¼€å¯å¼€å‘æ¨¡å¼" class="headerlink" title="å¼€å¯å¼€å‘æ¨¡å¼"></a>å¼€å¯å¼€å‘æ¨¡å¼</h2><p>åœ¨å¼€å‘é˜¶æ®µï¼Œæœ€å¥½æ˜¯å¼€å¯â€œå¼€å‘æ¨¡å¼â€ï¼Œè¿™æ ·åªè¦ä¿å­˜ä»£ç åï¼ŒStreamlitå°±èƒ½é‡æ–°è¿è¡Œappã€‚è¿™ä¼šæå¤§åœ°æé«˜å¼€å‘æ•ˆç‡ã€‚<br>å¼€å¯æ–¹å¼æ˜¯åœ¨å³ä¸Šè§’é€‰æ‹©â€œAlways rerunâ€ã€‚</p><h2 id="å±•ç¤ºæ•°æ®"><a href="#å±•ç¤ºæ•°æ®" class="headerlink" title="å±•ç¤ºæ•°æ®"></a>å±•ç¤ºæ•°æ®</h2><h3 id="ä½¿ç”¨â€œé­”æ³•â€"><a href="#ä½¿ç”¨â€œé­”æ³•â€" class="headerlink" title="ä½¿ç”¨â€œé­”æ³•â€"></a>ä½¿ç”¨â€œé­”æ³•â€</h3><p>é­”æ³•magicå’Œ<code>st.write()</code>å¯ä»¥ç”¨æ¥å±•ç¤ºå¾ˆå¤šæ•°æ®ç±»å‹ï¼Œæ¯”å¦‚textã€dataã€matplotlibå›¾è¡¨ã€Altairå›¾è¡¨ã€‚ç›´æ¥å°†è¿™äº›æ•°æ®ä¼ ç»™<code>st.write()</code>æˆ–è€…magicå³å¯ï¼ŒStreamlitå¯ä»¥è‡ªåŠ¨è¯†åˆ«ã€‚<br>è¿™é‡Œé­”æ³•magicçš„æ„æ€æ˜¯ä¸ç”¨åœ¨ä»£ç é‡Œè°ƒç”¨Streamlitçš„ä»»ä½•æ–¹æ³•å°±å¯ä»¥ç›´æ¥å±•ç¤ºæ•°æ®ï¼ŒåŸå› æ˜¯å½“Streamlitçœ‹åˆ°åœ¨ä¸€è¡Œä¸­åªæœ‰ä¸€ä¸ªå˜é‡åæ—¶ï¼Œå°±ä¼šè‡ªåŠ¨åœ¨è¿™é‡ŒåŠ ä¸Š<code>st.write()</code>ã€‚<br>æ¯”å¦‚ä¸‹é¢ä»£ç ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string"># My first app</span></span><br><span class="line"><span class="string">Here&#x27;s our first attempt at using data to create a table:</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> streamlit <span class="keyword">as</span> st</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line">df = pd.DataFrame(&#123;</span><br><span class="line">  <span class="string">&#x27;first column&#x27;</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>],</span><br><span class="line">  <span class="string">&#x27;second column&#x27;</span>: [<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">40</span>]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">df</span><br></pre></td></tr></table></figure><br>å®ƒè·Ÿä¸‹é¢çš„ä»£ç æ•ˆæœæ˜¯ä¸€æ ·çš„ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> streamlit <span class="keyword">as</span> st</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">st.write(pd.DataFrame(&#123;</span><br><span class="line">    <span class="string">&#x27;first column&#x27;</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>],</span><br><span class="line">    <span class="string">&#x27;second column&#x27;</span>: [<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">40</span>]</span><br><span class="line">&#125;))</span><br></pre></td></tr></table></figure></p><h3 id="å±•ç¤ºdata-frame"><a href="#å±•ç¤ºdata-frame" class="headerlink" title="å±•ç¤ºdata frame"></a>å±•ç¤ºdata frame</h3><p>å‰é¢è¯´äº†ï¼Œ<code>st.write()</code>æˆ–magicå‡ ä¹èƒ½å±•ç¤ºæ‰€æœ‰æ•°æ®ï¼Œä½†ä¹Ÿæœ‰å…¶ä»–çš„ä¸å…·ä½“æ•°æ®ç›¸å…³çš„å‡½æ•°ï¼Œå¦‚<code>st.dataframe()</code>å’Œ<code>st.table()</code>ç­‰ã€‚<br>è¿™é‡Œå¯èƒ½æœ‰ä¸€ä¸ªé—®é¢˜ï¼šâ€œä¸ºä»€ä¹ˆæˆ‘ä¸èƒ½å…¨ç”¨<code>st.write()</code>å‘¢â€ï¼ŒåŸå› å¦‚ä¸‹ï¼š<br>ï¼ˆ1ï¼‰<code>st.write()</code>æˆ–magicèƒ½è‡ªåŠ¨æ¸²æŸ“æ•°æ®ï¼Œä½†æœ‰æ—¶ä½ å¯èƒ½æƒ³ç”¨å¦å¤–ä¸€ç§æ–¹å¼æ¸²æŸ“ã€‚æ¯”å¦‚ï¼Œå¦‚æœä½ ä¸æƒ³å°†dataframeæ•°æ®æ¸²æŸ“æˆä¸€ç§å¯äº¤äº’çš„è¡¨æ ¼ï¼Œæ­¤æ—¶å°±éœ€è¦ä½¿ç”¨<code>st.table(df)</code>å°†å®ƒæ¸²æŸ“æˆé™æ€è¡¨æ ¼ï¼›<br>ï¼ˆ2ï¼‰å…¶ä»–æ–¹æ³•è¿”å›çš„å¯¹è±¡å¯ä»¥è¢«ä½¿ç”¨å’Œä¿®æ”¹ï¼Œæ¯”å¦‚åœ¨ä¸Šé¢å¢åŠ æ•°æ®æˆ–æ›¿æ¢æ•°æ®ï¼›<br>ï¼ˆ3ï¼‰å¯¹äºå…¶ä»–æ–¹æ³•ï¼Œå¯ä»¥ä¼ é€’æ›´å¤šçš„å‚æ•°æ¥å®šåˆ¶åŒ–è¡Œä¸ºã€‚<br>æ¯”å¦‚ä¸‹é¢çš„ä¾‹å­ä½¿ç”¨Pandasçš„styleræ¥é«˜äº®åŒ–æŸäº›å…ƒç´ ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> streamlit <span class="keyword">as</span> st</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">dataframe = pd.DataFrame(</span><br><span class="line">    np.random.randn(<span class="number">10</span>, <span class="number">20</span>),</span><br><span class="line">    columns=(<span class="string">&#x27;col %d&#x27;</span> % i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>)))</span><br><span class="line"></span><br><span class="line">st.dataframe(dataframe.style.highlight_max(axis=<span class="number">0</span>))</span><br></pre></td></tr></table></figure><br>ä»¥åŠé™æ€å›¾è¡¨ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> streamlit <span class="keyword">as</span> st</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">dataframe = pd.DataFrame(</span><br><span class="line">    np.random.randn(<span class="number">10</span>, <span class="number">20</span>),</span><br><span class="line">    columns=(<span class="string">&#x27;col %d&#x27;</span> % i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>)))</span><br><span class="line">st.table(dataframe)</span><br></pre></td></tr></table></figure></p><h3 id="å±•ç¤ºchartså’Œmaps"><a href="#å±•ç¤ºchartså’Œmaps" class="headerlink" title="å±•ç¤ºchartså’Œmaps"></a>å±•ç¤ºchartså’Œmaps</h3><p>Streamlitæ”¯æŒå¾ˆå¤šæµè¡Œçš„ç»˜å›¾åº“ï¼Œå¦‚Matplotlibã€Altairã€deck.glã€plotlyç­‰ç­‰ã€‚ä¸€äº›demoè§<a href="https://docs.streamlit.io/library/api-reference#chart-elements">è¿™é‡Œ</a>ã€‚<br>æŠ˜çº¿å›¾ä¸¾ä¾‹ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> streamlit <span class="keyword">as</span> st</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">chart_data = pd.DataFrame(</span><br><span class="line">     np.random.randn(<span class="number">20</span>, <span class="number">3</span>),</span><br><span class="line">     columns=[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>])</span><br><span class="line"></span><br><span class="line">st.line_chart(chart_data)</span><br></pre></td></tr></table></figure><br>åœ°å›¾ä¸¾ä¾‹ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> streamlit <span class="keyword">as</span> st</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">map_data = pd.DataFrame(</span><br><span class="line">    np.random.randn(<span class="number">1000</span>, <span class="number">2</span>) / [<span class="number">50</span>, <span class="number">50</span>] + [<span class="number">37.76</span>, -<span class="number">122.4</span>],</span><br><span class="line">    columns=[<span class="string">&#x27;lat&#x27;</span>, <span class="string">&#x27;lon&#x27;</span>])</span><br><span class="line"></span><br><span class="line">st.<span class="built_in">map</span>(map_data)</span><br></pre></td></tr></table></figure></p><h2 id="éƒ¨ä»¶"><a href="#éƒ¨ä»¶" class="headerlink" title="éƒ¨ä»¶"></a>éƒ¨ä»¶</h2><p>å½“æƒ³è¦æ¢ç´¢å¾—åˆ°çš„æ•°æ®æˆ–æ¨¡å‹æ—¶ï¼Œå¯ä»¥ä½¿ç”¨éƒ¨ä»¶è¿›è¡Œè°ƒèŠ‚ï¼Œæ¯”å¦‚æ»‘å—<code>st.slider()</code>ã€æŒ‰é’®<code>st.button</code>ã€ä¸‹æ‹‰åˆ—è¡¨<code>st.selectbox</code>ã€‚<br>ä½¿ç”¨æ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼Œå°±åƒå°†è¿™äº›éƒ¨ä»¶è§†ä½œå˜é‡ã€‚</p><h3 id="æ»‘å—"><a href="#æ»‘å—" class="headerlink" title="æ»‘å—"></a>æ»‘å—</h3><p>å¸¸ç”¨æ¥è°ƒèŠ‚æ•°å€¼ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> streamlit <span class="keyword">as</span> st</span><br><span class="line">x = st.slider(<span class="string">&#x27;x&#x27;</span>)  <span class="comment"># ğŸ‘ˆ this is a widget</span></span><br><span class="line">st.write(x, <span class="string">&#x27;squared is&#x27;</span>, x * x)</span><br></pre></td></tr></table></figure></p><h3 id="å¤é€‰æ¡†"><a href="#å¤é€‰æ¡†" class="headerlink" title="å¤é€‰æ¡†"></a>å¤é€‰æ¡†</h3><p>å¸¸ç”¨æ¥æ˜¾ç¤ºæˆ–å…³é—­æ•°æ®ã€‚<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> streamlit <span class="keyword">as</span> st</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> st.checkbox(<span class="string">&#x27;Show dataframe&#x27;</span>):</span><br><span class="line">    chart_data = pd.DataFrame(</span><br><span class="line">       np.random.randn(<span class="number">20</span>, <span class="number">3</span>),</span><br><span class="line">       columns=[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>])</span><br><span class="line"></span><br><span class="line">    chart_data</span><br></pre></td></tr></table></figure></p><h3 id="ä¸‹æ‹‰åˆ—è¡¨"><a href="#ä¸‹æ‹‰åˆ—è¡¨" class="headerlink" title="ä¸‹æ‹‰åˆ—è¡¨"></a>ä¸‹æ‹‰åˆ—è¡¨</h3><p>å¸¸ç”¨æ¥é€‰æ‹©æ•°æ®<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> streamlit <span class="keyword">as</span> st</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">df = pd.DataFrame(&#123;</span><br><span class="line">    <span class="string">&#x27;first column&#x27;</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>],</span><br><span class="line">    <span class="string">&#x27;second column&#x27;</span>: [<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">40</span>]</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">option = st.selectbox(</span><br><span class="line">    <span class="string">&#x27;Which number do you like best?&#x27;</span>,</span><br><span class="line">     df[<span class="string">&#x27;first column&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;You selected: &#x27;</span>, option</span><br></pre></td></tr></table></figure></p><h3 id="éƒ¨ä»¶çš„key"><a href="#éƒ¨ä»¶çš„key" class="headerlink" title="éƒ¨ä»¶çš„key"></a>éƒ¨ä»¶çš„key</h3><p>å¦‚æœå¯¹æŸä¸€éƒ¨ä»¶é™„åŠ äº†ä¸€ä¸ªç‹¬ç‰¹çš„keyï¼Œé‚£ä¹ˆï¼Œéƒ¨ä»¶çš„å€¼å¯ä»¥é€šè¿‡keyæ¥è·å–ï¼Œæ¯”å¦‚ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> streamlit <span class="keyword">as</span> st</span><br><span class="line">st.text_input(<span class="string">&quot;Your name&quot;</span>, key=<span class="string">&quot;name&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># You can access the value at any point with:</span></span><br><span class="line">st.session_state.name</span><br></pre></td></tr></table></figure><br>æœ‰keyçš„éƒ¨ä»¶ä¼šè¢«è‡ªåŠ¨æ·»åŠ åˆ°Session Stateä¸­ï¼Œä»è€Œå¯ä»¥åœ¨éƒ¨ä»¶é—´ä¼ é€’æ•°æ®ã€‚<br>è¯¦æƒ…æŸ¥çœ‹<a href="https://docs.streamlit.io/library/api-reference/session-state">è¿™é‡Œ</a>ã€‚</p><h3 id="è¿›åº¦æ¡"><a href="#è¿›åº¦æ¡" class="headerlink" title="è¿›åº¦æ¡"></a>è¿›åº¦æ¡</h3><p>å½“ä¸€ä¸ªappéœ€è¦è¿è¡Œå¾ˆé•¿æ—¶é—´æ—¶ï¼Œå¯ä»¥æ·»åŠ è¿›åº¦æ¡éƒ¨ä»¶<code>st.progress()</code>æ¥æ˜¾ç¤ºè¿›åº¦ã€‚è¿›åº¦æ¡ä¸èƒ½æ·»åŠ keyã€‚<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> streamlit <span class="keyword">as</span> st</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;Starting a long computation...&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Add a placeholder</span></span><br><span class="line">latest_iteration = st.empty()</span><br><span class="line">bar = st.progress(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">  <span class="comment"># Update the progress bar with each iteration.</span></span><br><span class="line">  latest_iteration.text(<span class="string">f&#x27;Iteration <span class="subst">&#123;i+<span class="number">1</span>&#125;</span>&#x27;</span>)</span><br><span class="line">  bar.progress(i + <span class="number">1</span>)</span><br><span class="line">  time.sleep(<span class="number">0.1</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;...and now we\&#x27;re done!&#x27;</span></span><br></pre></td></tr></table></figure></p><h2 id="å¸ƒå±€"><a href="#å¸ƒå±€" class="headerlink" title="å¸ƒå±€"></a>å¸ƒå±€</h2><h3 id="sidebar"><a href="#sidebar" class="headerlink" title="sidebar"></a>sidebar</h3><p>Streamlitæä¾›äº†ä¸€ä¸ªå·¦ä¾§ä¾§è¾¹æ <code>st.sidebar</code>æ¥ç»„ç»‡ä¸Šé¢çš„éƒ¨ä»¶ã€‚æ¯ä¸€ä¸ªä¼ ç»™è¯¥ä¾§è¾¹æ çš„å…ƒç´ éƒ½è¢«â€œé’‰â€åˆ°å·¦è¾¹ï¼Œè¿™æ ·ç”¨æˆ·å°±èƒ½ä¸“æ³¨äºè‡ªå·±çš„appå†…å®¹ä¸Šã€‚<br>æ¯”å¦‚ä½¿ç”¨<code>st.sidebar.slider</code>æ›¿ä»£<code>st.slider</code>ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> streamlit <span class="keyword">as</span> st</span><br><span class="line"></span><br><span class="line"><span class="comment"># Add a selectbox to the sidebar:</span></span><br><span class="line">add_selectbox = st.sidebar.selectbox(</span><br><span class="line">    <span class="string">&#x27;How would you like to be contacted?&#x27;</span>,</span><br><span class="line">    (<span class="string">&#x27;Email&#x27;</span>, <span class="string">&#x27;Home phone&#x27;</span>, <span class="string">&#x27;Mobile phone&#x27;</span>)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Add a slider to the sidebar:</span></span><br><span class="line">add_slider = st.sidebar.slider(</span><br><span class="line">    <span class="string">&#x27;Select a range of values&#x27;</span>,</span><br><span class="line">    <span class="number">0.0</span>, <span class="number">100.0</span>, (<span class="number">25.0</span>, <span class="number">75.0</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p><h3 id="columnså’Œexpander"><a href="#columnså’Œexpander" class="headerlink" title="columnså’Œexpander"></a>columnså’Œexpander</h3><p>é™¤äº†ä¾§è¾¹æ ï¼ŒStreamlitè¿˜æä¾›äº†å…¶ä»–æ§åˆ¶å¸ƒå±€çš„æ–¹å¼ï¼Œå¦‚<code>st.columns</code>å¯ä»¥ä¸€åˆ—ä¸€åˆ—åœ°æ’æ”¾éƒ¨ä»¶ï¼Œ<code>st.expander</code>å¯ä»¥å°†å¤§ç‰‡çš„å†…å®¹éšè—æˆ–å±•å¼€ã€‚<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> streamlit <span class="keyword">as</span> st</span><br><span class="line"></span><br><span class="line">left_column, right_column = st.columns(<span class="number">2</span>)</span><br><span class="line"><span class="comment"># You can use a column just like st.sidebar:</span></span><br><span class="line">left_column.button(<span class="string">&#x27;Press me!&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Or even better, call Streamlit functions inside a &quot;with&quot; block:</span></span><br><span class="line"><span class="keyword">with</span> right_column:</span><br><span class="line">    chosen = st.radio(</span><br><span class="line">        <span class="string">&#x27;Sorting hat&#x27;</span>,</span><br><span class="line">        (<span class="string">&quot;Gryffindor&quot;</span>, <span class="string">&quot;Ravenclaw&quot;</span>, <span class="string">&quot;Hufflepuff&quot;</span>, <span class="string">&quot;Slytherin&quot;</span>))</span><br><span class="line">    st.write(<span class="string">f&quot;You are in <span class="subst">&#123;chosen&#125;</span> house!&quot;</span>)</span><br></pre></td></tr></table></figure></p><h2 id="ä¸»é¢˜"><a href="#ä¸»é¢˜" class="headerlink" title="ä¸»é¢˜"></a>ä¸»é¢˜</h2><p>Streamlité»˜è®¤æ”¯æŒLightå’ŒDarkä¸¤ç§ä¸»é¢˜ã€‚å¯ä»¥é€šè¿‡Settingsè¿›è¡Œè®¾ç½®ã€‚ä¹Ÿå¯ä»¥è‡ªå®šä¹‰ä¸»é¢˜ã€‚</p><h2 id="ç¼“å­˜"><a href="#ç¼“å­˜" class="headerlink" title="ç¼“å­˜"></a>ç¼“å­˜</h2><p>å½“ä»webä¸ŠåŠ è½½æ•°æ®ã€æ“ä½œå¤§å‹æ•°æ®é›†ä»¥åŠè¿›è¡Œå¤§è§„æ¨¡è®¡ç®—æ—¶ï¼Œå¯¹çŠ¶æ€çš„ç¼“å­˜å°±éå¸¸é‡è¦ï¼ŒStreamlitç¼“å­˜ä½¿å¾—è¿™äº›æƒ…å†µä¸‹appä»ç„¶å¿«é€Ÿæ‰§è¡Œã€‚<br>Streamlitæä¾›äº†ä¸€äº›ç¼“å­˜æ–¹æ¡ˆï¼Œå¦‚<code>@st.cache</code>ã€<code>@st.experimental_memo</code>ã€<code>@st.experimental_singleton</code>ã€‚<br>å…·ä½“çš„ç”¨æ³•å¯ä»¥å‚è€ƒ<a href="https://docs.streamlit.io/library/advanced-features/experimental-cache-primitives">è¿™é‡Œ</a>ã€‚<br>ä»¥<code>@st.cache</code>ä¸ºä¾‹ï¼Œå½“æŒ‡å®šéœ€è¦ä½¿ç”¨ç¼“å­˜æ—¶ï¼Œå°±ç”¨è¿™ä¸ªè£…é¥°å™¨åŒ…è£…ä¸€ä¸‹å‡½æ•°ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> streamlit <span class="keyword">as</span> st</span><br><span class="line"></span><br><span class="line"><span class="meta">@st.cache  </span><span class="comment"># ğŸ‘ˆ This function will be cached</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">my_slow_function</span>(<span class="params">arg1, arg2</span>):</span></span><br><span class="line">    <span class="comment"># Do something really slow in here!</span></span><br><span class="line">    <span class="keyword">return</span> the_output</span><br></pre></td></tr></table></figure><br>è¿™ä¸ªè£…é¥°å™¨å‘Šè¯‰Streamlitï¼Œå½“è¯¥å‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œå®ƒéœ€è¦æ£€æŸ¥å¦‚ä¸‹ä¸œè¥¿ï¼š<br>ï¼ˆ1ï¼‰è¯¥å‡½æ•°çš„è¾“å…¥å‚æ•°ï¼›<br>ï¼ˆ2ï¼‰åœ¨å‡½æ•°å†…ç”¨åˆ°çš„ä»»æ„å¤–éƒ¨å˜é‡ï¼›<br>ï¼ˆ3ï¼‰å‡½æ•°ä½“ï¼›<br>ï¼ˆ4ï¼‰åœ¨è¯¥å‡½æ•°ä½“å†…ç”¨åˆ°çš„å…¶ä»–å‡½æ•°ä½“ã€‚<br>å¦‚æœæ˜¯Streamlitçœ‹åˆ°æ˜¯è¿™å››ä¸ªéƒ¨åˆ†éƒ½æ˜¯ç¬¬ä¸€æ¬¡ä»¥è¿™äº›æ•°å€¼åŠå…¶ç»„åˆé¡ºåºè¿è¡Œï¼Œé‚£ä¹ˆå®ƒå°±è¿è¡Œå‡½æ•°ï¼Œç„¶åå°†ç»“æœå­˜å‚¨åœ¨å±€éƒ¨ç¼“å­˜ä¸­ã€‚ç„¶åï¼Œå½“è¯¥ç¼“å­˜çš„å‡½æ•°ä¸‹ä¸€æ¬¡è¢«è°ƒç”¨æ—¶ï¼Œå¦‚æœä¸Šè¿°å››éƒ¨åˆ†éƒ½æ²¡æœ‰æ”¹å˜ï¼Œé‚£ä¹ˆStreamlitå°±ä¼šè·³è¿‡æ‰§è¡Œï¼Œè€Œå°†ä¸Šä¸€æ¬¡ç¼“å­˜çš„ç»“æœè¿”å›ã€‚</p><h2 id="è¿è¡Œæœºç†"><a href="#è¿è¡Œæœºç†" class="headerlink" title="è¿è¡Œæœºç†"></a>è¿è¡Œæœºç†</h2><p>çŸ¥é“äº†ä¸Šé¢çš„é›¶ç¢çš„çŸ¥è¯†ï¼Œæ€»ç»“ä¸€ä¸‹æ•´ä½“çš„è¿è¡Œæœºç†ï¼š<br>ï¼ˆ1ï¼‰Streamlitçš„appsæ˜¯ä»ä¸Šåˆ°ä¸‹æ‰§è¡Œçš„Pythonè„šæœ¬ï¼›<br>ï¼ˆ2ï¼‰æ¯æ¬¡å½“ä¸€ä¸ªç”¨æˆ·æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—®ä½ çš„appåï¼Œä¸Šè¿°è„šæœ¬å°±ä¼šé‡æ–°æ‰§è¡Œï¼›<br>ï¼ˆ3ï¼‰å½“è„šæœ¬æ‰§è¡Œæ—¶ï¼ŒStreamlitåœ¨æµè§ˆå™¨æ¸²æŸ“å®ƒçš„è¾“å‡ºï¼›<br>ï¼ˆ4ï¼‰è„šæœ¬ä½¿ç”¨Streamlitç¼“å­˜æ¥é¿å…é‡å¤æ‰§è¡Œæ˜‚è´µçš„è¿ç®—ï¼Œæ‰€ä»¥ç»“æœæ›´æ–°ä¼šéå¸¸å¿«ï¼›<br>ï¼ˆ5ï¼‰æ¯æ¬¡å½“ç”¨æˆ·ä¸éƒ¨ä»¶è¿›è¡Œäº¤äº’æ—¶ï¼Œè„šæœ¬å°±ä¼šé‡æ–°è¿è¡Œï¼Œéƒ¨ä»¶çš„è¿”å›å€¼ä¹Ÿä¼šæ›´æ–°ä¸ºæœ€æ–°çŠ¶æ€ã€‚</p><h1 id="ä¸Šæ‰‹æ€»ç»“"><a href="#ä¸Šæ‰‹æ€»ç»“" class="headerlink" title="ä¸Šæ‰‹æ€»ç»“"></a>ä¸Šæ‰‹æ€»ç»“</h1><p>ä»¥ä¸Šå°±æ˜¯æœ€åŸºæœ¬çš„Streamlitç”¨æ³•ï¼Œæ€»ä½“æ¥çœ‹ï¼Œç¡®å®æå¤§åœ°é™ä½äº†å¼€å‘web appçš„éš¾åº¦ï¼Œå¯ä»¥ä½¿ç”¨åŸç”Ÿpythonè¯­æ³•æ¥åšè¿™ä»¶äº‹æ˜¯å¤ªé¦™äº†ã€‚</p>]]></content>
    
    
    <summary type="html">ç®€ä»‹
Streamlitæ˜¯ä¸€ä¸ªå¼€æºPythonåº“ï¼Œå…¶æ—¨åœ¨ä¸ºæœºå™¨å­¦ä¹ å’Œæ•°æ®ç§‘å­¦é¢†åŸŸç®€å•å¿«é€Ÿåœ°åˆ›å»ºå’Œåˆ†äº«ç¾è§‚çš„ã€å®šåˆ¶åŒ–çš„webåº”ç”¨ã€‚ä½¿ç”¨Streamlitï¼Œç”¨æˆ·ä»…ä»…å‡ åˆ†é’Ÿå³å¯åˆ›å»ºå’Œéƒ¨ç½²å¼ºå¤§çš„æ•°æ®åº”ç”¨ã€‚
æˆªå‡ å¼ èŒƒä¾‹çš„ç•Œé¢å›¾ï¼š




å®‰è£…
ä½¿ç”¨pipå®‰è£…ï¼š
1


pip install streamlit




æµ‹è¯•ä¸€ä¸‹ï¼š
1


streamlit hello



æ­¤æ—¶æµè§ˆå™¨ä¼šæ‰“å¼€http://localhost:8501/ï¼Œç„¶åå‡ºç°streamlitå…³äºåŠ¨ç”»ã€åŠ¨æ€ç»˜å›¾ã€åœ°å›¾ã€pandasç»˜å›¾çš„å››ä¸ªdemoã€‚

æ ¸å¿ƒæ¦‚å¿µ
è¿è¡Œæ–¹å¼
1


streamlit run your_script.</summary>
    
    
    
    <category term="digitalization" scheme="http://qixinbo.github.io/categories/digitalization/"/>
    
    
    <category term="Streamlit" scheme="http://qixinbo.github.io/tags/Streamlit/"/>
    
  </entry>
  
  <entry>
    <title>å¼€æºæ·±åº¦å­¦ä¹ è®¡ç®—å¹³å°ImJoyè§£æï¼š11 -- ImJoyä¸»ç«™ä¹‹ä¸»ç»„ä»¶</title>
    <link href="http://qixinbo.github.io/2022/02/28/ImJoy_11/"/>
    <id>http://qixinbo.github.io/2022/02/28/ImJoy_11/</id>
    <published>2022-02-27T16:00:00.000Z</published>
    <updated>2022-03-04T07:19:56.137Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><p>å‰é¢è®²äº†<a href="https://imjoy.io">ImJoyä¸»ç«™</a>çš„å…¥å£æ–‡ä»¶<code>main.js</code>ï¼Œè¿™ä¸€ç¯‡è§£æä¸€ä¸‹è¯¥ä¸»ç«™çš„ImJoyç»„ä»¶ï¼Œå®ƒä¹Ÿæ˜¯æ•´ä¸ªappçš„â€œé—¨é¢æ‹…å½“â€ï¼Œèµ·åˆ°äº†ç»Ÿç­¹æ•´ä¸ªç½‘ç«™çš„ä½œç”¨ã€‚</p><p>ä¸ºäº†ä¾¿äºåˆ†æï¼Œå°†å¾ˆå¤šé«˜é˜¶çš„æš‚æ—¶ç”¨ä¸åˆ°çš„ç»„ä»¶ï¼ˆæ¯”å¦‚å·¥å…·æ ã€çª—å£ç®¡ç†ã€æ–‡ä»¶ä¸Šä¼ ã€è¿æ¥åå°Engineç­‰ï¼‰éƒ½åˆ æ‰ï¼Œç•™ä¸‹æœ€åŸºæœ¬çš„èƒ½è¿è¡Œæœ€å°åŒ–imjoyæ’ä»¶çš„åŠŸèƒ½ï¼Œæˆªå›¾å¦‚ä¸‹ï¼š<br><img src="https://user-images.githubusercontent.com/6218739/156502647-18321726-6c25-4631-bcc4-b632eef39f23.png" alt="mini-imjoy"></p><p>è¿™æ ·ä¾¿äºåˆ†ææ•´ä¸ªç»„ä»¶çš„å®è§‚ç»“æ„å’Œè¿è¡Œé€»è¾‘ã€‚<br>ä¸‹é¢æ˜¯å¯¹äºè¯¥æå°åŒ–ç»„ä»¶çš„é€è¡Œä»£ç åˆ†æã€‚</p><h1 id="templateä»£ç "><a href="#templateä»£ç " class="headerlink" title="templateä»£ç "></a>templateä»£ç </h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;imjoy noselect&quot;</span>&gt;</span><br><span class="line">    &lt;!-- æ•´ä¸ªimjoyé¡µé¢æ¡†æ¶æ˜¯é€šè¿‡vue materialè¿™ä¸ªç»„ä»¶åº“çš„md-appè¿›è¡Œç»„ç»‡çš„ --&gt;</span><br><span class="line">    &lt;!-- å®ƒåŒ…æ‹¬äº†md-app-toolbarå·¥å…·æ ã€ md-app-drawerèœå•æ å’Œmd-app-contentå†…å®¹åŒºä¸‰éƒ¨åˆ† --&gt;</span><br><span class="line">    &lt;!-- ç›¸å…³æ•™ç¨‹è§ï¼šhttps:<span class="comment">//www.creative-tim.com/vuematerial/components/app --&gt;</span></span><br><span class="line">    &lt;md-app&gt;</span><br><span class="line">      &lt;!-- å·¥å…·æ å°±æ˜¯æœ€ä¸Šé¢çš„æ¨ªæ¡ï¼Œé‡Œé¢çš„å†…å®¹ç›´æ¥å…¨éƒ¨åˆ é™¤äº†ï¼Œä»…ä¿ç•™æ¶å­ --&gt;</span><br><span class="line">      &lt;md-app-toolbar <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;md-dense app-toolbar&quot;</span> md-elevation=<span class="string">&quot;0&quot;</span>&gt;</span><br><span class="line">      &lt;/md-app-toolbar&gt;</span><br><span class="line"></span><br><span class="line">      &lt;!-- æ¥ä¸‹æ¥å°±æ˜¯å·¦ä¾§çš„èœå•æ  --&gt;</span><br><span class="line">      &lt;!-- drawerçš„å±æ€§è®¾ç½®è§ï¼šhttps:<span class="comment">//www.creative-tim.com/vuematerial/components/drawer# --&gt;</span></span><br><span class="line">      &lt;!-- å…·ä½“åœ°ï¼š --&gt;</span><br><span class="line">      &lt;!-- (<span class="number">1</span>)èœå•æ æ˜¯å¦å¯è§æ˜¯é€šè¿‡md-activeå±æ€§æ§åˆ¶ï¼Œå…¶é€šè¿‡v-bindç»‘å®šåˆ°äº†menuVisibleè¿™ä¸ªå˜é‡ä¸Š --&gt;</span><br><span class="line">      &lt;!-- (<span class="number">2</span>)èœå•æ å…³é—­å’Œæ‰“å¼€ä¸¤ä¸ªäº‹ä»¶éƒ½é€šè¿‡v-onç»‘å®šåˆ°äº†wm.resizeAll()å‡½æ•°ä¸Š --&gt;</span><br><span class="line">      &lt;!-- (<span class="number">3</span>)èœå•æ æ˜¯å¦å¸¸é©»md-persistentå’Œèœå•æ æ˜¯å¦æ”¯æŒè§¦å±ä¸‹çš„swipeç»‘å®šåˆ°äº†screenWidthè¿™ä¸ªå˜é‡ä¸Š --&gt;</span><br><span class="line">      &lt;md-app-drawer</span><br><span class="line">        :md-active.sync=<span class="string">&quot;menuVisible&quot;</span></span><br><span class="line">        @md-closed=<span class="string">&quot;wm.resizeAll()&quot;</span></span><br><span class="line">        @md-opened=<span class="string">&quot;wm.resizeAll()&quot;</span></span><br><span class="line">        :md-persistent=<span class="string">&quot;screenWidth &gt; 800 ? &#x27;full&#x27; : null&quot;</span></span><br><span class="line">        :md-swipeable=<span class="string">&quot;screenWidth &gt; 600 ? false : true&quot;</span></span><br><span class="line">      &gt;</span><br><span class="line">        &lt;!-- æ¥ä¸‹æ¥æ˜¯å°†ä¸Šä¼ æ–‡ä»¶,æ·»åŠ å·¥ä½œæµ,æ·»åŠ æ’ä»¶å’Œæ’ä»¶åˆ—è¡¨éƒ½æ”¾åœ¨äº†ä¸€ä¸ªcardä¸­ --&gt;</span><br><span class="line">        &lt;!-- è¿™ä¸ªcardçš„æ˜¾ç¤ºæœ‰ä¸¤ä¸ªåˆ¤æ–­è¯­å¥,ä¸€ä¸ªæ˜¯ç”¨v-showåˆ¤æ–­plugin_loadedè¿™ä¸ªå˜é‡æ˜¯å¦ä¸º<span class="literal">true</span> --&gt;</span><br><span class="line">        &lt;!-- å¦ä¸€ä¸ªæ˜¯ç”¨v-<span class="keyword">if</span>åˆ¤æ–­pmè¿™ä¸ªå˜é‡æ˜¯å¦ä¸º<span class="literal">true</span>, --&gt;</span><br><span class="line">        &lt;!-- v-<span class="keyword">if</span>å’Œv-showçœ‹èµ·æ¥å·®ä¸å¤š,ä½†æœ‰åŒºåˆ«,è§:https:<span class="comment">//cn.vuejs.org/v2/guide/conditional.html --&gt;</span></span><br><span class="line">        &lt;md-card id=<span class="string">&quot;plugin-menu&quot;</span> v-show=<span class="string">&quot;plugin_loaded&quot;</span> v-<span class="keyword">if</span>=<span class="string">&quot;pm&quot;</span>&gt;</span><br><span class="line">          &lt;!-- å°†files,workflowå’Œpluginséƒ½æ”¾åœ¨äº†cardçš„headerä¸­, --&gt;</span><br><span class="line">          &lt;!-- è¿™é‡Œæˆ‘ä»¬å°†fileså’Œworkflowéƒ½åˆ æ‰äº†,ä»…ç•™pluginsçš„ä»£ç  --&gt;</span><br><span class="line">          &lt;md-card-header&gt;</span><br><span class="line">            &lt;!-- æ·»åŠ pluginså°±æ˜¯ä¸€ä¸ªæŒ‰é’®,å…¶<span class="class"><span class="keyword">class</span>ä¹Ÿæ˜¯ç”±<span class="title">v</span>-<span class="title">bind</span>ç»‘å®šå¹¶åˆ¤æ–­ --&gt;</span></span><br><span class="line"><span class="class">            &lt;!-- è¯¥æŒ‰é’®çš„ç‚¹å‡»æ—¶é—´ç”¨<span class="title">v</span>-<span class="title">on</span>ç»‘å®šåˆ°äº†<span class="title">showPluginManagement</span>()å‡½æ•°ä¸Š --&gt;</span></span><br><span class="line">            &lt;!-- å½“ç‚¹å‡»è¯¥æŒ‰é’®å, ä»è€Œæ‰§è¡Œè¯¥å‡½æ•°,å…¶ä¸­æœ‰ä¸€ä¸ªéå¸¸é‡è¦çš„å˜é‡:--&gt;</span><br><span class="line">            &lt;!-- <span class="built_in">this</span>.showAddPluginDialogä¼šè®¾ä¸º<span class="literal">true</span> --&gt;</span><br><span class="line">            &lt;!-- ä»è€Œä¼šå¼•å‘å¦‚ä¸‹å¯¹è¯æ¡†çš„å¼¹å‡º:</span><br><span class="line">            &lt;md-dialog</span><br><span class="line">              <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;plugin-dialog&quot;</span></span><br><span class="line">              :md-active.sync=<span class="string">&quot;showAddPluginDialog&quot;</span></span><br><span class="line">              :md-click-outside-to-close=<span class="string">&quot;true&quot;</span></span><br><span class="line">            &gt; --&gt;</span><br><span class="line">            &lt;md-button</span><br><span class="line">              ref=<span class="string">&quot;add_plugin_button&quot;</span></span><br><span class="line">              :<span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;pm.installed_plugins.length &gt; 0 ? &#x27;&#x27; : &#x27;md-primary&#x27;&quot;</span></span><br><span class="line">              @click=<span class="string">&quot;showPluginManagement()&quot;</span></span><br><span class="line">            &gt;</span><br><span class="line">              &lt;md-icon&gt;add&lt;/md-icon&gt;Plugins</span><br><span class="line">            &lt;/md-button&gt;</span><br><span class="line">          &lt;/md-card-header&gt;</span><br><span class="line"></span><br><span class="line">          &lt;!-- æ¥ä¸‹æ¥å°±æ˜¯å°†æ’ä»¶åˆ—è¡¨æ”¾åœ¨cardçš„contentåŒºåŸŸ --&gt;</span><br><span class="line">          &lt;md-card-content&gt;</span><br><span class="line">            &lt;!-- ä½¿ç”¨v-<span class="keyword">for</span>æ¥å¾ªç¯æ’ä»¶åˆ—è¡¨,å¹¶å¯¹æ¯ä¸€é¡¹æä¾›äº†keyçš„èº«ä»½ --&gt;</span><br><span class="line">            &lt;!-- v-<span class="keyword">for</span>çš„æ•™ç¨‹è§:https:<span class="comment">//cn.vuejs.org/v2/guide/list.html --&gt;</span></span><br><span class="line">            &lt;div v-<span class="keyword">for</span>=<span class="string">&quot;plugin in sortedRunnablePlugins()&quot;</span> :key=<span class="string">&quot;plugin.name&quot;</span>&gt;</span><br><span class="line">              &lt;!-- å¢åŠ ä¸€ä¸ªåˆ†å‰²çº¿ --&gt;</span><br><span class="line">              &lt;md-divider&gt;&lt;/md-divider&gt;</span><br><span class="line">              &lt;div style=<span class="string">&quot;display: flex;&quot;</span>&gt;</span><br><span class="line">                &lt;!-- è¿™é‡Œå¯¹æ¯ä¸€ä¸ªæ’ä»¶ä¼šåŒ…è£…ä¸€ä¸ªbadgeå¾½ç« ,ç”¨é€”æ˜¯åˆ¤æ–­å®ƒéœ€ä¸éœ€è¦å‡çº§ --&gt;</span><br><span class="line">                &lt;!-- å¦‚æœéœ€è¦å‡çº§,ä¼šå‡ºç°ä¸€ä¸ªNEWçš„è§’æ ‡ --&gt;</span><br><span class="line">                &lt;md-badge</span><br><span class="line">                  :<span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;plugin.update_available ? &#x27;&#x27; : &#x27;hide-badge&#x27;&quot;</span></span><br><span class="line">                  <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;md-square md-primary&quot;</span></span><br><span class="line">                  md-dense</span><br><span class="line">                  md-content=<span class="string">&quot;NEW&quot;</span></span><br><span class="line">                &gt;</span><br><span class="line">                  &lt;!-- è¿™é‡Œæ˜¯å¯¹æ’ä»¶çš„iconæŒ‰é’®ç‚¹å‡»åä¼šå‡ºç°çš„èœå•è¿›è¡Œå®šä¹‰ --&gt;</span><br><span class="line">                  &lt;md-menu md-size=<span class="string">&quot;medium&quot;</span>&gt;</span><br><span class="line">                    &lt;!-- è§¦å‘èœå•çš„iconæŒ‰é’®å®šä¹‰ --&gt;</span><br><span class="line">                    &lt;md-button</span><br><span class="line">                      <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;md-icon-button&quot;</span></span><br><span class="line">                      :<span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;plugin.running ? &#x27;md-accent&#x27; : &#x27;&#x27;&quot;</span></span><br><span class="line">                      md-menu-trigger</span><br><span class="line">                    &gt;</span><br><span class="line">                      &lt;!-- æ’ä»¶çš„åŠ è½½çŠ¶æ€ --&gt;</span><br><span class="line">                      &lt;md-progress-spinner</span><br><span class="line">                        v-<span class="keyword">if</span>=<span class="string">&quot;plugin.initializing || plugin.terminating&quot;</span></span><br><span class="line">                        <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;md-accent&quot;</span></span><br><span class="line">                        :md-diameter=<span class="string">&quot;20&quot;</span></span><br><span class="line">                        md-mode=<span class="string">&quot;indeterminate&quot;</span></span><br><span class="line">                      &gt;&lt;/md-progress-spinner&gt;</span><br><span class="line">                      &lt;!-- iconä¼šåˆ¤æ–­è¯¥æ’ä»¶æœ‰æ²¡æœ‰æä¾›è‡ªå®šä¹‰çš„å›¾æ ‡,å¦‚æœæ²¡æœ‰,åˆ™ä½¿ç”¨é»˜è®¤çš„extensionå›¾æ ‡ --&gt;</span><br><span class="line">                      &lt;!-- è¿™ä¸ªåœ°æ–¹è°ƒç”¨çš„å°±æ˜¯ä¹‹å‰å…¥å£æ–‡ä»¶æ‰€å…¨å±€æ³¨å†Œçš„PluginIconç»„ä»¶ --&gt;</span><br><span class="line">                      &lt;plugin-icon</span><br><span class="line">                        v-<span class="keyword">else</span></span><br><span class="line">                        :icon=<span class="string">&quot;plugin.config.icon&quot;</span></span><br><span class="line">                      &gt;&lt;/plugin-icon&gt;</span><br><span class="line">                      &lt;!-- æŒ‰é’®çš„å·¥å…·æç¤ºä¿¡æ¯ --&gt;</span><br><span class="line">                      &lt;md-tooltip v-<span class="keyword">if</span>=<span class="string">&quot;screenWidth &gt; 500&quot;</span>&gt;&#123;&#123;</span><br><span class="line">                        plugin.name + <span class="string">&quot;: &quot;</span> + plugin.config.description</span><br><span class="line">                      &#125;&#125;&lt;/md-tooltip&gt;</span><br><span class="line">                    &lt;/md-button&gt;</span><br><span class="line"></span><br><span class="line">                    &lt;!-- ç‚¹å‡»iconæŒ‰é’®åå¼¹å‡ºçš„èœå•é€‰é¡¹ --&gt;</span><br><span class="line">                    &lt;md-menu-content&gt;</span><br><span class="line">                      &lt;!-- Docsé€‰é¡¹,ç»‘å®šäº†showDocæ–¹æ³• --&gt;</span><br><span class="line">                      &lt;md-menu-item @click=<span class="string">&quot;showDoc(plugin.id)&quot;</span>&gt;</span><br><span class="line">                        &lt;md-icon&gt;description&lt;/md-icon&gt;Docs</span><br><span class="line">                      &lt;/md-menu-item&gt;</span><br><span class="line">                      &lt;!-- Shareé€‰é¡¹,ä¸ä¸€å®šä¼šæ˜¾ç¤º,æœ‰ä¸€ä¸ªv-<span class="keyword">if</span>æ¡ä»¶æ¸²æŸ“ --&gt;</span><br><span class="line">                      &lt;md-menu-item</span><br><span class="line">                        v-<span class="keyword">if</span>=<span class="string">&quot;plugin.config.origin&quot;</span></span><br><span class="line">                        @click=<span class="string">&quot;sharePlugin(plugin.id)&quot;</span></span><br><span class="line">                      &gt;</span><br><span class="line">                        &lt;md-icon&gt;share&lt;/md-icon&gt;Share</span><br><span class="line">                      &lt;/md-menu-item&gt;</span><br><span class="line">                      &lt;!-- Exporté€‰é¡¹,ç»‘å®šäº†downloadPlugin --&gt;</span><br><span class="line">                      &lt;md-menu-item @click=<span class="string">&quot;downloadPlugin(plugin.id)&quot;</span>&gt;</span><br><span class="line">                        &lt;md-icon&gt;cloud_download&lt;/md-icon&gt;Export</span><br><span class="line">                      &lt;/md-menu-item&gt;</span><br><span class="line">                      &lt;!-- Edité€‰é¡¹,ç»‘å®šäº†editPlugin --&gt;</span><br><span class="line">                      &lt;md-menu-item @click=<span class="string">&quot;editPlugin(plugin.id)&quot;</span>&gt;</span><br><span class="line">                        &lt;md-icon&gt;edit&lt;/md-icon&gt;Edit</span><br><span class="line">                      &lt;/md-menu-item&gt;</span><br><span class="line">                      &lt;!-- Reloadé€‰é¡¹,ç»‘å®šäº†reloadPlugin --&gt;</span><br><span class="line">                      &lt;md-menu-item @click=<span class="string">&quot;reloadPlugin(plugin.config)&quot;</span>&gt;</span><br><span class="line">                        &lt;md-icon&gt;autorenew&lt;/md-icon&gt;Reload</span><br><span class="line">                      &lt;/md-menu-item&gt;</span><br><span class="line">                      &lt;!-- Terminateé€‰é¡¹,ç»‘å®šäº†unloadPlugin --&gt;</span><br><span class="line">                      &lt;md-menu-item @click=<span class="string">&quot;unloadPlugin(plugin)&quot;</span>&gt;</span><br><span class="line">                        &lt;md-icon&gt;clear&lt;/md-icon&gt;Terminate</span><br><span class="line">                      &lt;/md-menu-item&gt;</span><br><span class="line">                      &lt;!-- Removeé€‰é¡¹,ç»‘å®šäº†removePlugin --&gt;</span><br><span class="line">                      &lt;md-menu-item</span><br><span class="line">                        <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;md-accent&quot;</span></span><br><span class="line">                        @click=<span class="string">&quot;removePlugin(plugin)&quot;</span></span><br><span class="line">                      &gt;</span><br><span class="line">                        &lt;md-icon&gt;delete_forever&lt;/md-icon&gt;Remove</span><br><span class="line">                      &lt;/md-menu-item&gt;</span><br><span class="line"></span><br><span class="line">                    &lt;/md-menu-content&gt;</span><br><span class="line">                  &lt;/md-menu&gt;</span><br><span class="line">                &lt;/md-badge&gt;</span><br><span class="line"></span><br><span class="line">                &lt;!-- æ¥ä¸‹æ¥å°±æ˜¯ç”±æ’ä»¶çš„åç§°æ‰€å½¢æˆçš„æŒ‰é’® --&gt;</span><br><span class="line">                &lt;!-- å¯¹äºéœ€è¦é“¾æ¥åˆ°engineçš„æ’ä»¶,è¿˜ä¼šæ£€æµ‹å…¶çŠ¶æ€,å¦‚æœæ²¡æœ‰é“¾æ¥åˆ°engineä¸Š,å°±ä¼šdisableè¯¥æŒ‰é’®,ä»è€Œæ— æ³•è¿è¡Œ. --&gt;</span><br><span class="line">                &lt;!-- å¯¹äºé¼ æ ‡æ“ä½œ,ä¹Ÿé™„åŠ äº†é¼ æ ‡æŒ‰é’®ä¿®é¥°ç¬¦,é˜²æ­¢è¯¯æ“ä½œ,æ•™ç¨‹è§:https:<span class="comment">//cn.vuejs.org/v2/guide/events.html --&gt;</span></span><br><span class="line">                &lt;!-- ç‚¹å‡»è¯¥æŒ‰é’®åå°±ä¼šè¿è¡ŒrunOpæ–¹æ³• --&gt;</span><br><span class="line">                &lt;md-button</span><br><span class="line">                  <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;joy-run-button&quot;</span></span><br><span class="line">                  :<span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;</span></span><br><span class="line"><span class="string">                    plugin.running</span></span><br><span class="line"><span class="string">                      ? &#x27;busy-plugin&#x27;</span></span><br><span class="line"><span class="string">                      : plugin._disconnected &amp;&amp; plugin.engine</span></span><br><span class="line"><span class="string">                      ? &#x27;md-accent&#x27;</span></span><br><span class="line"><span class="string">                      : &#x27;md-primary&#x27;</span></span><br><span class="line"><span class="string">                  &quot;</span></span><br><span class="line">                  :disabled=<span class="string">&quot;plugin._disconnected &amp;&amp; !plugin.engine&quot;</span></span><br><span class="line">                  @click.exact=<span class="string">&quot;</span></span><br><span class="line"><span class="string">                    plugin._disconnected</span></span><br><span class="line"><span class="string">                      ? connectPlugin(plugin)</span></span><br><span class="line"><span class="string">                      : runOp(plugin.ops[plugin.name])</span></span><br><span class="line"><span class="string">                  &quot;</span></span><br><span class="line">                  @click.right.exact=<span class="string">&quot;logPlugin(plugin)&quot;</span></span><br><span class="line">                &gt;</span><br><span class="line">                  &#123;&#123; plugin.config.name + <span class="string">&quot; &quot;</span> + plugin.config.badges &#125;&#125;</span><br><span class="line">                &lt;/md-button&gt;</span><br><span class="line"></span><br><span class="line">              &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">              &lt;!-- è¿™ä¸ªåœ°æ–¹æ˜¯ImJoyçš„æ ¸å¿ƒ!! --&gt;</span><br><span class="line">              &lt;!-- æ­¤å¤„ä¹Ÿæ˜¯ImJoyçš„åç§°çš„æ¥æº,å³ImJoyæ¥è‡ªäºjoy.jsè¿™ä¸ªåº“ --&gt;</span><br><span class="line">              &lt;!-- è¿™ä¸ªåœ°æ–¹éœ€è¦åé¢ä»”ç»†ç ”ç©¶æœºç† --&gt;</span><br><span class="line">              &lt;div</span><br><span class="line">                v-<span class="keyword">for</span>=<span class="string">&quot;op in plugin.ops&quot;</span></span><br><span class="line">                :key=<span class="string">&quot;op.plugin_id + op.name&quot;</span></span><br><span class="line">                v-show=<span class="string">&quot;true&quot;</span></span><br><span class="line">              &gt;</span><br><span class="line">                &lt;joy :config=<span class="string">&quot;op&quot;</span> :show=<span class="string">&quot;true&quot;</span>&gt;&lt;/joy&gt;</span><br><span class="line">              &lt;/div&gt;</span><br><span class="line">              &lt;md-divider&gt;&lt;/md-divider&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;md-divider&gt;&lt;/md-divider&gt;</span><br><span class="line">          &lt;/md-card-content&gt;</span><br><span class="line">        &lt;/md-card&gt;</span><br><span class="line">      &lt;/md-app-drawer&gt;</span><br><span class="line"></span><br><span class="line">      &lt;!-- æ¥ä¸‹æ¥å°±æ˜¯æ•´ä¸ªç•Œé¢çš„ç¬¬ä¸‰éƒ¨åˆ†,å³å†…å®¹åŒº --&gt;</span><br><span class="line">      &lt;md-app-content</span><br><span class="line">        :<span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;workspace_dropping ? &#x27;file-dropping&#x27; : &#x27;&#x27;&quot;</span></span><br><span class="line">        <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;whiteboard-content&quot;</span></span><br><span class="line">      &gt;</span><br><span class="line">        &lt;!-- å°±æ˜¯å¼•ç”¨äº†whiteboardè¿™ä¸ªç»„ä»¶ --&gt;</span><br><span class="line">        &lt;whiteboard</span><br><span class="line">          v-<span class="keyword">if</span>=<span class="string">&quot;wm&quot;</span></span><br><span class="line">          id=<span class="string">&quot;whiteboard&quot;</span></span><br><span class="line">          @create=<span class="string">&quot;createWindow($event)&quot;</span></span><br><span class="line">          :mode=<span class="string">&quot;wm.window_mode&quot;</span></span><br><span class="line">          :<span class="built_in">window</span>-manager=<span class="string">&quot;wm&quot;</span></span><br><span class="line">        &gt;&lt;/whiteboard&gt;</span><br><span class="line">      &lt;/md-app-content&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- ä»¥ä¸Šå°±æ˜¯æ•´ä¸ªç•Œé¢çš„å¸ƒå±€ --&gt;</span><br><span class="line">    &lt;/md-app&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- è¿™ä¸ªæ˜¯æ¶ˆæ¯æé†’å¯¹è¯æ¡†ï¼Œå½“æŸå¤„è°ƒç”¨showAlert()å‡½æ•°æ—¶ä¼šè§¦å‘ï¼Œæ¯”å¦‚api.alertæ—¶--&gt;</span><br><span class="line">    &lt;md-dialog-alert</span><br><span class="line">      <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;api-dialog&quot;</span></span><br><span class="line">      :md-active.sync=<span class="string">&quot;alert_config.show&quot;</span></span><br><span class="line">      :md-title=<span class="string">&quot;alert_config.title&quot;</span></span><br><span class="line">      :md-content=<span class="string">&quot;alert_config.content&quot;</span></span><br><span class="line">      :md-confirm-text=<span class="string">&quot;alert_config.confirm_text&quot;</span></span><br><span class="line">    /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- è¿™ä¸ªæ˜¯æ¶ˆæ¯ç¡®è®¤å¯¹è¯æ¡†ï¼Œå½“æŸå¤„è°ƒç”¨showConfirm()å‡½æ•°æ—¶ä¼šè§¦å‘ï¼Œæ¯”å¦‚åˆ é™¤æ’ä»¶æ—¶ --&gt;</span><br><span class="line">    &lt;md-dialog-confirm</span><br><span class="line">      <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;api-dialog&quot;</span></span><br><span class="line">      :md-active.sync=<span class="string">&quot;confirm_config.show&quot;</span></span><br><span class="line">      :md-title=<span class="string">&quot;confirm_config.title&quot;</span></span><br><span class="line">      :md-content=<span class="string">&quot;confirm_config.content&quot;</span></span><br><span class="line">      :md-confirm-text=<span class="string">&quot;confirm_config.confirm_text&quot;</span></span><br><span class="line">      :md-cancel-text=<span class="string">&quot;confirm_config.canel_text&quot;</span></span><br><span class="line">      @md-confirm=<span class="string">&quot;confirm_config.confirm&quot;</span></span><br><span class="line">      @md-cancel=<span class="string">&quot;confirm_config.cancel&quot;</span></span><br><span class="line">    /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- å‰é¢å·²åˆ†æåˆ°ï¼Œç‚¹å‡»æ·»åŠ Pluginsåä¼šè§¦å‘å¦‚ä¸‹æ’ä»¶å¯¹è¯æ¡†çš„å¼¹å‡º --&gt;</span><br><span class="line">    &lt;md-dialog</span><br><span class="line">      <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;plugin-dialog&quot;</span></span><br><span class="line">      :md-active.sync=<span class="string">&quot;showAddPluginDialog&quot;</span></span><br><span class="line">      :md-click-outside-to-close=<span class="string">&quot;true&quot;</span></span><br><span class="line">    &gt;</span><br><span class="line">      &lt;!-- è®¾ç½®è¯¥å¯¹è¯æ¡†çš„æ ‡é¢˜ --&gt;</span><br><span class="line">      &lt;md-dialog-title</span><br><span class="line">        &gt;&#123;&#123;</span><br><span class="line">          plugin4install ? <span class="string">&quot;Plugin Installation&quot;</span> : <span class="string">&quot;ImJoy Plugin Management&quot;</span></span><br><span class="line">        &#125;&#125;</span><br><span class="line">        &lt;!-- åœ¨æ ‡é¢˜æ æ·»åŠ ä¸€ä¸ªå…³é—­æŒ‰é’® --&gt;</span><br><span class="line">        &lt;md-button</span><br><span class="line">          <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;md-accent&quot;</span></span><br><span class="line">          style=<span class="string">&quot;position:absolute; top:8px; right:5px;&quot;</span></span><br><span class="line">          @click=<span class="string">&quot;</span></span><br><span class="line"><span class="string">            showAddPluginDialog = false;</span></span><br><span class="line"><span class="string">            clearPluginUrl();</span></span><br><span class="line"><span class="string">          &quot;</span></span><br><span class="line">          &gt;<span class="xml"><span class="tag">&lt;<span class="name">md-icon</span>&gt;</span>clear<span class="tag">&lt;/<span class="name">md-icon</span>&gt;</span></span>&lt;/md-button</span><br><span class="line">        &gt;&lt;/md-dialog-title</span><br><span class="line">      &gt;</span><br><span class="line">      &lt;!-- ä»¥ä¸‹æ˜¯å¯¹è¯æ¡†çš„å†…å®¹éƒ¨åˆ† --&gt;</span><br><span class="line">      &lt;!-- åŸæ¥çš„æ’ä»¶å¯¹è¯æ¡†æœ‰ä¸‰ç§æ·»åŠ æ’ä»¶çš„æ–¹å¼ï¼šï¼ˆ<span class="number">1</span>ï¼‰é€šè¿‡æ’ä»¶æ¨¡æ¿templateç¼–å†™æ’ä»¶ï¼ˆ<span class="number">2</span>ï¼‰è¾“å…¥æ’ä»¶urlåœ°å€å®‰è£…ï¼ˆ<span class="number">3</span>ï¼‰é€šè¿‡æ’ä»¶å•†åº—storeå®‰è£… --&gt;</span><br><span class="line">      &lt;!-- è¿™é‡Œæˆ‘ä»¬ä¸ºäº†ä»£ç ç²¾ç®€ï¼Œåªä¿ç•™äº†ç¬¬ä¸€ç§ï¼Œä¿è¯èƒ½è¿è¡Œä¸€ä¸ªæœ€ç®€å•çš„æ’ä»¶å³å¯ --&gt;</span><br><span class="line">      &lt;md-dialog-content&gt;</span><br><span class="line">        &lt;template v-<span class="keyword">if</span>=<span class="string">&quot;show_plugin_templates&quot;</span>&gt;</span><br><span class="line">          &lt;md-menu&gt;</span><br><span class="line">            &lt;!-- é€šè¿‡æ¨¡æ¿templateæ·»åŠ æ’ä»¶çš„æŒ‰é’® --&gt;</span><br><span class="line">            &lt;md-button <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;md-primary md-raised&quot;</span> md-menu-trigger&gt;</span><br><span class="line">              &lt;md-icon&gt;add&lt;/md-icon&gt;Create a <span class="keyword">new</span> plugin</span><br><span class="line">              &lt;md-tooltip&gt;Create a <span class="keyword">new</span> plugin&lt;/md-tooltip&gt;</span><br><span class="line">            &lt;/md-button&gt;</span><br><span class="line">            &lt;!-- ç‚¹å‡»ä¸Šé¢æŒ‰é’®åå¼¹å‡ºçš„èœå• --&gt;</span><br><span class="line">            &lt;md-menu-content&gt;</span><br><span class="line">              &lt;!-- èœå•é¡¹ä¼šå¯¹æ‰€æœ‰çš„æ¨¡æ¿è¿›è¡Œéå†å±•ç¤º --&gt;</span><br><span class="line">              &lt;!-- æ¯ä¸ªèœå•é¡¹ä¹Ÿéƒ½ä¼šå°†é¼ æ ‡ç‚¹å‡»äº‹ä»¶ç»‘å®šåˆ°newPluginæ–¹æ³•ä¸Š --&gt;</span><br><span class="line">              &lt;!-- è¯¥æ–¹æ³•ä¼šé€šè¿‡createWindowåˆ›å»ºplugin-editorç±»å‹çš„çª—å£ï¼Œå³ä»£ç ç¼–è¾‘å™¨ --&gt;</span><br><span class="line">              &lt;md-menu-item</span><br><span class="line">                @click=<span class="string">&quot;</span></span><br><span class="line"><span class="string">                  newPlugin(template.code);</span></span><br><span class="line"><span class="string">                  showAddPluginDialog = false;</span></span><br><span class="line"><span class="string">                &quot;</span></span><br><span class="line">                v-<span class="keyword">for</span>=<span class="string">&quot;template in plugin_templates&quot;</span></span><br><span class="line">                :key=<span class="string">&quot;template.name&quot;</span></span><br><span class="line">              &gt;</span><br><span class="line">                &lt;md-icon&gt;&#123;&#123; template.icon &#125;&#125;&lt;/md-icon</span><br><span class="line">                &gt;&#123;&#123; template.name &#125;&#125;</span><br><span class="line">              &lt;/md-menu-item&gt;</span><br><span class="line">            &lt;/md-menu-content&gt;</span><br><span class="line">          &lt;/md-menu&gt;</span><br><span class="line">          &lt;br /&gt;</span><br><span class="line">          &lt;br /&gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line"></span><br><span class="line">      &lt;/md-dialog-content&gt;</span><br><span class="line">    &lt;/md-dialog&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><h1 id="scriptä»£ç "><a href="#scriptä»£ç " class="headerlink" title="scriptä»£ç "></a>scriptä»£ç </h1><p>é€šè¿‡ä¸Šè¿°templateæ–‡ä»¶çš„è§£æï¼Œå‘ç°æ’ä»¶è¢«ç‚¹å‡»è¿è¡Œæ—¶æ‰§è¡Œçš„å‡½æ•°æ˜¯runOpæ–¹æ³•ã€‚<br>è¯¥ä»£ç è§£æç•™å‘å¾…å¡«ã€‚</p>]]></content>
    
    
    <summary type="html">ç®€ä»‹
å‰é¢è®²äº†ImJoyä¸»ç«™çš„å…¥å£æ–‡ä»¶main.jsï¼Œè¿™ä¸€ç¯‡è§£æä¸€ä¸‹è¯¥ä¸»ç«™çš„ImJoyç»„ä»¶ï¼Œå®ƒä¹Ÿæ˜¯æ•´ä¸ªappçš„â€œé—¨é¢æ‹…å½“â€ï¼Œèµ·åˆ°äº†ç»Ÿç­¹æ•´ä¸ªç½‘ç«™çš„ä½œç”¨ã€‚

ä¸ºäº†ä¾¿äºåˆ†æï¼Œå°†å¾ˆå¤šé«˜é˜¶çš„æš‚æ—¶ç”¨ä¸åˆ°çš„ç»„ä»¶ï¼ˆæ¯”å¦‚å·¥å…·æ ã€çª—å£ç®¡ç†ã€æ–‡ä»¶ä¸Šä¼ ã€è¿æ¥åå°Engineç­‰ï¼‰éƒ½åˆ æ‰ï¼Œç•™ä¸‹æœ€åŸºæœ¬çš„èƒ½è¿è¡Œæœ€å°åŒ–imjoyæ’ä»¶çš„åŠŸèƒ½ï¼Œæˆªå›¾å¦‚ä¸‹ï¼š


è¿™æ ·ä¾¿äºåˆ†ææ•´ä¸ªç»„ä»¶çš„å®è§‚ç»“æ„å’Œè¿è¡Œé€»è¾‘ã€‚
ä¸‹é¢æ˜¯å¯¹äºè¯¥æå°åŒ–ç»„ä»¶çš„é€è¡Œä»£ç åˆ†æã€‚

templateä»£ç 
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</summary>
    
    
    
    <category term="computer vision" scheme="http://qixinbo.github.io/categories/computer-vision/"/>
    
    
    <category term="ImJoy" scheme="http://qixinbo.github.io/tags/ImJoy/"/>
    
  </entry>
  
  <entry>
    <title>å¼€æºæ·±åº¦å­¦ä¹ è®¡ç®—å¹³å°ImJoyè§£æï¼š10 -- ImJoyä¸»ç«™ä¹‹å…¥å£æ–‡ä»¶</title>
    <link href="http://qixinbo.github.io/2022/02/27/ImJoy_10/"/>
    <id>http://qixinbo.github.io/2022/02/27/ImJoy_10/</id>
    <published>2022-02-26T16:00:00.000Z</published>
    <updated>2022-03-02T02:46:40.008Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><p>å‰é¢è®²äº†ImJoyçš„coreåº“å’Œrpcåº“ä½œä¸ºå‡½æ•°åº“å¦‚ä½•è¢«é›†æˆè°ƒç”¨ï¼Œè€ŒåŸºäºè¿™ä¸¤ä¸ªæ ¸å¿ƒåº“æœ‰ä¸€ä¸ªèƒ½å¼€ç®±å³ç”¨çš„å®Œæ•´ç½‘ç«™ï¼Œå³<a href="https://imjoy.io">ImJoyä¸»ç«™</a>ï¼Œä½¿ç”¨å®ƒå°±å¯ä»¥æ— éœ€äº†è§£ä¸Šé¢çš„æŠ€æœ¯ç»†èŠ‚ï¼Œç›´æ¥åŠ è½½å„ç§å‡½æ•°æ’ä»¶å³å¯ï¼ˆä½†ä¹Ÿå› ä¸ºè¿™æ ·ï¼Œä½ æ— æ³•æ›´æ”¹ç½‘ç«™æ ·è²Œï¼Œå¦‚æœæ²¡æœ‰å®šåˆ¶å¼€å‘çš„éœ€æ±‚ï¼Œåˆ™ç›´æ¥ä½¿ç”¨è¯¥ç½‘ç«™å³å¯ï¼‰ã€‚</p><p>ä»è¯¥æ–‡ç« å¼€å§‹ï¼Œå°†å°è¯•å¯¹ImJoyä¸»ç«™è¿›è¡Œè¯¦ç»†åˆ†æï¼Œçœ‹å®˜æ–¹æ˜¯æ€æ ·åº”ç”¨ImJoyçš„coreå’Œrpcåº“çš„ã€‚</p><h1 id="ä»£ç ç»“æ„"><a href="#ä»£ç ç»“æ„" class="headerlink" title="ä»£ç ç»“æ„"></a>ä»£ç ç»“æ„</h1><p>ImJoyä¸»ç«™æ˜¯ç”¨vue.jså‰ç«¯æ¡†æ¶å†™çš„ï¼Œæ•´ä¸ªç›®å½•ç»“æ„ç”±vueè„šæ‰‹æ¶vue-cli 4ç”Ÿæˆï¼Œæ‰€ä»¥é¦–å…ˆè¦åˆ†ææ¸…æ¥švueè„šæ‰‹æ¶ç”Ÿæˆçš„ä»£ç ç»“æ„æ˜¯æ€æ ·çš„ï¼Œå¯ä»¥å‚è€ƒ<a href="https://blog.csdn.net/weixin_43734095/article/details/106990775">è¿™ç¯‡æ•™ç¨‹</a><br>æˆªå–å…¶ä¸­çš„ä»£ç åˆ†æå›¾ï¼š<br><img src="https://user-images.githubusercontent.com/6218739/155942379-aeaeb37b-f46f-4145-b488-4ef8ea82c446.png" alt="vue-cli"></p><p>ç†æ¸…æ¥šä»£ç ç»“æ„åï¼Œä»å“ªé‡Œå¼€å§‹åˆ†æå‘¢ï¼Ÿ</p><h1 id="ç¨‹åºå…¥å£"><a href="#ç¨‹åºå…¥å£" class="headerlink" title="ç¨‹åºå…¥å£"></a>ç¨‹åºå…¥å£</h1><p><code>src/main.js</code>æ˜¯ç¨‹åºæ‰§è¡Œçš„å…¥å£æ–‡ä»¶ï¼Œæ‰€ä»¥æœ€å¥½æ˜¯é¡ºç€ä»£ç çš„æ‰§è¡Œè¿‡ç¨‹ä¸€æ­¥æ­¥åˆ†æã€‚<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br></pre></td></tr></table></figure><br>å¼•å…¥Vueå‡½æ•°ï¼Œåé¢å°†å®ä¾‹åŒ–å®ƒï¼Œä½œä¸ºæ•´ä¸ªç¨‹åº¦çš„æ€»è°ƒåº¦ï¼Œå³ï¼š<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">&quot;./App&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  el: <span class="string">&quot;#imjoy-app&quot;</span>,</span><br><span class="line">  router,</span><br><span class="line">  data: &#123;</span><br><span class="line">    store: store,</span><br><span class="line">    router: router,</span><br><span class="line">  &#125;,</span><br><span class="line">  template: <span class="string">&quot;&lt;App/&gt;&quot;</span>,</span><br><span class="line">  components: &#123;</span><br><span class="line">    App,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><br>å¯ä»¥çœ‹å‡ºï¼Œæ•´ä¸ªVueå®ä¾‹ç»‘å®šçš„æ˜¯IDåä¸º<code>imjoy-app</code>çš„htmlå…ƒç´ ï¼Œè€Œè¯¥å…ƒç´ æ˜¯ä½äº<code>public\index.html</code>æ–‡ä»¶ä¸­ï¼š<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;imjoy-app&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><br>å³ï¼š<code>src/main.js</code>æ˜¯ç¨‹åºæ‰§è¡Œçš„å…¥å£æ–‡ä»¶ï¼Œ<code>public\index.html</code>æ˜¯ç½‘é¡µæ˜¾ç¤ºçš„å…¥å£æ–‡ä»¶ï¼Œè‡³äºè¿™ä¸¤ä¸ªæ–‡ä»¶ä½œä¸ºå…¥å£æ˜¯vueçš„è„šæ‰‹æ¶åœ¨åå°æŒ‡å®šå¥½çš„ã€‚çŸ¥é“è¿™ä¸¤ä¸ªå…¥å£æ–‡ä»¶åï¼Œå°±å¯ä»¥å¾€åæŒ‰å›¾ç´¢éª¥èˆ¬ç ”ç©¶ã€‚<br>ä»ä¸Šè¿°ä»£ç è¿˜å¯ä»¥çœ‹å‡ºï¼Œè¯¥Vueå®ä¾‹ç®¡ç†äº†Appè¿™ä¸ªæ ¹ç»„ä»¶ï¼Œç”±è¯¥æ ¹ç»„ä»¶å†ç»Ÿä¸€å»ç®¡ç†å…¶ä»–æ‰€æœ‰ç»„ä»¶ï¼Œå³Appæ ¹ç»„ä»¶æ˜¾ç¤ºåˆ°<code>imjoy-app</code>è¿™ä¸ªhtmlå…ƒç´ ä¸Šã€‚<br>æ–°ç‰ˆçš„Vueè„šæ‰‹æ¶å¯¹äºvue2çš„å®ä¾‹åŒ–è¿™å—æ˜¯è¿™æ ·ä¹¦å†™çš„ï¼š<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">&#x27;./App.vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  render: <span class="function"><span class="params">h</span> =&gt;</span> h(App),</span><br><span class="line">&#125;).$mount(<span class="string">&#x27;#app&#x27;</span>)</span><br></pre></td></tr></table></figure><br>åŒæ ·å¾ˆç®€å•åœ°æŒ‡æ˜äº†Vueå®ä¾‹ä¸Appç»„ä»¶ã€appå…ƒç´ ä¹‹é—´çš„å…³ç³»ã€‚</p><h1 id="è·¯ç”±"><a href="#è·¯ç”±" class="headerlink" title="è·¯ç”±"></a>è·¯ç”±</h1><p>åœ¨<code>src/main.js</code>é‡Œç¬¬äºŒè¡Œå°±æ˜¯è·¯ç”±çš„è®¾ç½®ã€‚<br>Vue.js è·¯ç”±å…è®¸æˆ‘ä»¬é€šè¿‡ä¸åŒçš„ URL è®¿é—®ä¸åŒçš„å†…å®¹ã€‚<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¼•å…¥è·¯ç”±</span></span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&quot;./router&quot;</span>;</span><br></pre></td></tr></table></figure><br>è·¯ç”±çš„å®ç°æ¶‰åŠå¾ˆå¤šæ–‡ä»¶ï¼Œæ¯”å¦‚åœ¨å¦‚ä¸Š<code>router.js</code>æ–‡ä»¶ä¸­å®šä¹‰è·¯ç”±çš„è·¯å¾„å’Œç»„ä»¶ï¼ˆå³keyå’Œvalueï¼‰çš„æ˜ å°„å…³ç³»ã€åœ¨æ¨¡æ¿htmlæ–‡ä»¶ä¸­å®šä¹‰å“ªäº›å…ƒç´ è§¦å‘è·¯ç”±è·³è½¬ï¼ˆå¦‚router-linkï¼‰ä»¥åŠåŒ¹é…åˆ°è·¯ç”±åç»„ä»¶åœ¨å“ªæ˜¾ç¤ºï¼ˆrouter-viewï¼‰ã€æ³¨å†Œè·¯ç”±ç­‰ã€‚<br>æ¨è<a href="https://www.runoob.com/vue2/vue-routing.html">è¿™ç¯‡æ•™ç¨‹</a>ã€‚<br>Imjoyå®šä¹‰äº†å¤šä¸ªè·¯ç”±ï¼Œå¦‚<code>/</code>ã€<code>/app</code>ã€<code>/about</code>ç­‰ã€‚</p><h1 id="å‰ç«¯UI"><a href="#å‰ç«¯UI" class="headerlink" title="å‰ç«¯UI"></a>å‰ç«¯UI</h1><h2 id="UIç»„ä»¶åº“"><a href="#UIç»„ä»¶åº“" class="headerlink" title="UIç»„ä»¶åº“"></a>UIç»„ä»¶åº“</h2><p>åœ¨<code>src/main.js</code>é‡Œç¬¬ä¸‰è¡Œå°±æ˜¯UIåº“çš„å¼•å…¥ã€‚<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> VueMaterial <span class="keyword">from</span> <span class="string">&quot;vue-material&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;vue-material/dist/vue-material.min.css&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;vue-material/dist/theme/default.css&quot;</span>;</span><br><span class="line">Vue.use(VueMaterial);</span><br></pre></td></tr></table></figure><br>ImJoyå‰ç«¯ç»„ä»¶ä½¿ç”¨çš„æ˜¯<a href="https://github.com/vuematerial/vue-material">Vue Material</a>è¿™ä¸ªç»„ä»¶åº“ï¼Œå…¶é£æ ¼æ˜¯Googleå¼€å‘çš„Material Designè¿™ç§è®¾è®¡è¯­è¨€ï¼Œå³åŸç”ŸAndroidæ“ä½œç³»ç»Ÿä¸Šçš„è®¾è®¡é£æ ¼ã€‚<br>ä¸Šè¿°ä»£ç æ˜¯ä½¿ç”¨äº†å…¨å±€å¼•å…¥çš„æ–¹å¼ã€‚å…¶ç»„ä»¶çš„å…·ä½“ä½¿ç”¨æ–¹å¼åœ¨<a href="https://www.creative-tim.com/vuematerial/components/app">è¿™é‡Œ</a>ã€‚</p><h2 id="æ …æ ¼å¸ƒå±€"><a href="#æ …æ ¼å¸ƒå±€" class="headerlink" title="æ …æ ¼å¸ƒå±€"></a>æ …æ ¼å¸ƒå±€</h2><p>æ¥ç€å¼•å…¥äº†vue-grid-layoutï¼š<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> VueGridLayout <span class="keyword">from</span> <span class="string">&quot;vue-grid-layout&quot;</span>;</span><br><span class="line"></span><br><span class="line">Vue.component(<span class="string">&quot;grid-layout&quot;</span>, VueGridLayout.GridLayout);</span><br><span class="line">Vue.component(<span class="string">&quot;grid-item&quot;</span>, VueGridLayout.GridItem);</span><br></pre></td></tr></table></figure><br>vue-grid-layoutæ˜¯ä¸€ä¸ªå¯æ‹–æ‹½ã€å¯è°ƒæ•´å¤§å°çš„æ …æ ¼å¸ƒå±€ç³»ç»Ÿï¼Œç”¨äºæ‹–æ‹½è°ƒæ•´ImJoyå„ä¸ªç¨‹åºè¿è¡Œçª—å£çš„æ˜¾ç¤ºä½ç½®ç­‰ã€‚ </p><h2 id="è‡ªå®šä¹‰ç»„ä»¶"><a href="#è‡ªå®šä¹‰ç»„ä»¶" class="headerlink" title="è‡ªå®šä¹‰ç»„ä»¶"></a>è‡ªå®šä¹‰ç»„ä»¶</h2><p>ImJoyå†™äº†å¾ˆå¤šçš„è‡ªå®šä¹‰çš„ç»„ä»¶ã€‚<br>ç»„ä»¶ï¼ˆComponentï¼‰æ˜¯ Vue.js æœ€å¼ºå¤§çš„åŠŸèƒ½ä¹‹ä¸€ã€‚ç»„ä»¶å¯ä»¥æ‰©å±• HTML å…ƒç´ ï¼Œå°è£…å¯é‡ç”¨çš„ä»£ç ã€‚ç»„ä»¶ç³»ç»Ÿè®©æˆ‘ä»¬å¯ä»¥ç”¨ç‹¬ç«‹å¯å¤ç”¨çš„å°ç»„ä»¶æ¥æ„å»ºå¤§å‹åº”ç”¨ã€‚<br>ç»„ä»¶çš„ç›¸å…³çŸ¥è¯†æ¨è<a href="https://www.runoob.com/vue2/vue-component.html">è¿™ç¯‡æ•™ç¨‹</a>ã€‚<br>åœ¨<code>src/main.js</code>ä¸­ImJoyå°±å¼•å…¥äº†å®ƒå†™çš„å¾ˆå¤šç»„ä»¶ï¼Œå¹¶è¿›è¡Œäº†å…¨å±€æ³¨å†Œï¼š<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Imjoyç»„ä»¶ï¼Œå³https://imjoy.io/#/appè¿™ä¸ªé“¾æ¥æ‰€å±•ç¤ºçš„é¡µé¢ã€‚</span></span><br><span class="line"><span class="keyword">import</span> Imjoy <span class="keyword">from</span> <span class="string">&quot;@/components/Imjoy&quot;</span>;</span><br><span class="line"><span class="comment">// Aboutç»„ä»¶ï¼Œå³http://localhost:8001/#/aboutæ‰€å±•ç¤ºçš„é¡µé¢</span></span><br><span class="line"><span class="keyword">import</span> About <span class="keyword">from</span> <span class="string">&quot;@/components/About&quot;</span>;</span><br><span class="line"><span class="comment">// Whiteboardç»„ä»¶ï¼Œå³ImJoyä¸­é—´çš„å±•ç¤ºåŒºï¼Œå…¶åœ¨ä¸Šé¢çš„Imjoyç»„ä»¶ä¸­è¢«ä½¿ç”¨</span></span><br><span class="line"><span class="keyword">import</span> Whiteboard <span class="keyword">from</span> <span class="string">&quot;@/components/Whiteboard&quot;</span>;</span><br><span class="line"><span class="comment">// PluginListç»„ä»¶ï¼Œå³å®‰è£…æ’ä»¶æ—¶ä»äº‘ç«¯æœç´¢å¹¶ä¸‹è½½æ’ä»¶çš„çª—å£ï¼Œåœ¨Imjoyç»„ä»¶ä¸­è¢«ä½¿ç”¨</span></span><br><span class="line"><span class="keyword">import</span> PluginList <span class="keyword">from</span> <span class="string">&quot;@/components/PluginList&quot;</span>;</span><br><span class="line"><span class="comment">// PluginEditorç»„ä»¶ï¼Œå³ä»£ç ç¼–è¾‘å™¨ï¼Œå‡ºç°åœ¨Imjoyç»„ä»¶ä¸­æŸ¥çœ‹æ’ä»¶ä»£ç æ—¶ï¼Œä»¥åŠPluginListç»„ä»¶ä¸­åŒæ ·æŸ¥çœ‹æ’ä»¶ä»£ç æ—¶ã€‚</span></span><br><span class="line"><span class="keyword">import</span> PluginEditor <span class="keyword">from</span> <span class="string">&quot;@/components/PluginEditor&quot;</span>;</span><br><span class="line"><span class="comment">// PluginIconç»„ä»¶ï¼Œå³æ’ä»¶çš„å›¾æ ‡ï¼Œå‡ºç°åœ¨æ’ä»¶åˆ—è¡¨æœ€å³ä¾§ï¼Œå¦‚æœæ’ä»¶è‡ªå®šä¹‰äº†å›¾æ ‡ï¼Œåˆ™æ˜¾ç¤ºè¯¥å›¾æ ‡ï¼›å¦åˆ™æ˜¾ç¤ºé»˜è®¤çš„extensionå›¾æ ‡</span></span><br><span class="line"><span class="keyword">import</span> PluginIcon <span class="keyword">from</span> <span class="string">&quot;@/components/PluginIcon&quot;</span>;</span><br><span class="line"><span class="comment">// FileItemç»„ä»¶ï¼Œå³æ–‡ä»¶åˆ—è¡¨</span></span><br><span class="line"><span class="keyword">import</span> FileItem <span class="keyword">from</span> <span class="string">&quot;@/components/FileItem&quot;</span>;</span><br><span class="line"><span class="comment">// FileDialogç»„ä»¶ï¼Œå³æ–‡ä»¶å¯¹è¯æ¡†</span></span><br><span class="line"><span class="keyword">import</span> FileDialog <span class="keyword">from</span> <span class="string">&quot;@/components/FileDialog&quot;</span>;</span><br><span class="line"><span class="comment">// Windowç»„ä»¶ï¼Œå³ä»£ç ç¼–è¾‘å’Œç¨‹åºè¿è¡Œçª—å£ï¼Œåœ¨Imjoyç»„ä»¶ä¸­è¢«ä½¿ç”¨</span></span><br><span class="line"><span class="keyword">import</span> Window <span class="keyword">from</span> <span class="string">&quot;@/components/Window&quot;</span>;</span><br><span class="line"><span class="comment">// EngineControlPanelç»„ä»¶ï¼Œå³ImJoy appå³ä¸Šè§’çš„å°ç«ç®­å›¾æ ‡èœå•æ‰€å¯¹åº”çš„ç»„ä»¶</span></span><br><span class="line"><span class="keyword">import</span> EngineControlPanel <span class="keyword">from</span> <span class="string">&quot;@/components/EngineControlPanel&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…¨å±€æ³¨å†Œä»¥ä¸Šç»„ä»¶</span></span><br><span class="line">Vue.component(<span class="string">&quot;imjoy&quot;</span>, Imjoy);</span><br><span class="line">Vue.component(<span class="string">&quot;about&quot;</span>, About);</span><br><span class="line">Vue.component(<span class="string">&quot;whiteboard&quot;</span>, Whiteboard);</span><br><span class="line">Vue.component(<span class="string">&quot;plugin-list&quot;</span>, PluginList);</span><br><span class="line">Vue.component(<span class="string">&quot;plugin-editor&quot;</span>, PluginEditor);</span><br><span class="line">Vue.component(<span class="string">&quot;plugin-icon&quot;</span>, PluginIcon);</span><br><span class="line">Vue.component(<span class="string">&quot;file-item&quot;</span>, FileItem);</span><br><span class="line">Vue.component(<span class="string">&quot;file-dialog&quot;</span>, FileDialog);</span><br><span class="line">Vue.component(<span class="string">&quot;window&quot;</span>, Window);</span><br><span class="line">Vue.component(<span class="string">&quot;engine-control-panel&quot;</span>, EngineControlPanel);</span><br></pre></td></tr></table></figure><br>è¿˜æœ‰ä¸€äº›ç»„ä»¶æ²¡æœ‰è¢«å…¨å±€æ³¨å†Œï¼Œåªæ˜¯è¢«éƒ¨åˆ†å®ä¾‹ä½¿ç”¨ï¼Œå¦‚Homeç»„ä»¶ï¼ˆå³<a href="https://imjoy.io/#/">imjoyé¦–é¡µ</a>å±•ç¤ºçš„é¡µé¢ï¼‰ã€‚</p><h2 id="æ¨¡æ€æ¡†æ’ä»¶"><a href="#æ¨¡æ€æ¡†æ’ä»¶" class="headerlink" title="æ¨¡æ€æ¡†æ’ä»¶"></a>æ¨¡æ€æ¡†æ’ä»¶</h2><p>ImJoyå¼•å…¥äº†<a href="https://github.com/euvl/vue-js-modal">vue-js-modalæ¨¡æ€æ¡†æ’ä»¶</a>ï¼š<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> vmodal <span class="keyword">from</span> <span class="string">&quot;vue-js-modal&quot;</span>;</span><br><span class="line">Vue.use(vmodal);</span><br></pre></td></tr></table></figure><br>å®ƒçš„ä½¿ç”¨æ•™ç¨‹è§<a href="https://euvl.github.io/vue-js-modal/Intro.html#static-modals">è¿™é‡Œ</a>ã€‚</p><h1 id="äº‹ä»¶æ€»çº¿"><a href="#äº‹ä»¶æ€»çº¿" class="headerlink" title="äº‹ä»¶æ€»çº¿"></a>äº‹ä»¶æ€»çº¿</h1><p>æ¥ç€çœ‹<code>src/main.js</code>ï¼Œæ¥ä¸‹æ¥å¼•å…¥äº†äº‹ä»¶æ€»çº¿åº“ï¼š<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&quot;./store.js&quot;</span>;</span><br><span class="line"></span><br><span class="line">åœ¨store.jsä¸­ï¼š</span><br><span class="line"><span class="keyword">import</span> Minibus <span class="keyword">from</span> <span class="string">&quot;minibus&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> event_bus = Minibus.create();</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  event_bus: event_bus,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><br>å¯ä»¥çœ‹å‡ºImjoyå¼•å…¥äº†<a href="https://github.com/axelpale/minibus">minibusåº“</a>ï¼Œå®ç°åœ¨ä¸€ä¸ªåœ°æ–¹è§¦å‘ï¼ˆå‘å¸ƒï¼‰äº‹ä»¶ï¼Œç„¶åé€šè¿‡äº‹ä»¶ä¸­å¿ƒé€šçŸ¥æ‰€æœ‰è®¢é˜…è€…ï¼ˆè®¢é˜…ï¼‰ã€‚<br>onå‘å¸ƒè®¢é˜…ã€onceå‘å¸ƒè®¢é˜…(è§¦å‘ä¸€æ¬¡)ã€emité€šçŸ¥æ‰§è¡Œ(è§¦å‘äº‹ä»¶)ã€offå–æ¶ˆè®¢é˜…ã€‚</p>]]></content>
    
    
    <summary type="html">ç®€ä»‹
å‰é¢è®²äº†ImJoyçš„coreåº“å’Œrpcåº“ä½œä¸ºå‡½æ•°åº“å¦‚ä½•è¢«é›†æˆè°ƒç”¨ï¼Œè€ŒåŸºäºè¿™ä¸¤ä¸ªæ ¸å¿ƒåº“æœ‰ä¸€ä¸ªèƒ½å¼€ç®±å³ç”¨çš„å®Œæ•´ç½‘ç«™ï¼Œå³ImJoyä¸»ç«™ï¼Œä½¿ç”¨å®ƒå°±å¯ä»¥æ— éœ€äº†è§£ä¸Šé¢çš„æŠ€æœ¯ç»†èŠ‚ï¼Œç›´æ¥åŠ è½½å„ç§å‡½æ•°æ’ä»¶å³å¯ï¼ˆä½†ä¹Ÿå› ä¸ºè¿™æ ·ï¼Œä½ æ— æ³•æ›´æ”¹ç½‘ç«™æ ·è²Œï¼Œå¦‚æœæ²¡æœ‰å®šåˆ¶å¼€å‘çš„éœ€æ±‚ï¼Œåˆ™ç›´æ¥ä½¿ç”¨è¯¥ç½‘ç«™å³å¯ï¼‰ã€‚

ä»è¯¥æ–‡ç« å¼€å§‹ï¼Œå°†å°è¯•å¯¹ImJoyä¸»ç«™è¿›è¡Œè¯¦ç»†åˆ†æï¼Œçœ‹å®˜æ–¹æ˜¯æ€æ ·åº”ç”¨ImJoyçš„coreå’Œrpcåº“çš„ã€‚

ä»£ç ç»“æ„
ImJoyä¸»ç«™æ˜¯ç”¨vue.jså‰ç«¯æ¡†æ¶å†™çš„ï¼Œæ•´ä¸ªç›®å½•ç»“æ„ç”±vueè„šæ‰‹æ¶vue-cli 4ç”Ÿæˆï¼Œæ‰€ä»¥é¦–å…ˆè¦åˆ†ææ¸…æ¥švueè„šæ‰‹æ¶ç”Ÿæˆçš„ä»£ç ç»“æ„æ˜¯æ€æ ·çš„ï¼Œå¯ä»¥å‚è€ƒè¿™ç¯‡æ•™ç¨‹
æˆªå–å…¶ä¸­çš„ä»£ç åˆ†æå›¾ï¼š


ç†æ¸…æ¥šä»£</summary>
    
    
    
    <category term="computer vision" scheme="http://qixinbo.github.io/categories/computer-vision/"/>
    
    
    <category term="ImJoy" scheme="http://qixinbo.github.io/tags/ImJoy/"/>
    
  </entry>
  
  <entry>
    <title>å¼€æºæ·±åº¦å­¦ä¹ è®¡ç®—å¹³å°ImJoyè§£æï¼š9 -- é›†æˆ</title>
    <link href="http://qixinbo.github.io/2022/02/12/ImJoy_9/"/>
    <id>http://qixinbo.github.io/2022/02/12/ImJoy_9/</id>
    <published>2022-02-11T16:00:00.000Z</published>
    <updated>2022-03-04T08:05:50.754Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><p>ImJoyè®¾è®¡çš„åˆè¡·å°±åŒ…æ‹¬å¯ä»¥è¢«é›†æˆä½¿ç”¨ã€‚è¿™æ„å‘³ç€å®ƒå¯ä»¥æ ¹æ®éœ€æ±‚ä»¥å¤šç§æ–¹å¼é›†æˆåˆ°ä¸€ä¸ªé¡¹ç›®ä¸­ã€‚<br>è¿™é‡Œçš„â€œé›†æˆâ€æœ‰ä¸¤ä¸ªæ„æ€ï¼š<br>ï¼ˆ1ï¼‰å°†ImJoyçš„æ ¸å¿ƒcoreåº“é›†æˆåœ¨è‡ªå·±çš„ç½‘ç«™æˆ–webåº”ç”¨ä¸­ï¼Œä»è€Œå¯ä»¥è°ƒç”¨ImJoyç”Ÿæ€ä¸­çš„å„ç§æ’ä»¶ï¼›<br>ï¼ˆ2ï¼‰å°†ImJoyçš„è¿è¡Œæ—¶rpcåº“é›†æˆåˆ°è‡ªå·±çš„webåº”ç”¨ä¸­ï¼Œä»è€Œå°†è‡ªå·±çš„webåº”ç”¨è½¬æ¢ä¸ºImJoyçš„ä¸€ä¸ªæ’ä»¶ï¼Œå³è¢«åˆ«äººå¯è°ƒç”¨å’Œè®¿é—®ã€‚</p><h1 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h1><p>é›†æˆImJoyï¼ˆæ— è®ºæ˜¯imjoy-coreè¿˜æ˜¯imjoy-rpcï¼‰ä¸»è¦æœ‰ä¸‰ç§æ–¹å¼ï¼š<br>ï¼ˆ1ï¼‰åœ¨é¡µé¢ä¸Šä»¥ CDN åŒ…çš„å½¢å¼å¯¼å…¥ã€‚<br>ï¼ˆ2ï¼‰ä¸‹è½½ JavaScript æ–‡ä»¶å¹¶è‡ªè¡Œæ‰˜ç®¡ã€‚<br>ï¼ˆ3ï¼‰ä½¿ç”¨ npm å®‰è£…å®ƒã€‚<br>ä¸‹é¢è¯¦ç»†è¯´æ˜ã€‚</p><h2 id="CDN"><a href="#CDN" class="headerlink" title="CDN"></a>CDN</h2><p>å¯ä»¥ç›´æ¥ä½¿ç”¨æ‰˜ç®¡åœ¨CDNä¸Šçš„JSåº“ï¼ˆå¯¹äºimjoy-coreåº“å’Œimjoy-rpcåº“éƒ½æ˜¯å¼•ç”¨è¿™ä¸ªjsæ–‡ä»¶ï¼‰ï¼š<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=<span class="string">&quot;https://lib.imjoy.io/imjoy-loader.js&quot;</span>&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure><br>å¯ä»¥çœ‹å‡ºï¼Œimjoyçš„æ ¸å¿ƒåº“éƒ½åœ¨<a href="https://lib.imjoy.io">lib.imjoy.io</a>ä¸Šè¿›è¡Œäº†æ‰˜ç®¡ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œè¿™é‡Œæ”¾çš„æ˜¯æœ€æ–°çš„ç‰ˆæœ¬ã€‚<br>å¦å¤–ï¼Œåœ¨<a href="https://www.jsdelivr.com/?query=imjoy">jsdelivr</a>ä¸Šä¹Ÿæœ‰æ‰˜ç®¡ã€‚</p><h2 id="ä¸‹è½½å¹¶è‡ªæ‰˜ç®¡"><a href="#ä¸‹è½½å¹¶è‡ªæ‰˜ç®¡" class="headerlink" title="ä¸‹è½½å¹¶è‡ªæ‰˜ç®¡"></a>ä¸‹è½½å¹¶è‡ªæ‰˜ç®¡</h2><p>å¦‚æœä½ æƒ³é¿å…ä½¿ç”¨æ„å»ºå·¥å…·ï¼Œä½†åˆæ— æ³•åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨CDNï¼Œé‚£ä¹ˆå¯ä»¥ä¸‹è½½ç›¸å…³jsæ–‡ä»¶å¹¶è‡ªè¡Œæ‰˜ç®¡åœ¨è‡ªå·±çš„æœåŠ¡å™¨ä¸Šã€‚ç„¶åå¯ä»¥é€šè¿‡scriptæ ‡ç­¾å¼•å…¥ï¼Œä¸ä½¿ç”¨ CDN çš„æ–¹æ³•ç±»ä¼¼ã€‚<br>å¯ä»¥åœ¨<a href="https://github.com/imjoy-team/lib.imjoy.io">è¿™ä¸ªGitHubä»“åº“</a>é‡Œç›´æ¥ä¸‹è½½é‚£äº›jsæ–‡ä»¶ã€‚</p><h3 id="è‡ªå·±æ‰“åŒ…"><a href="#è‡ªå·±æ‰“åŒ…" class="headerlink" title="è‡ªå·±æ‰“åŒ…"></a>è‡ªå·±æ‰“åŒ…</h3><p>è¿™äº›æ‰“åŒ…å¥½çš„é“¾æ¥åº“çš„æºç åœ¨<a href="https://github.com/imjoy-team/imjoy-core">imjoy-coreè¿™ä¸ªä»“åº“</a>é‡Œï¼Œå¦‚æœæƒ³å¯¹å®ƒçš„æºç è¿›è¡Œä¿®æ”¹ï¼Œå¯ä»¥å…‹éš†ä¸‹æ¥è¿™ä¸ªä»“åº“ï¼Œç„¶åå†è‡ªå·±æ‰“åŒ…ï¼Œå³ï¼š<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">git clone https:<span class="comment">//github.com/imjoy-team/imjoy-core.git</span></span><br><span class="line">cd imjoy-core</span><br><span class="line">npm run install</span><br><span class="line"></span><br><span class="line"># test</span><br><span class="line">npm run test</span><br><span class="line"></span><br><span class="line"># build</span><br><span class="line">npm run build</span><br></pre></td></tr></table></figure><br>ä¸Šé¢çš„å‘½ä»¤å¯¹äºlinuxå’Œmacç³»ç»Ÿæ˜¯é€‚ç”¨çš„ï¼Œå¦‚æœæ˜¯windowsç³»ç»Ÿï¼Œå¯ä»¥ç›´æ¥ï¼š<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx webpack</span><br></pre></td></tr></table></figure><br>è¿›è¡Œæ‰“åŒ…ã€‚</p><h2 id="npm"><a href="#npm" class="headerlink" title="npm"></a>npm</h2><p>åœ¨ç”¨ imjoy æ„å»ºå¤§å‹åº”ç”¨æ—¶æ¨èä½¿ç”¨ npm å®‰è£…ã€‚npmèƒ½å¾ˆå¥½åœ°å’Œwebpackç­‰æ‰“åŒ…å™¨é…åˆä½¿ç”¨ã€‚<br>å¯¹äºimjoy-coreåº“ï¼š<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install imjoy-core</span><br></pre></td></tr></table></figure><br>å¯¹äºimjoy-rpcåº“ï¼š<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install imjoy-rpc</span><br></pre></td></tr></table></figure></p><h1 id="é›†æˆImjoy-Core"><a href="#é›†æˆImjoy-Core" class="headerlink" title="é›†æˆImjoy Core"></a>é›†æˆImjoy Core</h1><h2 id="ç›´æ¥å¼•ç”¨"><a href="#ç›´æ¥å¼•ç”¨" class="headerlink" title="ç›´æ¥å¼•ç”¨"></a>ç›´æ¥å¼•ç”¨</h2><h3 id="åœ¨çº¿å¼•ç”¨"><a href="#åœ¨çº¿å¼•ç”¨" class="headerlink" title="åœ¨çº¿å¼•ç”¨"></a>åœ¨çº¿å¼•ç”¨</h3><p>æ–°å»ºä¸€ä¸ªcore-example.htmlçš„æ–‡ä»¶ï¼ˆè¿™ä¸ªæ–‡ä»¶åœ¨<a href="https://github.com/imjoy-team/imjoy-core/blob/master/src/core-example.html">è¿™é‡Œ</a>ï¼‰ï¼Œå†™å…¥ä»¥ä¸‹å†…å®¹ï¼š<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span>&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;utf-8&quot;</span> /&gt;</span><br><span class="line">    &lt;title&gt;ImJoy Core Example&lt;/title&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line"></span><br><span class="line">  &lt;body&gt;</span><br><span class="line">    &lt;h1&gt;ImJoy Core Example&lt;/h1&gt;</span><br><span class="line">    &lt;script src=<span class="string">&quot;https://lib.imjoy.io/imjoy-loader.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script&gt;</span><br><span class="line">      loadImJoyCore().then(<span class="function"><span class="params">imjoyCore</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> imjoy = <span class="keyword">new</span> imjoyCore.ImJoy(&#123;</span><br><span class="line">          imjoy_api: &#123;&#125;,</span><br><span class="line">          <span class="comment">//imjoy core config</span></span><br><span class="line">        &#125;);</span><br><span class="line">        imjoy.start(&#123; <span class="attr">workspace</span>: <span class="literal">null</span> &#125;).then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          alert(<span class="string">&quot;ImJoy Core started successfully!&quot;</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;);</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><br>åŒå‡»è¯¥é¡µé¢ä¼šåœ¨æµè§ˆå™¨ä¸­è¿è¡Œå®ƒï¼Œæ•ˆæœæ˜¯å‘ˆç°ä¸€ä¸ªå¼¹å‡ºæ¡†è¡¨æ˜æˆåŠŸå¯åŠ¨äº†ImJoyã€‚</p><h3 id="æœ¬åœ°æ‰˜ç®¡å¼•ç”¨"><a href="#æœ¬åœ°æ‰˜ç®¡å¼•ç”¨" class="headerlink" title="æœ¬åœ°æ‰˜ç®¡å¼•ç”¨"></a>æœ¬åœ°æ‰˜ç®¡å¼•ç”¨</h3><p>ä¸Šé¢ä¾‹å­æ˜¯åœ¨çº¿å¼•ç”¨<a href="https://lib.imjoy.io/imjoy-loader.js">https://lib.imjoy.io/imjoy-loader.js</a>è¿™ä¸ªæ–‡ä»¶ã€‚<br>å¯¹äºæœ¬åœ°æ‰˜ç®¡çš„æ–‡ä»¶ï¼Œå¯ä»¥å°†ä¸Šè¿°é¡µé¢çš„å¯¹åº”éƒ¨åˆ†æ”¹ä¸ºå¦‚ä¸‹ï¼š<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=<span class="string">&quot;/imjoy-loader.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">  loadImJoyCore(</span><br><span class="line">    &#123;</span><br><span class="line">      base_url: <span class="string">&quot;/&quot;</span>,</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><br>å³å¼•ç”¨æœ¬åœ°è·¯å¾„ä¸‹çš„æ–‡ä»¶ã€‚<br>ä½†è¿™æ ·æ”¹å†™åå¹¶ä¸èƒ½ç›´æ¥è¿è¡Œè¯¥htmlæ–‡ä»¶ï¼Œå› ä¸ºå®ƒç°åœ¨æ˜¯æœ¬åœ°æ–‡ä»¶ï¼Œéœ€è¦å°†å…¶æ”¾ç½®åœ¨ä¸€ä¸ªæœåŠ¡å™¨ä¸Šä»¥httpä¼ è¾“æ‰è¡Œã€‚<br>æœ€ç®€å•çš„ä¸€ä¸ªè¿è¡Œæ–¹å¼æ˜¯åœ¨æœ¬åœ°å¯ç”¨ä¸€ä¸ªæµ‹è¯•æœåŠ¡å™¨ï¼Œæ¯•ç«Ÿæ­¤å¤„åªæ˜¯ä¸ºäº†æµ‹è¯•è¿™ä¸ªæ–‡ä»¶çš„è¿è¡Œã€‚<br>å¦‚æœä½¿ç”¨pythonï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m http.server</span><br></pre></td></tr></table></figure><br>è¿™æ ·å°±å¯ä»¥åœ¨è¿™ä¸ªæœ¬åœ°webæœåŠ¡å™¨ä¸ŠæŸ¥çœ‹è¯¥ç›®å½•ä¸‹çš„å†…å®¹ã€‚<br>å…·ä½“åŸç†è§<a href="https://developer.mozilla.org/zh-CN/docs/Learn/Common_questions/set_up_a_local_testing_server">å¦‚ä½•è®¾ç½®ä¸€ä¸ªæœ¬åœ°æµ‹è¯•æœåŠ¡å™¨ï¼Ÿ</a></p><p>pythonçš„è¿™ä¸ªæµ‹è¯•æœåŠ¡å™¨åŠŸèƒ½éå¸¸å¼±ï¼Œåˆ°äº†å…·ä½“éƒ¨ç½²åº”ç”¨æ—¶ï¼Œå¯ä»¥ä½¿ç”¨nginxæ¥æ„å»ºwebæœåŠ¡å™¨ä»è€Œé¡ºåˆ©æ‰¾åˆ°è¿™äº›æ–‡ä»¶ã€‚<br><a href="https://blog.csdn.net/vfsdfdsf/article/details/89354541">Windowsç¯å¢ƒåˆ©ç”¨nginxæ­å»ºwebæœåŠ¡å™¨</a></p><h2 id="npmåŒ…å¼•ç”¨"><a href="#npmåŒ…å¼•ç”¨" class="headerlink" title="npmåŒ…å¼•ç”¨"></a>npmåŒ…å¼•ç”¨</h2><p>å¦‚ä¸Šæ‰€è¿°ï¼Œå¦‚æœè¦å¼€å‘å¤§å‹ç¨‹åºï¼Œè¿˜æ˜¯æ¨èä½¿ç”¨npmåŒ…çš„å½¢å¼è¿›è¡Œã€‚<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> imjoyCore <span class="keyword">from</span> <span class="string">&#x27;imjoy-core&#x27;</span></span><br><span class="line"><span class="keyword">const</span> imjoy = <span class="keyword">new</span> imjoyCore.ImJoy(&#123;</span><br><span class="line">    imjoy_api: &#123;&#125;,</span><br><span class="line">    <span class="comment">//imjoy config</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">imjoy.start(&#123;<span class="attr">workspace</span>: <span class="string">&#x27;default&#x27;</span>&#125;).then(<span class="keyword">async</span> ()=&gt;&#123;</span><br><span class="line">    <span class="keyword">await</span> imjoy.api.alert(<span class="string">&quot;hello world&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><br>ä¸è¿‡ä¸Šé¢ä»£ç ç°åœ¨è¿˜æ²¡æ³•ç›´æ¥è¿è¡Œã€‚<br>å› ä¸ºImJoyæ˜¯åŸºäºæµè§ˆå™¨çš„ï¼Œå®ƒéœ€è¦è·å–æµè§ˆå™¨çš„windowå¯¹è±¡ï¼ˆå³åŒ…å«DOMæ–‡æ¡£çš„çª—å£ï¼‰ï¼Œæ‰€ä»¥å®ƒå¾—è¿è¡Œåœ¨å‰ç«¯ï¼Œä¸èƒ½ä½œä¸ºåç«¯çš„åŒ…ä½¿ç”¨ã€‚<br>å› æ­¤é¦–å…ˆä¸èƒ½ä½¿ç”¨node.jsæ¥è¿è¡ŒåŒ…å«ImJoyçš„ç¨‹åºï¼Œä¸æ­¤åŒæ—¶ï¼ŒnpmåŒ…è¿™ç§ç¼–ç¨‹å¼•ç”¨æ–¹å¼è¿˜éœ€è¦è¢«æµè§ˆå™¨è®¤è¯†ï¼Œå› æ­¤æ­¤æ—¶éœ€è¦webpackè¿™ä¸€ç±»çš„æ‰“åŒ…å·¥å…·æ¥è¿›è¡Œå¼€å‘ã€‚<br>è¿™é‡Œå¯ä»¥ä½¿ç”¨åŸç”Ÿçš„webpackæ¥æ‰“åŒ…å¼€å‘ï¼Œä¸è¿‡webpackçš„é…ç½®æŒºå¤æ‚çš„ï¼Œè¿™é‡Œæ¨èç›´æ¥ä½¿ç”¨Vue.jsæ¥å¼€å‘ï¼Œè¿™æ ·æ—¢èƒ½æ–¹ä¾¿åœ°æ„å»ºå‰ç«¯é¡µé¢ï¼Œä¹Ÿèƒ½å€ŸåŠ©Vue-cliè„šæ‰‹æ¶æ¥å¾ˆæ–¹ä¾¿çš„æ‰“åŒ…å’Œéƒ¨ç½²ï¼ˆå‚è€ƒæ•™ç¨‹å¯ä»¥çœ‹ä¸‹é¢çš„æ¨èé“¾æ¥ï¼‰ã€‚</p><p>å¦‚æœé€‰æ‹©Vue.jsè¿›è¡Œå¼€å‘ï¼Œé‚£ä¹ˆä¸Šé¢çš„ä»£ç å¯ä»¥ç›´æ¥æ”¾åœ¨æŸä¸ªVueç»„ä»¶ä¸­ï¼Œç„¶åå†é€šè¿‡ï¼š<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run serve</span><br></pre></td></tr></table></figure><br>è¿›è¡Œçƒ­éƒ¨ç½²å³å¯è¿è¡ŒæŸ¥çœ‹ã€‚</p><h1 id="é›†æˆImjoy-RPC"><a href="#é›†æˆImjoy-RPC" class="headerlink" title="é›†æˆImjoy RPC"></a>é›†æˆImjoy RPC</h1><h2 id="ç›´æ¥å¼•ç”¨-1"><a href="#ç›´æ¥å¼•ç”¨-1" class="headerlink" title="ç›´æ¥å¼•ç”¨"></a>ç›´æ¥å¼•ç”¨</h2><h3 id="åœ¨çº¿å¼•ç”¨-1"><a href="#åœ¨çº¿å¼•ç”¨-1" class="headerlink" title="åœ¨çº¿å¼•ç”¨"></a>åœ¨çº¿å¼•ç”¨</h3><p>æ–°å»ºä¸€ä¸ªplugin-example.htmlçš„æ–‡ä»¶ï¼ˆè¿™ä¸ªdemoæ–‡ä»¶åœ¨<a href="https://github.com/imjoy-team/imjoy-core/blob/master/src/plugin-example.html">è¿™é‡Œ</a>ï¼‰ï¼Œå†™å…¥ä»¥ä¸‹å†…å®¹ï¼š<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>ImJoy Plugin Example<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>ImJoy Plugin Example<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://lib.imjoy.io/imjoy-loader.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">      loadImJoyRPC().then(<span class="keyword">async</span> imjoyRPC =&gt; &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> api = <span class="keyword">await</span> imjoyRPC.setupRPC(&#123; <span class="attr">name</span>: <span class="string">&quot;My Awesome App&quot;</span> &#125;);</span></span><br><span class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> <span class="title">setup</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">          api.alert(<span class="string">&quot;ImJoy RPC initialized. Hello!&quot;</span>);</span></span><br><span class="line">        &#125;</span><br><span class="line"><span class="javascript">        <span class="comment">// define your api which can be called by other plugins in ImJoy</span></span></span><br><span class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> <span class="title">my_api_func</span>(<span class="params"></span>) </span>&#123;&#125;</span></span><br><span class="line"><span class="javascript">        <span class="comment">// Importantly, you need to call `api.export(...)` in order to expose the api for your web application</span></span></span><br><span class="line">        api.export(&#123; setup: setup, my_api_func: my_api_func &#125;);</span><br><span class="line">      &#125;);</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><br>ä½†è¯¥æ–‡ä»¶å¹¶ä¸èƒ½åƒä¸Šé¢çš„core-example.htmlé‚£æ ·å¯ä»¥ç›´æ¥åŒå‡»è¿è¡Œï¼Œä¼šæŠ¥å¦‚ä¸‹é”™è¯¯ï¼š<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Uncaught (in promise) Error: imjoy-rpc should only run inside an iframe or a webworker.</span><br></pre></td></tr></table></figure><br>è¿™æ˜¯å› ä¸ºæ³¨å…¥äº†ImJoy RPCè¿è¡Œæ—¶çš„webåº”ç”¨å¿…é¡»åœ¨ImJoyä¸­ä½œä¸ºä¸€ä¸ªæ’ä»¶ä½¿ç”¨ã€‚<code>è¿™æ ·åšçš„ç›®çš„æ˜¯éš”ç¦»è¿è¡Œç¯å¢ƒï¼Œä»è€Œè®©æ’ä»¶æ”¯æŒä»»æ„webæ¡†æ¶ã€‚</code>ï¼ˆæ¥è‡ªImJoyä½œè€…çš„äº¤æµæŒ‡ç‚¹ï¼Œthanksï¼‰ã€‚<br>é‚£ä¹ˆï¼Œä¸ºäº†è®©ä¸Šé¢è¿™ä¸ªæ–‡ä»¶æ­£å¸¸è¿è¡Œï¼Œéœ€è¦è¿›è¡Œå¦‚ä¸‹æ“ä½œï¼š<br>ï¼ˆ1ï¼‰å°†å®ƒæ‰˜ç®¡æˆä¸ºä¸€ä¸ªweb appï¼Œå¾—åˆ°å®ƒçš„ä½¿ç”¨é“¾æ¥ã€‚è¿™é‡Œå¯ä»¥ä½¿ç”¨ä»»æ„æ‰˜ç®¡æœåŠ¡ï¼Œæ¯”å¦‚ä¸Šé¢çš„æµ‹è¯•æœåŠ¡å™¨ã€nginxæœåŠ¡å™¨ï¼Œä»¥åŠGithub pagesç­‰ï¼›<br>ï¼ˆ2ï¼‰åœ¨ä»»æ„ä¸€ä¸ªå…¶ä»–çš„ImJoyæ’ä»¶ä¸­ï¼Œä½¿ç”¨è¯¥web appã€‚</p><p>ä¸ºäº†ç®€åŒ–æ¼”ç¤ºï¼Œé‡‡ç”¨æœ€ç®€å•çš„æ–¹æ³•ï¼š<br>å¯¹äºç¬¬ä¸€æ­¥ï¼Œç›´æ¥ä½¿ç”¨pythonçš„æµ‹è¯•æœåŠ¡å™¨ï¼›<br>å¯¹äºç¬¬äºŒæ­¥ï¼Œä¿®æ”¹ä¸Šé¢çš„core-example.htmlæ–‡ä»¶ä¸ºï¼š<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>ImJoy Core Example<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>ImJoy Core Example<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/imjoy-loader.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">      loadImJoyCore().then(<span class="function"><span class="params">imjoyCore</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(imjoyCore);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> imjoy = <span class="keyword">new</span> imjoyCore.ImJoy(&#123;</span></span><br><span class="line">          imjoy_api: &#123;&#125;,</span><br><span class="line"><span class="javascript">          <span class="comment">//imjoy core config</span></span></span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line"><span class="javascript">        imjoy.start(&#123; <span class="attr">workspace</span>: <span class="literal">null</span> &#125;).then(<span class="keyword">async</span> () =&gt; &#123;</span></span><br><span class="line"><span class="javascript">          alert(<span class="string">&quot;ImJoy Core started successfully!&quot;</span>);</span></span><br><span class="line"><span class="javascript">          <span class="keyword">const</span> win = <span class="keyword">await</span> imjoy.api.createWindow(&#123;</span></span><br><span class="line"><span class="javascript">          type: <span class="string">&#x27;My Window&#x27;</span>,</span></span><br><span class="line"><span class="javascript">          src: <span class="string">&#x27;/plugin-example.html&#x27;</span>,</span></span><br><span class="line">          data: &#123; &#125;</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line"><span class="javascript">        imjoy.event_bus.on(<span class="string">&quot;add_window&quot;</span>, <span class="function"><span class="params">w</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">          <span class="keyword">const</span> container = <span class="built_in">document</span>.createElement(<span class="string">&#x27;div&#x27;</span>);</span></span><br><span class="line"><span class="javascript">          container.id = w.window_id; <span class="comment">// &lt;--- this is important</span></span></span><br><span class="line"><span class="javascript">          container.style.backgroundColor = <span class="string">&#x27;#ececec&#x27;</span>;</span></span><br><span class="line"><span class="javascript">          container.style.height = <span class="string">&quot;300px&quot;</span>;</span></span><br><span class="line"><span class="javascript">          container.style.width = <span class="string">&quot;100%&quot;</span>;</span></span><br><span class="line"><span class="javascript">          <span class="comment">// Here we simply add to the body</span></span></span><br><span class="line"><span class="javascript">          <span class="comment">// but in reality, you can embed it into your UI</span></span></span><br><span class="line"><span class="javascript">          <span class="built_in">document</span>.body.appendChild(container)</span></span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">      &#125;);</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><br>ç°åœ¨ï¼Œè¿è¡Œæ•ˆæœå¦‚ä¸‹ï¼š<br><img src="https://user-images.githubusercontent.com/6218739/155644211-416c4dc6-2b49-4810-a1d5-c590a854e7b8.png" alt="rpc-demo"><br>å³ç”Ÿæˆäº†ä¸€ä¸ªçª—å£ï¼Œé‡Œé¢è¿è¡Œäº†é‚£ä¸ªdemo appã€‚</p><h3 id="æœ¬åœ°æ‰˜ç®¡å¼•ç”¨-1"><a href="#æœ¬åœ°æ‰˜ç®¡å¼•ç”¨-1" class="headerlink" title="æœ¬åœ°æ‰˜ç®¡å¼•ç”¨"></a>æœ¬åœ°æ‰˜ç®¡å¼•ç”¨</h3><p>è·Ÿä¸Šé¢imjoy-coreåº“çš„å¼•ç”¨æ–¹å¼ç›¸åŒã€‚</p><h2 id="npmåŒ…å¼•ç”¨-1"><a href="#npmåŒ…å¼•ç”¨-1" class="headerlink" title="npmåŒ…å¼•ç”¨"></a>npmåŒ…å¼•ç”¨</h2><p>å¼•ç”¨æ–¹å¼ä¹Ÿæ˜¯ç±»ä¼¼äºimjoy-coreåº“ï¼š<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; imjoyRPC &#125; <span class="keyword">from</span> <span class="string">&#x27;imjoy-rpc&#x27;</span>;</span><br><span class="line"></span><br><span class="line">imjoyRPC.setupRPC(&#123;<span class="attr">name</span>: <span class="string">&#x27;My Awesome App&#x27;</span>&#125;).then(<span class="function">(<span class="params">api</span>)=&gt;</span>&#123;</span><br><span class="line"> <span class="comment">// call api.export to expose your plugin api</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><br>ç„¶åä¹Ÿæ˜¯åœ¨å…¶ä»–æ’ä»¶ä¸­ä½¿ç”¨è¯¥appæ‰å¯ä»¥ï¼š<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// as a new window</span></span><br><span class="line"><span class="keyword">const</span> win = <span class="keyword">await</span> api.createWindow(&#123;</span><br><span class="line">    type: <span class="string">&#x27;My Awesome App&#x27;</span>,</span><br><span class="line">    src: <span class="string">&#x27;https://my-awesome-app.com/&#x27;</span>,</span><br><span class="line">    data: &#123; &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// or, as a dialog</span></span><br><span class="line"><span class="keyword">const</span> win = <span class="keyword">await</span> api.showDialog(&#123;</span><br><span class="line">    type: <span class="string">&#x27;My Awesome App&#x27;</span>,</span><br><span class="line">    src: <span class="string">&#x27;https://my-awesome-app.com/&#x27;</span>,</span><br><span class="line">    data: &#123; &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// further interaction can be performed via `win` object</span></span><br></pre></td></tr></table></figure></p><h1 id="ç›´æ¥å¼•ç”¨jsçš„API"><a href="#ç›´æ¥å¼•ç”¨jsçš„API" class="headerlink" title="ç›´æ¥å¼•ç”¨jsçš„API"></a>ç›´æ¥å¼•ç”¨jsçš„API</h1><p>ä¸Šé¢ä¸¤ç§ç›´æ¥å¼•ç”¨jsæ–‡ä»¶çš„æ–¹å¼ï¼Œå…¶æä¾›äº†ä¸‰ä¸ªä¸»è¦çš„å‡½æ•°ä¾›è°ƒç”¨ï¼š<br>ï¼ˆ1ï¼‰loadImJoyCoreï¼šåŠ è½½ImJoyæ ¸å¿ƒåº“ï¼Œä½¿å¾—å¯ä»¥è°ƒç”¨ImJoyçš„å„ç§API<br>ï¼ˆ2ï¼‰loadImJoyRPCï¼šåŠ è½½ImJoyçš„rpcåº“ï¼Œä½¿å¾—æ’ä»¶å¯ä»¥é€šä¿¡ï¼Œæ³¨æ„ä»…åœ¨iframeé‡Œæ‰èƒ½ä½¿ç”¨è¿™ä¸ªå‡½æ•°<br>ï¼ˆ3ï¼‰loadImJoyBasicAppï¼šä¸€ä¸ªç®€æ˜“ä½†åŠŸèƒ½å®Œå–„çš„ImJoyæœ€å°åŒ–appã€‚</p><p>å¯¹äºè¿™ä¸‰ä¸ªåŠ è½½å‡½æ•°ï¼Œå¯ä»¥é€‰æ‹©æ€§åœ°ä¼ å…¥ä»¥ä¸‹é…ç½®å¯¹è±¡ï¼š</p><ul><li>version: æŒ‡å®šimjoy-coreæˆ–imjoy-rpcçš„ç‰ˆæœ¬</li><li>api_version: ä»…é€‚ç”¨äºimjoy-rpcï¼Œé™å®šRPCçš„apiç‰ˆæœ¬</li><li>debug: åŠ è½½imjoy-coreæœªå‹ç¼©è¿‡çš„åŒ…å«è°ƒè¯•ä¿¡æ¯çš„ç‰ˆæœ¬ï¼Œå¼€å‘é˜¶æ®µä½¿ç”¨</li><li>base_url: è‡ªå®šä¹‰åŠ è½½è¿™äº›åº“çš„è·¯å¾„ï¼ˆä¸Šé¢å·²æ¼”ç¤ºè¿‡ï¼Œå¯ä»¥è®¾ç½®è¿™ä¸ªå‚æ•°æ¥ä½¿ç”¨æœ¬åœ°æ‰˜ç®¡çš„åº“ï¼‰</li></ul><p>å¯¹äºloadImJoyBasicAppï¼Œè¿˜æœ‰å…¶ä»–é¢å¤–çš„é€‰é¡¹ï¼š</p><ul><li>process_url_query: å¸ƒå°”å€¼ï¼Œæ˜¯å¦å¤„ç†urlè¯·æ±‚</li><li>show_window_title: å¸ƒå°”å€¼ï¼Œæ˜¯å¦æ˜¾ç¤ºçª—å£æ ‡é¢˜</li><li>show_progress_bar: å¸ƒå°”å€¼ï¼Œæ˜¯å¦æ˜¾ç¤ºè¿›åº¦æ¡</li><li>show_empty_window: å¸ƒå°”å€¼ï¼Œæ˜¯å¦æ˜¾ç¤ºç©ºç™½çª—å£</li><li>hide_about_imjoy: å¸ƒå°”å€¼ï¼Œæ˜¯å¦éšè—â€œå…³äºâ€èœå•</li><li>menu_style: Object, èœå•æ ·å¼</li><li>window_style: Object, çª—å£æ ·å¼</li><li>main_container: String, å®šä¹‰ä¸»å®¹å™¨çš„id</li><li>menu_container: String, å®šä¹‰èœå•å®¹å™¨çš„id</li><li>window_manager_container: String, å®šä¹‰çª—å£ç®¡ç†å™¨çš„id</li><li>imjoy_api: Object, é‡è½½ä¸€äº›ImJoy APIå‡½æ•°çš„å®ç°</li></ul><p>è¿™é‡Œæ˜¯ä½¿ç”¨loadImJoyBasicAppç¼–å†™çš„ä¸€ä¸ª<a href="https://imjoy.io/lite">è½»é‡åŒ–çš„ImJoy app</a>ï¼Œæºä»£ç åœ¨<a href="https://github.com/imjoy-team/ImJoy/blob/master/web/public/lite.html">è¿™é‡Œ</a>ã€‚</p><h2 id="è‡ªåŠ¨åˆ‡æ¢coreå’Œplugin"><a href="#è‡ªåŠ¨åˆ‡æ¢coreå’Œplugin" class="headerlink" title="è‡ªåŠ¨åˆ‡æ¢coreå’Œplugin"></a>è‡ªåŠ¨åˆ‡æ¢coreå’Œplugin</h2><p>å¯¹äºä¸€ä¸ªæ—¢å¯ä»¥ä½œä¸ºæ’ä»¶pluginï¼Œåˆå¯ä»¥ä½¿ç”¨imjoy coreçš„web appï¼ŒImJoyæä¾›äº†ä¸€ä¸ªå‡½æ•°æ¥æ£€æµ‹å½“å‰appï¼Œä»è€Œåœ¨ä¸¤ç§æ¨¡å¼é—´è‡ªåŠ¨åˆ‡æ¢ï¼š<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// check if it&#x27;s inside an iframe</span></span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">window</span>.self !== <span class="built_in">window</span>.top)&#123;</span><br><span class="line">    loadImJoyRPC().then(<span class="function">(<span class="params">imjoyRPC</span>)=&gt;</span>&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    loadImJoyCore().then(<span class="function">(<span class="params">imjoyCore</span>)=&gt;</span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><p>ä¸Šé¢çš„æŠ€æœ¯éœ€è¦ç”¨åˆ°çš„webçŸ¥è¯†ï¼š<br>ï¼ˆ1ï¼‰JavaScriptè¯­æ³•ï¼š<br><a href="https://www.runoob.com/w3cnote/es6-module.html">ES6 æ¨¡å—</a><br><a href="https://www.runoob.com/js/js-async.html">JavaScript å¼‚æ­¥ç¼–ç¨‹</a><br><a href="https://www.ruanyifeng.com/blog/2012/12/asynchronous%EF%BC%BFjavascript.html">Javascriptå¼‚æ­¥ç¼–ç¨‹çš„4ç§æ–¹æ³•</a><br><a href="https://www.liaoxuefeng.com/wiki/1022910821149312/1023024413276544">Promise</a><br><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Using_promises">ä½¿ç”¨Promise</a><br><a href="https://developer.mozilla.org/zh-CN/docs/Learn/JavaScript/Asynchronous/Async_await">asyncå’Œawait:è®©å¼‚æ­¥ç¼–ç¨‹æ›´ç®€å•</a><br><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/async_function">asyncå‡½æ•°</a><br><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/await">await</a><br>ï¼ˆ2ï¼‰Webpackæ‰“åŒ…ï¼š<br><a href="https://www.jiangruitao.com/webpack/">Webpack æ•™ç¨‹</a><br>ï¼ˆ3ï¼‰Node.jså¼€å‘ï¼š<br><a href="https://segmentfault.com/q/1010000022020967">es6çš„importæ˜¯ä¸æ˜¯ä¹Ÿå¯ä»¥å¯¼å…¥csså’Œscssï¼Ÿ</a><br><a href="https://www.zhihu.com/question/358026810">vue main.jsä¸­å¼•å…¥node_modulesä¸­çš„æ–‡ä»¶ä¸ºä»€ä¹ˆè·¯å¾„ä¸ç”¨å†™node_modules?</a><br><a href="https://github.com/SunshowerC/blog/issues/8">package.json ä¸­ ä½ è¿˜ä¸æ¸…æ¥šçš„ browserï¼Œmoduleï¼Œmain å­—æ®µä¼˜å…ˆçº§</a><br>ï¼ˆ4ï¼‰Vue.jså¼€å‘ï¼š<br>è§†é¢‘æ•™ç¨‹æ¨èï¼š<br><a href="https://www.bilibili.com/video/BV1Zy4y1K7SH?from=search&amp;seid=396170412927101372">å°šç¡…è°·Vue2.0+Vue3.0å…¨å¥—æ•™ç¨‹ä¸¨vuejsä»å…¥é—¨åˆ°ç²¾é€š</a><br>æ–‡å­—ç‰ˆçš„æ•™ç¨‹æ¨èï¼š<br><a href="https://www.runoob.com/vue2/vue-tutorial.html">Vue.jsèœé¸Ÿæ•™ç¨‹</a><br><a href="https://cn.vuejs.org/v2/guide/index.html">Vue.jså®˜æ–¹æ•™ç¨‹</a></p>]]></content>
    
    
    <summary type="html">ç®€ä»‹
ImJoyè®¾è®¡çš„åˆè¡·å°±åŒ…æ‹¬å¯ä»¥è¢«é›†æˆä½¿ç”¨ã€‚è¿™æ„å‘³ç€å®ƒå¯ä»¥æ ¹æ®éœ€æ±‚ä»¥å¤šç§æ–¹å¼é›†æˆåˆ°ä¸€ä¸ªé¡¹ç›®ä¸­ã€‚
è¿™é‡Œçš„â€œé›†æˆâ€æœ‰ä¸¤ä¸ªæ„æ€ï¼š
ï¼ˆ1ï¼‰å°†ImJoyçš„æ ¸å¿ƒcoreåº“é›†æˆåœ¨è‡ªå·±çš„ç½‘ç«™æˆ–webåº”ç”¨ä¸­ï¼Œä»è€Œå¯ä»¥è°ƒç”¨ImJoyç”Ÿæ€ä¸­çš„å„ç§æ’ä»¶ï¼›
ï¼ˆ2ï¼‰å°†ImJoyçš„è¿è¡Œæ—¶rpcåº“é›†æˆåˆ°è‡ªå·±çš„webåº”ç”¨ä¸­ï¼Œä»è€Œå°†è‡ªå·±çš„webåº”ç”¨è½¬æ¢ä¸ºImJoyçš„ä¸€ä¸ªæ’ä»¶ï¼Œå³è¢«åˆ«äººå¯è°ƒç”¨å’Œè®¿é—®ã€‚

å®‰è£…
é›†æˆImJoyï¼ˆæ— è®ºæ˜¯imjoy-coreè¿˜æ˜¯imjoy-rpcï¼‰ä¸»è¦æœ‰ä¸‰ç§æ–¹å¼ï¼š
ï¼ˆ1ï¼‰åœ¨é¡µé¢ä¸Šä»¥ CDN åŒ…çš„å½¢å¼å¯¼å…¥ã€‚
ï¼ˆ2ï¼‰ä¸‹è½½ JavaScript æ–‡ä»¶å¹¶è‡ªè¡Œæ‰˜ç®¡ã€‚
ï¼ˆ3ï¼‰ä½¿ç”¨ npm å®‰è£…å®ƒã€‚
ä¸‹é¢è¯¦ç»†è¯´æ˜ã€‚</summary>
    
    
    
    <category term="computer vision" scheme="http://qixinbo.github.io/categories/computer-vision/"/>
    
    
    <category term="ImJoy" scheme="http://qixinbo.github.io/tags/ImJoy/"/>
    
  </entry>
  
  <entry>
    <title>å¼€æºæ·±åº¦å­¦ä¹ è®¡ç®—å¹³å°ImJoyè§£æï¼š8 -- ä½¿ç”¨pythonç¼–å†™è®¡ç®—æ’ä»¶</title>
    <link href="http://qixinbo.github.io/2021/12/18/ImJoy_8/"/>
    <id>http://qixinbo.github.io/2021/12/18/ImJoy_8/</id>
    <published>2021-12-17T16:00:00.000Z</published>
    <updated>2021-12-19T11:11:14.984Z</updated>
    
    <content type="html"><![CDATA[<p>ä¸Šä¸€ç¯‡ç€é‡ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨JavaScriptåº“æ¥ç¼–å†™æ’ä»¶çš„å‰ç«¯UIå’Œåç«¯è®¡ç®—é€»è¾‘ï¼Œè¿™ä¸€èŠ‚ä¼šä»‹ç»å¦‚ä½•å°†è®¡ç®—åç«¯åˆ‡æ¢ä¸ºpythonè¯­è¨€ï¼Œå³è®¡ç®—é€»è¾‘å®Œå…¨ä½¿ç”¨pythonç¼–å†™ï¼Œå……åˆ†åˆ©ç”¨pythonåºå¤§çš„è®¡ç®—ç”Ÿæ€ã€‚<br>ä½¿ç”¨pythonå¼€å‘è®¡ç®—æ’ä»¶æœ‰ä¸¤ç§ï¼š<br>ï¼ˆ1ï¼‰web-pythonï¼šå³pythonè¿è¡Œåœ¨æµè§ˆå™¨ä¸­ï¼Œå…¶åŸç†å®é™…æ˜¯åº”ç”¨äº†<a href="https://pyodide.org/en/stable/">Pyodide</a>è¿™ä¸€å·¥å…·ï¼Œå°†pythonä»£ç ç¼–è¯‘åœ¨æµè§ˆå™¨ä¸­ï¼Œä½†å…¶ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œé¦–å…ˆæ˜¯åŠ è½½é€Ÿåº¦éå¸¸æ…¢ï¼Œå› ä¸ºç¬¬ä¸€æ¬¡è¿è¡Œæ—¶éœ€è¦å°†æ‰€ç”¨çš„pythonåº“éƒ½ä¸‹è½½ä¸‹æ¥ï¼›ç„¶åå…¶ä¹Ÿæ— æ³•åº”ç”¨æ•´ä¸ªpythonæ·±åº¦å­¦ä¹ ç”Ÿæ€ã€‚<br>ï¼ˆ2ï¼‰native-pythonï¼šè¯¥ç±»å‹æ’ä»¶ä¼šé“¾æ¥ä¸€ä¸ªæœ¬åœ°çš„jupyteræ’ä»¶å¼•æ“ï¼Œå¯ä»¥å……åˆ†å‘æŒ¥pythonçš„æœ€å¤§ä»·å€¼ï¼Œæœ¬ç¯‡ä¹Ÿå°†ç€é‡ä»‹ç»è¯¥ç§æ’ä»¶çš„ç¼–å†™ã€‚</p><h1 id="web-pythonçš„hello-world"><a href="#web-pythonçš„hello-world" class="headerlink" title="web-pythonçš„hello world"></a>web-pythonçš„hello world</h1><p>å…ˆçœ‹ä¸€ä¸ªä½¿ç”¨web-pythonç¼–å†™çš„hello worldä¾‹å­ï¼Œå®ƒä¼šå®Œå…¨åœ¨æµè§ˆå™¨ä¸­è¿è¡ŒPythonä»£ç ã€‚<br>æ³¨æ„ï¼Œå½“è¿è¡Œä»¥ä¸‹æ’ä»¶æ—¶ï¼Œä¼šéœ€è¦ä¸€æ®µæ—¶é—´ï¼Œå› ä¸ºå®ƒéœ€è¦å°†pythonåº“åŠ è½½åˆ°æµè§ˆå™¨ä¸­ï¼š<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;docs lang=<span class="string">&quot;markdown&quot;</span>&gt;</span><br><span class="line">[TODO: write documentation <span class="keyword">for</span> this plugin.]</span><br><span class="line">&lt;/docs&gt;</span><br><span class="line">&lt;config lang=<span class="string">&quot;json&quot;</span>&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Untitled Plugin&quot;</span>,</span><br><span class="line">  <span class="string">&quot;type&quot;</span>: <span class="string">&quot;web-python&quot;</span>,</span><br><span class="line">  <span class="string">&quot;version&quot;</span>: <span class="string">&quot;0.1.0&quot;</span>,</span><br><span class="line">  <span class="string">&quot;description&quot;</span>: <span class="string">&quot;[TODO: describe this plugin with one sentence.]&quot;</span>,</span><br><span class="line">  <span class="string">&quot;tags&quot;</span>: [],</span><br><span class="line">  <span class="string">&quot;ui&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="string">&quot;cover&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="string">&quot;inputs&quot;</span>: null,</span><br><span class="line">  <span class="string">&quot;outputs&quot;</span>: null,</span><br><span class="line">  <span class="string">&quot;flags&quot;</span>: [],</span><br><span class="line">  <span class="string">&quot;icon&quot;</span>: <span class="string">&quot;extension&quot;</span>,</span><br><span class="line">  <span class="string">&quot;api_version&quot;</span>: <span class="string">&quot;0.1.8&quot;</span>,</span><br><span class="line">  <span class="string">&quot;env&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="string">&quot;permissions&quot;</span>: [],</span><br><span class="line">  <span class="string">&quot;requirements&quot;</span>: [],</span><br><span class="line">  <span class="string">&quot;dependencies&quot;</span>: []</span><br><span class="line">&#125;</span><br><span class="line">&lt;/config&gt;</span><br><span class="line">&lt;script lang=<span class="string">&quot;python&quot;</span>&gt;</span><br><span class="line"><span class="keyword">from</span> imjoy <span class="keyword">import</span> api</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ImJoyPlugin</span>():</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setup</span>(<span class="params">self</span>):</span></span><br><span class="line">        api.log(<span class="string">&#x27;initialized&#x27;</span>)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span>(<span class="params">self, ctx</span>):</span></span><br><span class="line">        api.alert(<span class="string">&#x27;hello world.&#x27;</span>)</span><br><span class="line">api.export(ImJoyPlugin())</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><br>å®æµ‹é€Ÿåº¦éå¸¸æ…¢ï¼Œæ‰€ä»¥å¹¶ä¸æ¨èä½¿ç”¨web-pythonè¿™ç§æ–¹å¼æ¥ç¼–å†™æ’ä»¶ã€‚</p><h1 id="native-pythonå¼€å‘æ’ä»¶"><a href="#native-pythonå¼€å‘æ’ä»¶" class="headerlink" title="native-pythonå¼€å‘æ’ä»¶"></a>native-pythonå¼€å‘æ’ä»¶</h1><p>å¦‚æœæƒ³å……åˆ†åˆ©ç”¨pythonçš„æ·±åº¦å­¦ä¹ ç”Ÿæ€ï¼Œå”¯ä¸€ä½¿ç”¨çš„æ–¹å¼å°±æ˜¯native-pythonè¿™ç§å¼€å‘æ¨¡å¼ã€‚<br>æ­¤æ¨¡å¼çš„ä½¿ç”¨å¯ä»¥æœ‰ä¸‰ç§ç»„åˆæ–¹å¼ï¼š<br>ï¼ˆ1ï¼‰<a href="https://imjoy.io/#/app">ImJoyå®˜æ–¹éƒ¨ç½²</a>+<a href="https://mybinder.org/">MyBinder</a>æ’ä»¶å¼•æ“ï¼›<br>ï¼ˆ2ï¼‰<a href="https://imjoy.io/#/app">ImJoyå®˜æ–¹éƒ¨ç½²</a>+æœ¬åœ°Jupyteræ’ä»¶å¼•æ“ï¼›<br>ï¼ˆ3ï¼‰æœ¬åœ°éƒ¨ç½²+æœ¬åœ°Jupyteræ’ä»¶å¼•æ“ã€‚<br>ç¬¬ä¸€ç§å› ä¸ºä½¿ç”¨MyBinderè¿™ä¸€å…è´¹çš„Jupyteræ‰˜ç®¡æ–¹æ¡ˆï¼Œå…¶æ€§èƒ½ä¼šè¾ƒå¼±ï¼Œé€šå¸¸åªç”¨äºdemoç”¨é€”ï¼Œå› æ­¤ä¸æ¨èï¼›<br>ç¬¬äºŒç§ä¼šä½¿ç”¨ImJoyçš„å®˜æ–¹web appæ¥ä½œä¸ºåº”ç”¨å…¥å£ï¼Œå› æ­¤å¯èƒ½ä¼šå—é™äºå…¶å®˜ç½‘çš„å¯è¿æ¥æ€§ï¼Œå¿«é€Ÿå¼€å‘æ—¶æ¨èä½¿ç”¨ï¼›<br>ç¬¬ä¸‰ç§web appå’ŒJupyteréƒ½æ˜¯åœ¨æœ¬åœ°éƒ¨ç½²ï¼Œå› æ­¤æœ‰æœ€å¤§çš„çµæ´»æ€§ã€‚æœ¬éƒ¨åˆ†å°†å¯¹ç¬¬ä¸‰ç§çš„ç¯å¢ƒæ­å»ºåšä¸€ä»‹ç»ã€‚</p><h2 id="æœ¬åœ°éƒ¨ç½²web-app"><a href="#æœ¬åœ°éƒ¨ç½²web-app" class="headerlink" title="æœ¬åœ°éƒ¨ç½²web app"></a>æœ¬åœ°éƒ¨ç½²web app</h2><p>ImJoyçš„ä¸»web appç¨‹åºä¹Ÿåœ¨GitHubä¸Šè¿›è¡Œäº†å¼€æºï¼Œè§<a href="https://github.com/imjoy-team/ImJoy">è¿™é‡Œ</a>ã€‚<br>ï¼ˆ1ï¼‰cloneè¯¥ä»“åº“ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone git@github.com:imjoy-team/ImJoy.git</span><br></pre></td></tr></table></figure><br>ï¼ˆ2ï¼‰å®‰è£…ä¾èµ–åŒ…<br>è¿›å…¥<code>web</code>æ–‡ä»¶å¤¹ï¼Œç„¶åï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install</span><br></pre></td></tr></table></figure><br>è¿™ä¸€æ­¥éœ€è¦å®‰è£…nodejsï¼Œæ­¤å¤„ä¸è¯¦ç»†ä»‹ç»ï¼Œå¯ä»¥ç§»æ­¥<a href="https://nodejs.org/zh-cn/">è¿™é‡Œ</a>ã€‚<br>ï¼ˆ3ï¼‰ç¼–è¯‘è¿è¡Œï¼š<br>æœ‰ä¸¤ç§ç¼–è¯‘å’Œè¿è¡Œæ–¹å¼ï¼Œä¸€ç§æ˜¯å¼€å‘æ¨¡å¼ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run serve</span><br></pre></td></tr></table></figure><br>æˆ–è€…ç”Ÿäº§æ¨¡å¼ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run build</span><br></pre></td></tr></table></figure><br>ï¼ˆ4ï¼‰è®¿é—®appï¼š<br>ä¸Šä¸€æ­¥è¿è¡Œè¯¥appåï¼Œå°±ä¼šç”Ÿæˆå¯è®¿é—®çš„é“¾æ¥ï¼Œé€šå¸¸æ˜¯ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:<span class="number">8001</span></span><br></pre></td></tr></table></figure></p><h2 id="æ­å»ºæœ¬åœ°Jupyteræ’ä»¶å¼•æ“"><a href="#æ­å»ºæœ¬åœ°Jupyteræ’ä»¶å¼•æ“" class="headerlink" title="æ­å»ºæœ¬åœ°Jupyteræ’ä»¶å¼•æ“"></a>æ­å»ºæœ¬åœ°Jupyteræ’ä»¶å¼•æ“</h2><p>æ­å»ºæœ¬åœ°Jupyteræ’ä»¶å¼•æ“æœ‰ä¸¤ç§æ–¹æ³•ï¼š<br>ï¼ˆ1ï¼‰å®‰è£…Jupyter notebookï¼ˆé€šè¿‡<code>pip install jupyter</code>ï¼‰ï¼Œç„¶åå®‰è£…<a href="https://github.com/imjoy-team/imjoy-jupyter-extension">imjoy-jupyter-extension</a>ã€‚<br>ï¼ˆ2ï¼‰å¯ä»¥é€šè¿‡ <code>pip install imjoy</code> å®‰è£…è¿™ä¸ª<a href="https://github.com/imjoy-team/imjoy-engine">ImJoy-Engine</a>åº“ã€‚<br>æ¨èä½¿ç”¨åè€…ï¼Œå› ä¸ºè¿™æ ·å¯ä»¥å¯¹JupyteræœåŠ¡å™¨åšä¸€äº›å¯¹ImJoyæœ‰ç”¨çš„è®¾ç½®ï¼Œå¹¶ä¸”ä¸éœ€è¦å•ç‹¬å®‰è£…imjoy-jupyter-extensionã€‚<br>å…·ä½“çš„æ­å»ºæµç¨‹å¦‚ä¸‹ï¼š<br>ï¼ˆ1ï¼‰ä¸‹è½½å¹¶å®‰è£…condaç¯å¢ƒï¼šæ¨èä½¿ç”¨python3.7ç‰ˆæœ¬çš„Anacondaã€‚<br>ï¼ˆ2ï¼‰å®‰è£…å¼•æ“ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install -U imjoy[jupyter]</span><br></pre></td></tr></table></figure><br>ï¼ˆ3ï¼‰å¯åŠ¨å¼•æ“ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">imjoy --jupyter</span><br></pre></td></tr></table></figure><br>ç„¶ååœ¨ç»ˆç«¯å°±ä¼šå¾—åˆ°å½¢å¦‚ï¼š<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:8888/?token=caac2d7f2e8e0...ad871fe</span><br></pre></td></tr></table></figure><br>çš„é“¾æ¥ã€‚è¿™å°±æ˜¯æ’ä»¶å¼•æ“çš„åœ°å€ã€‚<br>ï¼ˆ4ï¼‰è¿æ¥web app<br>åœ¨å‰é¢å¼€å¯çš„web appé¡µé¢ä¸Š<code>http://localhost:8001/#/app</code>ï¼Œç‚¹å‡»å³ä¸Šè§’çš„å°ç«ç®­å›¾æ ‡ï¼Œç„¶åç‚¹å‡»<code>Add Jupyter-Engine</code>ï¼Œå°†ä¸Šé¢æ’ä»¶å¼•æ“çš„åœ°å€å¡«å…¥å³å¯ã€‚</p><h1 id="native-pythonçš„hello-world"><a href="#native-pythonçš„hello-world" class="headerlink" title="native-pythonçš„hello world"></a>native-pythonçš„hello world</h1><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&lt;docs lang=<span class="string">&quot;markdown&quot;</span>&gt;</span><br><span class="line">[TODO: write documentation <span class="keyword">for</span> this plugin.]</span><br><span class="line">&lt;/docs&gt;</span><br><span class="line">&lt;config lang=<span class="string">&quot;json&quot;</span>&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Untitled Plugin&quot;</span>,</span><br><span class="line">  <span class="string">&quot;type&quot;</span>: <span class="string">&quot;native-python&quot;</span>,</span><br><span class="line">  <span class="string">&quot;version&quot;</span>: <span class="string">&quot;0.1.0&quot;</span>,</span><br><span class="line">  <span class="string">&quot;description&quot;</span>: <span class="string">&quot;[TODO: describe this plugin with one sentence.]&quot;</span>,</span><br><span class="line">  <span class="string">&quot;tags&quot;</span>: [],</span><br><span class="line">  <span class="string">&quot;ui&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="string">&quot;cover&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="string">&quot;inputs&quot;</span>: null,</span><br><span class="line">  <span class="string">&quot;outputs&quot;</span>: null,</span><br><span class="line">  <span class="string">&quot;flags&quot;</span>: [],</span><br><span class="line">  <span class="string">&quot;icon&quot;</span>: <span class="string">&quot;extension&quot;</span>,</span><br><span class="line">  <span class="string">&quot;api_version&quot;</span>: <span class="string">&quot;0.1.8&quot;</span>,</span><br><span class="line">  <span class="string">&quot;env&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="string">&quot;permissions&quot;</span>: [],</span><br><span class="line">  <span class="string">&quot;requirements&quot;</span>: [],</span><br><span class="line">  <span class="string">&quot;dependencies&quot;</span>: []</span><br><span class="line">&#125;</span><br><span class="line">&lt;/config&gt;</span><br><span class="line">&lt;script lang=<span class="string">&quot;python&quot;</span>&gt;</span><br><span class="line"><span class="keyword">from</span> imjoy <span class="keyword">import</span> api</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ImJoyPlugin</span>():</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setup</span>(<span class="params">self</span>):</span></span><br><span class="line">        api.log(<span class="string">&#x27;initialized&#x27;</span>)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span>(<span class="params">self, ctx</span>):</span></span><br><span class="line">        api.alert(<span class="string">&#x27;hello world.&#x27;</span>)</span><br><span class="line">api.export(ImJoyPlugin())</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h1 id="ç”¨pythonå†™å›¾åƒå¤„ç†æ’ä»¶"><a href="#ç”¨pythonå†™å›¾åƒå¤„ç†æ’ä»¶" class="headerlink" title="ç”¨pythonå†™å›¾åƒå¤„ç†æ’ä»¶"></a>ç”¨pythonå†™å›¾åƒå¤„ç†æ’ä»¶</h1><p>è¿™ä¸€éƒ¨åˆ†å°è¯•å°†<a href="https://qixinbo.info/2021/12/17/imjoy_7/">æ„å»ºåŸºäºWebçš„å›¾åƒåˆ†ææ’ä»¶</a>è¿™ä¸€ç¯‡ä¸­çš„opencv.jsåŠŸèƒ½ç”¨pythonç‰ˆçš„opencvå®ç°ä¸€éã€‚<br>åœ¨æ­¤ä¾‹ä¸­ï¼Œæœ‰<strong>ä¸¤ä¸ªæ’ä»¶</strong>ï¼šUIæ’ä»¶å’Œcomputeæ’ä»¶ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥è¿æ¥å®ƒä»¬ï¼š<br>ï¼ˆ1ï¼‰é¦–å…ˆç”¨<code>api.createWindow(...)</code>ä»computeæ’ä»¶å®ä¾‹åŒ–UIæ’ä»¶ï¼Œç„¶åä¸è¿”å›çš„çª—å£å¯¹è±¡è¿›è¡Œäº¤äº’ï¼›<br>ï¼ˆ2ï¼‰ä¹Ÿå¯ä»¥ç›´æ¥å¯åŠ¨UIæ’ä»¶ï¼Œç„¶åé€šè¿‡<code>api.getPlugin()</code>æ¥è·å–computeæ’ä»¶æä¾›çš„apiã€‚<br>ä¸¤ç§æ–¹æ³•åˆ°åº•ç”¨å“ªä¸€ç§å–å†³äºåº”ç”¨ç¨‹åºçš„å®é™…éœ€è¦ï¼Œè¿™é‡Œæ¨èç¬¬ä¸€ç§æ–¹å¼ç”¨äºPythonæ’ä»¶çš„ç¼–å†™ï¼Œå› ä¸ºå®ƒå¯ä»¥æ›´è½»æ¾åœ°åœ¨Jupyterç¬”è®°æœ¬ä¸­è°ƒè¯•ã€‚</p><p>è¿™é‡Œçš„æ’ä»¶æ˜¯ç”¨Pythoné‡å†™è®¡ç®—åŠŸèƒ½ã€JavaScriptä»ç„¶æ˜¯å‰ç«¯ï¼Œå› æ­¤æ¶‰åŠåˆ°ä¸¤ç§è¯­è¨€å¯¹å›¾åƒæ ¼å¼çš„è½¬è¯‘ï¼Œéœ€è¦è¿›è¡Œç¼–ç å’Œè§£ç ä»¥ä½¿å®ƒä»¬äº¤å‰å…¼å®¹ã€‚æœ€ç®€å•çš„æ–¹æ³•æ˜¯å°†å›¾åƒç¼–ç ä¸ºâ€œbase64â€å­—ç¬¦ä¸²ã€‚<br>å› æ­¤ï¼Œæ•´ä¸ªæ’ä»¶çš„æµç¨‹ä¸ºï¼ˆæœ¬èŠ‚æœ«å°¾ä¼šç»™å‡ºæ‰€æœ‰ä»£ç ï¼Œè¿™é‡Œæ˜¯å°†ä»£ç åˆ†è§£ï¼‰ï¼š<br>ï¼ˆ1ï¼‰ä»UIæ’ä»¶ï¼ˆå³å›¾åƒæŸ¥çœ‹å™¨ï¼‰çš„canvasç”»å¸ƒä¸­å¾—åˆ°å›¾åƒçš„<code>base64</code>ç¼–ç ï¼š<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> canvas = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;canvas-id&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// get `base64` encoded image from a canvas</span></span><br><span class="line"><span class="keyword">const</span> base64String = canvas.toDataURL()</span><br></pre></td></tr></table></figure><br>ï¼ˆ2ï¼‰åœ¨UIæ’ä»¶ä¸­è°ƒç”¨computeæ’ä»¶ä¸­çš„å‡½æ•°ï¼Œå¹¶ä¼ é€’ä¸Šé¢çš„<code>base64</code>ç¼–ç ï¼š<br>UIæ’ä»¶èƒ½è°ƒç”¨computeæ’ä»¶ä¸­çš„pythonå‡½æ•°ï¼Œæ˜¯é€šè¿‡æ’ä»¶ä¸­çš„<code>ctx</code>å˜é‡æ¥å¾—åˆ°å®ƒï¼Œå½¢å¦‚ï¼š<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// the run funciton of the image viewer</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="title">run</span>(<span class="params">ctx</span>)</span>&#123;</span><br><span class="line">    <span class="comment">// check if there is a process function passed in</span></span><br><span class="line">    <span class="keyword">if</span>(ctx.data &amp;&amp; ctx.data.process)&#123;</span><br><span class="line">        <span class="comment">// show an additional &quot;Process in Python&quot; button</span></span><br><span class="line">        <span class="comment">// and set the call back to use this process function</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>ç›¸å¯¹åº”åœ°ï¼Œåœ¨Pythonæ’ä»¶ä¸­å°±å¯ä»¥æ‰§è¡Œ<code>await api.createWindow(type=&quot;Image Viewer&quot;, data=&#123;&quot;process&quot;: self.process&#125;)</code>æ¥ä¼ ç»™JSæ’ä»¶ï¼ˆå‡è®¾å·²ç»åœ¨æ’ä»¶ä¸­å®šä¹‰äº†ä¸€ä¸ªåä¸º <code>process</code>çš„å‡½æ•°ï¼‰ã€‚<br>åœ¨è°ƒç”¨<code>api.createWindow</code> æ—¶ï¼Œæœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥å¼•ç”¨å¦ä¸€ä¸ªçª—å£æ’ä»¶ï¼š<br>ï¼ˆaï¼‰å°†<code>type</code>é”®è®¾ç½®ä¸ºçª—å£æ’ä»¶åç§°ï¼Œä¾‹å¦‚å¦‚æœUIæ’ä»¶åä¸º<code>My Window Plugin</code>ï¼Œå°±å°†å…¶è®¾ç½®ä¸º<code>type</code>ã€‚æ³¨æ„ï¼Œè¿™ä¸ªåç§°æ˜¯ä» <code>&lt;config&gt;</code> å—ä¸­çš„ <code>name</code> å®šä¹‰ä¸­è·å¾—çš„ã€‚<br>ï¼ˆbï¼‰å¦‚æœUIæ’ä»¶æ˜¯æºä»£ç çš„å½¢å¼æˆ–è€…ç”±å…¬å…±æœåŠ¡å™¨æä¾›ï¼Œå¯ä»¥è®¾ç½®<code>src</code>ä½œä¸ºæ’ä»¶æºä»£ç æˆ–è€…æ’ä»¶URLï¼Œæ¯”å¦‚<code>name=&quot;Kaibu&quot;,src=&quot;https://kaibu.org/#/app&quot;</code>ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ’ä»¶å°†è¢«åŠ¨æ€å¡«å……ã€‚ä¾‹å¦‚ï¼Œå®ƒå…è®¸å°†çª—å£æ’ä»¶å­˜å‚¨ä¸ºPythonä¸­çš„å­—ç¬¦ä¸²ï¼Œç”šè‡³å¯ä»¥æ ¹æ®æ¨¡æ¿åŠ¨æ€ç”Ÿæˆçª—å£æ’ä»¶ã€‚</p><p>å¦å¤–ä¸€ä¸ªéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœæ˜¯ä½¿ç”¨<code>await api.createWindow(type=&quot;Image Viewer&quot;, data=&#123;&quot;process&quot;: self.process&#125;)</code>ï¼Œæ­¤æ—¶ä¼šå‘ç°ï¼Œå¦‚æœç¬¬äºŒæ¬¡å•å‡»è¯¥æŒ‰é’®ï¼Œå®ƒå°†ä¸å†èµ·ä½œç”¨ï¼Œå¹¶ä¸”å¦‚æœè½¬åˆ°æµè§ˆå™¨æ§åˆ¶å°ï¼Œå°†çœ‹åˆ°ä¸€æ¡é”™è¯¯æ¶ˆæ¯ï¼Œæç¤º<code>Callback function can only called once, if you want to call a function for multiple times, please make it as a plugin api function.</code>ã€‚è¿™æ˜¯å› ä¸ºåœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨åä»çª—å£ä¸­åˆ é™¤äº†<code>process</code>å‡½æ•°ã€‚ä¸ºäº†æ˜ç¡®åœ°å‘Šè¯‰çª—å£ä¿ç•™<code>process</code>å‡½æ•°ï¼Œå¯ä»¥å°†ä¸€ä¸ªç‰¹æ®Šçš„é”®<code>_rintf</code>è®¾ç½®ä¸º<code>True</code>ï¼Œå³æŠŠä¸Šé¢çš„ä»£ç æ”¹æˆ<code>data=&#123;&quot;process&quot;: self.process, &quot;_rintf&quot;: True&#125;</code>ã€‚<br>ï¼ˆ3ï¼‰åœ¨pythonæ’ä»¶ä¸­è§£ç <code>base64</code>ï¼Œå¹¶è¯»å–ä¸ºnumpyç±»å‹æ•°ç»„ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> io</span><br><span class="line"><span class="keyword">import</span> imageio</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">base64_to_image</span>(<span class="params">base64_string, <span class="built_in">format</span>=<span class="literal">None</span></span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;This function takes a base64 string as input</span></span><br><span class="line"><span class="string">    and decode it into an numpy array image</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    base64_string = re.sub(<span class="string">&quot;^data:image/.+;base64,&quot;</span>, <span class="string">&quot;&quot;</span>, base64_string)</span><br><span class="line">    image_file = io.BytesIO(base64.b64decode(base64_string.encode(<span class="string">&#x27;ascii&#x27;</span>)))</span><br><span class="line">    <span class="keyword">return</span> imageio.imread(image_file, <span class="built_in">format</span>)</span><br></pre></td></tr></table></figure></p><p>ï¼ˆ4ï¼‰åœ¨pythonæ’ä»¶ä¸­ç¼–å†™å›¾åƒå¤„ç†ç®—æ³•ï¼š<br>è¿™é‡Œä»ç„¶ä½¿ç”¨çš„æ˜¯opencvï¼Œä¸è¿‡è¦ç”¨çš„æ˜¯å®ƒçš„pythonç‰ˆæœ¬ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;requirements&quot;</span>: [<span class="string">&quot;opencv-python&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">process_image</span>(<span class="params">src</span>):</span></span><br><span class="line">    dst = cv2.cvtColor(src, cv2.COLOR_RGBA2GRAY)</span><br><span class="line">    <span class="keyword">return</span> dst</span><br></pre></td></tr></table></figure><br>ï¼ˆ5ï¼‰å°†numpyæ•°ç»„ç±»å‹çš„å¤„ç†ç»“æœç¼–ç ä¸º<code>base64</code>å¹¶è¿”å›ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">image_to_base64</span>(<span class="params">image_array</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;This function takes a numpy image array as input</span></span><br><span class="line"><span class="string">    and encode it into a base64 string</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    buf = io.BytesIO()</span><br><span class="line">    imageio.imwrite(buf, image_array, <span class="string">&quot;PNG&quot;</span>)</span><br><span class="line">    buf.seek(<span class="number">0</span>)</span><br><span class="line">    img_bytes = buf.getvalue()</span><br><span class="line">    base64_string = base64.b64encode(img_bytes).decode(<span class="string">&#x27;ascii&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;data:image/png;base64,&#x27;</span> + base64_string</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">process</span>(<span class="params">self, base64string</span>):</span></span><br><span class="line">    img = base64_to_image(base64string)</span><br><span class="line">    dst = process_image(img)</span><br><span class="line">    base64dst = image_to_base64(dst)</span><br><span class="line">    <span class="keyword">return</span> base64dst</span><br></pre></td></tr></table></figure><br>ï¼ˆ6ï¼‰åœ¨JSæ’ä»¶ä¸­æ¥æ”¶<code>base64</code>ç¼–ç ï¼Œå¹¶åœ¨ç”»å¸ƒä¸­æ˜¾ç¤ºä¸ºå›¾åƒï¼š<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// draw a `base64` encoded image to the canvas</span></span><br><span class="line"><span class="keyword">const</span> drawImage = <span class="function">(<span class="params">canvas, base64Image</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">const</span> img = <span class="keyword">new</span> Image()</span><br><span class="line">        img.crossOrigin = <span class="string">&quot;anonymous&quot;</span></span><br><span class="line">        img.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">const</span> ctx = canvas.getContext(<span class="string">&quot;2d&quot;</span>);</span><br><span class="line">            canvas.width = <span class="built_in">Math</span>.min(<span class="built_in">this</span>.width, <span class="number">512</span>);</span><br><span class="line">            canvas.height= <span class="built_in">Math</span>.min(<span class="built_in">this</span>.height, <span class="built_in">parseInt</span>(<span class="number">512</span>*<span class="built_in">this</span>.height/<span class="built_in">this</span>.width), <span class="number">1024</span>);</span><br><span class="line">            <span class="comment">// draw the img into canvas</span></span><br><span class="line">            ctx.drawImage(<span class="built_in">this</span>, <span class="number">0</span>, <span class="number">0</span>, canvas.width, canvas.height);</span><br><span class="line">            resolve(canvas);</span><br><span class="line">        &#125;</span><br><span class="line">        img.onerror = reject;</span><br><span class="line">        img.src = base64Image;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>æ•´ä¸ªæ’ä»¶çš„å¤„ç†é€»è¾‘å¦‚ä¸Šï¼Œç»“æœä¸å®Œå…¨JSä½œä¸ºå‰ç«¯å’Œåç«¯çš„ç»“æœç›¸åŒï¼Œå¦‚ä¸‹å›¾ï¼š<br><img src="https://user-images.githubusercontent.com/6218739/146639355-669e3cac-2134-4171-ba21-19884d536abb.png" alt="pythonbackend"></p><p>å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š<br>å¯¹äºUIæ’ä»¶ï¼š<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line">&lt;config lang=<span class="string">&quot;json&quot;</span>&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Image Viewer&quot;</span>,</span><br><span class="line">  <span class="string">&quot;type&quot;</span>: <span class="string">&quot;window&quot;</span>,</span><br><span class="line">  <span class="string">&quot;tags&quot;</span>: [],</span><br><span class="line">  <span class="string">&quot;ui&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="string">&quot;version&quot;</span>: <span class="string">&quot;0.1.0&quot;</span>,</span><br><span class="line">  <span class="string">&quot;cover&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="string">&quot;description&quot;</span>: <span class="string">&quot;This is a demo plugin for displaying image&quot;</span>,</span><br><span class="line">  <span class="string">&quot;icon&quot;</span>: <span class="string">&quot;extension&quot;</span>,</span><br><span class="line">  <span class="string">&quot;inputs&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="string">&quot;outputs&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="string">&quot;api_version&quot;</span>: <span class="string">&quot;0.1.8&quot;</span>,</span><br><span class="line">  <span class="string">&quot;env&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="string">&quot;permissions&quot;</span>: [],</span><br><span class="line">  <span class="string">&quot;requirements&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;https://cdn.jsdelivr.net/npm/bulma@0.9.1/css/bulma.min.css&quot;</span>, </span><br><span class="line">    <span class="string">&quot;https://use.fontawesome.com/releases/v5.14.0/js/all.js&quot;</span>],</span><br><span class="line">  <span class="string">&quot;dependencies&quot;</span>: []</span><br><span class="line">&#125;</span><br><span class="line">&lt;/config&gt;</span><br><span class="line"></span><br><span class="line">&lt;script lang=<span class="string">&quot;javascript&quot;</span>&gt;</span><br><span class="line"><span class="keyword">const</span> drawImage = <span class="function">(<span class="params">canvas, base64Image</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">const</span> img = <span class="keyword">new</span> Image()</span><br><span class="line">        img.crossOrigin = <span class="string">&quot;anonymous&quot;</span></span><br><span class="line">        img.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">const</span> ctx = canvas.getContext(<span class="string">&quot;2d&quot;</span>);</span><br><span class="line">            canvas.width = <span class="built_in">Math</span>.min(<span class="built_in">this</span>.width, <span class="number">512</span>);</span><br><span class="line">            canvas.height= <span class="built_in">Math</span>.min(<span class="built_in">this</span>.height, <span class="built_in">parseInt</span>(<span class="number">512</span>*<span class="built_in">this</span>.height/<span class="built_in">this</span>.width), <span class="number">1024</span>);</span><br><span class="line">            <span class="comment">// draw the img into canvas</span></span><br><span class="line">            ctx.drawImage(<span class="built_in">this</span>, <span class="number">0</span>, <span class="number">0</span>, canvas.width, canvas.height);</span><br><span class="line">            resolve(canvas);</span><br><span class="line">        &#125;</span><br><span class="line">        img.onerror = reject;</span><br><span class="line">        img.src = base64Image;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> readImageFile = <span class="function">(<span class="params">file</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">const</span> U = <span class="built_in">window</span>.URL || <span class="built_in">window</span>.webkitURL;</span><br><span class="line">        <span class="keyword">if</span>(U.createObjectURL)&#123;</span><br><span class="line">            resolve(U.createObjectURL(file))</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">const</span> fr = <span class="keyword">new</span> FileReader();</span><br><span class="line">            fr.onload = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">                resolve(e.target.result)</span><br><span class="line">            &#125;;</span><br><span class="line">            fr.onerror = reject</span><br><span class="line">            fr.readAsDataURL(file);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ImJoyPlugin</span></span>&#123;</span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">setup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">const</span> fileInput = <span class="built_in">document</span>.getElementById(<span class="string">&quot;file-input&quot;</span>);</span><br><span class="line">        <span class="keyword">const</span> canvas = <span class="built_in">document</span>.getElementById(<span class="string">&quot;input-canvas&quot;</span>);</span><br><span class="line">        <span class="keyword">const</span> outputcanvas = <span class="built_in">document</span>.getElementById(<span class="string">&quot;output-canvas&quot;</span>);</span><br><span class="line">        fileInput.addEventListener(<span class="string">&quot;change&quot;</span>, <span class="keyword">async</span> ()=&gt;&#123;</span><br><span class="line">        <span class="keyword">const</span> img = <span class="keyword">await</span> readImageFile(fileInput.files[<span class="number">0</span>]);</span><br><span class="line">        <span class="keyword">await</span> drawImage(canvas, img);</span><br><span class="line">        &#125;, <span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">await</span> api.log(<span class="string">&quot;plugin initialized&quot;</span>)</span><br><span class="line">        <span class="keyword">const</span> selectButton = <span class="built_in">document</span>.getElementById(<span class="string">&quot;select-button&quot;</span>);</span><br><span class="line">        selectButton.addEventListener(<span class="string">&quot;click&quot;</span>, <span class="keyword">async</span> ()=&gt;&#123;</span><br><span class="line">        fileInput.click()</span><br><span class="line">        &#125;, <span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">run</span>(<span class="params">ctx</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(ctx.data &amp;&amp; ctx.data.process)&#123;</span><br><span class="line">            <span class="keyword">const</span> canvas = <span class="built_in">document</span>.getElementById(<span class="string">&quot;input-canvas&quot;</span>);</span><br><span class="line">            <span class="keyword">const</span> outputcanvas = <span class="built_in">document</span>.getElementById(<span class="string">&quot;output-canvas&quot;</span>);</span><br><span class="line">            <span class="keyword">const</span> btn = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;process-button&#x27;</span>)</span><br><span class="line">            btn.disabled = <span class="literal">false</span>;</span><br><span class="line">            btn.addEventListener(<span class="string">&quot;click&quot;</span>, <span class="keyword">async</span> ()=&gt;&#123;</span><br><span class="line">                <span class="keyword">const</span> base64String = canvas.toDataURL()</span><br><span class="line">                <span class="keyword">const</span> base64dst = <span class="keyword">await</span> ctx.data.process(base64String)</span><br><span class="line">                <span class="keyword">await</span> drawImage(outputcanvas, base64dst)</span><br><span class="line">            &#125;, <span class="literal">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">api.export(<span class="keyword">new</span> ImJoyPlugin())</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;<span class="built_in">window</span>&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;input  id=<span class="string">&quot;file-input&quot;</span> accept=<span class="string">&quot;image/*&quot;</span> capture=<span class="string">&quot;camera&quot;</span> type=<span class="string">&quot;file&quot;</span>/&gt;</span><br><span class="line">        &lt;nav <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;panel&quot;</span>&gt;</span><br><span class="line">        &lt;p <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;panel-heading&quot;</span>&gt;</span><br><span class="line">            &lt;i <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;fas fa-eye&quot;</span> aria-hidden=<span class="string">&quot;true&quot;</span>&gt;&lt;/i&gt; My Image Viewer <span class="keyword">with</span> Python backend</span><br><span class="line">        &lt;/p&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;panel-block&quot;</span>&gt;</span><br><span class="line">            &lt;button id=<span class="string">&quot;select-button&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;button is-link is-outlined is-fullwidth&quot;</span>&gt;</span><br><span class="line">            Open an image</span><br><span class="line">            &lt;/button&gt;</span><br><span class="line">            &lt;button id=<span class="string">&quot;process-button&quot;</span> disabled <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;button is-link is-outlined is-fullwidth&quot;</span>&gt;</span><br><span class="line">            RGB to Gray</span><br><span class="line">            &lt;/button&gt;            </span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;panel-block&quot;</span>&gt;</span><br><span class="line">            &lt;canvas id=<span class="string">&quot;input-canvas&quot;</span> style=<span class="string">&quot;width: 100%; object-fit: cover;&quot;</span>&gt;&lt;/canvas&gt;</span><br><span class="line">            &lt;canvas id=<span class="string">&quot;output-canvas&quot;</span> style=<span class="string">&quot;width: 100%; object-fit: cover;&quot;</span>&gt;&lt;/canvas&gt;</span><br><span class="line">        &lt;/div&gt; </span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;panel-block&quot;</span>&gt;</span><br><span class="line">            &lt;button id=<span class="string">&quot;predict-button&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;button is-link is-outlined is-fullwidth&quot;</span>&gt;</span><br><span class="line">            Predict</span><br><span class="line">            &lt;/button&gt;        </span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/<span class="built_in">window</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line">#file-input&#123;</span><br><span class="line">    display: none;</span><br><span class="line">&#125;</span><br><span class="line">h1&#123;</span><br><span class="line">    color: pink;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><br>å¯¹äºcomputeæ’ä»¶ï¼š<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">&lt;config lang=<span class="string">&quot;json&quot;</span>&gt;</span><br><span class="line">&#123;</span><br><span class="line"> <span class="string">&quot;type&quot;</span>: <span class="string">&quot;native-python&quot;</span>,</span><br><span class="line"> <span class="string">&quot;name&quot;</span>: <span class="string">&quot;my-python-plugin&quot;</span>,</span><br><span class="line"> <span class="string">&quot;id&quot;</span>: <span class="string">&quot;9l3fewe7l&quot;</span>,</span><br><span class="line"> <span class="string">&quot;namespace&quot;</span>: <span class="string">&quot;9l3fewe7l&quot;</span>,</span><br><span class="line"> <span class="string">&quot;lang&quot;</span>: <span class="string">&quot;python&quot;</span>,</span><br><span class="line"> <span class="string">&quot;window_id&quot;</span>: <span class="string">&quot;code_9l3fewe7l&quot;</span>,</span><br><span class="line"> <span class="string">&quot;api_version&quot;</span>: <span class="string">&quot;0.1.8&quot;</span>,</span><br><span class="line"> <span class="string">&quot;description&quot;</span>: <span class="string">&quot;[TODO: describe this plugin with one sentence.]&quot;</span>,</span><br><span class="line"> <span class="string">&quot;tags&quot;</span>: [],</span><br><span class="line"> <span class="string">&quot;version&quot;</span>: <span class="string">&quot;0.1.0&quot;</span>,</span><br><span class="line"> <span class="string">&quot;ui&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"> <span class="string">&quot;cover&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"> <span class="string">&quot;icon&quot;</span>: <span class="string">&quot;extension&quot;</span>,</span><br><span class="line"> <span class="string">&quot;inputs&quot;</span>: null,</span><br><span class="line"> <span class="string">&quot;outputs&quot;</span>: null,</span><br><span class="line"> <span class="string">&quot;env&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"> <span class="string">&quot;permissions&quot;</span>: [],</span><br><span class="line"> <span class="string">&quot;requirements&quot;</span>: [<span class="string">&quot;opencv-python&quot;</span>],</span><br><span class="line"> <span class="string">&quot;dependencies&quot;</span>: []</span><br><span class="line">&#125;</span><br><span class="line">&lt;/config&gt;</span><br><span class="line"></span><br><span class="line">&lt;script lang=<span class="string">&quot;python&quot;</span>&gt;</span><br><span class="line"><span class="keyword">from</span> imjoy <span class="keyword">import</span> api</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> io</span><br><span class="line"><span class="keyword">import</span> imageio</span><br><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">image_to_base64</span>(<span class="params">image_array</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;This function takes a numpy image array as input</span></span><br><span class="line"><span class="string">    and encode it into a base64 string</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    buf = io.BytesIO()</span><br><span class="line">    imageio.imwrite(buf, image_array, <span class="string">&quot;PNG&quot;</span>)</span><br><span class="line">    buf.seek(<span class="number">0</span>)</span><br><span class="line">    img_bytes = buf.getvalue()</span><br><span class="line">    base64_string = base64.b64encode(img_bytes).decode(<span class="string">&#x27;ascii&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;data:image/png;base64,&#x27;</span> + base64_string</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">base64_to_image</span>(<span class="params">base64_string, <span class="built_in">format</span>=<span class="literal">None</span></span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;This function takes a base64 string as input</span></span><br><span class="line"><span class="string">    and decode it into an numpy array image</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    base64_string = re.sub(<span class="string">&quot;^data:image/.+;base64,&quot;</span>, <span class="string">&quot;&quot;</span>, base64_string)</span><br><span class="line">    image_file = io.BytesIO(base64.b64decode(base64_string.encode(<span class="string">&#x27;ascii&#x27;</span>)))</span><br><span class="line">    <span class="keyword">return</span> imageio.imread(image_file, <span class="built_in">format</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">process_image</span>(<span class="params">src</span>):</span></span><br><span class="line">    dst = cv2.cvtColor(src, cv2.COLOR_RGBA2GRAY)</span><br><span class="line">    <span class="keyword">return</span> dst</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ImJoyPlugin</span>():</span></span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">setup</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">process</span>(<span class="params">self, base64string</span>):</span></span><br><span class="line">        img = base64_to_image(base64string)</span><br><span class="line">        dst = process_image(img)</span><br><span class="line">        base64dst = image_to_base64(dst)</span><br><span class="line">        <span class="keyword">return</span> base64dst</span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">run</span>(<span class="params">self, ctx</span>):</span></span><br><span class="line">        <span class="keyword">await</span> api.createWindow(</span><br><span class="line">            <span class="built_in">type</span>=<span class="string">&quot;Image Viewer&quot;</span>, </span><br><span class="line">            data=&#123;</span><br><span class="line">                <span class="string">&quot;process&quot;</span>: self.process,</span><br><span class="line">                <span class="string">&quot;_rintf&quot;</span>: <span class="literal">True</span>&#125;)</span><br><span class="line"></span><br><span class="line">api.export(ImJoyPlugin())</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><br>åœ¨è°ƒè¯•ä¸Šè¿°æ’ä»¶æ—¶ï¼Œå› ä¸ºæ¶‰åŠåˆ°äº†<code>base64</code>çš„ç¼–ç å’Œè§£ç ï¼Œæˆ‘é¢‘ç¹ç”¨åˆ°äº†å¦‚ä¸‹debugæ–¹æ³•ï¼Œæ¨èå°è¯•ï¼š<br>ï¼ˆ1ï¼‰ä½¿ç”¨<code>api.log(base64string)</code>å°†base64ç¼–ç ç»“æœæ˜¾ç¤ºåœ¨æ§åˆ¶å°ä¸­ï¼›<br>ï¼ˆ2ï¼‰ä½¿ç”¨è¿™ä¸ªç½‘ç«™<a href="https://base64.guru/converter/decode/image">Base64 to Image</a>å°†base64ç¼–ç å¯è§†åŒ–ï¼Œä»¥æŸ¥çœ‹ç»“æœæ­£ä¸æ­£ç¡®ã€‚</p><h1 id="ä½¿ç”¨pythonæ·±åº¦å­¦ä¹ åº“"><a href="#ä½¿ç”¨pythonæ·±åº¦å­¦ä¹ åº“" class="headerlink" title="ä½¿ç”¨pythonæ·±åº¦å­¦ä¹ åº“"></a>ä½¿ç”¨pythonæ·±åº¦å­¦ä¹ åº“</h1><p>å¦‚ä¸Šï¼Œæˆ‘ä»¬ä½¿ç”¨äº†opencv-pythonè¿›è¡Œäº†ç®€å•çš„å›¾åƒå¤„ç†ï¼ŒéªŒè¯äº†native pythonæ’ä»¶çš„å¯è¡Œæ€§ã€‚<br>è€Œé™¤äº†opencv-pythonï¼ŒpythonèƒŒåè¿˜æœ‰ç€æ›´ä¸ºå¹¿é˜”çš„æ·±åº¦å­¦ä¹ ç”Ÿæ€ï¼Œå¦‚tensorflowã€pytorchã€mxnetã€paddlepaddleç­‰æ·±åº¦å­¦ä¹ æ¡†æ¶ï¼Œä»¥åŠè¿™äº›æ¡†æ¶å¯è°ƒç”¨çš„GPUèµ„æºï¼Œå› æ­¤å¯ä»¥è¯´æ•´ä¸ªpythonè®¡ç®—ç”Ÿæ€éƒ½å¯ä»¥è¢«ImJoyçš„native pythonæ’ä»¶æ‰€è°ƒç”¨ï¼Œè¿™å°±æä¾›äº†éå¸¸å¹¿é˜”çš„åº”ç”¨ç©ºé—´ã€‚<br>è¯¥éƒ¨åˆ†ä¸å†ä»‹ç»native pythonæ€æ ·è°ƒç”¨pythonæ·±åº¦å­¦ä¹ åº“ï¼Œè€Œæ˜¯åœ¨åé¢çš„å…·ä½“åº”ç”¨ä¸­è¯¦ç»†è§£æã€‚</p>]]></content>
    
    
    <summary type="html">ä¸Šä¸€ç¯‡ç€é‡ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨JavaScriptåº“æ¥ç¼–å†™æ’ä»¶çš„å‰ç«¯UIå’Œåç«¯è®¡ç®—é€»è¾‘ï¼Œè¿™ä¸€èŠ‚ä¼šä»‹ç»å¦‚ä½•å°†è®¡ç®—åç«¯åˆ‡æ¢ä¸ºpythonè¯­è¨€ï¼Œå³è®¡ç®—é€»è¾‘å®Œå…¨ä½¿ç”¨pythonç¼–å†™ï¼Œå……åˆ†åˆ©ç”¨pythonåºå¤§çš„è®¡ç®—ç”Ÿæ€ã€‚
ä½¿ç”¨pythonå¼€å‘è®¡ç®—æ’ä»¶æœ‰ä¸¤ç§ï¼š
ï¼ˆ1ï¼‰web-pythonï¼šå³pythonè¿è¡Œåœ¨æµè§ˆå™¨ä¸­ï¼Œå…¶åŸç†å®é™…æ˜¯åº”ç”¨äº†Pyodideè¿™ä¸€å·¥å…·ï¼Œå°†pythonä»£ç ç¼–è¯‘åœ¨æµè§ˆå™¨ä¸­ï¼Œä½†å…¶ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œé¦–å…ˆæ˜¯åŠ è½½é€Ÿåº¦éå¸¸æ…¢ï¼Œå› ä¸ºç¬¬ä¸€æ¬¡è¿è¡Œæ—¶éœ€è¦å°†æ‰€ç”¨çš„pythonåº“éƒ½ä¸‹è½½ä¸‹æ¥ï¼›ç„¶åå…¶ä¹Ÿæ— æ³•åº”ç”¨æ•´ä¸ªpythonæ·±åº¦å­¦ä¹ ç”Ÿæ€ã€‚
ï¼ˆ2ï¼‰native-pythonï¼šè¯¥ç±»å‹æ’ä»¶ä¼šé“¾æ¥ä¸€ä¸ªæœ¬åœ°çš„jupyteræ’ä»¶å¼•</summary>
    
    
    
    <category term="computer vision" scheme="http://qixinbo.github.io/categories/computer-vision/"/>
    
    
    <category term="ImJoy" scheme="http://qixinbo.github.io/tags/ImJoy/"/>
    
  </entry>
  
  <entry>
    <title>å¼€æºæ·±åº¦å­¦ä¹ è®¡ç®—å¹³å°ImJoyè§£æï¼š7 -- æ„å»ºåŸºäºWebçš„å›¾åƒåˆ†ææ’ä»¶ï¼ˆJavaScriptå®ç°ï¼‰</title>
    <link href="http://qixinbo.github.io/2021/12/17/ImJoy_7/"/>
    <id>http://qixinbo.github.io/2021/12/17/ImJoy_7/</id>
    <published>2021-12-16T16:00:00.000Z</published>
    <updated>2021-12-18T12:28:53.161Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h1><p><a href="https://imjoy.io/docs/#/i2k_tutorial?id=_3-build-web-based-plugins-for-image-analysis">Build web-based plugins for image analysis</a></p><h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><p>åœ¨æœ¬æ–‡ä¸­ï¼Œå°†åˆ¶ä½œä¸€ä¸ªåŸºäºWebç½‘é¡µçš„ç”¨äºå›¾åƒåˆ†æçš„ImJoyäº¤äº’å¼æ’ä»¶ã€‚</p><h1 id="ä½¿ç”¨-HTML-CSS-JS-åˆ¶ä½œGUIæ’ä»¶"><a href="#ä½¿ç”¨-HTML-CSS-JS-åˆ¶ä½œGUIæ’ä»¶" class="headerlink" title="ä½¿ç”¨ HTML/CSS/JS åˆ¶ä½œGUIæ’ä»¶"></a>ä½¿ç”¨ HTML/CSS/JS åˆ¶ä½œGUIæ’ä»¶</h1><p>å¦‚ä¸‹æ’ä»¶å®ç°äº†ä¸€ä¸ªä¸Šä¼ å¹¶æ˜¾ç¤ºå›¾åƒçš„åŠŸèƒ½ï¼Œå…·ä½“å‡½æ•°è¯´æ˜è¯¦è§ä¸‹é¢ä»£ç çš„æ³¨é‡Šï¼š<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- ä»¥Jsonæ ¼å¼å®šä¹‰æ’ä»¶å±æ€§ --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- åç§°ä¸ºImage Viewerï¼Œç±»å‹ä¸ºwindowæ’ä»¶ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">config</span> <span class="attr">lang</span>=<span class="string">&quot;json&quot;</span>&gt;</span></span><br><span class="line">&#123;</span><br><span class="line">    &quot;name&quot;: &quot;Image Viewer&quot;, </span><br><span class="line">    &quot;type&quot;: &quot;window&quot;,</span><br><span class="line">    &quot;tags&quot;: [],</span><br><span class="line">    &quot;ui&quot;: &quot;&quot;,</span><br><span class="line">    &quot;version&quot;: &quot;0.1.0&quot;,</span><br><span class="line">    &quot;cover&quot;: &quot;&quot;,</span><br><span class="line">    &quot;description&quot;: &quot;This is a demo plugin for displaying image&quot;,</span><br><span class="line">    &quot;icon&quot;: &quot;extension&quot;,</span><br><span class="line">    &quot;inputs&quot;: null,</span><br><span class="line">    &quot;outputs&quot;: null,</span><br><span class="line">    &quot;api_version&quot;: &quot;0.1.8&quot;,</span><br><span class="line">    &quot;env&quot;: &quot;&quot;,</span><br><span class="line">    &quot;permissions&quot;: [],</span><br><span class="line">    &quot;requirements&quot;: [],</span><br><span class="line">    &quot;dependencies&quot;: []</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">config</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- ä½¿ç”¨HTMLç¼–å†™çª—å£çš„æ˜¾ç¤ºå†…å®¹ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">window</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- æ˜¾ç¤ºæ–‡æœ¬ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Please open an image (jpg/png/gif)<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- ä½¿ç”¨&lt;input&gt;æ ‡ç­¾å®šä¹‰ç”¨æˆ·å¯è¾“å…¥çš„å­—æ®µï¼Œå…¶ä¸­ï¼š</span></span><br><span class="line"><span class="comment">        typeå±æ€§å®šä¹‰å…ƒç´ ç±»å‹ï¼Œè¿™é‡Œä¸ºfileï¼Œå³ä¸Šä¼ æ–‡ä»¶</span></span><br><span class="line"><span class="comment">        acceptå±æ€§åˆ™é™åˆ¶å¯ç”¨æ–‡ä»¶ç±»å‹ï¼Œè¿™é‡Œé™åˆ¶æ–‡ä»¶ä¸ºå›¾ç‰‡ç±»å‹</span></span><br><span class="line"><span class="comment">        captureå±æ€§åˆ™å®šä¹‰åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šå¯ä»¥ä¸ä¸Šä¼ æ–‡ä»¶ï¼Œè€Œæ˜¯è°ƒç”¨ç³»ç»Ÿçš„ç›¸æœºæ¥æ‹ç…§</span></span><br><span class="line"><span class="comment">        è¿™äº›å±æ€§çš„ç”¨æ³•å¯ä»¥å‚è§å¦‚ä¸‹æ•™ç¨‹ï¼š</span></span><br><span class="line"><span class="comment">        https://cloud.tencent.com/developer/article/1537891 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span>  <span class="attr">id</span>=<span class="string">&quot;file-input&quot;</span> <span class="attr">accept</span>=<span class="string">&quot;image/*&quot;</span> <span class="attr">capture</span>=<span class="string">&quot;camera&quot;</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- ä½¿ç”¨&lt;canvas&gt;æ ‡ç­¾æ¥å®šä¹‰ä¸€ä¸ªç”»å¸ƒï¼Œç”¨äºæ‰¿è½½å›¾åƒçš„æ˜¾ç¤º</span></span><br><span class="line"><span class="comment">        canvaså…ƒç´ æœ¬èº«åªæ˜¯ä¸€ä¸ªå›¾åƒå®¹å™¨ï¼Œæ²¡æœ‰ç»˜å›¾èƒ½åŠ›ï¼Œéœ€è¦ä½¿ç”¨JSè„šæœ¬è¿›è¡Œç»˜åˆ¶ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span>=<span class="string">&quot;input-canvas&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 100%; object-fit: cover;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">window</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- ä½¿ç”¨CSSä»£ç æ¥ç¼–å†™çª—å£æ˜¾ç¤ºå†…å®¹çš„æ ·å¼</span></span><br><span class="line"><span class="comment">è¿™é‡Œæ²¡æœ‰å®šä¹‰ç‰¹æ®Šæ ·å¼ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- å®é™…æ’ä»¶ä»£ç  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;javascript&quot;</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="comment">// å°†base64æ ¼å¼å›¾ç‰‡ä¼ åˆ°ç”»å¸ƒä¸Š</span></span></span><br><span class="line"><span class="javascript"><span class="comment">// ç”¨æ³•è§ï¼šhttps://blog.csdn.net/qq_39765048/article/details/118021098</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">const</span> drawImage = <span class="function">(<span class="params">canvas, base64Image</span>)=&gt;</span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>)=&gt;</span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> img = <span class="keyword">new</span> Image()</span></span><br><span class="line"><span class="javascript">        img.crossOrigin = <span class="string">&quot;anonymous&quot;</span></span></span><br><span class="line"><span class="javascript">        img.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">const</span> ctx = canvas.getContext(<span class="string">&quot;2d&quot;</span>);</span></span><br><span class="line"><span class="javascript">            canvas.width = <span class="built_in">Math</span>.min(<span class="built_in">this</span>.width, <span class="number">512</span>);</span></span><br><span class="line"><span class="javascript">            canvas.height= <span class="built_in">Math</span>.min(<span class="built_in">this</span>.height, <span class="built_in">parseInt</span>(<span class="number">512</span>*<span class="built_in">this</span>.height/<span class="built_in">this</span>.width), <span class="number">1024</span>);</span></span><br><span class="line"><span class="javascript">            <span class="comment">// draw the img into canvas</span></span></span><br><span class="line"><span class="javascript">            ctx.drawImage(<span class="built_in">this</span>, <span class="number">0</span>, <span class="number">0</span>, canvas.width, canvas.height);</span></span><br><span class="line">            resolve(canvas);</span><br><span class="line">        &#125;</span><br><span class="line">        img.onerror = reject;</span><br><span class="line">        img.src = base64Image;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="javascript"><span class="comment">// è¯»å–æ–‡ä»¶å†…å®¹</span></span></span><br><span class="line"><span class="javascript"><span class="comment">// æ³¨æ„è¿™é‡Œçš„å½¢å‚fileï¼Œå®ƒå¯¹åº”çš„å®å‚æ˜¯Fileå¯¹è±¡ï¼ˆç”±ä¸‹é¢çš„fileInput.files[0]å¯çŸ¥ï¼‰</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">const</span> readImageFile = <span class="function">(<span class="params">file</span>)=&gt;</span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>)=&gt;</span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> U = <span class="built_in">window</span>.URL || <span class="built_in">window</span>.webkitURL;</span></span><br><span class="line"><span class="javascript">        <span class="comment">// è¯¥æµç¨‹ç”¨äºsafariæµè§ˆå™¨</span></span></span><br><span class="line"><span class="javascript">        <span class="comment">// Fileå¯¹è±¡ç»§æ‰¿è‡ªBlob</span></span></span><br><span class="line">        if(U.createObjectURL)&#123;</span><br><span class="line"><span class="javascript">            <span class="comment">// ä»¥ä¸‹ç”¨æ³•å°±æ˜¯å°†Blobç”¨ä½œURLï¼Œè¿™æ ·å°±å¯ä»¥ç›´æ¥è®¿é—®å®ƒ</span></span></span><br><span class="line"><span class="javascript">            <span class="comment">// ç”¨æ³•è§ï¼šhttps://zh.javascript.info/blob</span></span></span><br><span class="line">            resolve(U.createObjectURL(file))</span><br><span class="line">        &#125;</span><br><span class="line"><span class="javascript">        <span class="comment">// ç¬¬äºŒç§å°±æ˜¯å°†blobè½¬ä¸ºäº†base64ç¼–ç </span></span></span><br><span class="line"><span class="javascript">        <span class="comment">// ç”¨æ³•è§ï¼šhttps://zh.javascript.info/file</span></span></span><br><span class="line"><span class="javascript">        <span class="comment">// https://segmentfault.com/a/1190000022208272</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">else</span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">const</span> fr = <span class="keyword">new</span> FileReader();</span></span><br><span class="line"><span class="javascript">            <span class="comment">// when image is loaded, set the src of the image where you want to display it</span></span></span><br><span class="line"><span class="javascript">            fr.onload = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span></span><br><span class="line">                resolve(e.target.result)</span><br><span class="line">            &#125;;</span><br><span class="line">            fr.onerror = reject</span><br><span class="line"><span class="javascript">            <span class="comment">// è½¬æ¢ä¸º base64 çš„ data url</span></span></span><br><span class="line">            fr.readAsDataURL(file);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="javascript"><span class="comment">// ç¼–å†™æ’ä»¶å‡½æ•°</span></span></span><br><span class="line"><span class="javascript"><span class="comment">// ä¸€ä¸ªæœ€å°çš„æ’ä»¶éœ€è¦å®ç°ä¸¤ä¸ªå‡½æ•°ï¼šsetup() å’Œ run()</span></span></span><br><span class="line"><span class="javascript"><span class="class"><span class="keyword">class</span> <span class="title">ImJoyPlugin</span></span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="comment">// setup() å‡½æ•°ï¼šåœ¨æ’ä»¶ç¬¬ä¸€æ¬¡åŠ è½½å’Œåˆå§‹åŒ–æ—¶æ‰§è¡Œå®ƒã€‚</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">async</span> <span class="function"><span class="title">setup</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="comment">// é€šè¿‡IDè·å¾—é¡µé¢ä¸­çš„inputå…ƒç´ </span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> fileInput = <span class="built_in">document</span>.getElementById(<span class="string">&quot;file-input&quot;</span>);</span></span><br><span class="line"><span class="javascript">        <span class="comment">// é€šè¿‡IDè·å¾—é¡µé¢ä¸­çš„canvaså…ƒç´ </span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> canvas = <span class="built_in">document</span>.getElementById(<span class="string">&quot;input-canvas&quot;</span>);</span></span><br><span class="line"><span class="javascript">        <span class="comment">// ä¸ºinputå…ƒç´ æ·»åŠ ç‚¹å‡»äº‹ä»¶ï¼Œå…¶ä¸­æ¶‰åŠäº†å¦‚ä¸‹è¯­æ³•ç‚¹ï¼š</span></span></span><br><span class="line"><span class="javascript">        <span class="comment">// ï¼ˆ1ï¼‰addEventListenerè¯­æ³•ï¼šhttps://www.runoob.com/jsref/met-document-addeventlistener.html</span></span></span><br><span class="line"><span class="javascript">        <span class="comment">// ï¼ˆ2ï¼‰ç®­å¤´å‡½æ•°ï¼šhttps://www.helloworld.net/p/0020086208</span></span></span><br><span class="line"><span class="javascript">        <span class="comment">// https://gauliang.github.io/blog/2020/javascript-arrow-function-best-practices/</span></span></span><br><span class="line"><span class="javascript">        <span class="comment">// ï¼ˆ3ï¼‰async/awaitå¼‚æ­¥ç¼–ç¨‹ï¼šhttps://www.ruanyifeng.com/blog/2015/05/async.html</span></span></span><br><span class="line"><span class="javascript">        <span class="comment">// https://developer.mozilla.org/zh-CN/docs/Learn/JavaScript/Asynchronous/Async_await</span></span></span><br><span class="line"><span class="javascript">        fileInput.addEventListener(<span class="string">&quot;change&quot;</span>, <span class="keyword">async</span> ()=&gt;&#123;</span></span><br><span class="line"><span class="javascript">            <span class="comment">// æ‰§è¡Œä¸Šé¢çš„readImageFileå‡½æ•°</span></span></span><br><span class="line"><span class="javascript">            <span class="comment">// è¾“å…¥å‚æ•°å°±æ˜¯inputå…ƒç´ è·å–çš„æ–‡ä»¶ï¼Œå…·ä½“ç”¨æ³•å¦‚ä¸‹ï¼š</span></span></span><br><span class="line"><span class="javascript">            <span class="comment">// https://developer.mozilla.org/en-US/docs/Web/API/FileList</span></span></span><br><span class="line"><span class="javascript">            <span class="keyword">const</span> img = <span class="keyword">await</span> readImageFile(fileInput.files[<span class="number">0</span>]);</span></span><br><span class="line"><span class="javascript">            <span class="comment">// æ‰§è¡Œä¸Šé¢çš„drawImageå‡½æ•°</span></span></span><br><span class="line"><span class="javascript">            <span class="keyword">await</span> drawImage(canvas, img);</span></span><br><span class="line"><span class="javascript">        &#125;, <span class="literal">true</span>);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">await</span> api.log(<span class="string">&quot;plugin initialized&quot;</span>)</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="javascript">    <span class="comment">// run() å‡½æ•°ï¼šæ¯æ¬¡æ‰§è¡Œæ’ä»¶æ—¶éƒ½ä¼šè°ƒç”¨ã€‚</span></span></span><br><span class="line"><span class="javascript">    <span class="comment">// æ‰§è¡Œæ—¶ï¼Œä¸€ä¸ªå¸¦æœ‰ä¸Šä¸‹æ–‡ï¼ˆåä¸ºâ€œctxâ€ï¼‰çš„å¯¹è±¡objectï¼ˆJavascriptæ’ä»¶ï¼‰æˆ–å­—å…¸dictionaryï¼ˆPythonæ’ä»¶ï¼‰å°†è¢«ä¼ é€’åˆ°å‡½æ•°ä¸­ã€‚</span></span></span><br><span class="line"><span class="javascript">    <span class="comment">// è¿”å›çš„ç»“æœå°†æ˜¾ç¤ºä¸ºä¸€ä¸ªæ–°çª—å£æˆ–ä¼ é€’ç»™å·¥ä½œæµä¸­çš„ä¸‹ä¸€ä¸ª opã€‚</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">async</span> <span class="function"><span class="title">run</span>(<span class="params">ctx</span>)</span>&#123;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="javascript"><span class="comment">// å¯¼å‡ºæ’ä»¶å‡½æ•°ï¼Œæˆ–ç§°æ³¨å†Œæ’ä»¶å‡½æ•°ï¼Œ</span></span></span><br><span class="line"><span class="javascript"><span class="comment">// è¿™æ˜¯ä¸ºäº†ä½¿å¾—æ’ä»¶å¯ä»¥è¢«ImJoyä¸»ç¨‹åºæˆ–å…¶ä»–æ’ä»¶æ‰€è°ƒç”¨</span></span></span><br><span class="line"><span class="javascript">api.export(<span class="keyword">new</span> ImJoyPlugin())</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><br>æ’ä»¶çš„è¿è¡Œç»“æœå¦‚ä¸‹å›¾ï¼š<br><img src="https://user-images.githubusercontent.com/6218739/145956208-426aac96-134f-433c-9658-15a32939b996.png" alt="canvas"></p><h2 id="æ›´æ”¹"><a href="#æ›´æ”¹" class="headerlink" title="æ›´æ”¹"></a>æ›´æ”¹</h2><p>å¯¹ä¸Šè¿°æ’ä»¶åšä¸€ç‚¹æ›´æ”¹ï¼Œæ¥åŠ æ·±å¯¹å®ƒçš„ç†è§£ã€‚å…·ä½“åœ°ï¼Œå¢åŠ ä¸€ä¸ªä¸Šä¼ æŒ‰é’®<code>&lt;button&gt;</code>ï¼Œå®ƒå°†è§¦å‘æ‰“å¼€æ–‡ä»¶å¯¹è¯æ¡†ï¼Œä»¥ä¾¿å¯ä»¥ä½¿ç”¨è¯¥æŒ‰é’®æ¥é€‰æ‹©æ–‡ä»¶ã€‚ ï¼ˆè¿™æ ·åšåŸå› æ˜¯ä¸ºäº†åé¢å¯ä»¥è½»æ¾è‡ªå®šä¹‰æŒ‰é’®çš„å¤–è§‚ã€‚ï¼‰<br>ï¼ˆ1ï¼‰åœ¨<code>&lt;input&gt;</code>æ ‡ç­¾ä¸‹æ–¹ï¼Œæ·»åŠ ä¸€è¡Œï¼š<br><code>&lt;button id=&quot;select-button&quot;&gt;Open an image&lt;/button&gt;</code><br>ï¼ˆ2ï¼‰åœ¨<code>setup</code>å‡½æ•°ä¸­ï¼Œæ·»åŠ ï¼š<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å½“æŒ‰é’®ç‚¹å‡»æ—¶è§¦å‘æ–‡ä»¶ä¸Šä¼ æ¡† </span></span><br><span class="line"><span class="keyword">const</span> selectButton = <span class="built_in">document</span>.getElementById(<span class="string">&quot;select-button&quot;</span>);</span><br><span class="line">selectButton.addEventListener(<span class="string">&quot;click&quot;</span>, <span class="keyword">async</span> ()=&gt;&#123;</span><br><span class="line">    <span class="comment">// æ¨¡æ‹Ÿå¯¹&lt;input&gt;æ ‡ç­¾çš„ç‚¹å‡»</span></span><br><span class="line">    fileInput.click()</span><br><span class="line">&#125;, <span class="literal">true</span>);</span><br></pre></td></tr></table></figure><br>ï¼ˆ3ï¼‰åœ¨<code>&lt;style&gt;</code>å—ä¸­æ·»åŠ ä¸€ä¸ªcssæ ·å¼æ¥éšè—<code>&lt;input&gt;</code>å…ƒç´ ï¼š<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-id">#file-input</span>&#123;</span><br><span class="line">   <span class="attribute">display</span>: none;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>ï¼ˆ4ï¼‰å¦å¤–ï¼Œå¯ä»¥é€šè¿‡æ·»åŠ æ›´å¤šcssæ¥æ›´æ”¹æ ‡é¢˜æ–‡æœ¬çš„æ ·å¼ï¼š<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">h1</span>&#123;</span><br><span class="line">   <span class="attribute">color</span>: pink;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>ç°åœ¨æ’ä»¶å˜æˆäº†å¦‚ä¸‹æ¨¡æ ·ï¼š<br><img src="https://user-images.githubusercontent.com/6218739/145958371-b1a76c5b-aa58-4420-be31-a00b75a51d30.png" alt="canvas2"></p><h1 id="ä½¿ç”¨cssåº“"><a href="#ä½¿ç”¨cssåº“" class="headerlink" title="ä½¿ç”¨cssåº“"></a>ä½¿ç”¨cssåº“</h1><p>æ‰‹å·¥åˆ¶ä½œCSSæ ·å¼éå¸¸è€—æ—¶ï¼Œéœ€è¦æ·±å…¥äº†è§£UIè®¾è®¡åŸç†å’ŒCSSæœ¬èº«ã€‚<br>å¹¸è¿çš„æ˜¯ï¼Œå·²ç»æœ‰å¾ˆå¤šUIåº“ï¼ˆ<a href="https://getbootstrap.com/">Bootstrap</a>, <a href="https://materializecss.com/">https://materializecss.com/</a> ç­‰ï¼‰å¯ä»¥åˆ©ç”¨ã€‚è¿˜æœ‰æ›´å¼ºå¤§çš„jsåº“å’Œæ¡†æ¶å¯ä»¥æ„å»ºæ›´ä¸“ä¸šçš„UIï¼Œä¾‹å¦‚ï¼š<a href="https://reactjs.org/">React</a>ã€<a href="https://vuejs.org/">Vuejs</a>å’Œ<a href="https://angular.io/">Angular</a>ã€‚åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œå°†é€‰æ‹©ä¸€ä¸ªåä¸º <a href="https://bulma.io/"><strong>Bulma</strong></a> çš„å°å‹CSSè¿›è¡Œè¯´æ˜ã€‚<br>é€šè¿‡æŸ¥çœ‹Bulmaçš„æ–‡æ¡£<a href="https://bulma.io/documentation/overview/start/">è¿™é‡Œ</a>ï¼Œå¯ä»¥çœ‹å‡ºï¼Œåªéœ€è¦åŠ è½½ä¸€ä¸ªCSSæ–‡ä»¶ã€‚<br>åœ¨ImJoyæ’ä»¶ä¸­ï¼ŒåŠ è½½ç¬¬ä¸‰æ–¹CSSæˆ–Javascriptåº“çš„æ–¹å¼æ˜¯å°†urlæ·»åŠ åˆ°<code>&lt;config&gt;</code>å—ä¸­çš„<code>requirements</code>å­—æ®µã€‚<br>å› æ­¤å¢åŠ å¦‚ä¸‹ä»£ç ï¼š<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;requirements&quot;</span>: [<span class="string">&quot;https://cdn.jsdelivr.net/npm/bulma@0.9.1/css/bulma.min.css&quot;</span>],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>Bulmaæ”¯æŒå¤§é‡ä¸åŒçš„å…ƒç´ å’Œå¸ƒå±€ï¼Œå¯ä»¥åœ¨<a href="https://bulma.io/documentation/elements/button/">æ­¤å¤„</a>é˜…è¯»æœ‰å…³æŒ‰é’®çš„ä¿¡æ¯ã€‚<br>åŸºæœ¬ä¸Šï¼Œåªéœ€è¦å‘æŒ‰é’®æ ‡ç­¾æ·»åŠ ä¸€ä¸ªç±»ï¼ˆä¾‹å¦‚<code>class=&quot;button is-primary&quot;</code>ï¼‰ï¼Œå®ƒå°±ä¼šæ”¹å˜å®ƒçš„å¤–è§‚ã€‚åŒæ ·ï¼Œä¹Ÿå¯ä»¥åœ¨ <code>&lt;h1&gt;</code> æ ‡é¢˜ä¸­æ·»åŠ  <code>class=&quot;title&quot;</code>ã€‚<br>å³ä¿®æ”¹å¦‚ä¸‹ä»£ç ï¼š<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">class</span>=<span class="string">&quot;title&quot;</span>&gt;</span>Please Open an image (jpg/png/gif)<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;select-button&quot;</span> <span class="attr">class</span>=<span class="string">&quot;button is-primary&quot;</span>&gt;</span>Open an image<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>ç°åœ¨æ’ä»¶å˜æˆäº†å¦‚ä¸‹æ¨¡æ ·ï¼š<br><img src="https://user-images.githubusercontent.com/6218739/145963258-5090eb3e-8280-46f2-b188-831169c4fb44.png" alt="canvas-3"></p><p>è¿›ä¸€æ­¥åœ°ï¼Œå¯ä»¥å°è¯•ä½¿ç”¨<a href="https://bulma.io/documentation/components/panel/">panel</a>å°† <code>button</code> å’Œ <code>&lt;canvas&gt;</code> åˆ†ç»„ã€‚<br>è¦åœ¨Bulmaä¸­ä½¿ç”¨å›¾æ ‡ï¼Œéœ€è¦æ·»åŠ  <code>https://use.fontawesome.com/releases/v5.14.0/js/all.js</code> å’Œ <code>requirements</code>ã€‚ç„¶åä»<a href="https://fontawesome.com/icons">è¿™é‡Œ</a>æœç´¢å›¾æ ‡ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‰¾åˆ°ä¸€ä¸ªåä¸º <code>eye</code> çš„å›¾æ ‡ï¼Œå¯ä»¥ä½¿ç”¨å°†è¯¥å›¾æ ‡ä½œä¸º <code>&lt;i class=&quot;fas fa-eye&quot;&gt;&lt;/i&gt;</code> æ·»åŠ åˆ°htmlä¸­ã€‚<br>åœ¨ç›¸åº”çš„åœ°æ–¹ä¿®æ”¹ä»£ç å¦‚ä¸‹ï¼š<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&quot;requirements&quot;: [&quot;https://cdn.jsdelivr.net/npm/bulma@0.9.1/css/bulma.min.css&quot;, &quot;https://use.fontawesome.com/releases/v5.14.0/js/all.js&quot;]</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">window</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span>  <span class="attr">id</span>=<span class="string">&quot;file-input&quot;</span> <span class="attr">accept</span>=<span class="string">&quot;image/*&quot;</span> <span class="attr">capture</span>=<span class="string">&quot;camera&quot;</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">nav</span> <span class="attr">class</span>=<span class="string">&quot;panel&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;panel-heading&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fas fa-eye&quot;</span> <span class="attr">aria-hidden</span>=<span class="string">&quot;true&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> My Image Viewer</span><br><span class="line">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;panel-block&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;select-button&quot;</span> <span class="attr">class</span>=<span class="string">&quot;button is-link is-outlined is-fullwidth&quot;</span>&gt;</span></span><br><span class="line">            Open an image</span><br><span class="line">            <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;panel-block&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span>=<span class="string">&quot;input-canvas&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 100%; object-fit: cover;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">window</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>ç°åœ¨æ’ä»¶å˜æˆäº†å¦‚ä¸‹æ¨¡æ ·ï¼š<br><img src="https://user-images.githubusercontent.com/6218739/145964220-18b1e5fa-06dd-4331-9f67-c94e8c6ea7fd.png" alt="canvas-4"></p><h1 id="ä½¿ç”¨å›¾åƒå¤„ç†åº“OpenCV-js"><a href="#ä½¿ç”¨å›¾åƒå¤„ç†åº“OpenCV-js" class="headerlink" title="ä½¿ç”¨å›¾åƒå¤„ç†åº“OpenCV.js"></a>ä½¿ç”¨å›¾åƒå¤„ç†åº“OpenCV.js</h1><p>OpenCVæ˜¯ä¸€ä¸ªå¸¸ç”¨çš„è®¡ç®—æœºè§†è§‰åº“ï¼Œç”¨C++ç¼–å†™ï¼Œç°åœ¨å®ƒå·²ç»ç”¨WebAssemblyç¼–è¯‘ï¼Œå¯ä»¥åœ¨æµè§ˆå™¨ä¸­è¿è¡Œã€‚<br>opencv.jsæœ‰å¾ˆå¤šåŠŸèƒ½ä»‹ç»æ–‡æ¡£ï¼Œä½†å¯¹äºæœ¬æ•™ç¨‹ï¼Œä»¥ä¸‹ä¸¤éƒ¨åˆ†å°±è¶³å¤Ÿäº†ï¼š<br>ï¼ˆ1ï¼‰äº†è§£å¦‚ä½•ä½¿ç”¨opencv.jsåŠ è½½å’Œä¿å­˜å›¾ç‰‡ï¼Œé˜…è¯»<a href="https://docs.opencv.org/3.4/df/d24/tutorial_js_image_display.html">è¿™é‡Œ</a><br>ï¼ˆ2ï¼‰ä»<a href="https://docs.opencv.org/3.4/d2/df0/tutorial_js_table_of_contents_imgproc.html">æ­¤åˆ—è¡¨</a> ä¸­é€‰æ‹©ä¸€ä¸ªå›¾åƒå¤„ç†æ•™ç¨‹å¹¶å°†å…¶é›†æˆåˆ°å›¾åƒæŸ¥çœ‹å™¨æ’ä»¶ä¸­ã€‚ä¾‹å¦‚ï¼Œ<a href="https://docs.opencv.org/3.4/d7/dd0/tutorial_js_thresholding.html">å›¾åƒé˜ˆå€¼</a>ã€<a href="https://docs.opencv.org/3.4/dd/d6a/tutorial_js_filtering.html">å¹³æ»‘å›¾åƒ</a>ã€<a href="https://docs.opencv.org/3.4/d7/de1/tutorial_js_canny.html">canny è¾¹ç¼˜æ£€æµ‹</a>æˆ–<a href="https://docs.opencv.org/3.4/d7/d1c/tutorial_js_watershed.html">åˆ†æ°´å²­åˆ†å‰²</a>ã€‚</p><p>åŸºæœ¬ä¸Šï¼Œéœ€è¦ç»è¿‡ä¸‰ä¸ªæ­¥éª¤æ¥å®ç°ï¼š<br>ï¼ˆ1ï¼‰åœ¨<code>&lt;config&gt;</code>ä¸‹çš„<code>&quot;requirements&quot;</code>ä¸­æ·»åŠ opencv.jsåº“<code>&quot;https://docs.opencv.org/master/opencv.js&quot;</code><br>ï¼ˆ2ï¼‰ä»æ•™ç¨‹ä¸­å–å‡ºå›¾åƒå¤„ç†éƒ¨åˆ†ï¼Œå¹¶å°†å…¶åŒ…è£…ä¸ºä¸€ä¸ªå‡½æ•°ï¼ˆä¾‹å¦‚<code>processImage</code>ï¼‰<br>ï¼ˆ3ï¼‰æ·»åŠ ç‚¹å‡»æ—¶è°ƒç”¨å‡½æ•°çš„<code>button</code>ã€‚</p><p>æ¥ä¸‹æ¥ä»¥â€œå½©è‰²è½¬ç°åº¦â€è¿™ä¸€åŠŸèƒ½ä½œä¸ºä¾‹å­ï¼š<br>ï¼ˆ1ï¼‰æ·»åŠ opencv.jsåº“ï¼š<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;requirements&quot;: [&quot;https://cdn.jsdelivr.net/npm/bulma@0.9.1/css/bulma.min.css&quot;, &quot;https://use.fontawesome.com/releases/v5.14.0/js/all.js&quot;, &quot;https://docs.opencv.org/master/opencv.js&quot;]</span><br></pre></td></tr></table></figure><br>ï¼ˆ2ï¼‰ç¼–å†™å›¾åƒå¤„ç†å‡½æ•°ï¼š<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;panel-block&quot;</span>&gt;</span><br><span class="line">    &lt;canvas id=<span class="string">&quot;input-canvas&quot;</span> style=<span class="string">&quot;width: 100%; object-fit: cover;&quot;</span>&gt;&lt;/canvas&gt;</span><br><span class="line">    <span class="comment">// æ–°å¢ä¸€ä¸ªç”»å¸ƒï¼Œç”¨äºæ˜¾ç¤ºå¤„ç†åçš„å›¾åƒ</span></span><br><span class="line">    &lt;canvas id=<span class="string">&quot;output-canvas&quot;</span> style=<span class="string">&quot;width: 100%; object-fit: cover;&quot;</span>&gt;&lt;/canvas&gt;</span><br><span class="line">&lt;/div&gt; </span><br><span class="line"></span><br><span class="line"><span class="comment">// opencvå›¾åƒå¤„ç†å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">processImage</span>(<span class="params">inputCanvasId, outputCanvasId</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> src = cv.imread(inputCanvasId);</span><br><span class="line">    <span class="keyword">let</span> dst = <span class="keyword">new</span> cv.Mat();</span><br><span class="line">    cv.cvtColor(src, dst, cv.COLOR_RGBA2GRAY);</span><br><span class="line">    cv.imshow(outputCanvasId, dst);</span><br><span class="line">    src.delete();</span><br><span class="line">    dst.delete();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>(3) æ·»åŠ äº‹ä»¶ï¼š<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;panel-block&quot;</span>&gt;</span><br><span class="line">    &lt;button id=<span class="string">&quot;select-button&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;button is-link is-outlined is-fullwidth&quot;</span>&gt;</span><br><span class="line">    Open an image</span><br><span class="line">    &lt;/button&gt;</span><br><span class="line">    <span class="comment">// æ–°å¢ä¸€ä¸ªæŒ‰é’®æ¥è§¦å‘å›¾åƒå¤„ç†æ“ä½œ</span></span><br><span class="line">    &lt;button id=<span class="string">&quot;process-button&quot;</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;button is-link is-outlined is-fullwidth&quot;</span>&gt;</span><br><span class="line">    RGB to Gray</span><br><span class="line">    &lt;/button&gt;            </span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨setupå‡½æ•°ç§æ–°å¢å¦‚ä¸‹äº‹ä»¶</span></span><br><span class="line"><span class="keyword">const</span> processButton = <span class="built_in">document</span>.getElementById(<span class="string">&quot;process-button&quot;</span>);</span><br><span class="line">processButton.addEventListener(<span class="string">&quot;click&quot;</span>, <span class="keyword">async</span> ()=&gt;&#123;</span><br><span class="line">    processImage(<span class="string">&#x27;input-canvas&#x27;</span>, <span class="string">&#x27;output-canvas&#x27;</span>)</span><br><span class="line">&#125;, <span class="literal">true</span>);</span><br></pre></td></tr></table></figure><br>æ•´ä¸ªæ’ä»¶çš„è¿è¡Œç¤ºä¾‹å¦‚ä¸‹ï¼š<br><img src="https://user-images.githubusercontent.com/6218739/146137751-81871ffc-4295-45c7-b552-2e028e39eabc.png" alt="opencvjs"></p><h1 id="ä½¿ç”¨æ·±åº¦å­¦ä¹ åº“tensorflow-js"><a href="#ä½¿ç”¨æ·±åº¦å­¦ä¹ åº“tensorflow-js" class="headerlink" title="ä½¿ç”¨æ·±åº¦å­¦ä¹ åº“tensorflow.js"></a>ä½¿ç”¨æ·±åº¦å­¦ä¹ åº“tensorflow.js</h1><p><a href="https://www.tensorflow.org/">Tensorflow</a>æ˜¯ä¸€ä¸ªè¢«å¹¿æ³›ä½¿ç”¨çš„æ·±åº¦å­¦ä¹ åº“ï¼Œå®ƒå·²ç»è¢«ç§»æ¤åˆ°javascriptåœ¨æµè§ˆå™¨ä¸­è¿è¡Œï¼Œè¯¥åº“è¢«ç§°ä¸º<a href="https://www.tensorflow.org/js/">Tensorflow.js</a>ã€‚<br>è¿™ä¸€éƒ¨åˆ†ä¼šå°†Tensorflow.jsé›†æˆåˆ°ä¸Šè¿°æ’ä»¶ä¸­ï¼Œå…·ä½“åŠŸèƒ½ä¸ºä½¿ç”¨ä¸€ä¸ªé¢„è®­ç»ƒçš„MobileNetç®—æ³•å¯¹å›¾åƒè¿›è¡Œåˆ†ç±»ï¼Œè¯¦è§<a href="https://github.com/imjoy-team/imjoy-plugins/blob/54675ae50a0e958605f2a5458e635fdb0437a1f4/repository/imageRecognition.imjoy.html">è¿™é‡Œ</a>ã€‚<br>ï¼ˆ1ï¼‰é¦–å…ˆå¼•ç”¨å¿…è¦çš„JSåº“ï¼š<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&quot;requirements&quot;: [</span><br><span class="line">&quot;https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@0.14.1&quot;,</span><br><span class="line">&quot;https://cdn.jsdelivr.net/npm/@tensorflow-models/mobilenet@0.2.2&quot;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><br>ï¼ˆ2ï¼‰å¢åŠ é¢„æµ‹æŒ‰é’®ã€ç»“æœæ˜¾ç¤ºã€æ¨¡å‹åŠ è½½ç­‰çª—å£ç»„ä»¶ï¼š<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;panel-block&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;predict-button&quot;</span> <span class="attr">class</span>=<span class="string">&quot;button is-link is-outlined is-fullwidth&quot;</span>&gt;</span></span><br><span class="line">    Predict</span><br><span class="line">    <span class="tag">&lt;/<span class="name">button</span>&gt;</span>        </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">&lt;!â€“â€“ Header bar â€“â€“&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;hero hero-sm bg-secondary&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;mx-2&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h3</span> <span class="attr">id</span>=<span class="string">&quot;hero_title&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;status&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><br>ï¼ˆ3ï¼‰åœ¨setupå‡½æ•°ä¸­å¢åŠ äº‹ä»¶å“åº”ï¼š<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> predictButton = <span class="built_in">document</span>.getElementById(<span class="string">&quot;predict-button&quot;</span>);</span><br><span class="line">predictButton.onclick = <span class="function">()=&gt;</span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.predict()</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Load the model.</span></span><br><span class="line"><span class="keyword">const</span> statusElement = <span class="built_in">document</span>.getElementById(<span class="string">&quot;status&quot;</span>);</span><br><span class="line">statusElement.innerHTML = <span class="string">&#x27;Loading pretrained model...&#x27;</span>;</span><br><span class="line"><span class="built_in">this</span>.model = <span class="keyword">await</span> mobilenet.load();</span><br><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">&quot;hero_title&quot;</span>).innerHTML = <span class="string">&#x27;Model loaded&#x27;</span></span><br><span class="line">statusElement.innerHTML = <span class="string">&#x27;1. Open image (.png/.jpg) or use pre-loaded image. &lt;br&gt; 2. Click `Predict` for image recognition!&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Display the predict button and file selection</span></span><br><span class="line">predictButton.style.display = <span class="string">&quot;inline&quot;</span>;</span><br><span class="line">fileInput.style.display = <span class="string">&quot;inline&quot;</span>;</span><br></pre></td></tr></table></figure><br>å¯ä»¥çœ‹å‡ºï¼Œåˆ†åˆ«ä¸ºé¢„æµ‹æŒ‰é’®ç»‘å®šäº†ç‚¹å‡»äº‹ä»¶å“åº”ï¼Œä»¥åŠè‡ªåŠ¨ä¸‹è½½æ¨¡å‹ã€‚<br>ï¼ˆ4ï¼‰ç¼–å†™æ¨¡å‹é¢„æµ‹é€»è¾‘ï¼š<br>åœ¨ä¸Šé¢çš„é¢„æµ‹æŒ‰é’®ç‚¹å‡»åï¼Œä¼šè§¦å‘å¦‚ä¸‹é¢„æµ‹å‡½æ•°ï¼ˆè¿™ä¸ªå‡½æ•°åœ¨setupä¹‹å¤–ï¼Œå³ä¸setupåœ°ä½å¹³é½ï¼‰ï¼š<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="title">predict</span>(<span class="params"></span>)</span>&#123;    </span><br><span class="line">  <span class="keyword">const</span> canvas = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;input-canvas&#x27;</span>);</span><br><span class="line">  <span class="comment">// Classify the image.</span></span><br><span class="line">  <span class="keyword">const</span> predictions = <span class="keyword">await</span> <span class="built_in">this</span>.model.classify(canvas)</span><br><span class="line">  <span class="comment">// Output result in console</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;Predictions&#x27;</span>, predictions);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// Output results in interface</span></span><br><span class="line">  <span class="built_in">document</span>.getElementById(<span class="string">&quot;hero_title&quot;</span>).innerHTML = <span class="string">&#x27;Predictions: &#x27;</span></span><br><span class="line">  <span class="keyword">const</span> result_string_html = <span class="string">`Top-1: <span class="subst">$&#123;predictions[<span class="number">0</span>].className&#125;</span> (<span class="subst">$&#123;<span class="built_in">Math</span>.round(predictions[<span class="number">0</span>].probability*<span class="number">100</span>)&#125;</span>%) &lt;br&gt; Top-2: <span class="subst">$&#123;predictions[<span class="number">1</span>].className&#125;</span> (<span class="subst">$&#123;<span class="built_in">Math</span>.round(predictions[<span class="number">1</span>].probability*<span class="number">100</span>)&#125;</span>%)`</span>;</span><br><span class="line">  <span class="built_in">document</span>.getElementById(<span class="string">&quot;status&quot;</span>).innerHTML = result_string_html</span><br><span class="line">  <span class="comment">// Output results as ImJoy alert</span></span><br><span class="line">  <span class="keyword">const</span> result_string =  <span class="string">`Predictions: Top-1 <span class="subst">$&#123;predictions[<span class="number">0</span>].className&#125;</span> (<span class="subst">$&#123;<span class="built_in">Math</span>.round(predictions[<span class="number">0</span>].probability*<span class="number">100</span>)&#125;</span>%); Top-2 <span class="subst">$&#123;predictions[<span class="number">1</span>].className&#125;</span> (<span class="subst">$&#123;<span class="built_in">Math</span>.round(predictions[<span class="number">1</span>].probability*<span class="number">100</span>)&#125;</span>%);`</span>;</span><br><span class="line">  api.alert(result_string)</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å¢åŠ ä¸Šè¿°å†…å®¹åï¼Œæ•´ä¸ªæ’ä»¶è¿è¡Œç»“æœå¦‚ä¸‹ï¼š<br><img src="https://user-images.githubusercontent.com/6218739/146505050-e59640d2-9cd4-45f2-8a9c-736ad08e87ca.png" alt="tfjs"><br>å¯ä»¥çœ‹å‡ºï¼Œåœ¨æœ€ä¸‹é¢å¯¹å›¾åƒä¸­çš„å†…å®¹è¿›è¡Œäº†åˆ†ç±»è¯†åˆ«ã€‚</p><p>æ³¨æ„ï¼šè™½ç„¶åŸºäºæµè§ˆå™¨çš„æ’ä»¶å·²ç»å¾ˆæœ‰ç”¨ï¼Œå¹¶ä¸”éšç€WebAssemblyå’Œ<a href="https://en.wikipedia.org/wiki/WebGPU">WebGPU</a>ç­‰æ–°æŠ€æœ¯çš„ä½¿ç”¨è€Œå˜å¾—æ›´åŠ å¼ºå¤§ï¼Œä½†å®ƒæ— æ³•è¿›è¡Œå¤§è§„æ¨¡è®¡ç®—ï¼Œå¹¶ä¸”ç”±äºå…¶å®‰å…¨æ€§è€Œå—åˆ°è®¸å¤šé™åˆ¶ã€‚</p>]]></content>
    
    
    <summary type="html">å‚è€ƒæ–‡çŒ®
Build web-based plugins for image analysis

ç®€ä»‹
åœ¨æœ¬æ–‡ä¸­ï¼Œå°†åˆ¶ä½œä¸€ä¸ªåŸºäºWebç½‘é¡µçš„ç”¨äºå›¾åƒåˆ†æçš„ImJoyäº¤äº’å¼æ’ä»¶ã€‚

ä½¿ç”¨ HTML/CSS/JS åˆ¶ä½œGUIæ’ä»¶
å¦‚ä¸‹æ’ä»¶å®ç°äº†ä¸€ä¸ªä¸Šä¼ å¹¶æ˜¾ç¤ºå›¾åƒçš„åŠŸèƒ½ï¼Œå…·ä½“å‡½æ•°è¯´æ˜è¯¦è§ä¸‹é¢ä»£ç çš„æ³¨é‡Šï¼š
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
</summary>
    
    
    
    <category term="computer vision" scheme="http://qixinbo.github.io/categories/computer-vision/"/>
    
    
    <category term="ImJoy" scheme="http://qixinbo.github.io/tags/ImJoy/"/>
    
  </entry>
  
  <entry>
    <title>å¼€æºæ·±åº¦å­¦ä¹ è®¡ç®—å¹³å°ImJoyè§£æï¼š6 -- API</title>
    <link href="http://qixinbo.github.io/2021/12/11/ImJoy_6/"/>
    <id>http://qixinbo.github.io/2021/12/11/ImJoy_6/</id>
    <published>2021-12-10T16:00:00.000Z</published>
    <updated>2021-12-11T09:29:25.698Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h1><p><a href="https://imjoy.io/docs/#/api">ImJoy API</a></p><h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><p>ImJoyçš„æ¯ä¸ªæ’ä»¶éƒ½åœ¨è‡ªå·±çš„ç±»ä¼¼æ²™ç®±çš„å®¹å™¨ç¯å¢ƒä¸­è¿è¡Œï¼ˆå¦‚JavaScriptæ’ä»¶çš„Web Worker æˆ–iframeã€Pythonæ’ä»¶çš„è¿›ç¨‹processï¼‰ã€‚è¿™æ ·å¯ä»¥é¿å…å…¶ä»–æ’ä»¶çš„å¹²æ‰°å¹¶ä½¿ImJoyåº”ç”¨ç¨‹åºæ›´åŠ å®‰å…¨ã€‚<br>æ’ä»¶ä¸ImJoyä¸»ç¨‹åºæˆ–æ’ä»¶ä¸æ’ä»¶ä¹‹é—´çš„äº¤äº’æ˜¯é€šè¿‡ä¸€ç»„APIå‡½æ•°ï¼ˆ<code>ImJoy API</code>ï¼‰è¿›è¡Œçš„ã€‚æ‰€æœ‰æ’ä»¶éƒ½å¯ä»¥è®¿é—®åˆ°ä¸€ä¸ªåä¸º<code>api</code>çš„ç‰¹æ®Šå¯¹è±¡ã€‚åœ¨Javascriptä¸­ï¼Œ<code>api</code> æ˜¯ä¸€ä¸ªå¯ä»¥ç›´æ¥ä½¿ç”¨çš„å…¨å±€å¯¹è±¡ã€‚åœ¨Pythonä¸­ï¼Œå¯ä»¥é€šè¿‡è°ƒç”¨ <code>from imjoy import api</code> æ¥å¯¼å…¥å®ƒã€‚æœ‰äº†è¿™ä¸ªå¯¹è±¡ï¼Œæ’ä»¶å¯ä»¥åšå¾ˆå¤šäº‹æƒ…ï¼Œæ¯”å¦‚æ˜¾ç¤ºä¸€ä¸ªå¯¹è¯æ¡†ã€å°†ç»“æœå‘é€åˆ°ä¸»åº”ç”¨ç¨‹åºï¼Œæˆ–è°ƒç”¨å¦ä¸€ä¸ªæ’ä»¶çš„å‚æ•°å’Œæ•°æ®ç­‰ã€‚</p><h1 id="å¼‚æ­¥ç¼–ç¨‹"><a href="#å¼‚æ­¥ç¼–ç¨‹" class="headerlink" title="å¼‚æ­¥ç¼–ç¨‹"></a>å¼‚æ­¥ç¼–ç¨‹</h1><p>ä¸ºäº†ä½¿äº¤äº’æ›´åŠ é«˜æ•ˆå’Œå¹¶å‘ï¼Œå¯¹äºè¿™äº›APIå‡½æ•°ï¼ŒImJoyä½¿ç”¨ä¸€ç§ç§°ä¸º<a href="http://cs.brown.edu/courses/cs168/s12/handouts/async.pdf">å¼‚æ­¥ç¼–ç¨‹</a>çš„ç¼–ç¨‹æ¨¡å¼ã€‚<br>æ‰€æœ‰ImJoy APIå‡½æ•°éƒ½æ˜¯å¼‚æ­¥çš„ã€‚è¿™æ„å‘³ç€å½“ä¸€ä¸ª<code>ImJoy API</code>å‡½æ•°è¢«è°ƒç”¨æ—¶ï¼ŒImJoyä¸ä¼šé˜»æ­¢åŸç¨‹åºçš„æ‰§è¡Œï¼Œè€Œæ˜¯ä¼šç«‹å³è¿”å›ä¸€ä¸ªåä¸º <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/ Promise">Promise(JS)</a> æˆ– <a href="https://docs.python.org/3/library/asyncio-future.html">Future (Python)</a>çš„å¯¹è±¡ã€‚å¼€å‘è€…å¯ä»¥å†³å®šç­‰å¾…å®é™…ç»“æœè¿”å›æˆ–è®¾ç½®ä¸€ä¸ªå›è°ƒå‡½æ•°ä»¥åœ¨è¿›ç¨‹ç»ˆæ­¢åå†å–å›ç»“æœã€‚ä¾‹å¦‚ï¼Œå¦‚æœå¼¹å‡ºä¸€ä¸ªå¯¹è¯æ¡†è¦æ±‚ç”¨æˆ·è¾“å…¥ï¼Œåœ¨è®¸å¤šç¼–ç¨‹è¯­è¨€ï¼ˆåŒæ­¥ç¼–ç¨‹ï¼‰ä¸­ï¼Œä»£ç æ‰§è¡Œå°†è¢«é˜»å¡ï¼Œç›´åˆ°ç”¨æˆ·å…³é—­å¯¹è¯æ¡†ã€‚ä½†æ˜¯ï¼Œå¯¹äºä¸€ä¸ªå¼‚æ­¥ç¨‹åºï¼Œå°½ç®¡ç”¨æˆ·æ²¡æœ‰å…³é—­å¯¹è¯æ¡†ï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ª<code>promise</code>å¯¹è±¡ï¼Œç„¶åç»§ç»­æ‰§è¡Œã€‚<br>ç”±äºæ¯ä¸ªAPIè°ƒç”¨éƒ½æ˜¯å¼‚æ­¥å’Œéé˜»å¡çš„ï¼Œä¸€ä¸ªç»™å®šçš„æ’ä»¶å¯ä»¥è°ƒç”¨å¤šä¸ªå…¶ä»–æ’ä»¶æ¥åŒæ—¶æ‰§è¡Œä»»åŠ¡ï¼Œè€Œæ— éœ€ä½¿ç”¨å¤šçº¿ç¨‹æˆ–å¤šè¿›ç¨‹ç­‰æŠ€æœ¯ã€‚<br>å¯¹äºPythonå’ŒJavaScriptæ’ä»¶ï¼ŒImJoy éƒ½æ”¯æŒä¸¤ç§å¼‚æ­¥ç¼–ç¨‹é£æ ¼æ¥è®¿é—®è¿™äº›å¼‚æ­¥å‡½æ•°ï¼š<code>async/await</code> å’Œ <code>callback</code> é£æ ¼ã€‚å‡ ä¸ªé‡è¦çš„æ³¨æ„ç‚¹æ˜¯ï¼š</p><ul><li>å¯¹äºJavaScriptå’ŒPython 3ï¼Œæ¨è<code>async/await</code></li><li><code>callback</code> æ ·å¼å¯ç”¨äº JavaScriptã€Python 2 å’Œ Python 3ã€‚</li><li>æ³¨æ„ï¼Œä¸èƒ½åŒæ—¶ä½¿ç”¨è¿™ä¸¤ç§é£æ ¼ã€‚</li><li>å¯¹äº<code>async/await</code> é£æ ¼ï¼Œå¯ä»¥ä½¿ç”¨ <code>try catch</code> (JavaScript) æˆ– <code>try except</code> (Python) è¯­æ³•æ¥æ•è·é”™è¯¯ï¼Œä½†å¯¹äº <code>callback</code> é£æ ¼ï¼Œåˆ™ä¸èƒ½ä½¿ç”¨å®ƒä»¬æ¥æ•è·é”™è¯¯ã€‚</li></ul><p>åœ¨ä¸‹é¢çš„APIå‡½æ•°åˆ—è¡¨ä¸­ï¼Œæä¾›äº† <code>async</code> é£æ ¼çš„ç¤ºä¾‹ã€‚å¯¹äº Python 2ï¼Œä¹Ÿå¯ä»¥è½»æ¾åœ°è½¬æ¢ä¸ºç›¸åº”çš„<code>callback</code>é£æ ¼ã€‚</p><h2 id="async-awaité£æ ¼"><a href="#async-awaité£æ ¼" class="headerlink" title="async/awaité£æ ¼"></a>async/awaité£æ ¼</h2><p>Javascript å’Œ Python 3+ æ’ä»¶åŸç”Ÿæ”¯æŒå¹¶æ¨èä½¿ç”¨è¿™ç§é£æ ¼ã€‚<br>ä½¿ç”¨ <code>async</code> å…³é”®å­—å£°æ˜å‡½æ•°ã€‚åœ¨å¼‚æ­¥ä¹‹å‰æ·»åŠ <code>await</code>å‡½æ•°ç­‰å¾…ç»“æœè¿”å›ã€‚è¿™åŸºæœ¬ä¸Šå°±æ˜¯æ— éœ€è®¾ç½®å›è°ƒå‡½æ•°å³å¯è¿›è¡ŒåŒæ­¥ç¼–ç¨‹ã€‚<br>ä¸‹é¢æ˜¯ä¸€ä¸ªåä¸º<code>XXXXX</code>çš„apiå‡½æ•°çš„ç®€å•ç¤ºä¾‹ã€‚æ³¨æ„ï¼Œåœ¨å‡½æ•°ä¸­ä½¿ç”¨awaitæ—¶ï¼Œè¦åœ¨å‡½æ•°å®šä¹‰å‰æ·»åŠ asyncã€‚å¯¹äº Python3ï¼Œä¸è¦å¿˜è®°<code>import asyncio</code>ã€‚<br>JavaScriptè¯­è¨€çš„å®ç°ä¸ºï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"> <span class="class"><span class="keyword">class</span> <span class="title">ImJoyPlugin</span>()</span>&#123;</span><br><span class="line">  <span class="keyword">async</span> <span class="function"><span class="title">setup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">async</span> <span class="function"><span class="title">run</span>(<span class="params">ctx</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">      result = <span class="keyword">await</span> api.XXXXX()</span><br><span class="line">      <span class="built_in">console</span>.log(result)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span>(e)&#123;</span><br><span class="line">      <span class="built_in">console</span>.error(e)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>Pythonè¯­è¨€çš„å®ç°ä¸ºï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">from</span> imjoy <span class="keyword">import</span> api</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ImJoyPlugin</span>():</span></span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">setup</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">run</span>(<span class="params">self, ctx</span>):</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            result = <span class="keyword">await</span> api.XXXXX()</span><br><span class="line">            <span class="built_in">print</span>(result)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(e)</span><br></pre></td></tr></table></figure></p><h2 id="Callbacké£æ ¼"><a href="#Callbacké£æ ¼" class="headerlink" title="Callbacké£æ ¼"></a>Callbacké£æ ¼</h2><p>å¯¹äº Python 2 æˆ– Web Pythonï¼Œä¸æ”¯æŒ <code>asyncio</code>ï¼Œå› æ­¤æ­¤æ—¶éœ€è¦ä½¿ç”¨<code>callback</code>é£æ ¼ã€‚<br>è°ƒç”¨å¼‚æ­¥å‡½æ•°å¹¶ä½¿ç”¨ <code>.then(callback_func)</code> è®¾ç½®å…¶å›è°ƒã€‚å¯¹äº JavaScript æ’ä»¶ï¼Œå°†è¿”å›åŸç”Ÿ JavaScript <code>Promise</code>ï¼ˆ<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">æ›´å¤šå…³äº Promise</a>ã€‚å¯¹äº Python æ’ä»¶ï¼Œå®ƒå°†è¿”å›<code>Promise</code>çš„ä¸€ä¸ªç®€åŒ–çš„Pythonå®ç°ã€‚<br>ä¸‹é¢æ˜¯åä¸ºâ€œXXXXXâ€çš„ api å‡½æ•°ç¤ºä¾‹ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ImJoyPlugin</span>()</span>&#123;</span><br><span class="line">  <span class="function"><span class="title">setup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">run</span>(<span class="params">ctx</span>)</span>&#123;</span><br><span class="line">      api.XXXXX().then(<span class="built_in">this</span>.callback)</span><br><span class="line"></span><br><span class="line">      <span class="comment">// optionally, you can catch error</span></span><br><span class="line">      <span class="keyword">const</span> <span class="function"><span class="title">error_callback</span>(<span class="params">error</span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.error(error)</span><br><span class="line">      &#125;</span><br><span class="line">      api.XXXXX().then(<span class="built_in">this</span>.callback).catch(error_callback)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">callback</span>(<span class="params">result</span>)</span>&#123;</span><br><span class="line">     <span class="built_in">console</span>.log(result)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>æˆ–<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> imjoy <span class="keyword">import</span> api</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ImJoyPlugin</span>():</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setup</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span>(<span class="params">self, ctx</span>):</span></span><br><span class="line">        api.XXXXX().then(self.callback)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># this function will be called when we get results from api.XXXXX()</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">result_callback</span>(<span class="params">result</span>):</span></span><br><span class="line">            <span class="built_in">print</span>(result)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># optionally, you can catch an error for the call</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">error_callback</span>(<span class="params">error</span>):</span></span><br><span class="line">            <span class="built_in">print</span>(error)</span><br><span class="line"></span><br><span class="line">        api.XXXXX().then(result_callback).catch(error_callback)</span><br></pre></td></tr></table></figure></p><h1 id="è¾“å…¥å‚æ•°"><a href="#è¾“å…¥å‚æ•°" class="headerlink" title="è¾“å…¥å‚æ•°"></a>è¾“å…¥å‚æ•°</h1><p>è°ƒç”¨APIå‡½æ•°æ—¶ï¼Œå¤§å¤šæ•°å‡½æ•°æ¥æ”¶ä¸€ä¸ªå¯¹è±¡objectï¼ˆå¯¹äºJavaScriptï¼‰æˆ–å­—å…¸dictionaryï¼ˆå¯¹äºPythonï¼‰ä½œä¸ºå®ƒçš„ç¬¬ä¸€ä¸ªå‚æ•°ã€‚<br>ä»¥ä¸‹å‡½æ•°è°ƒç”¨å¯¹JavaScriptå’ŒPythonéƒ½é€‚ç”¨ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// JavaScript or Python</span></span><br><span class="line"><span class="keyword">await</span> api.XXXXX(&#123;<span class="string">&quot;option1&quot;</span>: <span class="number">3</span>, <span class="string">&quot;option2&quot;</span>: <span class="string">&#x27;hi&#x27;</span>&#125;)</span><br></pre></td></tr></table></figure><br>ä»¥ä¸‹è°ƒç”¨åˆ™ä»…é€‚ç”¨äº Pythonï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Python</span></span><br><span class="line"><span class="keyword">await</span> api.XXXXX(option1=<span class="number">3</span>, option2=<span class="string">&#x27;hi&#x27;</span>)</span><br></pre></td></tr></table></figure></p><h1 id="å‡€åŒ–çš„HTMLå’ŒCSS"><a href="#å‡€åŒ–çš„HTMLå’ŒCSS" class="headerlink" title="å‡€åŒ–çš„HTMLå’ŒCSS"></a>å‡€åŒ–çš„HTMLå’ŒCSS</h1><p>å‡ºäºå®‰å…¨åŸå› ï¼ŒImJoyä½¿ç”¨<a href="https://github.com/cure53/DOMPurify">DOMPurify</a> æ¥å‡€åŒ–ImJoyä¸»ç•Œé¢ä¸­ä½¿ç”¨çš„HTMLå’ŒCSSï¼Œä¸»è¦æ˜¯ä¸ºäº†é˜²æ­¢è·¨ç«™è„šæœ¬æ”»å‡»XSSï¼ŒåŒ…æ‹¬æ‰€æœ‰çš„markdownã€<code>&lt;config&gt;</code>å—å’Œ<code>api.register</code>ä¸­çš„<code>ui</code>å­—ç¬¦ä¸²ï¼Œä»¥åŠ<code>api.alert</code>ã€<code>api.confirm</code>å’Œ<code>api.prompt</code>ä¸­æ˜¾ç¤ºçš„å†…å®¹ã€‚ å¦è¯·æ³¨æ„ï¼Œ<code>window</code>æ’ä»¶ä¸­æ˜¾ç¤ºçš„å†…å®¹æ²¡æœ‰è¿™äº›é™åˆ¶ã€‚</p><h1 id="APIå‡½æ•°"><a href="#APIå‡½æ•°" class="headerlink" title="APIå‡½æ•°"></a>APIå‡½æ•°</h1><p>å¯¹äºæ¯ä¸ªAPIå‡½æ•°ï¼Œä¸‹é¢æä¾›äº†ä¸€ä¸ªç®€çŸ­çš„ä»£ç ç‰‡æ®µæ¥è¯´æ˜å¦‚ä½•ä½¿ç”¨å®ƒçš„åŠŸèƒ½ã€‚è¿™äº›ä¾‹å­æ˜¯JavaScriptè¯­è¨€ç¼–å†™çš„ï¼Œä½†åœ¨Pythonä¸­å¯ä»¥ä»¥ç±»ä¼¼çš„æ–¹å¼è°ƒç”¨ã€‚</p><h2 id="api-alert"><a href="#api-alert" class="headerlink" title="api.alert"></a>api.alert</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> api.alert(message)</span><br></pre></td></tr></table></figure><p>å‚æ•°ï¼š<br>å¯¹äºçº¯æ–‡æœ¬ï¼š</p><ul><li><code>message</code>ï¼šStringç±»å‹ã€‚å…¶åŒ…å«è¦æ˜¾ç¤ºçš„æ¶ˆæ¯ã€‚æ¶ˆæ¯ä¸­å¯ä»¥ä½¿ç”¨HTMLæ ‡ç­¾ï¼Œä½†ä»…é™äºä¸€ç»„å—é™çš„æ ‡ç­¾å’Œ cssï¼Œå¦‚ä¸Šé¢[å‡€åŒ–çš„HTMLå’ŒCSS]ä¸€èŠ‚æ‰€è¿°ã€‚</li></ul><p>å¯¹äºHTMLï¼š</p><ul><li><code>message</code>ï¼šObjectç±»å‹ã€‚å®ƒåŒ…å«ä»¥ä¸‹å­—æ®µï¼š<ul><li>contentï¼šåŒ…å«è¦æ˜¾ç¤ºçš„é—®é¢˜ã€‚æ¶ˆæ¯ä¸­å¯ä»¥ä½¿ç”¨HTMLæ ‡ç­¾ï¼Œä½†ä»…é™äºä¸€ç»„å—é™çš„æ ‡ç­¾å’Œ cssï¼Œå¦‚ä¸Šé¢[å‡€åŒ–çš„HTMLå’ŒCSS]ä¸€èŠ‚æ‰€è¿°ã€‚</li><li>titleï¼šå¯¹è¯æ¡†çš„æ ‡é¢˜</li></ul></li></ul><p>ä¸¾ä¾‹ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> api.alert(<span class="string">&#x27;hello world&#x27;</span>)</span><br></pre></td></tr></table></figure></p><h2 id="api-prompt"><a href="#api-prompt" class="headerlink" title="api.prompt"></a>api.prompt</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> answer = <span class="keyword">await</span> api.prompt(question, default_answer)</span><br></pre></td></tr></table></figure><p>æ˜¾ç¤ºè¦æ±‚ç”¨æˆ·è¾“å…¥çš„æç¤ºã€‚<br>å‚æ•°ï¼š<br>å¯¹äºçº¯æ–‡æœ¬ï¼š</p><ul><li>questionï¼šStringã€‚åŒ…å«è¦æ˜¾ç¤ºçš„é—®é¢˜ã€‚æ¶ˆæ¯ä¸­å¯ä»¥ä½¿ç”¨ HTML æ ‡ç­¾ï¼Œä½†ä»…é™äºä¸€ç»„å—é™çš„æ ‡ç­¾å’Œ cssï¼Œå¦‚ä¸Šé¢[å‡€åŒ–çš„HTMLå’ŒCSS]ä¸€èŠ‚æ‰€è¿°ã€‚</li></ul><p>å¯¹äº HTMLï¼š</p><ul><li><p>questionï¼šObjectã€‚å®ƒåŒ…å«ä»¥ä¸‹å­—æ®µï¼š</p><ul><li>contentï¼šåŒ…å«è¦æ˜¾ç¤ºçš„é—®é¢˜ã€‚æ¶ˆæ¯ä¸­å¯ä»¥ä½¿ç”¨ HTML æ ‡ç­¾ï¼Œä½†ä»…é™äºä¸€ç»„å—é™çš„æ ‡ç­¾å’Œ cssï¼Œå¦‚ä¸Šé¢[å‡€åŒ–çš„HTMLå’ŒCSS]ä¸€èŠ‚æ‰€è¿°ã€‚</li><li>placeholderï¼šé—®é¢˜çš„é»˜è®¤ç­”æ¡ˆ</li><li>titleï¼šå¯¹è¯æ¡†çš„æ ‡é¢˜</li></ul></li><li><p>default_answerï¼ˆå¯é€‰ï¼‰ï¼šStringã€‚åŒ…å«é—®é¢˜çš„é»˜è®¤ç­”æ¡ˆã€‚</p></li></ul><p>è¿”å›å€¼ï¼š</p><ul><li>answerï¼šå¸ƒå°”å€¼Booleanã€‚æ¥è‡ªç”¨æˆ·çš„å›ç­”ã€‚</li></ul><p>ä¾‹å­ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> answer = <span class="keyword">await</span> api.prompt(<span class="string">&#x27;What is your name?&#x27;</span>)</span><br></pre></td></tr></table></figure></p><h2 id="api-confirm"><a href="#api-confirm" class="headerlink" title="api.confirm"></a>api.confirm</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> confirmation = <span class="keyword">await</span> api.confirm(question)</span><br></pre></td></tr></table></figure><p>å‘ç”¨æˆ·æ˜¾ç¤ºç¡®è®¤æ¶ˆæ¯ã€‚<br>å‚æ•°ï¼š<br>å¯¹äºçº¯æ–‡æœ¬ï¼š</p><ul><li>questionï¼šStringã€‚åŒ…å«è¦æ˜¾ç¤ºçš„é—®é¢˜ã€‚æ¶ˆæ¯ä¸­å¯ä»¥ä½¿ç”¨ HTML æ ‡ç­¾ï¼Œä½†ä»…é™äºä¸€ç»„å—é™çš„æ ‡ç­¾å’Œ cssï¼Œå¦‚ä¸Šé¢[å‡€åŒ–çš„HTMLå’ŒCSS]ä¸€èŠ‚æ‰€è¿°ã€‚</li></ul><p>å¯¹äº HTMLï¼š</p><ul><li>questionï¼šObjectã€‚å®ƒåŒ…å«ä»¥ä¸‹å­—æ®µï¼š<ul><li>contentï¼šåŒ…å«è¦æ˜¾ç¤ºçš„é—®é¢˜ã€‚æ¶ˆæ¯ä¸­å¯ä»¥ä½¿ç”¨ HTML æ ‡ç­¾ï¼Œä½†ä»…é™äºä¸€ç»„å—é™çš„æ ‡ç­¾å’Œ cssï¼Œå¦‚ä¸Šé¢[å‡€åŒ–çš„HTMLå’ŒCSS]ä¸€èŠ‚æ‰€è¿°ã€‚</li><li>titleï¼šå¯¹è¯æ¡†çš„æ ‡é¢˜</li></ul></li></ul><p>è¿”å›å€¼ï¼š</p><ul><li>confirmationï¼šå¸ƒå°”å€¼ã€‚å¯¹æˆ–é”™ã€‚</li></ul><p>ä¾‹å­ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> confirmation = <span class="keyword">await</span> api.confirm(<span class="string">&#x27;Do you want to delete these files?&#x27;</span>)</span><br><span class="line"><span class="keyword">if</span>(confirmation)&#123;</span><br><span class="line">  delete_file()</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;User cancelled file deletion.&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="api-call"><a href="#api-call" class="headerlink" title="api.call"></a>api.call</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">result = <span class="keyword">await</span> api.call(plugin_name, plugin_op, arg1, arg2 ...)</span><br></pre></td></tr></table></figure><p>ä»å¦ä¸€ä¸ªæ’ä»¶è°ƒç”¨å‡½æ•°ã€‚<br>è¿˜å¯ä»¥ä¼ è¾“æ•°æ®ã€‚å‚æ•°çš„æ•°é‡å¿…é¡»ä¸è¢«è°ƒç”¨å‡½æ•°çš„å‚æ•°æ‰€éœ€çš„æ•°ç›®ç›¸åŒ¹é…ã€‚<br>å¦‚æœæƒ³é¢‘ç¹è°ƒç”¨å…¶ä»–æ’ä»¶çš„åŠŸèƒ½ï¼Œæ¨èä½¿ç”¨<code>api.getPlugin</code>ã€‚</p><p>å‚æ•°ï¼š</p><ul><li>plugin_nameï¼šStringã€‚è¢«è°ƒç”¨æ’ä»¶çš„åç§°ã€‚</li><li>plugin_opï¼šStringã€‚æ’ä»¶çš„å‡½æ•°çš„åç§° (op)ã€‚</li><li>argsï¼ˆå¯é€‰ï¼‰ï¼šå¯ä»¥ä¼ è¾“çš„ä»»ä½•å—æ”¯æŒçš„åŸå§‹æ•°æ®ç±»å‹ã€‚</li></ul><p>è¿”å›å€¼ï¼š</p><ul><li>resultï¼šæ’ä»¶çš„å‡½æ•°è¿”å›çš„ç»“æœï¼ˆå¦‚æœæœ‰ï¼‰ã€‚</li></ul><p>ä¾‹å­ï¼š<br>è°ƒç”¨æ’ä»¶<code>PluginX</code>ä¸­å®šä¹‰çš„å‡½æ•°<code>funcX</code>ï¼Œå¹¶ä¼ å…¥å‚æ•°<code>1</code>ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> api.call(<span class="string">&quot;PluginX&quot;</span>, <span class="string">&quot;funcX&quot;</span>, <span class="number">1</span>)</span><br></pre></td></tr></table></figure></p><h2 id="api-createWindow"><a href="#api-createWindow" class="headerlink" title="api.createWindow"></a>api.createWindow</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">win = <span class="keyword">await</span> api.createWindow(config)</span><br></pre></td></tr></table></figure><p>åœ¨ ImJoy å·¥ä½œåŒºä¸­åˆ›å»ºä¸€ä¸ªæ–°çª—å£ã€‚<br>ä¸€æ—¦åˆ›å»ºäº†ä¸€ä¸ªçª—å£ï¼Œå®ƒå°†è¿”å›ä¸€ä¸ªå¸¦æœ‰ç›¸åº”<code>window</code>æ’ä»¶APIçš„å¯¹è±¡ï¼Œè¯¥å¯¹è±¡å¯ç”¨äºæ›´æ–°çª—å£ï¼Œæ¯”å¦‚å¯ä»¥ä½¿ç”¨ <code>win.run(&#123;&quot;data&quot;: ...&#125;)</code> æ›´æ–°æ•°æ®å­—æ®µã€‚<br>æ³¨æ„1ï¼šè°ƒç”¨å…³é—­çª—å£çš„å‡½æ•°ã€‚å¦‚æœçª—å£å…³é—­å¹¶ä¸”å°è¯•è°ƒç”¨å®ƒçš„å‡½æ•°ï¼Œå°†ä¼šå¾—åˆ°ä¸€ä¸ªé”™è¯¯ï¼Œè§£å†³è¿™ä¸ªé—®é¢˜çš„ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨ <code>try ... catch</code>(JavaScript) æˆ– <code>try: ... except: ...</code>(Python) è¯­å¥æ¥æ•è·é”™è¯¯ã€‚<br>æ³¨æ„2ï¼š<code>api.createWindow</code>å’Œ<code>api.getPlugin</code>ä¹‹é—´çš„åŒºåˆ«ã€‚ä¸¤ä¸ªå‡½æ•°éƒ½å¯ç”¨äºè·å–åŒ…å«<code>window</code>æ’ä»¶apiçš„å¯¹è±¡ã€‚ä½†æ˜¯ï¼Œåªæœ‰é€šè¿‡<code>api.createWindow</code>è·å–çš„å¯¹è±¡æ‰èƒ½ç”¨äºæ›´æ–°ç°æœ‰çª—å£ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œ<code>api.getPlugin</code>è¿”å›çš„å¯¹è±¡æ¯æ¬¡ä½¿ç”¨éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çª—å£ã€‚è¿™ç§è¡Œä¸ºå·®å¼‚å¯ä»¥é€šè¿‡ImJoyå¤„ç†ä¸åŒæ’ä»¶ç±»å‹çš„è¡Œä¸ºæ¥è§£é‡Šã€‚å½“ImJoyåŠ è½½ä¸€ä¸ªä¸æ˜¯<code>window</code>æ’ä»¶çš„æ’ä»¶æ—¶ï¼Œå®ƒä¼šå¯åŠ¨ç‹¬ç«‹çš„pythonè¿›ç¨‹ã€webworkeræˆ– iframeã€‚è¿™ç¡®ä¿äº†åªæœ‰ä¸€ä¸ªæ’ä»¶å®ä¾‹æ­£åœ¨è¿è¡Œã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œ<code>window</code> æ’ä»¶å°†ä»…ç”¨æ¥æ³¨å†Œå¹¶åˆ›å»ºä»£ç†æ’ä»¶ï¼Œæ­¤æ—¶æ²¡æœ‰å®é™…å®ä¾‹å¼€å¯ï¼Œé™¤éç”¨æˆ·ç‚¹å‡»æ’ä»¶èœå•æˆ–æ’ä»¶è¢«å¦ä¸€ä¸ªæ’ä»¶æ‰€è°ƒç”¨ã€‚å·¥ä½œåŒºä¸­çš„æ¯ä¸ªçª—å£éƒ½æ˜¯ <code>window</code> æ’ä»¶çš„ä¸€ä¸ªæ–°å®ä¾‹ã€‚å½“<code>api.getPlugin</code> è¢«è°ƒç”¨æ—¶ï¼Œå®ƒä¼šè¿”å›ä»£ç†æ’ä»¶çš„apiï¼Œä¾‹å¦‚<code>proxy = await api.getPlugin(&#123;&#39;name&#39;: &#39;Image Window&#39;&#125;)</code>)ã€‚æ¯æ¬¡<code>run</code>å‡½æ•°æ‰§è¡Œåï¼Œå°†åˆ›å»ºä¸€ä¸ªæ–°çª—å£ã€‚ä¾‹å¦‚ï¼Œå¦‚æœè¿è¡Œ<code>proxy.run(&#123;data: ...&#125;)</code>10æ¬¡ï¼Œå°†åˆ›å»º10ä¸ªçª—å£ã€‚è¦å–å¾—ä½¿ç”¨<code>api.createWindow</code>ï¼ˆæˆ–<code>api.showDialog</code>ï¼‰åˆ›å»ºçš„çª—å£ï¼Œå¯ä»¥ä½¿ç”¨<code>api.getWindow</code>ã€‚å½“ä½¿ç”¨<code>api.createWindow</code>æ—¶ï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ª<code>window</code>æ’ä»¶çš„å®ä¾‹ï¼Œä¾‹å¦‚<code>win=await api.createWindow(&#123;&#39;name&#39;: &#39;new window&#39;, &#39;type&#39;: &#39;Image Window&#39;, &#39;data&#39;: &#123;...&#125;&#125;)</code>)ã€‚å¦‚æœè¿è¡Œ <code>win.run(&#123;&#39;data&#39;: ...&#125;)</code> 10 æ¬¡ï¼ŒåŒä¸€ä¸ªçª—å£å®ä¾‹å°†è¢«æ›´æ–°10æ¬¡ã€‚è¿è¡Œ <code>win.close()</code> å°†å…³é—­çª—å£ã€‚</p><p>å‚æ•°ï¼š</p><ul><li><p>configï¼šStringæˆ–Objectã€‚åˆ›å»ºçª—å£çš„é€‰é¡¹ã€‚å½“å®ƒæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²æ—¶ï¼Œå®ƒä¼šè¢«è½¬æ¢æˆä¸€ä¸ªå¯¹è±¡ã€‚è½¬æ¢æŒ‰ç…§ä»¥ä¸‹è§„åˆ™è¿›è¡Œï¼š 1) å¦‚æœå­—ç¬¦ä¸²åŒ…å«å¤šè¡Œï¼Œæ¯”å¦‚URLæˆ–æ’ä»¶URIï¼Œåˆ™å°†å…¶è§†ä¸ºçª—å£æ’ä»¶æºï¼ˆå‚è§ä¸‹é¢çš„ <code>src</code> é”®ï¼‰ï¼› 2) å¦åˆ™å°†è¢«è§†ä¸º<code>window</code>æ’ä»¶ç±»å‹ï¼ˆå‚è§ä¸‹é¢çš„â€œtypeâ€é”®ï¼‰ã€‚<br>å®ƒåŒ…å«ä»¥ä¸‹å­—æ®µï¼š</p><ul><li><code>name</code>ï¼šStringã€‚æŒ‡å®šæ–°çª—å£çš„åç§°ã€‚</li><li><p><code>type</code>ï¼šStringã€‚æŒ‡å®šçª—å£ç±»å‹ã€‚è¿™å¯ä»¥æ˜¯<code>window</code>æ’ä»¶åç§°ã€ImJoyå†…éƒ¨çª—å£ç±»å‹æˆ–<code>external</code>ã€‚ä»¥ä¸‹å†…éƒ¨çª—å£ç±»å‹æ˜¯æ”¯æŒçš„ï¼š</p><ul><li><code>imjoy/generic</code>ã€‚å°†æ˜¾ç¤º <code>data</code> ä¸­çš„æ‰€æœ‰å¯¹è±¡ã€‚</li><li><code>imjoy/image</code>ã€‚æ˜¾ç¤ºå›¾åƒã€‚éœ€è¦<code>data.src</code> æŒ‡å‘å›¾åƒä½ç½®ã€‚</li><li><code>imjoy/image-compare</code>ã€‚æ˜¾ç¤ºè¿›è¡Œæ¯”è¾ƒçš„ä¸¤ä¸ªå›¾åƒã€‚å›¾åƒä½œä¸º <code>data.first</code> å’Œ <code>data.second</code> ä¼ é€’ã€‚è¯·å‚é˜…ä¸‹é¢çš„ç¤ºä¾‹ã€‚</li><li><code>imjoy/panel</code>ã€‚æ¸²æŸ“<code>&lt;config&gt;</code> å—ä¸­çš„<code>ui</code>å­—æ®µã€‚ </li><li><code>imjoy/markdown</code>ã€‚æ¸²æŸ“<code>data.source</code>ä¸­æä¾›çš„Markdownæ–‡æœ¬ã€‚</li><li><code>imjoy/plugin-editor</code>ã€‚æ‰“å¼€æºä»£ç ç¼–è¾‘å™¨ã€‚ <code>data.id</code>æ˜¯ä¸€ä¸ªå”¯ä¸€çš„å­—ç¬¦ä¸²ï¼ˆæœ€å¥½æ˜¯éšæœºçš„ï¼‰ï¼Œç”¨æ¥æŒ‡å®šçª—å£çš„idï¼Œ<code>data.code</code> åŒ…å«æºä»£ç ã€‚</li></ul><p>å¦‚æœä»å¤–éƒ¨urlåˆ›å»ºçª—å£ï¼Œä¾‹å¦‚æ‰˜ç®¡åœ¨Githubé¡µé¢ä¸Šçš„Webåº”ç”¨ç¨‹åºã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œéœ€è¦ä½¿ç”¨ <code>src</code> é”®æŒ‡å®šurlã€‚æœ‰å…³å¦‚ä½•ä»å¤–éƒ¨Webåº”ç”¨ç¨‹åºæ”¯æŒImJoyçš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§ <a href="https://github.com/imjoy-team/imjoy-core/">æ­¤å¤„</a>ã€‚<br>å¦‚æœå¤–éƒ¨ç½‘é¡µåŠ è½½äº†ImJoy æ’ä»¶apiï¼Œå°±å¯ä»¥åƒæ™®é€šçš„ ImJoy æ’ä»¶ä¸€æ ·ä¸å¤–éƒ¨ç½‘ç«™è¿›è¡Œäº¤äº’ã€‚ä½†æ˜¯ï¼Œå¦‚æœå¤–éƒ¨ç½‘é¡µä¸æ”¯æŒImJoyï¼Œåˆ™éœ€è¦è®¾ç½®<code>passive=true</code>æ¥å‘Šè¯‰ImJoyè¯¥çª—å£å°†æ²¡æœ‰æ’ä»¶apiã€‚</p></li><li><code>src</code>ï¼šStringï¼ŒæŒ‡å®šçª—å£æ’ä»¶çš„æºä»£ç ã€çª—å£æ’ä»¶æºä»£ç çš„ url æˆ–æ”¯æŒ <code>imjoy-rpc</code> çš„ç½‘ç»œåº”ç”¨ç¨‹åºçš„ urlã€‚å¦‚æœ url ä»¥ <code>.imjoy.html</code> ç»“å°¾ã€ æˆ–æ˜¯<code>gist</code> url æˆ–æ˜¯githubæºä»£ç é¡µé¢ urlï¼Œåˆ™è¯¥ url å°†è¢«è§†ä¸ºæºä»£ç ã€‚åˆ›å»ºçª—å£æ—¶å¯ä»¥ä¼ é€’æºä»£ç è¿™å°±ä½¿å¾—å¦‚ä¸‹åœºæ™¯æˆä¸ºå¯èƒ½ï¼Œä¾‹å¦‚å°†çª—å£æ’ä»¶çš„æºä»£ç å­˜å‚¨åœ¨ Python æ’ä»¶ä¸­ï¼Œå¹¶åœ¨éœ€è¦æ—¶å®ä¾‹åŒ–å®ƒã€‚<ul><li>tagï¼šStringã€‚å¦‚æœæ’ä»¶æ”¯æŒå¤šä¸ª<code>tags</code>ï¼Œåˆ™ä¸<code>src</code> ä¸€èµ·ä½¿ç”¨æ¥æŒ‡å®šæ’ä»¶çš„æ ‡ç­¾ã€‚</li><li>namespaceï¼šStringã€‚ä¸ <code>src</code> ä¸€èµ·ä½¿ç”¨æ¥æŒ‡å®šæ’ä»¶çš„å‘½åç©ºé—´ã€‚</li><li>passive: Booleanï¼Œä»…åœ¨æŒ‡å®šäº† <code>src</code> æ—¶ä½¿ç”¨ã€‚æ ‡è®°æ’ä»¶æ˜¯å¦ä¸ºè¢«åŠ¨ç½‘é¡µï¼ˆæ²¡æœ‰æš´éœ²ImJoy apiï¼‰ã€‚é»˜è®¤å€¼ä¸º <code>false</code>ã€‚</li><li>wï¼šIntegerã€‚ç½‘æ ¼çš„çª—å£åˆ—å®½ï¼ˆ1 åˆ— = 30 åƒç´ ï¼‰ã€‚</li><li>hï¼šIntegerã€‚ç½‘æ ¼çš„çª—å£è¡Œé«˜ï¼ˆ1 è¡Œ = 30 åƒç´ ï¼‰ã€‚</li><li>configï¼šObjectå¯¹è±¡ï¼ˆJavaScriptï¼‰æˆ–å­—å…¸ï¼ˆPythonï¼‰ã€‚</li><li>dataï¼šObjectå¯¹è±¡ (JavaScript) æˆ–å­—å…¸ (Python)ã€‚åŒ…å«è¦ä¼ è¾“åˆ°çª—å£çš„æ•°æ®ã€‚</li></ul></li></ul></li></ul><p>è¿”å›å€¼ï¼š</p><ul><li>winï¼šObjectå¯¹è±¡ã€‚åˆ›å»ºçš„çª—å£çš„APIå¯¹è±¡ã€‚å¯ä»¥å­˜å‚¨åœ¨æ’ä»¶ç±»ä¸­ï¼ˆPythonçš„<code>self</code>ï¼Œæˆ–JavaScriptçš„<code>this</code>ï¼‰ä¾›ä»¥åä½¿ç”¨ï¼Œä¾‹å¦‚æ›´æ–°çª—å£ã€‚æ³¨æ„ï¼šå¦‚æœ<code>type=&quot;external&quot;</code>å’Œ<code>passive=true</code>ï¼Œåˆ™çª—å£ä¸ä¼šæš´éœ²apiï¼Œæ­¤æ—¶<code>win</code>ä¸ºç©ºã€‚</li></ul><p>ä¾‹å­ï¼š<br>ç”¨ JavaScript åˆ›å»ºä¸€ä¸ªç®€å•çš„çª—å£ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">win = <span class="keyword">await</span> api.createWindow(&#123;<span class="attr">name</span>: <span class="string">&#x27;new window&#x27;</span>, <span class="attr">type</span>: <span class="string">&#x27;Image Window&#x27;</span>, <span class="attr">w</span>:<span class="number">7</span>, <span class="attr">h</span>:<span class="number">7</span>, <span class="attr">data</span>: &#123;<span class="attr">image</span>: ...&#125;, <span class="attr">config</span>: &#123;&#125;&#125;)</span><br></pre></td></tr></table></figure></p><p>ç”¨pythonå®ç°çš„è¯ï¼ŒPython 3å¯ä»¥ä½¿ç”¨ <code>async/await</code> é£æ ¼ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">win = <span class="keyword">await</span> api.createWindow(name=<span class="string">&#x27;new window&#x27;</span>, <span class="built_in">type</span>=<span class="string">&#x27;Image Window&#x27;</span>, w=<span class="number">7</span>, h=<span class="number">7</span>, data=&#123;image: ...&#125;, config=&#123;&#125;)</span><br></pre></td></tr></table></figure><br>Python 2å¯ä»¥ä½¿ç”¨<code>callback</code> é£æ ¼ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">window_callback</span>(<span class="params">win</span>):</span></span><br><span class="line">    self.win = win</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;window created&#x27;</span>)</span><br><span class="line"></span><br><span class="line">api.createWindow(&#123;name: <span class="string">&#x27;new window&#x27;</span>, <span class="built_in">type</span>: <span class="string">&#x27;Image Window&#x27;</span>, w:<span class="number">7</span>, h:<span class="number">7</span>, data: &#123;image: ...&#125;, config: &#123;&#125;&#125;).then(window_callback)</span><br></pre></td></tr></table></figure><br>ç„¶åä½¿ç”¨è¿”å›çš„å¯¹è±¡æ›´æ–°çª—å£ï¼Œæˆ–è€…ä½¿ç”¨<code>win.on(&#39;close&#39;, callback)</code>æ¥è®¾ç½®å…³é—­çª—å£æ—¶çš„å›è°ƒå‡½æ•°ã€‚ç±»ä¼¼åœ°ï¼Œ<code>win.on(&#39;resize&#39;, callback)</code> å¯ç”¨äºè®¾ç½®çª—å£å¤§å°æ”¹å˜æ—¶çš„å›è°ƒå‡½æ•°ã€‚<br>è¦å…³é—­åˆ›å»ºçš„çª—å£ï¼Œåˆ™è°ƒç”¨ <code>win.close()</code>ã€‚<br>è¦æ»šåŠ¨ImJoyå·¥ä½œåŒºä¸­çš„çª—å£ï¼Œè°ƒç”¨â€œwin.focus()â€ã€‚<br>åœ¨<code>window</code>æ’ä»¶ä¸­ï¼Œå¯ä»¥ä½¿ç”¨<code>this.close</code>ã€<code>this.on</code>ã€<code>this.emit</code>ã€<code>this.focus</code>ã€<code>this.resize</code>ã€‚<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// win is the object returned from api.createWindow</span></span><br><span class="line"><span class="keyword">await</span> win.run(&#123;<span class="string">&#x27;data&#x27;</span>: &#123;<span class="string">&#x27;image&#x27;</span>: ...&#125;&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// set `on-close` callback</span></span><br><span class="line">win.on(<span class="string">&#x27;close&#x27;</span>, <span class="function">()=&gt;</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;closing window.&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><br>åˆ›å»ºä¸€ä¸ªåŒ…å«ä¸¤ä¸ªå›¾åƒå’Œä¸€ä¸ªæ¯”è¾ƒæ»‘å—çš„çª—å£ã€‚<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">api.createWindow(&#123;</span><br><span class="line">  name: <span class="string">&#x27;test compare&#x27;</span>,</span><br><span class="line">  <span class="built_in">type</span>: <span class="string">&#x27;imjoy/image-compare&#x27;</span>,</span><br><span class="line">  data: &#123;</span><br><span class="line">    first: <span class="string">&#x27;//placehold.it/350x150/0288D1/FFFFFF&#x27;</span>,</span><br><span class="line">    second: <span class="string">&#x27;//placehold.it/350x150/E8117F/FFFFFF&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><br>è°ƒç”¨<code>win</code>å¯¹è±¡ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># win æ˜¯ api.createWindow è¿”å›çš„å¯¹è±¡</span></span><br><span class="line"><span class="comment"># ä½œä¸ºå­—å…¸ä¼ é€’</span></span><br><span class="line"><span class="keyword">await</span> win.run(&#123;<span class="string">&#x27;data&#x27;</span>: &#123;<span class="string">&#x27;image&#x27;</span>: ...&#125;&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æˆ–å‘½åå‚æ•°</span></span><br><span class="line"><span class="keyword">await</span> win.run(data=&#123;<span class="string">&#x27;image&#x27;</span>: ...&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®`on-close`å›è°ƒ</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">close_callback</span>():</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;closing window.&#x27;</span>)</span><br><span class="line"></span><br><span class="line">win.on(<span class="string">&#x27;close&#x27;</span>, close_callback)</span><br></pre></td></tr></table></figure></p><h2 id="api-error"><a href="#api-error" class="headerlink" title="api.error"></a>api.error</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">api.error(message)</span><br></pre></td></tr></table></figure><p>è®°å½•å½“å‰æ’ä»¶çš„é”™è¯¯æ¶ˆæ¯ï¼Œè¯¥æ¶ˆæ¯å­˜å‚¨åœ¨å…¶æ—¥å¿—å†å²è®°å½•ä¸­ã€‚<br>æ’ä»¶åç§°æ—è¾¹çš„çº¢è‰²å›¾æ ‡è¡¨æ˜æœ‰é”™è¯¯å­˜åœ¨ã€‚ç‚¹å‡»æ­¤å›¾æ ‡å°†æ‰“å¼€ä¸€ä¸ªæ˜¾ç¤ºæ—¥å¿—å†å²è®°å½•çš„çª—å£ã€‚<br>ä¸ <code>console.error</code> æˆ– <code>print</code> ç±»ä¼¼ï¼Œ<code>api.error</code> å¯ä»¥æ¥å—å¤šä¸ªå‚æ•°ï¼Œè¿™äº›å‚æ•°å°†é€šè¿‡ç©ºæ ¼è¿æ¥ã€‚<br>å‚æ•°ï¼š</p><ul><li>messageï¼šStringã€‚è¦è®°å½•çš„é”™è¯¯æ¶ˆæ¯ã€‚</li></ul><p>ä¾‹å­ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">api.error(<span class="string">&#x27;Error occurred during processing.&#x27;</span>)</span><br></pre></td></tr></table></figure></p><h2 id="api-echo"><a href="#api-echo" class="headerlink" title="api.echo"></a>api.echo</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">api.echo(obj)</span><br></pre></td></tr></table></figure><p>è¿”å›ä¸ä¼ å…¥å¯¹è±¡ç›¸åŒå€¼çš„å‡½æ•°ï¼Œç”¨äºæµ‹è¯•ç›®çš„ã€‚<br>è¿™å¯¹äºæµ‹è¯•ç¼–ç /è§£ç å¯¹è±¡å¾ˆæœ‰ç”¨ã€‚</p><p>å‚æ•°ï¼š</p><ul><li>objï¼šä»»æ„å€¼ã€‚</li></ul><p>ä¾‹å­ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ret = <span class="keyword">await</span> api.echo(<span class="string">&#x27;hi&#x27;</span>)</span><br><span class="line"><span class="built_in">console</span>.log(ret) <span class="comment">// should get &#x27;hi&#x27;</span></span><br></pre></td></tr></table></figure></p><h2 id="api-registerCodec"><a href="#api-registerCodec" class="headerlink" title="api.registerCodec"></a>api.registerCodec</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">api.registerCodec(config)</span><br></pre></td></tr></table></figure><p>æ³¨å†Œç”¨äºå‘é€å’Œæ¥æ”¶è¿œç¨‹å¯¹è±¡çš„è‡ªå®šä¹‰ç¼–è§£ç å™¨ã€‚<br>æ³¨æ„ï¼š<code>web-python</code> æ’ä»¶å°šä¸æ”¯æŒè¯¥apiã€‚<br>å‚æ•°ï¼š</p><ul><li>configï¼šObjectå¯¹è±¡ï¼ˆJavaScriptï¼‰æˆ–å­—å…¸ï¼ˆPythonï¼‰ã€‚ç¼–è§£ç å™¨çš„é€‰é¡¹ã€‚å®ƒåŒ…å«ä»¥ä¸‹å­—æ®µï¼š<ul><li>nameï¼šStringã€‚ç¼–è§£ç å™¨åç§°</li><li>typeï¼šClassã€‚ç”¨äºåŒ¹é…å¯¹è±¡è¿›è¡Œç¼–ç çš„ç±»å¯¹è±¡ã€‚åœ¨Javascriptä¸­ï¼Œ<code>instanceof</code> å°†ç”¨äºåŒ¹é…ç±»å‹ã€‚åœ¨Pythonä¸­å°†ä½¿ç”¨ <code>isinstance()</code>ï¼Œè¿™ä¹Ÿæ„å‘³ç€åœ¨ Python ä¸­ï¼Œ<code>type</code> å¯ä»¥æ˜¯ç±»çš„å…ƒç»„ã€‚</li><li>encoderï¼šFunctionã€‚<code>encoder</code>å‡½æ•°å°†ä¸€ä¸ªå¯¹è±¡ä½œä¸ºè¾“å…¥ï¼Œéœ€è¦è¿”å›è¦è¡¨ç¤ºçš„å¯¹è±¡/å­—å…¸ã€‚æ³¨æ„ï¼Œåªèƒ½åœ¨è¦è¡¨ç¤ºçš„å¯¹è±¡ä¸­ä½¿ç”¨åŸå§‹ç±»å‹åŠ ä¸Šæ•°ç»„/åˆ—è¡¨å’Œå¯¹è±¡/å­—å…¸ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœè¿”å›çš„å¯¹è±¡ä¸åŒ…å«<code>_rtype</code>é”®ï¼Œåˆ™ç¼–è§£ç å™¨<code>name</code>å°†ç”¨ä½œ <code>_rtype</code>ã€‚è¿˜å¯ä»¥æŒ‡å®šä¸åŒçš„<code>_rtype</code>åç§°ï¼Œä»¥å…è®¸ä¸åŒç±»å‹ä¹‹é—´çš„è½¬æ¢ã€‚</li><li>decoderï¼šFunctionã€‚ <code>decoder</code> å‡½æ•°å°†ç¼–ç å¯¹è±¡è½¬æ¢ä¸ºå®é™…å¯¹è±¡ã€‚ä»…å½“å¯¹è±¡çš„<code>_rtype</code>ä¸ç¼–è§£ç å™¨çš„<code>name</code>åŒ¹é…æ—¶æ‰ä¼šè°ƒç”¨å®ƒã€‚</li></ul></li></ul><p>ä¾‹å­ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cat</span></span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">name, color, age, clean</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.name = name</span><br><span class="line">    <span class="built_in">this</span>.color = color</span><br><span class="line">    <span class="built_in">this</span>.age = age</span><br><span class="line">    <span class="built_in">this</span>.clean = clean</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">api.registerCodec(&#123;</span><br><span class="line">    <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;cat&#x27;</span>, </span><br><span class="line">    <span class="string">&#x27;type&#x27;</span>: Cat, </span><br><span class="line">    <span class="string">&#x27;encoder&#x27;</span>: <span class="function">(<span class="params">obj</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="comment">// convert the Cat instance as a dictionary with all the properties</span></span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="attr">name</span>: obj.name, <span class="attr">color</span>: obj.color, <span class="attr">age</span>: obj.age, <span class="attr">clean</span>: obj.clean&#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&#x27;decoder&#x27;</span>: <span class="function">(<span class="params">encoded_obj</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="comment">// recover the Cat instance</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Cat(encoded_obj.name, encoded_obj.color, encoded_obj.age, encoded_obj.clean)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Plugin</span> </span>&#123;</span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">setup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">run</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">const</span> dirtyCat = <span class="keyword">new</span> Cat(<span class="string">&#x27;boboshu&#x27;</span>, <span class="string">&#x27;mixed&#x27;</span>, <span class="number">0.67</span>, <span class="literal">false</span>)</span><br><span class="line">        <span class="comment">// assuming we have a shower plugin</span></span><br><span class="line">        <span class="keyword">const</span> showerPlugin = <span class="keyword">await</span> api.getPlugin(&#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;catShower&#x27;</span>&#125;)</span><br><span class="line">        <span class="comment">// now pass a cat into the shower plugin, and we should get a clean cat, the name should be the same</span></span><br><span class="line">        <span class="comment">// note that the other plugin is running in another sandboxed iframe or in Python</span></span><br><span class="line">        <span class="comment">// because we have the cat codec registered, we can send the Cat object to the other plugin</span></span><br><span class="line">        <span class="comment">// Also notice that the other plugin should also define custom encoding decoding following the same representation</span></span><br><span class="line">        <span class="keyword">const</span> cleanCat = <span class="keyword">await</span> showerPlugin.wash(dirtyCat)</span><br><span class="line">        <span class="keyword">if</span>(cleanCat.clean) api.alert(cleanCat.name + <span class="string">&#x27; is clean.&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">api.export(<span class="keyword">new</span> Plugin())</span><br></pre></td></tr></table></figure></p><h2 id="api-disposeObject"><a href="#api-disposeObject" class="headerlink" title="api.disposeObject"></a>api.disposeObject</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">api.disposeObject(obj)</span><br></pre></td></tr></table></figure><p>ä»å…¶å¯¹è±¡å­˜å‚¨ä¸­åˆ é™¤è¿œç¨‹å¯¹è±¡ï¼Œä»¥ä¾¿åƒåœ¾æ”¶é›†å™¨å¯ä»¥å›æ”¶å®ƒã€‚<br>å½“ä¸å†éœ€è¦è¿œç¨‹å¯¹è±¡æ—¶è°ƒç”¨æ­¤å‡½æ•°å¾ˆé‡è¦ï¼Œå¦åˆ™ï¼Œå®ƒå°†å¯¼è‡´å†…å­˜æ³„æ¼ï¼Œå› ä¸ºå¯¹è±¡å°†ä¿ç•™åœ¨å…¶å¯¹è±¡å­˜å‚¨ä¸­ã€‚<br>å‚æ•°ï¼š</p><ul><li>objï¼šå¯¹è±¡ã€‚è¦åˆ é™¤çš„è¿œç¨‹å¯¹è±¡ã€‚</li></ul><h2 id="api-export"><a href="#api-export" class="headerlink" title="api.export"></a>api.export</h2><p>å°†æ’ä»¶å®šä¹‰çš„å‡½æ•°å¯¼å‡ºä¸º<code>Plugin API</code>ã€‚æ¯ä¸ªimjoyæ’ä»¶éƒ½åº”è¯¥å¯¼å‡ºå…¶æ’ä»¶apiå‡½æ•°ï¼Œé™¤é <code>&lt;config&gt;</code> ä¸‹çš„ <code>passive</code> é”®è®¾ç½®ä¸º <code>true</code>ã€‚<br><code>Plugin API</code> å¯ä»¥å¯¼å‡ºä¸ºæ’ä»¶ç±»æˆ–åŒ…å«æ‰€æœ‰apiåŠŸèƒ½çš„å¯¹è±¡/å­—å…¸ï¼š<br>ï¼ˆ1ï¼‰JavaScriptç±»<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ImJoyPlugin</span>()</span>&#123;</span><br><span class="line">  <span class="keyword">async</span> <span class="function"><span class="title">setup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">async</span> <span class="function"><span class="title">run</span>(<span class="params">ctx</span>)</span>&#123;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">api.export(<span class="keyword">new</span> ImJoyPlugin())</span><br></pre></td></tr></table></figure><br>ï¼ˆ2ï¼‰JavaScriptå‡½æ•°<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">run</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">api.export(&#123;<span class="attr">setup</span>: setup, <span class="attr">run</span>: run&#125;)</span><br></pre></td></tr></table></figure><br>ï¼ˆ3ï¼‰Pythonç±»<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ImJoyPlugin</span>():</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setup</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span>(<span class="params">self, ctx</span>):</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">api.export(ImJoyPlugin())</span><br></pre></td></tr></table></figure></p><p>ï¼ˆ4ï¼‰Pythonå‡½æ•°<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">setup</span>():</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span>(<span class="params">ctx</span>):</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">api.export(&#123;<span class="string">&#x27;setup&#x27;</span>: setup, <span class="string">&#x27;run&#x27;</span>: run&#125;)</span><br></pre></td></tr></table></figure></p><p>è¯¥APIè°ƒç”¨å¯¹äºæ¯ä¸ªImJoyæ’ä»¶éƒ½æ˜¯å¼ºåˆ¶æ€§çš„ï¼ˆé€šå¸¸ä½œä¸ºæ’ä»¶è„šæœ¬çš„æœ€åä¸€è¡Œï¼‰ã€‚<br><code>ImJoyPlugin</code> å®ä¾‹çš„æ¯ä¸ªæˆå‘˜éƒ½å°†å¯¼å‡ºä¸º <code>Plugin API</code>ï¼Œè¿™æ„å‘³ç€è¿™äº›å¯¼å‡ºçš„å‡½æ•°å¯ä»¥è¢«ImJoyä¸»ç¨‹åºæˆ–å…¶ä»–æ’ä»¶è°ƒç”¨ï¼Œå…¶ä»–æ’ä»¶å¯ä½¿ç”¨<code>api.run</code> æˆ–<code>api.call</code> æ¥è°ƒç”¨æ’ä»¶çš„åŠŸèƒ½ã€‚<br>æ³¨æ„ï¼šåªèƒ½å¯¼å‡ºå…·æœ‰åŸå§‹ç±»å‹çš„å‡½æ•°å’Œå˜é‡ï¼ˆæ•°å­—ã€å­—ç¬¦ä¸²ã€å¸ƒå°”å€¼ï¼‰ã€‚å¦‚æœå˜é‡æˆ–å‡½æ•°çš„åç§°ä»¥<code>_</code>å¼€å¤´ï¼Œåˆ™è¡¨ç¤ºå®ƒæ˜¯å†…éƒ¨å˜é‡æˆ–å‡½æ•°ï¼Œä¸ä¼šè¢«å¯¼å‡ºã€‚<br>è¿˜æœ‰éœ€è¦æ³¨æ„ï¼Œåœ¨JavaScriptä¸­ï¼Œ<code>new</code> å…³é”®å­—æ˜¯åˆ›å»ºä¸€ä¸ªç±»çš„å®ä¾‹ï¼Œè€Œåœ¨Pythonä¸­æ²¡æœ‰<code>new</code>å…³é”®å­—ã€‚</p><h2 id="api-init"><a href="#api-init" class="headerlink" title="api.init"></a>api.init</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">api.init(config)</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨æœ€å°çš„æ’ä»¶æ¥å£å’Œé…ç½®è¿›è¡Œåˆå§‹åŒ–ã€‚å½“ä¸æƒ³å¯¼å‡ºä»»ä½•æ’ä»¶apiæ—¶ï¼Œè¿™å¯ä»¥ç”¨ä½œ <code>api.export</code> çš„å¿«æ·æ–¹å¼ã€‚<br>ä»¥Pythonä¸ºä¾‹ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">api.init(config)</span><br></pre></td></tr></table></figure><br>ç­‰ä»·äºï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">def setup():</span><br><span class="line">    pass</span><br><span class="line"></span><br><span class="line">api.export(&#123;&quot;setup&quot;: setup&#125;, config)</span><br></pre></td></tr></table></figure></p><p>å‚æ•°ï¼š</p><ul><li>configï¼šObjectï¼Œå¯é€‰ã€‚æ’ä»¶çš„é…ç½®ï¼ŒåŒ…æ‹¬æ‰€æœ‰é…ç½®å­—æ®µï¼Œæ¯”å¦‚<code>name</code>ã€<code>type</code>ç­‰ï¼ˆå®Œæ•´åˆ—è¡¨å¯ä»¥åœ¨<a href="https://imjoy.io/docs/#/development?id=ltconfiggt-block">è¿™é‡Œ</a>ï¼‰ .</li></ul><h2 id="api-exportFile"><a href="#api-exportFile" class="headerlink" title="api.exportFile"></a>api.exportFile</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">api.exportFile(file, name)</span><br></pre></td></tr></table></figure><p>è§¦å‘ä»æµè§ˆå™¨ä¸‹è½½æ–‡ä»¶ã€‚<br>å‚æ•°ï¼š</p><ul><li>fileï¼šæ–‡ä»¶ã€Blob æˆ–å­—ç¬¦ä¸²ã€‚è¦ä¸‹è½½çš„æ–‡ä»¶å¯¹è±¡ã€‚å¦‚æœä¼ é€’äº†ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå®ƒå°†è¢«åŒ…è£…ä¸ºä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ã€‚<br>è¿”å›å€¼ï¼š</li><li>nameï¼šStringã€‚æ–‡ä»¶åã€‚</li></ul><p>ä¾‹å­ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> blob = <span class="keyword">new</span> Blob([<span class="string">&quot;Hello, world!&quot;</span>], &#123;<span class="attr">type</span>: <span class="string">&quot;text/plain;charset=utf-8&quot;</span>&#125;);</span><br><span class="line">api.exportFile(blob, <span class="string">&#x27;hello.txt&#x27;</span>)</span><br></pre></td></tr></table></figure></p><h2 id="api-getAttachment"><a href="#api-getAttachment" class="headerlink" title="api.getAttachment"></a>api.getAttachment</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">content = <span class="keyword">await</span> api.getAttachment(att_name)</span><br></pre></td></tr></table></figure><p>è·å¾—å­˜å‚¨åœ¨æ’ä»¶æ–‡ä»¶çš„<code>&lt;attachment&gt;</code>å—ä¸­çš„æ•°æ®ã€‚<br>å¯ä»¥åœ¨<code>&lt;attachment&gt;</code>å—ä¸­å­˜å‚¨ä»»ä½•æ–‡æœ¬æ•°æ®ï¼Œä¾‹å¦‚base64ç¼–ç çš„å›¾åƒã€ä»£ç å’Œ jsonã€‚<br>å‚æ•°ï¼š</p><ul><li>att_nameï¼šStringã€‚é™„ä»¶çš„æ ‡è¯†ç¬¦ã€‚<br>è¿”å›å€¼ï¼š</li><li>contentï¼šå­˜å‚¨åœ¨<code>&lt;attachment&gt;</code>å—ä¸­çš„æ–‡æœ¬å†…å®¹ã€‚</li></ul><p>ä¾‹å­ï¼š<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">attachment</span> <span class="attr">name</span>=<span class="string">&quot;att_name&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">attachment</span>&gt;</span></span><br></pre></td></tr></table></figure><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">content = <span class="keyword">await</span> api.getAttachment(att_name)</span><br></pre></td></tr></table></figure></p><h2 id="api-getConfig"><a href="#api-getConfig" class="headerlink" title="api.getConfig"></a>api.getConfig</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">config_value = <span class="keyword">await</span> api.getConfig(config_name)</span><br></pre></td></tr></table></figure><p>è·å¾—æ’ä»¶çš„é…ç½®ã€‚<br>æ³¨1ï¼šä½¿ç”¨ <code>api.setConfig</code> ä¿å­˜æ—¶ï¼Œæ•°å­—ä¼šè½¬æ¢ä¸ºå­—ç¬¦ä¸²ã€‚åœ¨ä½¿ç”¨å®ƒä»¬ä¹‹å‰å¿…é¡»å°†å®ƒä»¬è½¬æ¢å›æ•°å­—ï¼ˆåœ¨JavaScriptä¸­ä½¿ç”¨ <code>parseInt()</code> æˆ– <code>parseFloat()</code>ï¼Œåœ¨Pythonä¸­ä½¿ç”¨ <code>int()</code> æˆ– <code>float()</code>ï¼‰ã€‚<br>æ³¨2ï¼šä¹Ÿå¯ä»¥é€šè¿‡åœ¨å­—æ®µåååŠ ä¸Š<code>_</code>æ¥è®¿é—®<code>&lt;config&gt;</code>å—ä¸­å®šä¹‰çš„å­—æ®µï¼Œä¾‹å¦‚ï¼Œå¦‚æœæƒ³è¯»å–<code>&lt;config&gt;</code> å—ï¼Œå¯ä»¥ä½¿ç”¨ <code>plugin_name = await api.getConfig(&#39;_name&#39;)</code>ã€‚<br>å‚æ•°ï¼š</p><ul><li>param_nameï¼šStringã€‚å‚æ•°åç§°ã€‚<br>è¿”å›å€¼ï¼š</li><li>paramï¼šStringã€‚è¿”å›çš„å‚æ•°å€¼ã€‚æ³¨æ„ï¼Œæ•°å­—ä¹Ÿå°†ä½œä¸ºå­—ç¬¦ä¸²è¿”å›ã€‚</li></ul><p>ä¾‹å­ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sigma = <span class="keyword">await</span> api.getConfig(<span class="string">&#x27;sigma&#x27;</span>)</span><br></pre></td></tr></table></figure></p><h2 id="api-installPlugin"><a href="#api-installPlugin" class="headerlink" title="api.installPlugin"></a>api.installPlugin</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plugin = <span class="keyword">await</span> api.installPlugin(config)</span><br></pre></td></tr></table></figure><p>é€šè¿‡ä¼ é€’æ’ä»¶URIæˆ–æºä»£ç æ¥å®‰è£…æ’ä»¶ï¼Œæ’ä»¶æºä»£ç å°†ä¿å­˜åˆ°æµè§ˆå™¨æ•°æ®åº“ï¼ˆåœ¨å½“å‰å·¥ä½œåŒºä¸­ï¼‰ã€‚<br>å‚æ•°ï¼š</p><ul><li>configï¼šObjectã€‚é…ç½®å¯¹è±¡ã€‚ç›®å‰ï¼Œå¯ä»¥ä¼ é€’ä»¥ä¸‹é…ç½®ï¼š<ul><li><code>src</code>ï¼šStringã€‚è¦å®‰è£…çš„æ’ä»¶çš„æºä»£ç ã€URIã€‚</li><li><code>tag</code>ï¼šStringï¼Œå¯é€‰ã€‚å¦‚æœæ’ä»¶æœ‰å¤šä¸ªæ ‡ç­¾ï¼Œåˆ™é€‰æ‹©æ’ä»¶æ ‡ç­¾ã€‚</li><li><code>namespace</code>ï¼šStringï¼Œå¯é€‰ã€‚æ’ä»¶çš„å‘½åç©ºé—´ã€‚</li></ul></li></ul><p>ä¾‹å­ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> api.installPlugin(&#123;<span class="attr">uri</span>: <span class="string">&quot;https://raw.githubusercontent.com/imjoy-team/imjoy-core/master/src/plugins/webWorkerTemplate.imjoy.html&quot;</span>&#125;)</span><br></pre></td></tr></table></figure></p><h2 id="api-uninstallPlugin"><a href="#api-uninstallPlugin" class="headerlink" title="api.uninstallPlugin"></a>api.uninstallPlugin</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plugin = <span class="keyword">await</span> api.uninstallPlugin(config)</span><br></pre></td></tr></table></figure><p>å¸è½½å·²å®‰è£…çš„æ’ä»¶ã€‚<br>å‚æ•°ï¼š</p><ul><li>configï¼šObjectã€‚é…ç½®å¯¹è±¡ã€‚ç›®å‰ï¼Œå¯ä»¥ä¼ é€’ä»¥ä¸‹é…ç½®ï¼š<ul><li><code>name</code>ï¼šStringã€‚è¦å¸è½½çš„æ’ä»¶çš„åç§°ã€‚</li><li><code>namespace</code>ï¼šStringï¼Œæ’ä»¶çš„å‘½åç©ºé—´ï¼ˆæ³¨æ„ï¼Œç›®å‰å°šä¸æ”¯æŒè¯¥å‚æ•°ï¼Œä½†åé¢ä¼šæ”¯æŒï¼‰ã€‚</li></ul></li></ul><p>ä¾‹å­ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> api.uninstallPlugin(&#123;<span class="attr">name</span>: <span class="string">&quot;MyAwesomePlugin&quot;</span>&#125;)</span><br></pre></td></tr></table></figure></p><h2 id="api-getPlugin"><a href="#api-getPlugin" class="headerlink" title="api.getPlugin"></a>api.getPlugin</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plugin = <span class="keyword">await</span> api.getPlugin(config)</span><br></pre></td></tr></table></figure><p>é€šè¿‡idæˆ–åç§°è·å–å·²åŠ è½½æ’ä»¶çš„APIå¯¹è±¡ã€‚æ’ä»¶å¿…é¡»å·²ç»åŠ è½½åˆ°å·¥ä½œåŒºä¸­ã€‚<br>æ³¨1ï¼šå¦‚æœæ’ä»¶è¢«ç»ˆæ­¢å¹¶ä¸”å°è¯•è°ƒç”¨å…¶å‡½æ•°ï¼Œåˆ™å°†æ”¶åˆ°é”™è¯¯æ¶ˆæ¯ã€‚å¯¹æ­¤çš„ä¸€ç§è§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨<code>try ... catch</code>(JavaScript) æˆ–<code>try: ... except: ...</code>(Python)è¯­å¥æ¥æ•è·é”™è¯¯ã€‚<br>æ³¨2ï¼šå…³äº<code>api.getPlugin</code>å’Œ<code>api.call</code>ï¼Œå¦‚æœæƒ³ä¸æ–­è®¿é—®å¦ä¸€ä¸ªæ’ä»¶çš„ä¸åŒåŠŸèƒ½ï¼Œæœ€å¥½ä½¿ç”¨<code>api.getPlugin</code>æ¥è·å–è¯¥æ’ä»¶çš„æ‰€æœ‰APIï¼Œç„¶åå¯ä»¥é€šè¿‡è¿”å›çš„å¯¹è±¡è®¿é—®å®ƒä»¬ã€‚å¦‚æœåªå¶å°”è®¿é—®å¦ä¸€ä¸ªæ’ä»¶ä¸­çš„APIå‡½æ•°ï¼Œåˆ™ä¹Ÿå¯ä»¥ä½¿ç”¨<code>api.call</code>ã€‚</p><p>å‚æ•°ï¼š</p><ul><li>configï¼šStringæˆ–Objectã€‚å¦‚æœæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²Stringï¼Œé‚£ä¹ˆå…¶åº”è¯¥æ˜¯æ’ä»¶çš„åç§°ï¼Œå¦åˆ™ï¼Œå¯ä»¥ä¼ é€’ä¸€ä¸ªåŒ…å«é”®<code>id</code>æˆ–<code>name</code>çš„å¯¹è±¡ã€‚<br>ç›®å‰ï¼Œå¯ä»¥ä¼ é€’ä»¥ä¸‹é…ç½®ï¼š<ul><li>nameï¼šStringã€‚æ’ä»¶åç§°ã€‚</li><li>idï¼šStringã€‚æ’ä»¶çš„idã€‚</li></ul></li></ul><p>è¿”å›å€¼ï¼š</p><ul><li>pluginï¼šå¯¹è±¡ã€‚å¯ç”¨äºè®¿é—®æ’ä»¶ API å‡½æ•°çš„å¯¹è±¡ã€‚</li></ul><p>ä¾‹å­ï¼š<br>è·å–æ’ä»¶<code>PluginX</code>çš„APIï¼Œå¹¶è®¿é—®å…¶åŠŸèƒ½ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">pluginX = <span class="keyword">await</span> api.getPlugin(<span class="string">&quot;PluginX&quot;</span>)</span><br><span class="line">result = <span class="keyword">await</span> pluginX.run()</span><br><span class="line"></span><br><span class="line"><span class="comment">// Assuming that PluginX defined an API function `funcX`, you can access it with:</span></span><br><span class="line"><span class="keyword">await</span> pluginX.funcX()</span><br></pre></td></tr></table></figure></p><h2 id="api-loadPlugin"><a href="#api-loadPlugin" class="headerlink" title="api.loadPlugin"></a>api.loadPlugin</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plugin = <span class="keyword">await</span> api.getPlugin(config)</span><br></pre></td></tr></table></figure><p>ä»æºä»£ç æˆ–URLåŠ è½½æ’ä»¶ï¼Œç„¶åè¿”å›æ’ä»¶APIå¯¹è±¡ã€‚<br>å‚æ•°ï¼š</p><ul><li>configï¼šå­—ç¬¦ä¸²æˆ–å¯¹è±¡ã€‚è·å–æ’ä»¶çš„é…ç½®ã€‚å¦‚æœå®ƒæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆæ ¹æ®å­—ç¬¦ä¸²çš„å†…å®¹ï¼Œå®ƒå°†è¢«è½¬æ¢ä¸ºä¸€ä¸ªé…ç½®å¯¹è±¡ã€‚è½¬æ¢æŒ‰ç…§ä»¥ä¸‹è§„åˆ™è¿›è¡Œï¼š 1) å¦‚æœå­—ç¬¦ä¸²åŒ…å«å¤šè¡Œï¼Œæ˜¯URLæˆ–æ’ä»¶URIï¼Œåˆ™å°†å…¶è§†ä¸ºæ’ä»¶æºï¼ˆè¯·å‚é˜…ä¸‹é¢çš„ <code>src</code> é”®ï¼‰ï¼› 2) å¦åˆ™å°†è¢«è§†ä¸ºæ’ä»¶åç§°å¹¶è¿”å›ä¸<code>api.getPlugin</code> ç›¸åŒçš„ç»“æœã€‚ç›®å‰ï¼Œå¯ä»¥ä¼ é€’ä»¥ä¸‹é…ç½®ï¼š<ul><li>srcï¼šå­—ç¬¦ä¸²ã€‚æ’ä»¶çš„URLæˆ–æºä»£ç ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒå°†å³æ—¶å®ä¾‹åŒ–ã€‚é€šè¿‡ä¼ é€’æºä»£ç ï¼Œå®ƒå¯ä»¥çµæ´»åœ°å°†ä¸€ä¸ªæˆ–å¤šä¸ªæ’ä»¶æºä»£ç åµŒå…¥åˆ°å¦ä¸€ä¸ªæ’ä»¶ä¸­ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªPythonæ’ä»¶å¯ä»¥åŠ¨æ€å¡«å……ä¸€ä¸ªHTMLæ ¼å¼çš„<code>window</code>æ’ä»¶ã€‚</li><li>tagï¼šå­—ç¬¦ä¸²ï¼Œå¯é€‰ã€‚å¦‚æœæ’ä»¶æ”¯æŒå¤šä¸ª<code>tags</code>ï¼Œåˆ™æŒ‡å®šæ’ä»¶çš„æ ‡ç­¾ï¼Œä»…åœ¨<code>src</code>ä¸ºæ’ä»¶æºä»£ç æ—¶ä½¿ç”¨ã€‚</li><li>namespaceï¼šå­—ç¬¦ä¸²ï¼Œå¯é€‰ã€‚æŒ‡å®šæ’ä»¶çš„å‘½åç©ºé—´ï¼Œä»…åœ¨<code>src</code>ä¸ºæ’ä»¶æºä»£ç æ—¶ä½¿ç”¨ã€‚</li><li>engine_modeï¼šå­—ç¬¦ä¸²ï¼Œå¯é€‰ã€‚ ä»…é€‚ç”¨äºé€šè¿‡æ’ä»¶å¼•æ“è¿è¡Œçš„æ’ä»¶ã€‚é€‰æ‹©é»˜è®¤å¼•æ“æ¨¡å¼ï¼Œå®ƒå¯ä»¥æ˜¯ <code>auto</code> æˆ–å¼•æ“ URLï¼ˆä¾‹å¦‚ï¼š<code>https://mybinder.org</code>ï¼‰ã€‚</li></ul></li></ul><p>è¿”å›å€¼ï¼š</p><ul><li>pluginï¼šObjectå¯¹è±¡ã€‚å¯ç”¨äºè®¿é—®æ’ä»¶APIå‡½æ•°çš„å¯¹è±¡ã€‚</li></ul><p>ä¾‹å­ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pokemonChooser = <span class="keyword">await</span> api.loadPlugin(&#123;<span class="attr">src</span>: <span class="string">&quot;https://gist.github.com/oeway/3c2e1ee72c79a6aafd9d6e3b473f0bbf&quot;</span>&#125;)</span><br><span class="line"><span class="keyword">const</span> result = <span class="keyword">await</span> pokemonChooser.choosePokemon()</span><br></pre></td></tr></table></figure></p><h2 id="api-getServices"><a href="#api-getServices" class="headerlink" title="api.getServices"></a>api.getServices</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">services = <span class="keyword">await</span> api.getServices(config)</span><br></pre></td></tr></table></figure><p>é€šè¿‡æŒ‡å®šæ’ä»¶æœåŠ¡çš„<code>name</code>ã€<code>type</code>ã€<code>id</code> ç­‰ï¼Œè·å–æ’ä»¶æœåŠ¡åˆ—è¡¨ï¼ˆä½¿ç”¨<code>api.registerService()</code> æ³¨å†Œï¼‰ã€‚<br>å‚æ•°ï¼š</p><ul><li>configï¼šObjectå¯¹è±¡ã€‚å®ƒæ˜¯ä¸€ä¸ªæŸ¥è¯¢å¯¹è±¡ï¼Œç”±å‡ ä¸ªå­—æ®µï¼ˆè‡³å°‘ä¸€ä¸ªï¼‰ç»„æˆï¼š<ul><li><code>id</code>ï¼šå­—ç¬¦ä¸²ã€‚æœåŠ¡çš„IDï¼ˆå¦‚æœåŒ¹é…ï¼Œå°†è¿”å›ä¸€ä¸ªåŒ…å«ä¸€ä¸ªå…ƒç´ çš„åˆ—è¡¨ï¼‰ã€‚</li><li><code>name</code>ï¼šå­—ç¬¦ä¸²ã€‚æœåŠ¡çš„åç§°ã€‚</li><li><code>type</code>ï¼šå­—ç¬¦ä¸²ã€‚æœåŠ¡ç±»å‹ã€‚</li><li>åœ¨æœåŠ¡apiä¸­å®šä¹‰çš„ä»»ä½•å…¶ä»–é”®ã€‚</li></ul></li></ul><p>è¿”å›å€¼ï¼š</p><ul><li>servicesï¼šObjectå¯¹è±¡ã€‚æœåŠ¡apiæˆ–å¯¹è±¡çš„åˆ—è¡¨ã€‚</li></ul><p>ä¾‹å­ï¼š<br>è·å–æ‰€æœ‰ä½¿ç”¨ <code>type=&quot;@model&quot;</code> æ³¨å†Œçš„æ’ä»¶æœåŠ¡ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> models = <span class="keyword">await</span> api.getServices(&#123;<span class="attr">type</span>: <span class="string">&quot;@model&quot;</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(models)</span><br></pre></td></tr></table></figure></p><h2 id="api-getWindow"><a href="#api-getWindow" class="headerlink" title="api.getWindow"></a>api.getWindow</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">w = <span class="keyword">await</span> api.getWindow(config)</span><br></pre></td></tr></table></figure><p>é€šè¿‡çª—å£çš„<code>id</code>ã€<code>window_id</code>ã€<code>name</code>æˆ–<code>type</code>è·å–ç°æœ‰çª—å£ã€‚<br>å‚æ•°ï¼š</p><ul><li>configï¼šå­—ç¬¦ä¸²æˆ–å¯¹è±¡ã€‚å®ƒå¯ä»¥æ˜¯ä¸€ä¸ªçª—å£åç§°å­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªç”±å‡ ä¸ªå­—æ®µï¼ˆè‡³å°‘ä¸€ä¸ªï¼‰ç»„æˆçš„å¯¹è±¡ï¼š<ul><li><code>name</code>ï¼šå­—ç¬¦ä¸²ã€‚çª—å£åç§°ã€‚</li><li><code>type</code>ï¼šå­—ç¬¦ä¸²ã€‚çª—å£çš„ç±»å‹ã€‚</li><li><code>window_id</code>ï¼šå­—ç¬¦ä¸²ã€‚çª—å£çš„idã€‚</li><li><code>plugin_id</code>ï¼šå­—ç¬¦ä¸²ã€‚é™„åŠ åˆ°çª—å£çš„æ’ä»¶å®ä¾‹çš„idã€‚</li></ul></li></ul><p>è¿”å›å€¼</p><ul><li>wï¼šå¯¹è±¡ã€‚å¯ç”¨äºè®¿é—®çª—å£APIå‡½æ•°çš„çª—å£å¯¹è±¡ã€‚</li></ul><p>ä¾‹å­ï¼š<br>è·å–ç°æœ‰çš„<a href="https://kaibu.org">Kaibu</a> çª—å£å¹¶è®¿é—®å®ƒã€‚<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> createWindow(&#123;<span class="attr">name</span>: <span class="string">&quot;My Kaibu Window&quot;</span>, <span class="attr">src</span>: <span class="string">&quot;https://kaibu.org&quot;</span>&#125;)</span><br><span class="line"></span><br><span class="line">w = <span class="keyword">await</span> api.getWindow(<span class="string">&quot;My Kaibu Window&quot;</span>)</span><br><span class="line"><span class="keyword">await</span> w.open(<span class="string">&quot;https://imjoy.io/static/img/imjoy-icon.png&quot;</span>)</span><br></pre></td></tr></table></figure></p><h2 id="api-getEngine"><a href="#api-getEngine" class="headerlink" title="api.getEngine"></a>api.getEngine</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">engine = <span class="keyword">await</span> api.getEngine(engine_url)</span><br></pre></td></tr></table></figure><p>è·å–æ’ä»¶å¼•æ“çš„APIå¯¹è±¡ã€‚<br>å‚æ•°ï¼š</p><ul><li>engine_urlï¼šå­—ç¬¦ä¸²ã€‚æ’ä»¶å¼•æ“çš„URLã€‚</li></ul><p>è¿”å›å€¼ï¼š</p><ul><li>engineï¼šå¯¹è±¡ã€‚å¯ç”¨äºè®¿é—®å¼•æ“APIå‡½æ•°çš„å¼•æ“å¯¹è±¡ã€‚</li></ul><p>ä¾‹å­ï¼š<br>è·å–å¼•æ“çš„APIï¼ˆurl = <code>https://127.0.0.1:2957</code>ï¼‰ï¼Œå¹¶è®¿é—®å…¶åŠŸèƒ½ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">engine = <span class="keyword">await</span> api.getEngine(<span class="string">&quot;https://127.0.0.1:2957&quot;</span>)</span><br><span class="line"><span class="keyword">await</span> engine.disconnect()</span><br></pre></td></tr></table></figure></p><h2 id="api-getEngineFactory"><a href="#api-getEngineFactory" class="headerlink" title="api.getEngineFactory"></a>api.getEngineFactory</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">engine_factory = <span class="keyword">await</span> api.getEngineFactory(engine_factory_name)</span><br></pre></td></tr></table></figure><p>è·å–æ’ä»¶å¼•æ“å·¥å‚çš„APIå¯¹è±¡ã€‚<br>å‚æ•°ï¼š</p><ul><li>engine_factory_nameï¼šå­—ç¬¦ä¸²ã€‚æ’ä»¶å¼•æ“å·¥å‚çš„åç§°ã€‚<br>è¿”å›å€¼ï¼š</li><li>engine_factoryï¼šå¯¹è±¡ã€‚ä¸€ä¸ªæ’ä»¶å¼•æ“å·¥å‚å¯¹è±¡ï¼Œå¯ç”¨äºè®¿é—®å¼•æ“ API å‡½æ•°ã€‚</li></ul><p>ä¾‹å­ï¼š<br>è·å–æ’ä»¶å¼•æ“å·¥å‚çš„APIï¼ˆname = <code>ImJoy-Engine</code>ï¼‰ï¼Œå¹¶è®¿é—®å…¶åŠŸèƒ½ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">engine_factory = <span class="keyword">await</span> api.getEngineFactory(<span class="string">&quot;ImJoy-Engine&quot;</span>)</span><br><span class="line"><span class="keyword">await</span> engine_factory.addEngine(config)</span><br></pre></td></tr></table></figure></p><h2 id="api-getFileManager"><a href="#api-getFileManager" class="headerlink" title="api.getFileManager"></a>api.getFileManager</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file_manager = <span class="keyword">await</span> api.getFileManager(file_manager_url)</span><br></pre></td></tr></table></figure><p>è·å–æ–‡ä»¶ç®¡ç†å™¨çš„APIå¯¹è±¡ã€‚<br>æ³¨æ„ï¼šè‡ªä»<code>api_version &gt; 0.1.6</code>ï¼Œ<code>api.getFileUrl</code> å’Œ<code>api.requestUploadUrl</code> å·²å¼ƒç”¨ï¼Œæ›¿æ¢æ–¹æ¡ˆæ˜¯å…ˆä½¿ç”¨<code>api.getFileManager</code> è·å–æ–‡ä»¶ç®¡ç†å™¨ï¼Œç„¶åä»è¿”å›çš„æ–‡ä»¶ç®¡ç†å™¨å¯¹è±¡ä¸­è®¿é—®<code>getFileUrl</code> å’Œ<code>requestUploadUrl</code>ã€‚<br>å‚æ•°ï¼š</p><ul><li>file_manager_urlï¼šå­—ç¬¦ä¸²ã€‚æ–‡ä»¶ç®¡ç†å™¨çš„ URLã€‚</li></ul><p>è¿”å›å€¼ï¼š</p><ul><li>file_managerï¼šå¯¹è±¡ã€‚å¯ç”¨äºè®¿é—®æ–‡ä»¶ç®¡ç†å™¨ API å‡½æ•°çš„æ–‡ä»¶ç®¡ç†å™¨å¯¹è±¡ã€‚</li></ul><p>ä¾‹å­ï¼š<br>è·å–æ–‡ä»¶ç®¡ç†å™¨çš„APIï¼ˆurl = <code>https://127.0.0.1:2957</code>ï¼‰ï¼Œå¹¶è®¿é—®å…¶åŠŸèƒ½ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">file_manager = <span class="keyword">await</span> api.getFileManager(<span class="string">&quot;https://127.0.0.1:2957&quot;</span>)</span><br><span class="line"><span class="keyword">await</span> file_manager.listFiles()</span><br></pre></td></tr></table></figure><br>è·å–ä¸‹è½½æ–‡ä»¶åœ°å€ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">file_manager = <span class="keyword">await</span> api.getFileManager(<span class="string">&quot;https://127.0.0.1:2957&quot;</span>)</span><br><span class="line"><span class="keyword">await</span> file_manager.getFileUrl(&#123;<span class="string">&#x27;path&#x27;</span>: <span class="string">&#x27;./data/output.png&#x27;</span>&#125;)</span><br></pre></td></tr></table></figure><br>å¦‚æœè¦è·å–å½“å‰æ–‡ä»¶çš„æ–‡ä»¶URLï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">from imjoy import api</span><br><span class="line"></span><br><span class="line">class ImJoyPlugin():</span><br><span class="line">    def setup(self):</span><br><span class="line">        api.log(&#39;initialized&#39;)</span><br><span class="line"></span><br><span class="line">    async def run(self, ctx):</span><br><span class="line">        file_manager &#x3D; await api.getFileManager(api.config.file_manager)</span><br><span class="line">        url &#x3D; await file_manager.getFileUrl(&#123;&quot;path&quot;: &#39;.&#x2F;screenshot-imjoy-notebook.png&#39;&#125;)</span><br><span class="line">        await api.alert(url)</span><br><span class="line"></span><br><span class="line">api.export(ImJoyPlugin())</span><br></pre></td></tr></table></figure></p><p>ç”¨äºä¸Šä¼ çš„æ–‡ä»¶URLè¯·æ±‚ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">file_manager = <span class="keyword">await</span> api.getFileManager(<span class="string">&quot;https://127.0.0.1:2957&quot;</span>)</span><br><span class="line"><span class="keyword">await</span> file_manager.requestUploadUrl(&#123;<span class="string">&#x27;path&#x27;</span>: <span class="string">&#x27;./data/input.png&#x27;</span>&#125;)</span><br></pre></td></tr></table></figure></p><h2 id="api-log"><a href="#api-log" class="headerlink" title="api.log"></a>api.log</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">api.log(message)</span><br></pre></td></tr></table></figure><p>è®°å½•å½“å‰æ’ä»¶çš„çŠ¶æ€æ¶ˆæ¯ï¼Œè¯¥æ¶ˆæ¯å­˜å‚¨åœ¨å…¶æ—¥å¿—å†å²è®°å½•ä¸­ã€‚<br>æ’ä»¶åæ—è¾¹çš„ç°è‰²å›¾æ ‡è¡¨æ˜è¯¥çŠ¶æ€çš„å­˜åœ¨ï¼Œç‚¹å‡»æ­¤å›¾æ ‡å°†æ‰“å¼€ä¸€ä¸ªçª—å£ï¼Œæ˜¾ç¤ºå†å²è®°å½•çš„æ¶ˆæ¯ã€‚<br>çŠ¶æ€æ¶ˆæ¯å¯ä»¥æ˜¯å­—ç¬¦ä¸²æˆ–å›¾åƒã€‚åè€…å¯ç”¨äºåˆ›å»ºè‡ªåŠ¨æ—¥å¿—ï¼Œä¾‹å¦‚ï¼Œè®°å½•ç¥ç»ç½‘ç»œçš„è®­ç»ƒã€‚<br>ä¸ <code>console.log</code> æˆ– <code>print</code> ç±»ä¼¼ï¼Œ<code>api.log</code> å¯ä»¥æ¥å—å¤šä¸ªå‚æ•°ï¼Œè¿™äº›å‚æ•°å°†é€šè¿‡ç©ºæ ¼è¿æ¥ã€‚</p><p>å‚æ•°ï¼š</p><ul><li>messageï¼šå­—ç¬¦ä¸²ã€‚è¦è®°å½•çš„æ¶ˆæ¯</li></ul><p>ä¾‹å­:<br>åˆ›å»ºä¸€ä¸ªç®€å•çš„æ–‡æœ¬æ¶ˆæ¯ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">api.log(<span class="string">&#x27;Processing data ...&#x27;</span>)</span><br></pre></td></tr></table></figure><br>è®°å½•ä¸€ä¸ªå›¾åƒæ–‡ä»¶ã€‚<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">api.log(&#123;<span class="attr">type</span>: <span class="string">&#x27;image&#x27;</span>, <span class="attr">value</span>: <span class="string">&#x27;https://imjoy.io/static/img/imjoy-icon.png&#x27;</span> &#125;)</span><br></pre></td></tr></table></figure></p><h2 id="api-progress"><a href="#api-progress" class="headerlink" title="api.progress"></a>api.progress</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">api.progress(progress)</span><br></pre></td></tr></table></figure><p>æ›´æ–°å½“å‰æ’ä»¶çš„è¿›åº¦æ¡ã€‚<br>æ­¤è¿›åº¦æ¡å°†æ˜¾ç¤ºåœ¨æ’ä»¶èœå•æœ¬èº«ä¸­ã€‚ä½¿ç”¨<code>api.showProgress</code> ä¸ºImJoyçŠ¶æ€æ ç”Ÿæˆè¿›åº¦æ¡ã€‚<br>å‚æ•°ï¼š</p><ul><li>progressï¼šæµ®ç‚¹æ•°æˆ–æ•´æ•°ã€‚è¿›åº¦ç™¾åˆ†æ¯”ã€‚æ•´æ•°çš„å…è®¸èŒƒå›´ä¸º 0 åˆ° 100ï¼Œæµ®ç‚¹æ•°çš„èŒƒå›´ä¸º 0 åˆ° 1ã€‚</li></ul><p>ä¾‹å­ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">api.progress(<span class="number">85</span>)</span><br></pre></td></tr></table></figure></p><h2 id="api-registerService"><a href="#api-registerService" class="headerlink" title="api.registerService"></a>api.registerService</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> service_id = <span class="keyword">await</span> api.registerService(config)</span><br></pre></td></tr></table></figure><p>æ³¨å†Œä¸€ä¸ªæ’ä»¶æœåŠ¡ã€‚<br>å‚æ•°ï¼š</p><ul><li>configï¼šå¯¹è±¡ï¼ˆJavaScriptï¼‰æˆ–å­—å…¸ï¼ˆPythonï¼‰ã€‚å®ƒå¿…é¡»è‡³å°‘åŒ…å«ä¸€ä¸ª <code>type</code> é”®å’Œä¸€ä¸ª <code>name</code> é”®ã€‚å…¶ä»–é”®å–å†³äºç›¸åº”çš„ç±»å‹å®šä¹‰ï¼ˆè§ä¸‹æ–‡ï¼‰ã€‚</li></ul><p>è¿”å›å€¼ï¼š</p><ul><li>service_idï¼šå­—ç¬¦ä¸²ã€‚è¯¥æœåŠ¡çš„idå¯ç”¨äºè·å–æˆ–å–æ¶ˆæ³¨å†ŒæœåŠ¡ã€‚</li></ul><h3 id="å†…ç½®æ’ä»¶æœåŠ¡"><a href="#å†…ç½®æ’ä»¶æœåŠ¡" class="headerlink" title="å†…ç½®æ’ä»¶æœåŠ¡"></a>å†…ç½®æ’ä»¶æœåŠ¡</h3><p>operator service (type=<code>operator</code>) æ˜¯ä¸€ç§å†…ç½®æœåŠ¡ï¼Œç”¨äºæ‰©å±•æ’ä»¶èœå•ä»¥æ‰§è¡Œç‰¹å®šä»»åŠ¡ã€‚<br>å¯¹äºæœåŠ¡çš„<code>config</code>ï¼Œå…è®¸å‡ ä¸ªå­—æ®µï¼š</p><ul><li><code>name</code>ï¼šå­—ç¬¦ä¸²ã€‚æ“ä½œ<code>op</code>åç§°ã€‚</li><li><code>ui</code>ï¼šå¯¹è±¡ï¼ˆJavaScriptï¼‰æˆ–å­—å…¸ï¼ˆPythonï¼‰ã€‚æ¸²æŸ“ç•Œé¢ã€‚ä¸ <code>&lt;config&gt;</code> ä¸­çš„ <code>ui</code> å­—æ®µå…·æœ‰ç›¸åŒçš„å®šä¹‰è§„åˆ™ã€‚</li><li><code>run</code>ï¼šå‡½æ•°ï¼Œå¯é€‰ã€‚æŒ‡å®šå½“<code>op</code>è¿è¡Œæ—¶æ‰€æ‰§è¡Œçš„ <code>Plugin API</code> å‡½æ•°ã€‚æ³¨æ„ï¼Œå®ƒå¿…é¡»æ˜¯ä½¿ç”¨ <code>api.export</code> å¯¼å‡ºçš„æ’ä»¶ç±»çš„æˆå‘˜æˆ–å‡½æ•°ã€‚å¦‚æœæœªæŒ‡å®šï¼Œå°†æ‰§è¡Œæ’ä»¶çš„ <code>run</code> å‡½æ•°ã€‚</li><li><code>update</code>ï¼šå­—ç¬¦ä¸²ï¼Œå¯é€‰ã€‚æŒ‡å®šå½“<code>ui</code>å­—æ®µä¸­çš„ä»»ä½•é€‰é¡¹å‘ç”Ÿæ›´æ”¹æ—¶å°†è¿è¡Œçš„<code>Plugin API</code>å‡½æ•°ã€‚</li><li><code>inputs</code>ï¼šå¯¹è±¡ï¼Œå¯é€‰ã€‚ å®šä¹‰æ­¤<code>op</code>çš„è¾“å…¥ï¼Œæ ¼å¼ä¸º<a href="https://json-schema.org/">JSON Schema</a>ã€‚</li><li><code>outputs</code>ï¼šå¯¹è±¡ï¼Œå¯é€‰ã€‚å®šä¹‰æ­¤<code>op</code>çš„è¾“å‡ºï¼Œæ ¼å¼ä¸º<a href="https://json-schema.org/">JSON Schema</a>ã€‚</li></ul><p>ï¼ˆå¦å¤–å‚é˜…ä¸Šé¢çš„[è¾“å…¥å‚æ•°]ä¸€èŠ‚äº†è§£å¦‚ä½•è®¾ç½®å‚æ•°ã€‚ï¼‰<br><code>op</code>å¯ä»¥æœ‰è‡ªå·±çš„ GUIï¼Œç”± <code>ui</code> å­—ç¬¦ä¸²å®šä¹‰ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ’ä»¶çš„æ‰€æœ‰æ“ä½œéƒ½ä¼šè°ƒç”¨æ’ä»¶çš„<code>run</code>å‡½æ•°ã€‚å¯ä»¥åœ¨<code>run</code>å‡½æ•°ä¸­ä½¿ç”¨ <code>ctx.config.type</code> æ¥åŒºåˆ†è°ƒç”¨äº†å“ªä¸ªæ“ä½œã€‚<br>å¦‚æœæƒ³åŠ¨æ€æ”¹å˜ç•Œé¢ï¼Œå¯ä»¥è¿è¡Œ<code>api.registerService</code>å¤šæ¬¡è¦†ç›–ä»¥å‰çš„ç‰ˆæœ¬ã€‚ <code>api.registerService</code> ä¹Ÿå¯ä»¥ç”¨äºè¦†ç›– <code>&lt;config&gt;</code> ä¸­å®šä¹‰çš„æ’ä»¶çš„é»˜è®¤<code>ui</code>å­—ç¬¦ä¸²ï¼Œåªéœ€å°†æ’ä»¶åç§°è®¾ç½®ä¸º<code>op</code>åç§°ï¼ˆæˆ–ä¸è®¾ç½®åç§°ï¼‰ã€‚</p><p>ä¾‹å­ï¼š<br>æ³¨å†Œä¸€ä¸ªæ–°çš„æ’ä»¶æ“ä½œç¬¦ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// JavaScript</span></span><br><span class="line"><span class="keyword">await</span> api.registerService(&#123;</span><br><span class="line">     <span class="string">&quot;type&quot;</span>: <span class="string">&quot;operator&quot;</span>,</span><br><span class="line">     <span class="string">&quot;name&quot;</span>: <span class="string">&quot;LUT&quot;</span>,</span><br><span class="line">     <span class="string">&quot;ui&quot;</span>: [&#123;</span><br><span class="line">        <span class="string">&quot;apply LUT&quot;</span>: &#123;</span><br><span class="line">            id: <span class="string">&#x27;lut&#x27;</span>,</span><br><span class="line">            type: <span class="string">&#x27;choose&#x27;</span>,</span><br><span class="line">            options: [<span class="string">&#x27;hot&#x27;</span>, <span class="string">&#x27;rainbow&#x27;</span>],</span><br><span class="line">            placeholder: <span class="string">&#x27;hot&#x27;</span></span><br><span class="line">          &#125;</span><br><span class="line">      &#125;],</span><br><span class="line">      <span class="string">&quot;run&quot;</span>: <span class="built_in">this</span>.apply_lut,</span><br><span class="line">      <span class="string">&quot;update&quot;</span>: <span class="built_in">this</span>.update_lut</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure></p><h3 id="å¼€å‘è€…è´¡çŒ®çš„æ’ä»¶æœåŠ¡"><a href="#å¼€å‘è€…è´¡çŒ®çš„æ’ä»¶æœåŠ¡" class="headerlink" title="å¼€å‘è€…è´¡çŒ®çš„æ’ä»¶æœåŠ¡"></a>å¼€å‘è€…è´¡çŒ®çš„æ’ä»¶æœåŠ¡</h3><p>å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æœåŠ¡ç±»å‹çš„æ’ä»¶æœåŠ¡ï¼š</p><ul><li>type=<code>@transformation</code>ï¼š<a href="https://scikit-learn.org/stable/data_transforms.html">scikit-learnå…¼å®¹æ•°æ®é›†è½¬æ¢</a><ul><li><code>transform(data)</code>: å°†æ­¤è½¬æ¢æ¨¡å‹åº”ç”¨äºæœªè§è¿‡çš„æ•°æ®</li><li><code>fit(data)</code>ï¼šä»æ•°æ®ä¸­å­¦ä¹ æ¨¡å‹å‚æ•°</li><li><code>fit_transform(data)</code>ï¼šåŒæ—¶å»ºæ¨¡å’Œè½¬æ¢è®­ç»ƒæ•°æ®</li></ul></li><li>type=<code>@model</code>: keras å…¼å®¹æ¨¡å‹æœåŠ¡<ul><li><code>predict(data)</code>ï¼šå¯¹æ•°æ®è¿›è¡Œé¢„æµ‹ï¼ˆè§<a href="https://keras.io/api/models/model_training_apis/#predict-method">è¿™é‡Œ</a>ï¼‰</li><li><code>fit(data)</code>ï¼šåœ¨æ•°æ®ä¸Šè®­ç»ƒæ¨¡å‹ï¼ˆå‚è§ <a href="https://keras.io/api/models/model_training_apis/#fit-method">æ­¤å¤„</a>ï¼‰</li></ul></li><li>è¿˜å¯ä»¥è´¡çŒ®è‡ªå·±çš„æœåŠ¡ç±»å‹</li></ul><h3 id="å®šä¹‰ä¸€ä¸ªæ–°çš„æ’ä»¶æœåŠ¡ç±»å‹"><a href="#å®šä¹‰ä¸€ä¸ªæ–°çš„æ’ä»¶æœåŠ¡ç±»å‹" class="headerlink" title="å®šä¹‰ä¸€ä¸ªæ–°çš„æ’ä»¶æœåŠ¡ç±»å‹"></a>å®šä¹‰ä¸€ä¸ªæ–°çš„æ’ä»¶æœåŠ¡ç±»å‹</h3><p>å¦‚æœå†…ç½®å’Œå¼€å‘è€…è´¡çŒ®çš„æœåŠ¡ç±»å‹éƒ½ä¸èƒ½æ»¡è¶³è¦æ±‚ï¼Œè¿˜å¯ä»¥å®šä¹‰ä¸€ä¸ªæ–°çš„æ’ä»¶æœåŠ¡ç±»å‹ã€‚æœ€ç®€å•çš„æ–¹æ³•æ˜¯ä»å®šä¹‰è‡ªå®šä¹‰ç±»å‹å¼€å§‹ï¼Œä¾‹å¦‚ï¼š<code>api.registerService(&#123;&quot;type&quot;: &quot;my-awesome-service&quot;, ...&#125;)</code>ã€‚å¯ä»¥ä½¿ç”¨å®ƒæ¥å¼€å‘å’Œæµ‹è¯•æœåŠ¡ã€‚ä¸€æ—¦æœåŠ¡ç±»å‹å®šä¹‰ç¨³å®šå¯ç”¨äº†ï¼Œå¯ä»¥åœ¨æœåŠ¡ç±»å‹åç§°ä¸­æ·»åŠ ä¸€ä¸ª <code>@</code> å¹¶å°†è¯¥ç±»å‹æäº¤åˆ° imjoy-core å­˜å‚¨åº“ã€‚<br>ä»¥ä¸‹æ˜¯æäº¤ç±»å‹å®šä¹‰çš„æ­¥éª¤ï¼š</p><ol><li>fork<a href="https://github.com/imjoy-team/imjoy-core">imjoy-core repo</a></li><li>ç¼–è¾‘<a href="https://github.com/imjoy-team/imjoy-core/blob/master/docs/api.md">æœ¬é¡µ</a> å°†æ–°ç±»å‹æ·»åŠ åˆ°ä¸Šé¢çš„åˆ—è¡¨ä¸­ï¼Œå¹¶æä¾›è¯¦ç»†è¯´æ˜</li><li>åœ¨ <a href="https://github.com/imjoy-team/imjoy-core/blob/master/src/serviceSpec.js">serviceSpec.js</a> æ–‡ä»¶ä¸­å®šä¹‰æ¨¡æ¿ã€‚</li><li>å‘<a href="https://github.com/imjoy-team/imjoy-core">imjoy-core repo</a>æäº¤PRã€‚</li></ol><h2 id="api-run"><a href="#api-run" class="headerlink" title="api.run"></a>api.run</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> api.run(plugin_name)</span><br></pre></td></tr></table></figure><p>é€šè¿‡æŒ‡å®šå…¶åç§°è¿è¡Œå¦ä¸€ä¸ªæ’ä»¶ã€‚<br>ä¹Ÿå¯ä»¥ä¼ é€’<code>ctx</code>åˆ°è¿™ä¸ªæ’ä»¶ä¸­ä»¥ä¼ è¾“æ•°æ®ã€‚<br>å‚æ•°ï¼š</p><ul><li>plugin_nameï¼šå­—ç¬¦ä¸²ã€‚æ’ä»¶åç§°ã€‚</li></ul><p>ä¾‹å­ï¼š<br>è°ƒç”¨ä¸€ä¸ªæ’ä»¶ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> api.run(<span class="string">&quot;Python Demo Plugin&quot;</span>)</span><br></pre></td></tr></table></figure></p><p>ä¸‹é¢æ˜¯ä¸¤ä¸ªæ’ä»¶å¹¶å‘æ‰§è¡Œçš„ä¾‹å­ï¼Œå…¶ä¸­ä¸¤ä¸ªæ’ä»¶æ˜¯åŒæ—¶æ‰§è¡Œï¼Œä½†ImJoyä¸€ä¸ªæ¥ä¸€ä¸ªåœ°ç­‰å¾…ç»“æœã€‚<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Python</span></span><br><span class="line">p1 = api.run(<span class="string">&quot;name of plugin 1&quot;</span>)</span><br><span class="line">p2 = api.run(<span class="string">&quot;name of plugin 2&quot;</span>)</span><br><span class="line"></span><br><span class="line">result1 = <span class="keyword">await</span> p1</span><br><span class="line">result2 = <span class="keyword">await</span> p2</span><br></pre></td></tr></table></figure><br>è¿™ä¹Ÿå¯ä»¥é€šè¿‡Pythonä¸­çš„ <code>asyncio.gather</code> æ¥å®ç°ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">p1 = api.run(<span class="string">&quot;name of plugin 1&quot;</span>)</span><br><span class="line">p2 = api.run(<span class="string">&quot;name of plugin 2&quot;</span>)</span><br><span class="line">result1, result2 = <span class="keyword">await</span> asyncio.gather(p1, p2)</span><br></pre></td></tr></table></figure><br>å¦‚æœç”¨JavaScriptå†™ä¸Šé¢çš„ä¾‹å­ï¼Œå¯ä»¥ä½¿ç”¨<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> p1 = api.run(<span class="string">&quot;name of plugin 1&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> p2 = api.run(<span class="string">&quot;name of plugin 2&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> [result1, result2] = [<span class="keyword">await</span> p1, <span class="keyword">await</span> p2]</span><br></pre></td></tr></table></figure><br>è€Œä¸¤ä¸ªæ’ä»¶é¡ºåºæ‰§è¡Œçš„ä¾‹å­å¦‚ä¸‹ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">result1 = <span class="keyword">await</span> api.run(<span class="string">&quot;name of plugin 1&quot;</span>)</span><br><span class="line">result2 = <span class="keyword">await</span> api.run(<span class="string">&quot;name of plugin 2&quot;</span>)</span><br></pre></td></tr></table></figure></p><h2 id="api-setConfig"><a href="#api-setConfig" class="headerlink" title="api.setConfig"></a>api.setConfig</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">api.setConfig(config_name, config_value)</span><br></pre></td></tr></table></figure><p>å°†æ’ä»¶æ•°æ®å­˜å‚¨åœ¨å…¶é…ç½®ä¸­ã€‚<br>å½“ImJoyé‡æ–°å¯åŠ¨æ—¶ï¼Œå¯ä»¥è·å¾—è¿™äº›å€¼ã€‚æ­¤åŠŸèƒ½éå¸¸é€‚åˆå­˜å‚¨å’Œé‡æ–°åŠ è½½è®¾ç½®ã€‚ä½†æ˜¯ï¼Œè¯¥å‡½æ•°æ—¨åœ¨å­˜å‚¨å°‘é‡æ•°æ®ï¼Œè€Œä¸æ˜¯å¤§å‹å¯¹è±¡ã€‚å½“å‰çš„å®ç°æ˜¯ä½¿ç”¨<code>localStorage</code> è¿›è¡Œå­˜å‚¨ã€‚å¤§å¤šæ•°æµè§ˆå™¨åªå…è®¸ImJoyè‡ªèº«åŠæ‰€æœ‰æ’ä»¶ä¸€å…±ä½¿ç”¨5MBæ•°æ®å­˜å‚¨ã€‚<br>è¦åˆ é™¤ä¸€ä¸ªå‚æ•°ï¼Œå°†å…¶å€¼è®¾ç½®ä¸º <code>null</code> (JavaScript) æˆ– <code>None</code> (Python)ã€‚<br>å‚æ•°ï¼š</p><ul><li>config<em>nameï¼šå­—ç¬¦ä¸²ã€‚å‚æ•°åç§°ã€‚ä¸è¦ä½¿ç”¨ä»¥`</em><code>å¼€å¤´ã€ä¸”åè·Ÿ</code><config>` å—çš„ä»»ä½•å­—æ®µåç§°è¿™æ ·çš„åå­—ã€‚</li><li>config_valueï¼šæ•°å­—æˆ–å­—ç¬¦ä¸²ã€‚æ—¢ä¸æ˜¯å¯¹è±¡/æ•°ç»„ï¼ˆJSï¼‰ä¹Ÿä¸æ˜¯å­—å…¸/åˆ—è¡¨ï¼ˆPythonï¼‰ã€‚è¯·æ³¨æ„ï¼Œæ•°å­—è¢«å­˜å‚¨ä¸ºå­—ç¬¦ä¸²ã€‚</li></ul><p>ä¾‹å­ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">api.setConfig(<span class="string">&#x27;sigma&#x27;</span>, <span class="number">928</span>)</span><br></pre></td></tr></table></figure></p><h2 id="api-showDialog"><a href="#api-showDialog" class="headerlink" title="api.showDialog"></a>api.showDialog</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">answer = <span class="keyword">await</span> api.showDialog(config)</span><br></pre></td></tr></table></figure><p>å°†çª—å£æˆ–è‡ªå®šä¹‰ GUI æ˜¾ç¤ºä¸ºå¯¹è¯æ¡†ã€‚<br>ç±»ä¼¼äº<code>api.createWindow</code>ï¼Œå¯ä»¥ä¼ é€’ä¸€ä¸ªå¯¹è±¡<code>&#123;&quot;type&quot;: &quot;WINDOW_PLUGIN_NAME&quot;, &quot;name&quot;: &quot;new dialog&quot;, &quot;config&quot;: &#123;...&#125;, &quot;data&quot;: &#123;... &#125;&#125;</code>ã€‚è¿™ä¼šå°†çª—å£æ’ä»¶å®ä¾‹æ˜¾ç¤ºä¸ºå¯¹è¯æ¡†ã€‚è¯¥å¯¹è¯æ¡†å¯ä»¥é€šè¿‡<code>win.close()</code>ä»¥ç¼–ç¨‹æ–¹å¼å…³é—­ï¼Œä¹Ÿå¯ä»¥ç”±ç”¨æˆ·ä½¿ç”¨å…³é—­æŒ‰é’®å…³é—­ã€‚<br>å¯¹äºå¸¦æœ‰joy uiçš„ç®€å•å¯¹è¯æ¡†ï¼Œå¯ä»¥ä¼ é€’<code>&#123;&quot;type&quot;: &quot;joy&quot;, &quot;name&quot;: &quot;new dialog&quot;, &quot;config&quot;: &#123;...&#125;, &quot;data&quot;: &#123;...&#125;&#125;</code>ã€‚å¯¹è¯æ¡†çš„å›ç­”å°†å­˜å‚¨åœ¨è¿”å›çš„å¯¹è±¡ä¸­ï¼Œå¯ä»¥ä½¿ç”¨æŒ‡å®šçš„<code>id</code>è·å¾—ã€‚å½“è€ƒè™‘ç”¨æˆ·æŒ‰ä¸‹<code>cancel</code>çš„æƒ…å†µï¼Œå¯ä»¥ä½¿ç”¨<code>try catch</code>ï¼ˆJavaScriptï¼‰æˆ–<code>try except</code>ï¼ˆPythonï¼‰è¯­æ³•ã€‚<br>å‚æ•°ï¼š</p><ul><li>configï¼šå¯¹è±¡ (JavaScript) æˆ–å­—å…¸ (Python)ã€‚å®šä¹‰å¯¹è¯æ¡†ã€‚åŒ…å«ä»¥ä¸‹å­—æ®µï¼š<ul><li><code>name</code>ï¼šå­—ç¬¦ä¸²ã€‚å¯¹è¯æ¡†çš„æ ‡é¢˜ã€‚</li><li><code>type</code>ï¼šå­—ç¬¦ä¸²ã€‚å¯¹è¯æ¡†çš„ç±»å‹ï¼ˆä½¿ç”¨<code>window</code>æ’ä»¶åç§°æˆ–<code>joy</code>ï¼‰ã€‚å¦‚æœ<code>type=&quot;joy&quot;</code>ï¼Œåˆ™éœ€è¦æä¾›<code>ui</code>ï¼Œå®ƒçš„å®šä¹‰ä¸<code>&lt;config&gt;</code> ä¸­çš„<code>ui</code> å­—æ®µç›¸åŒã€‚å¦åˆ™ï¼Œéœ€è¦ä¸º <code>api.createWindow</code>æä¾› <code>config</code> å’Œ <code>data</code>ã€‚</li></ul></li></ul><p>è¿”å›å€¼ï¼š</p><ul><li>answerã€‚å¯¹è±¡ (JavaScript) æˆ–å­—å…¸ (Python)ã€‚é€šè¿‡å­—æ®µ<code>answer[id]</code>åŒ…å«å¯¹è¯æ¡†çš„ç­”æ¡ˆã€‚</li></ul><p>ä¾‹å­ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">result = <span class="keyword">await</span> api.showDialog(&#123;</span><br><span class="line">   <span class="string">&quot;name&quot;</span>: <span class="string">&quot;This is a dialog&quot;</span>,</span><br><span class="line">   <span class="string">&quot;ui&quot;</span>: <span class="string">&quot;Hey, please select a value for sigma: &#123;id:&#x27;sigma&#x27;, type:&#x27;choose&#x27;, options:[&#x27;1&#x27;, &#x27;3&#x27;], placeholder: &#x27;1&#x27;&#125;.&quot;</span>,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p><h2 id="api-showFileDialog"><a href="#api-showFileDialog" class="headerlink" title="api.showFileDialog"></a>api.showFileDialog</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ret = <span class="keyword">await</span> api.showFileDialog(config)</span><br></pre></td></tr></table></figure><p>æ˜¾ç¤ºä¸€ä¸ªæ–‡ä»¶å¯¹è¯æ¡†æ¥é€‰æ‹©æ–‡ä»¶æˆ–ç›®å½•ã€‚<br>è¯¥å‡½æ•°å°†è¿”å›ä¸€ä¸ª<code>promise</code>ï¼Œå¯ä»¥ä»ä¸­è·å–æ–‡ä»¶è·¯å¾„çš„å­—ç¬¦ä¸²ã€‚<br>æ ¹æ®æ’ä»¶å¼•æ“çš„å®ç°ï¼ŒImJoyå°†å°è¯•é€šè¿‡<code>api.config.file_manager</code> é€‰æ‹©æ’ä»¶å¼•æ“æŒ‡å®šçš„æ–‡ä»¶ç®¡ç†å™¨ã€‚<br>ImJoyä¸»ç¨‹åºå’Œæ’ä»¶å¼•æ“çš„æ–‡ä»¶å¤„ç†æ˜¯ä¸åŒçš„ã€‚<br>æ³¨æ„ï¼ŒJavaScriptæ’ä»¶çš„æ–‡ä»¶è·¯å¾„ä½œä¸ºurlè¿”å›ï¼Œè€Œå¯¹äºPythonæ’ä»¶ï¼Œå®ƒå°†æ˜¯ç»å¯¹æ–‡ä»¶è·¯å¾„ã€‚å¯¹äºJavaScriptæ’ä»¶ï¼Œéœ€è¦urlæ ¼å¼æ¥æ‰“å¼€æ–‡ä»¶ ã€‚å¯ä»¥ä½¿ç”¨<code>uri_type</code> é€‰é¡¹ï¼ˆè§ä¸‹æ–‡ï¼‰æ¥æ”¹å˜æ­¤è¡Œä¸ºã€‚ä¾‹å¦‚ï¼Œå¯¹äºJavaScriptæ’ä»¶ä¹Ÿå¯ä»¥è·å–ç»å¯¹è·¯å¾„ã€‚ä½†æ˜¯ï¼Œä¸èƒ½ä½¿ç”¨æ­¤è·¯å¾„æ‰“å¼€æ–‡ä»¶JavaScriptï¼Œä½†å¯ä»¥å°†å…¶ä¼ é€’ç»™å¦ä¸€ä¸ªPythonæ’ä»¶è¿›è¡Œå¤„ç†ã€‚</p><p>å‚æ•°ï¼š</p><ul><li>configï¼šå¯¹è±¡ (JavaScript) æˆ–å­—å…¸ (Python)ã€‚æ˜¾ç¤ºæ–‡ä»¶å¯¹è¯æ¡†çš„é€‰é¡¹ã€‚å®ƒåŒ…å«ä»¥ä¸‹å­—æ®µï¼š</li></ul><ul><li>typeï¼šå­—ç¬¦ä¸²ã€‚æ”¯æŒçš„æ–‡ä»¶å¯¹è¯æ¡†æ¨¡å¼ï¼š<ul><li><code>file</code>ï¼ˆé»˜è®¤ï¼‰ï¼šé€‰æ‹©ä¸€ä¸ªæˆ–å¤šä¸ªæ–‡ä»¶ï¼›</li><li><code>directory</code>ï¼šé€‰æ‹©ä¸€ä¸ªæˆ–å¤šä¸ªç›®å½•ã€‚å¯¹äºPythonæ’ä»¶ï¼Œå¦‚æœä¸æŒ‡å®šç±»å‹ï¼Œæ–‡ä»¶æˆ–ç›®å½•éƒ½å¯ä»¥é€‰æ‹©ã€‚</li></ul></li><li>titleï¼šå­—ç¬¦ä¸²ã€‚å¯¹è¯æ¡†çš„æ ‡é¢˜ã€‚</li><li>rootï¼šå­—ç¬¦ä¸²ã€‚æ˜¾ç¤ºå¯¹è¯æ¡†çš„åˆå§‹è·¯å¾„ã€‚æ³¨æ„ï¼šå¯¹äºWindowsä¸Šçš„Pythonæ’ä»¶ï¼Œå¯èƒ½å¸Œæœ›ä½¿ç”¨ <code>r&quot;xxxxxx&quot;</code> è¯­æ³•å°†è·¯å¾„å­—ç¬¦ä¸²å®šä¹‰ä¸ºåŸå§‹å­—ç¬¦ä¸²ï¼Œå› ä¸ºæœ‰å¯èƒ½é‡åˆ°æ— æ³•è¯†åˆ«æ™®é€šå­—ç¬¦ä¸²çš„è·¯å¾„é—®é¢˜ã€‚</li><li>modeï¼šå­—ç¬¦ä¸²ã€‚æ–‡ä»¶é€‰æ‹©æ¨¡å¼ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œç”¨æˆ·å¯ä»¥é€‰æ‹©å•ä¸ªæˆ–å¤šä¸ªæ–‡ä»¶ï¼ˆæŒ‰ä¸‹ <code>shift</code> é”®ï¼‰<ul><li><code>single</code>ï¼šåªèƒ½é€‰æ‹©å•ä¸ªæ–‡ä»¶æˆ–ç›®å½•ã€‚</li><li><code>multiple</code>ï¼šé€‰æ‹©å¤šä¸ªæ–‡ä»¶æˆ–ç›®å½•ï¼Œå¹¶ä»¥æ•°ç»„æˆ–åˆ—è¡¨çš„å½¢å¼è¿”å›ã€‚</li><li><code>single|multiple</code>ï¼ˆé»˜è®¤ï¼‰ï¼šå…è®¸å•é€‰å’Œå¤šé€‰ã€‚</li></ul></li><li>file_managerï¼šå­—ç¬¦ä¸²ã€‚é€šè¿‡urlæŒ‡å®šæ–‡ä»¶ç®¡ç†å™¨ï¼Œä¾‹å¦‚åœ¨<code>native-python</code>æ’ä»¶ä¸­ï¼Œå¯ä»¥é€šè¿‡<code>api.config.file_manager</code>è·å–æ–‡ä»¶ç®¡ç†å™¨çš„URLã€‚</li></ul><p>è¿”å›å€¼ï¼š</p><ul><li>selectedï¼šå¯¹è±¡æ•°ç»„ (JavaScript) æˆ–å­—å…¸ (Python)ã€‚å®ƒå¯ä»¥åŒ…å« 0 åˆ°å¤šä¸ªé€‰å®šçš„æ–‡ä»¶/ç›®å½•ã€‚å¦‚æœè¿”å›çš„æ•°ç»„ä¸ºç©ºï¼Œåˆ™è¡¨ç¤ºç”¨æˆ·æ²¡æœ‰é€‰æ‹©ä»»ä½•æ–‡ä»¶/ç›®å½•ã€‚æ•°ç»„ä¸­çš„æ–‡ä»¶é¡¹é€šå¸¸åŒ…å«ï¼ˆå–å†³äºä¸åŒçš„æ–‡ä»¶ç®¡ç†å™¨å®ç°ï¼‰ï¼š<ul><li>pathï¼šå­—ç¬¦ä¸²ã€‚æ–‡ä»¶è·¯å¾„ã€‚</li><li>urlï¼šå­—ç¬¦ä¸²ã€‚æ–‡ä»¶çš„URLã€‚</li><li>å…¶ä»–å­—æ®µã€‚</li></ul></li></ul><p>ä¾‹å­ï¼š<br>ä»¥ä¸‹ç¤ºä¾‹å°†æ˜¾ç¤ºæŒ‡å®šçš„æ–‡ä»¶åæˆ–ç”¨æˆ·å–æ¶ˆæˆ–æ’ä»¶å¼•æ“æœªè¿è¡Œçš„æ¶ˆæ¯ã€‚<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> selected = <span class="keyword">await</span> api.showFileDialog()</span><br><span class="line"><span class="keyword">if</span>(selected.length&gt;<span class="number">0</span>)&#123;</span><br><span class="line">  <span class="keyword">await</span> api.alert(<span class="string">&quot;Selected file &quot;</span> + selected[<span class="number">0</span>].url)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">  <span class="keyword">await</span> api.alert(<span class="string">&quot;User cancelled file selection.&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="api-showMessage"><a href="#api-showMessage" class="headerlink" title="api.showMessage"></a>api.showMessage</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">api.showMessage(message,duration)</span><br></pre></td></tr></table></figure><p>æ›´æ–°ImJoyçŠ¶æ€æ ä¸Šçš„çŠ¶æ€æ–‡æœ¬å¹¶æ˜¾ç¤ºä¸€ä¸ªå¸¦æœ‰ç›¸åº”æ¶ˆæ¯çš„å¿«é€Ÿå¼¹å‡ºæ ã€‚<br>å¦‚æœæœªæŒ‡å®šæŒç»­æ—¶é—´ï¼Œåˆ™å¿«é€Ÿå¼¹å‡ºæ å°†æ˜¾ç¤º 10 ç§’ã€‚<br>å‚æ•°ï¼š</p><ul><li>messageï¼šå­—ç¬¦ä¸²ã€‚è¦æ˜¾ç¤ºçš„æ¶ˆæ¯ã€‚</li><li>durationï¼ˆå¯é€‰ï¼‰ï¼šæ•´æ•°ã€‚æ˜¾ç¤ºæ¶ˆæ¯çš„æŒç»­æ—¶é—´ï¼ˆä»¥ç§’ä¸ºå•ä½ï¼‰ã€‚</li></ul><p>ä¾‹å­ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">api.showMessage(<span class="string">&#x27;Processing...&#x27;</span>, <span class="number">5</span>)</span><br></pre></td></tr></table></figure></p><h2 id="api-showProgress"><a href="#api-showProgress" class="headerlink" title="api.showProgress"></a>api.showProgress</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">api.showProgress(progress)</span><br></pre></td></tr></table></figure><p>æ›´æ–°Imjoy GUI çš„è¿›åº¦æ¡ã€‚<br>å‚æ•°ï¼š</p><ul><li>progressï¼šæµ®ç‚¹æ•°æˆ–æ•´æ•°ã€‚è¿›åº¦ç™¾åˆ†æ¯”ã€‚æ•´æ•°çš„å…è®¸èŒƒå›´ä¸º 0 åˆ° 100ï¼Œæµ®ç‚¹æ•°çš„èŒƒå›´ä¸º 0 åˆ° 1ã€‚</li></ul><p>ä¾‹å­ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">api.showProgress(<span class="number">85</span>)</span><br></pre></td></tr></table></figure></p><h2 id="api-showSnackbar"><a href="#api-showSnackbar" class="headerlink" title="api.showSnackbar"></a>api.showSnackbar</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">api.showSnackbar(message, duration)</span><br></pre></td></tr></table></figure><p>æ˜¾ç¤ºä¸€ä¸ªå¸¦æœ‰æ¶ˆæ¯çš„å¿«é€Ÿå¼¹å‡ºæ ï¼Œå¹¶åœ¨ç‰¹å®šæ—¶é—´æ®µå†…æ¶ˆå¤±ã€‚</p><p>å‚æ•°ï¼š</p><ul><li>messageï¼šå­—ç¬¦ä¸²ã€‚è¦æ˜¾ç¤ºçš„æ¶ˆæ¯ã€‚</li><li>durationï¼šæ•´æ•°ã€‚å°†æ˜¾ç¤ºä»¥ç§’ä¸ºå•ä½çš„æŒç»­æ—¶é—´æ¶ˆæ¯ã€‚</li></ul><p>ä¾‹å­:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">api.showSnackbar(<span class="string">&#x27;processing...&#x27;</span>, <span class="number">5</span>)</span><br></pre></td></tr></table></figure></p><h2 id="api-showStatus"><a href="#api-showStatus" class="headerlink" title="api.showStatus"></a>api.showStatus</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">api.showStatus(status)</span><br></pre></td></tr></table></figure><p>æ›´æ–°Imjoy GUIä¸Šçš„çŠ¶æ€æ–‡æœ¬ã€‚<br>å‚æ•°:</p><ul><li>statusï¼šå­—ç¬¦ä¸²ã€‚è¦æ˜¾ç¤ºçš„æ¶ˆæ¯ã€‚</li></ul><p>ä¾‹å­ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> api.showStatus(<span class="string">&#x27;processing...&#x27;</span>)</span><br></pre></td></tr></table></figure></p><h2 id="api-TAG"><a href="#api-TAG" class="headerlink" title="api.TAG"></a>api.TAG</h2><p>è¿™æ˜¯ä¸€ä¸ªå¸¸é‡ï¼Œæ˜¯ç”¨æˆ·åœ¨å®‰è£…è¿‡ç¨‹ä¸­é€‰æ‹©çš„å½“å‰æ ‡ç­¾ã€‚</p><h2 id="api-unregisterService"><a href="#api-unregisterService" class="headerlink" title="api.unregisterService"></a>api.unregisterService</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> api.unregisterService(config)</span><br></pre></td></tr></table></figure><p>å–æ¶ˆæ³¨å†Œæ’ä»¶æœåŠ¡ã€‚<br>å‚æ•°ï¼š</p><ul><li>configï¼šå¯¹è±¡ã€‚å®ƒå¿…é¡»åŒ…å«æ’ä»¶æœåŠ¡çš„<code>id</code>ã€‚</li></ul><p>ä¾‹å­ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> sid = <span class="keyword">await</span> api.registerService(&#123;<span class="attr">type</span>: <span class="string">&#x27;my-service&#x27;</span>, <span class="attr">my_data</span>: <span class="number">123</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">await</span> api.unregisterService(&#123;<span class="attr">id</span>: sid&#125;)</span><br></pre></td></tr></table></figure></p><h2 id="api-utils"><a href="#api-utils" class="headerlink" title="api.utils.*"></a>api.utils.*</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> api.utils.UTILITY_NAME()</span><br></pre></td></tr></table></figure><p>è°ƒç”¨æ•ˆç”¨å‡½æ•°ã€‚<br>ç›®å‰æ‰€æœ‰æ’ä»¶éƒ½æ”¯æŒçš„åŠŸèƒ½æ˜¯ï¼š</p><ul><li><code>api.utils.$forceUpdate()</code>ï¼šæ‰‹åŠ¨åˆ·æ–° GUIã€‚</li><li><code>api.utils.openUrl(url)</code>ï¼šåœ¨æ–°çš„æµè§ˆå™¨é€‰é¡¹å¡ä¸­æ‰“å¼€ä¸€ä¸ª <code>url</code>ã€‚</li><li><code>api.utils.sleep(duration)</code>ï¼šä»¥ç§’ä¸ºå•ä½ä¼‘çœ æŒ‡å®šçš„<code>duration</code>ã€‚æ³¨æ„å¯¹äºPythonæ’ä»¶ï¼Œè¯·ç”¨ <code>time.sleep</code>ã€‚</li><li><code>api.utils.showOpenFilePicker</code>ï¼šä»…é€‚ç”¨äº Chrome 86+ï¼Œå¼¹å‡ºä¸€ä¸ªå¯¹è¯æ¡†ï¼Œç”¨äºä½¿ç”¨ <a href="https://web.dev/file-system-access/">æ–‡ä»¶ç³»ç»Ÿè®¿é—®</a> APIæ‰“å¼€æ–‡ä»¶</li><li><code>api.utils.showSaveFilePicker</code>ï¼šä»…é€‚ç”¨äº Chrome 86+ï¼Œå¼¹å‡ºä¸€ä¸ªå¯¹è¯æ¡†ç”¨äºä½¿ç”¨ <a href="https://web.dev/file-system-access/">æ–‡ä»¶ç³»ç»Ÿè®¿é—®</a> APIä¿å­˜æ–‡ä»¶</li><li><code>api.utils.showDirectoryPicker</code>: ä»…é€‚ç”¨äº Chrome 86+ï¼Œå¼¹å‡ºä¸€ä¸ªå¯¹è¯æ¡†ç”¨äºé€‰æ‹©å…·æœ‰<a href="https://web.dev/file-system-access/">æ–‡ä»¶ç³»ç»Ÿè®¿é—®</a> APIçš„ç›®å½•</li></ul><h2 id="api-config"><a href="#api-config" class="headerlink" title="api.config"></a>api.config</h2><p>é…ç½®ä¿¡æ¯åŒ…æ‹¬ï¼š</p><ul><li><code>workspace</code>ï¼šå½“å‰å·¥ä½œåŒºã€‚</li><li><code>engine</code>ï¼šå½“å‰æ’ä»¶å¼•æ“çš„ URLï¼Œä»…é€‚ç”¨äºåŸç”Ÿ python æ’ä»¶ã€‚</li><li><code>file_manager</code>ï¼šå½“å‰æ’ä»¶å¼•æ“æ³¨å†Œçš„æ–‡ä»¶ç®¡ç†å™¨çš„ URLï¼Œä»…é€‚ç”¨äºåŸç”Ÿ python æ’ä»¶ã€‚</li></ul><h2 id="api-WORKSPACE"><a href="#api-WORKSPACE" class="headerlink" title="api.WORKSPACE"></a>api.WORKSPACE</h2><p><strong>å·²å¼ƒç”¨ï¼</strong> ä½¿ç”¨ <code>api.config.workspace</code> ä»£æ›¿<br>å½“å‰å·¥ä½œåŒºçš„åç§°ã€‚</p><h2 id="api-ENGINE-URL"><a href="#api-ENGINE-URL" class="headerlink" title="api.ENGINE_URL"></a>api.ENGINE_URL</h2><p><strong>å·²å¼ƒç”¨ï¼</strong> ä½¿ç”¨ <code>api.config.engine</code> ä»£æ›¿<br><strong>ä»…é€‚ç”¨äºåŸç”Ÿ python æ’ä»¶</strong><br>å½“å‰æ’ä»¶å¼•æ“çš„ URLã€‚</p><h2 id="api-FILE-MANAGER-URL"><a href="#api-FILE-MANAGER-URL" class="headerlink" title="api.FILE_MANAGER_URL"></a>api.FILE_MANAGER_URL</h2><p><strong>å·²å¼ƒç”¨ï¼</strong> ä½¿ç”¨ <code>api.config.file_manager</code> ä»£æ›¿<br><strong>ä»…é€‚ç”¨äºåŸç”Ÿ python æ’ä»¶</strong><br>å½“å‰æ’ä»¶å¼•æ“æ³¨å†Œçš„æ–‡ä»¶ç®¡ç†å™¨çš„ URLã€‚</p><h1 id="å†…éƒ¨æ’ä»¶"><a href="#å†…éƒ¨æ’ä»¶" class="headerlink" title="å†…éƒ¨æ’ä»¶"></a>å†…éƒ¨æ’ä»¶</h1><p>é™¤äº†é»˜è®¤çš„ ImJoy apiï¼Œè¿˜æä¾›äº†ä¸€ç»„å†…éƒ¨æ”¯æŒçš„æ’ä»¶ï¼Œè¿™äº›æ’ä»¶å¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚åªæœ‰å½“å¦ä¸€ä¸ªæ’ä»¶é€šè¿‡ <code>api.getPlugin(...)</code> è¯·æ±‚æ’ä»¶æ—¶ï¼Œæ‰ä¼šåŠ è½½è¿™äº›æ’ä»¶ã€‚<br>ä»¥ä¸‹æ˜¯è¿™äº›å†…éƒ¨æ’ä»¶åŠå…¶ api åŠŸèƒ½çš„åˆ—è¡¨ã€‚</p><h2 id="BrowserFS"><a href="#BrowserFS" class="headerlink" title="BrowserFS"></a>BrowserFS</h2><p>è¦ä½¿ç”¨ <code>BrowserFS</code> æ’ä»¶ï¼Œéœ€è¦å…ˆè°ƒç”¨ï¼š<br>åœ¨Javascriptä¸­<code>const bfs = await api.getPlugin(&#39;BrowserFS&#39;)</code> ï¼Œæˆ–åœ¨Pythonä¸­<code>bfs = await api.getPlugin(&#39;BrowserFS&#39;)</code>ã€‚<br>ç„¶åï¼Œå¯ä»¥ä½¿ç”¨ <a href="https://nodejs.org/api/fs.html">Node JS æ–‡ä»¶ç³»ç»Ÿ API</a> è®¿é—®æµè§ˆå™¨å†…çš„æ–‡ä»¶ç³»ç»Ÿï¼ˆä¾‹å¦‚ï¼š<code>bfs.readFile(&#39;/tmp/temp.txt&#39;, &#39;utf-8&#39;)</code>)ã€‚æ›´å¤šåº•å±‚å®ç°è¯¦è§<a href="https://github.com/jvilk/BrowserFS">BrowserFS</a>ï¼ŒImJoyé»˜è®¤æ–‡ä»¶ç³»ç»Ÿæ”¯æŒä»¥ä¸‹èŠ‚ç‚¹ï¼š</p><ul><li><code>/tmp</code>: <code>InMemory</code>ï¼Œæ•°æ®ä¿å­˜åœ¨æµè§ˆå™¨å†…å­˜ä¸­ï¼ŒImJoyå…³é—­æ—¶æ¸…é™¤ã€‚</li><li><code>/home</code>ï¼š<code>IndexedDB</code>ï¼Œæ•°æ®å­˜å‚¨åœ¨æµè§ˆå™¨IndexedDBæ•°æ®åº“ä¸­ï¼Œå¯ä»¥ä½œä¸ºæŒä¹…åŒ–å­˜å‚¨ã€‚</li></ul><p>ä¾‹å­ï¼š<br>JavaScriptå†™æ³•ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">test_browser_fs</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">const</span> bfs_plugin = <span class="keyword">await</span> api.getPlugin(<span class="string">&#x27;BrowserFS&#x27;</span>)</span><br><span class="line">  <span class="keyword">const</span> bfs = bfs_plugin.fs</span><br><span class="line"></span><br><span class="line">  bfs.writeFile(<span class="string">&#x27;/tmp/temp.txt&#x27;</span>, <span class="string">&#x27;hello world&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err, data</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">          <span class="built_in">console</span>.log(err);</span><br><span class="line">          <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&quot;Successfully Written to File.&quot;</span>);</span><br><span class="line">      bfs.readFile(<span class="string">&#x27;/tmp/temp.txt&#x27;</span>, <span class="string">&#x27;utf8&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">          <span class="keyword">if</span> (err) &#123;</span><br><span class="line">              <span class="built_in">console</span>.log(err);</span><br><span class="line">              <span class="keyword">return</span></span><br><span class="line">          &#125;</span><br><span class="line">          <span class="built_in">console</span>.log(<span class="string">&#x27;Read from file&#x27;</span>, data)</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>Pythonå†™æ³•ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">test_browser_fs</span>():</span></span><br><span class="line">  bfs_plugin = <span class="keyword">await</span> api.getPlugin(<span class="string">&#x27;BrowserFS&#x27;</span>)</span><br><span class="line">  bfs = bfs_plugin.fs</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">read</span>(<span class="params">err, data=<span class="literal">None</span></span>):</span></span><br><span class="line">      <span class="keyword">if</span> err:</span><br><span class="line">          <span class="built_in">print</span>(err)</span><br><span class="line">          <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">      <span class="function"><span class="keyword">def</span> <span class="title">cb</span>(<span class="params">err, data=<span class="literal">None</span></span>):</span></span><br><span class="line">          <span class="keyword">if</span> err:</span><br><span class="line">              <span class="built_in">print</span>(err)</span><br><span class="line">              <span class="keyword">return</span></span><br><span class="line">          api.log(data)</span><br><span class="line">      bfs.readFile(<span class="string">&#x27;/tmp/temp.txt&#x27;</span>, <span class="string">&#x27;utf8&#x27;</span>, cb)</span><br><span class="line"></span><br><span class="line">  bfs.writeFile(<span class="string">&#x27;/tmp/temp.txt&#x27;</span>, <span class="string">&#x27;hello world&#x27;</span>, read)</span><br><span class="line"></span><br></pre></td></tr></table></figure></p><p>åœ¨ JavaScript ä¸­é€å—è¯»å–å¤§æ–‡ä»¶ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">generate_random_data</span>(<span class="params">size</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> chars = <span class="string">&#x27;abcdefghijklmnopqrstuvwxyz&#x27;</span>.split(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">    <span class="keyword">var</span> len = chars.length;</span><br><span class="line">    <span class="keyword">var</span> random_data = [];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (size--) &#123;</span><br><span class="line">        random_data.push(chars[<span class="built_in">Math</span>.random()*len | <span class="number">0</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> random_data.join(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fsRead</span>(<span class="params">fd, buffer, offset, chunkSize, bytesRead</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    fs.read(fd, buffer, offset, chunkSize, bytesRead, (err, bytesRead,</span><br><span class="line">      read_buffer) =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;err : &#x27;</span> + err);</span><br><span class="line">        reject(err)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">const</span> bytes = read_buffer.slice(<span class="number">0</span>, bytesRead)</span><br><span class="line">      resolve(bytes)</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">bfs.writeFile(<span class="string">&#x27;/tmp/test.txt&#x27;</span>, generate_random_data(<span class="number">100000</span>), <span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</span><br><span class="line"><span class="keyword">if</span> (err)&#123;</span><br><span class="line">    <span class="built_in">console</span>.error(err);</span><br><span class="line">&#125;</span><br><span class="line">bfs.open(<span class="string">&#x27;/tmp/test.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err, fd</span>) </span>&#123;</span><br><span class="line">    bfs.fstat(fd, <span class="keyword">async</span> <span class="function"><span class="keyword">function</span>(<span class="params">err, stats</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span>(err)&#123;</span><br><span class="line">          <span class="built_in">console</span>.error(err)</span><br><span class="line">          <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">var</span> bufferSize = stats.size,</span><br><span class="line">          chunkSize = <span class="number">512</span>,</span><br><span class="line">          buffer = <span class="keyword">new</span> <span class="built_in">Uint8Array</span>(<span class="keyword">new</span> <span class="built_in">ArrayBuffer</span>(chunkSize)),</span><br><span class="line">          bytesRead = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">try</span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (bytesRead &lt; bufferSize) &#123;</span><br><span class="line">            <span class="keyword">if</span> ((bytesRead + chunkSize) &gt; bufferSize) &#123;</span><br><span class="line">                chunkSize = (bufferSize - bytesRead);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">const</span> bytes = <span class="keyword">await</span> fsRead(fd, buffer, <span class="number">0</span>, chunkSize, bytesRead)</span><br><span class="line">            <span class="built_in">console</span>.log(bytes)</span><br><span class="line">            bytesRead += chunkSize;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;Finished reading.&quot;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">catch</span>(e)&#123;</span><br><span class="line">        <span class="built_in">console</span>.error(e)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">finally</span>&#123;</span><br><span class="line">        bfs.close(fd);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>]]></content>
    
    
    <summary type="html">å‚è€ƒæ–‡çŒ®
ImJoy API

ç®€ä»‹
ImJoyçš„æ¯ä¸ªæ’ä»¶éƒ½åœ¨è‡ªå·±çš„ç±»ä¼¼æ²™ç®±çš„å®¹å™¨ç¯å¢ƒä¸­è¿è¡Œï¼ˆå¦‚JavaScriptæ’ä»¶çš„Web Worker æˆ–iframeã€Pythonæ’ä»¶çš„è¿›ç¨‹processï¼‰ã€‚è¿™æ ·å¯ä»¥é¿å…å…¶ä»–æ’ä»¶çš„å¹²æ‰°å¹¶ä½¿ImJoyåº”ç”¨ç¨‹åºæ›´åŠ å®‰å…¨ã€‚
æ’ä»¶ä¸ImJoyä¸»ç¨‹åºæˆ–æ’ä»¶ä¸æ’ä»¶ä¹‹é—´çš„äº¤äº’æ˜¯é€šè¿‡ä¸€ç»„APIå‡½æ•°ï¼ˆImJoy APIï¼‰è¿›è¡Œçš„ã€‚æ‰€æœ‰æ’ä»¶éƒ½å¯ä»¥è®¿é—®åˆ°ä¸€ä¸ªåä¸ºapiçš„ç‰¹æ®Šå¯¹è±¡ã€‚åœ¨Javascriptä¸­ï¼Œapi æ˜¯ä¸€ä¸ªå¯ä»¥ç›´æ¥ä½¿ç”¨çš„å…¨å±€å¯¹è±¡ã€‚åœ¨Pythonä¸­ï¼Œå¯ä»¥é€šè¿‡è°ƒç”¨ from imjoy import api æ¥å¯¼å…¥å®ƒã€‚æœ‰äº†è¿™ä¸ªå¯¹è±¡ï¼Œæ’ä»¶å¯ä»¥åšå¾ˆå¤šäº‹æƒ…ï¼Œæ¯”å¦‚æ˜¾ç¤ºä¸€ä¸ªå¯¹è¯</summary>
    
    
    
    <category term="computer vision" scheme="http://qixinbo.github.io/categories/computer-vision/"/>
    
    
    <category term="ImJoy" scheme="http://qixinbo.github.io/tags/ImJoy/"/>
    
  </entry>
  
  <entry>
    <title>å¼€æºæ·±åº¦å­¦ä¹ è®¡ç®—å¹³å°ImJoyè§£æï¼š5 -- æ’ä»¶å¼€å‘æµç¨‹</title>
    <link href="http://qixinbo.github.io/2021/12/05/ImJoy_5/"/>
    <id>http://qixinbo.github.io/2021/12/05/ImJoy_5/</id>
    <published>2021-12-04T16:00:00.000Z</published>
    <updated>2021-12-05T02:26:53.973Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h1><p><a href="https://imjoy.io/docs/#/development">Developing Plugins for ImJoy</a></p><p><a href="https://qixinbo.info/2021/12/04/imjoy_4/">ä¸Šä¸€ç¯‡æ–‡ç« </a>ä¸­ä»‹ç»äº†æ’ä»¶çš„æ–‡ä»¶æ ¼å¼ï¼Œè¿™ä¸€ç¯‡ä»‹ç»å¦‚ä½•è¿›è¡Œå®é™…çš„æ’ä»¶å¼€å‘ã€‚</p><h1 id="æŒ‡å®šä¾èµ–"><a href="#æŒ‡å®šä¾èµ–" class="headerlink" title="æŒ‡å®šä¾èµ–"></a>æŒ‡å®šä¾èµ–</h1><p>å¯¹äºä¸€ä¸ªæ’ä»¶ï¼Œå…¶å¾€å¾€ä¸æ˜¯å•ä¸€çš„åŠŸèƒ½å®ç°ï¼Œå¾€å¾€éœ€è¦å…¶ä»–è½¯ä»¶åº“çš„é…åˆã€‚<br>æ’ä»¶çš„ä¾èµ–åœ¨å…¶æ–‡ä»¶çš„<code>config</code> å—çš„<code>requirements</code>å­—æ®µä¸­è¿›è¡ŒæŒ‡å®šã€‚<br>æ ¹æ®ä¸åŒçš„æ’ä»¶ç±»å‹ï¼Œå¯ä»¥æŒ‡å®šä¸ä¸€æ ·çš„ä¾èµ–ã€‚</p><h2 id="Web-Worker-å’Œ-Window-æ’ä»¶"><a href="#Web-Worker-å’Œ-Window-æ’ä»¶" class="headerlink" title="Web Worker å’Œ Window æ’ä»¶"></a>Web Worker å’Œ Window æ’ä»¶</h2><p>å¯¹äºè¿™ä¸¤ç±»æ’ä»¶ï¼Œå¯ä»¥é€šè¿‡ä¸€ä¸ªJavaScriptåº“çš„urlæ•°ç»„æ¥æŒ‡å®šä¾èµ–ã€‚è¿™äº›åº“ä¼šè¢«<code>importScripts</code>æ–¹æ³•å¯¼å…¥ã€‚<br>ä¾‹å¦‚ï¼Œè¦æŒ‡å®šæœ€æ–°çš„ <a href="https://plot.ly/javascript/">plotly.js</a> åº“ï¼Œå¯ä»¥è¿™æ ·å†™ï¼š<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;requirements&quot;: [&quot;https://cdn.plot.ly/plotly-latest.min.js&quot;]</span><br></pre></td></tr></table></figure></p><p>ç‰¹åˆ«åœ°ï¼Œå¯¹äºwindowæ’ä»¶ï¼Œè¿˜å¯ä»¥æŒ‡å®šCSSåº“çš„urlï¼Œè¿™äº›éœ€è¦ä»¥<code>.css</code> ç»“å°¾ï¼Œå¦åˆ™éœ€è¦åœ¨url åæ·»åŠ å‰ç¼€<code>css:</code>ã€‚<br>ä¾‹å¦‚ï¼Œè¦ä½¿ç”¨<a href="https://www.w3schools.com/w3css/">W3.CSSæ¡†æ¶</a>ï¼Œå¯ä»¥è¿™æ ·æŒ‡å®šï¼š<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;requirements&quot;: [&quot;https://www.w3schools.com/w3css/4/w3.css&quot;]</span><br></pre></td></tr></table></figure><br>å¦‚æœurlä¸ä»¥<code>.css</code>ç»“å°¾ï¼Œåˆ™éœ€è¦åœ¨å…¶å‰é¢åŠ ä¸Š<code>css:</code>ï¼Œä¾‹å¦‚ï¼š<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;requirements&quot;: [&quot;css:https://fonts.googleapis.com/icon?family=Material+Icons&quot;]</span><br></pre></td></tr></table></figure><br>ImJoyåœ¨è¿™ä¸ª<a href="https://github.com/imjoy-team/static.imjoy.io">GitHubä»“åº“</a>ä¸­æ‰˜ç®¡å¸¸ç”¨çš„åº“ã€‚å¯ä»¥ä½¿ç”¨ç®€å•çš„urlæ¥å¼•ç”¨åœ¨<code>docs</code>æ–‡ä»¶å¤¹ä¸­çš„æ‰€æœ‰æ–‡ä»¶ï¼š<code>https://static.imjoy.io</code> + <code>RelativePathInDocs</code>ã€‚<br>ä¾‹å¦‚ï¼Œåœ¨æ–‡ä»¶å¤¹<code>static.imjoy.io/docs/js/</code>ä¸­çš„æ–‡ä»¶<code>FileSaver.js</code>å¯ä»¥è¿™æ ·å¼•ç”¨ï¼š<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;requirements&quot;: [&quot;https://static.imjoy.io/js/FileSaver.js&quot;]</span><br></pre></td></tr></table></figure><br>å¦‚æœurlä¸ä»¥<code>.js</code>ç»“å°¾ï¼Œåˆ™éœ€è¦åœ¨å…¶å‰é¢åŠ ä¸Š<code>js:</code>ï¼Œä¾‹å¦‚ï¼š<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;requirements&quot;: [&quot;js:https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@0.11.2&quot;]</span><br></pre></td></tr></table></figure><br>å¯¹äºç¦»çº¿è®¿é—®çš„åœºæ™¯ï¼ŒJavascriptå’ŒCSSæ–‡ä»¶åœ¨è¢«æ·»åŠ åˆ°<code>requirements</code>åä¼šè¢«è‡ªåŠ¨ç¼“å­˜ã€‚<br>è¿˜å¯ä»¥ä½¿ç”¨ <code>cache:</code> å‰ç¼€å°†å…¶ä»–èµ„æºï¼ˆä¾‹å¦‚å›¾åƒã€å­—ä½“æ–‡ä»¶ï¼‰æ·»åŠ åˆ°ç¦»çº¿ç¼“å­˜ä¸­ï¼Œä¾‹å¦‚ï¼š<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;requirements&quot;: [&quot;cache:https://use.fontawesome.com/releases/v5.8.2/webfonts/fa-solid-900.woff2&quot;]</span><br></pre></td></tr></table></figure><br>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç¦»çº¿ç¼“å­˜è¿‡ç¨‹ä¸ä¼šè·Ÿè¸ªæ‰€ä¾èµ–çš„èµ„æºï¼Œéœ€è¦æ‰‹åŠ¨å°†å®ƒä»¬æ·»åŠ ä¸ºä¾èµ–åæ‰èƒ½ç¼“å­˜ã€‚<br>åœ¨<code>script</code>æ ‡ç­¾ä¸­å¯¼å…¥ ES æ¨¡å—æ—¶ï¼ˆä½¿ç”¨ <code>type=&quot;module&quot;</code>ï¼‰ï¼Œå»ºè®®åœ¨ <code>requirements</code> ä¸­æ˜ç¡®æ·»åŠ  es æ¨¡å—çš„ URLï¼Œå¹¶åœ¨ URL å‰åŠ ä¸Š <code>cache:</code> å‰ç¼€ã€‚è¿™å°†å…è®¸ ImJoy ç¼“å­˜åŠ¨æ€è„šæœ¬ä»¥ä¾›ç¦»çº¿ä½¿ç”¨ã€‚</p><h2 id="Web-Pythonæ’ä»¶"><a href="#Web-Pythonæ’ä»¶" class="headerlink" title="Web Pythonæ’ä»¶"></a>Web Pythonæ’ä»¶</h2><p>å¯ä»¥ä½¿ç”¨æ‰€éœ€ Python æ¨¡å—çš„å­—ç¬¦ä¸²åˆ—è¡¨æ¥æŒ‡å®šä¾èµ–ã€‚ä¾‹å¦‚ï¼Œ<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;requirements&quot;: [&quot;numpy&quot;, &quot;matplotlib&quot;]</span><br></pre></td></tr></table></figure><br>é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™äº›åŒ…æ˜¯ä»ImJoyå¼€å‘è€…åœ¨<a href="https://github.com/imjoy-team/static.imjoy.io/tree/master/docs/pyodide">è¯¥Githubä»“åº“</a>ä¸Šçš„é™æ€æ‰˜ç®¡åŠ è½½çš„ã€‚ç‰¹åˆ«åœ°ï¼Œå¯¹äº <code>scipy</code>ï¼Œéœ€è¦åŒ…å«ä¸€ä¸ªç»å¯¹è·¯å¾„çš„urlï¼š<br><code>&quot;requirements&quot;: [&quot;https://alpha.iodide.app/pyodide-0.10.0/scipy.js&quot;]</code>ã€‚<br>å¦‚æœæƒ³å¯¼å…¥é¢å¤–çš„ js æ–‡ä»¶ï¼Œéœ€è¦åœ¨ javascript url ä¹‹å‰ä½¿ç”¨ <code>js:</code> å‰ç¼€ã€‚<br>æ³¨æ„ï¼Œ<code>web-python</code>æ’ä»¶æ˜¯åŸºäº<a href="https://github.com/iodide-project/pyodide/">pyodide</a>çš„ï¼Œç›®å‰è¯¥æŠ€æœ¯åªæ”¯æŒæœ‰é™æ•°é‡çš„ python æ¨¡å—ã€‚</p><h2 id="Native-Pythonæ’ä»¶"><a href="#Native-Pythonæ’ä»¶" class="headerlink" title="Native Pythonæ’ä»¶"></a>Native Pythonæ’ä»¶</h2><p>ä¹Ÿæ˜¯é€šè¿‡ä¸€ä¸ªå­—ç¬¦ä¸²åˆ—è¡¨æ¥æŒ‡å®šä¾èµ–ï¼Œç„¶åæ·»åŠ ä¸€ä¸ªå‰ç¼€ç”¨äºæŒ‡å®šä¾èµ–çš„ç±»å‹ï¼š<code>conda:</code>ã€<code>pip:</code>å’Œ<code>repo:</code>ã€‚<br>ä¸€èˆ¬è¯­æ³•æ˜¯<code>&quot;requirements&quot;: [&quot;prefix:requirementToInstall&quot;]</code>ã€‚<br>ä¸‹è¡¨åˆ—å‡ºæ‰€æœ‰æ”¯æŒçš„ä¾èµ–ã€ImJoyå®é™…æ‰§è¡Œçš„å‘½ä»¤ï¼Œä»¥åŠç›¸åº”çš„ä¾‹å­ã€‚</p><div class="table-container"><table><thead><tr><th>Prefix</th><th>Command</th><th>Example</th></tr></thead><tbody><tr><td><code>conda</code></td><td><code>conda install -y</code></td><td><code>&quot;conda:scipy==1.0&quot;</code></td></tr><tr><td><code>pip</code></td><td><code>pip install</code></td><td><code>&quot;pip:scipy==1.0&quot;</code></td></tr><tr><td><code>repo</code></td><td><code>git clone</code> (new repo) <br> <code>git pull</code> (existing repo)</td><td><code>&quot;repo:https://github.com/userName/myRepo&quot;</code></td></tr><tr><td><code>cmd</code></td><td>Any other command</td><td><code>&quot;cmd:pip install -r myRepo/requirements.txt&quot;</code></td></tr></tbody></table></div><p>ä¸€äº›æ³¨æ„ç‚¹ï¼š<br>ï¼ˆ1ï¼‰å¦‚æœæ²¡æœ‰ä½¿ç”¨å‰ç¼€ï¼Œé‚£ä¹ˆä¾èµ–å°†è¢«è§†ä¸º<code>pip</code>åº“ã€‚<br>   <figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;requirements&quot;: [&quot;numpy&quot;, &quot;scipy==1.0&quot;]</span><br></pre></td></tr></table></figure><br>ï¼ˆ2ï¼‰å¦‚æœé€šè¿‡<code>env</code>å­—æ®µå®šä¹‰äº†ä¸€ä¸ªè™šæ‹Ÿç¯å¢ƒï¼Œé‚£ä¹ˆæ‰€æœ‰<code>pip</code>å’Œ<code>conda</code> è½¯ä»¶åŒ…å°†å®‰è£…åˆ°æ­¤ç¯å¢ƒä¸­ã€‚æ›´å¤šçš„ä¿¡æ¯å°†åœ¨ä¸‹é¢çš„â€œè™šæ‹Ÿç¯å¢ƒâ€ä¸€èŠ‚è¿›è¡Œä»‹ç»ã€‚<br>ï¼ˆ3ï¼‰å¯ä»¥ç›´æ¥åœ¨ä¸€ä¸ªå‰ç¼€åä»¥ä¸€ä¸ªå­—ç¬¦ä¸²çš„å½¢å¼åˆ—å‡ºå¤šä¸ªä¾èµ–ï¼š<br>   <figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;requirements&quot;: [&quot;conda:numpy scipy==1.0&quot;]</span><br></pre></td></tr></table></figure><br>æˆ–åœ¨ä¸€ä¸ªåˆ—è¡¨ä¸­å•ç‹¬æŒ‡å®šå‰ç¼€ï¼š<br>   <figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;requirements&quot;: [&quot;conda:numpy&quot;, &quot;conda:scipy==1.0&quot;]</span><br></pre></td></tr></table></figure><br>ï¼ˆ4ï¼‰ä¸åŒçš„ä¾èµ–ç±»å‹å¯ä»¥åˆå¹¶ä¸ºä¸€ä¸ªåˆ—è¡¨ï¼š<br>   <figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;requirements&quot;: [&quot;conda:numpy&quot;, &quot;pip:scipy==1.0&quot;, &quot;repo:https://github.com/userName/myRepo&quot;]</span><br></pre></td></tr></table></figure></p><h3 id="ä»GitHubå®‰è£…PythonåŒ…"><a href="#ä»GitHubå®‰è£…PythonåŒ…" class="headerlink" title="ä»GitHubå®‰è£…PythonåŒ…"></a>ä»GitHubå®‰è£…PythonåŒ…</h3><p>å¦‚æœæƒ³å¼•ç”¨çš„pythonæ¨¡å—æœ‰ä¸€ä¸ªå¯ç”¨çš„ <code>setup.py</code> æ–‡ä»¶ï¼Œåˆ™å¯ä»¥ç›´æ¥ä» Github ä½¿ç”¨å®ƒï¼Œè€Œæ— éœ€ä¸Šä¼ åˆ° Python Package Index (<a href="https://pypi.org">PyPI</a>)ã€‚æ–¹æ³•æ˜¯æŒ‰ç…§ä¸‹é¢çš„ PyPI æ ¼å¼æä¾›githubä»“åº“çš„URLã€‚<a href="https://packaging.python.org/tutorials/packaging-projects/">è¿™ä¸ªé“¾æ¥</a>å¯¹è¿™ä¸ªæ–¹æ³•æœ‰è¯¦ç»†è§£é‡Šã€‚<br>é€šç”¨è¯­æ³•å¦‚ä¸‹æ‰€ç¤ºï¼Œå‚æ•°ä»¥â€œ{}â€è¡¨ç¤ºï¼š<br> <figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;requirements&quot;: [&quot;pip:git+https://github.com/&#123;username&#125;/&#123;reponame&#125;@&#123;tagname&#125;#egg=&#123;reponame&#125;&quot;]</span><br></pre></td></tr></table></figure><br>è¯­æ³• <code>&quot;pip:git+https...&quot;</code> è¢« ImJoy ç¿»è¯‘æˆå‘½ä»¤ <code>pip install git+https...</code>ï¼Œè¯¥å‘½ä»¤å…è®¸ç›´æ¥ä»Gitå®‰è£…pythonåŒ…ï¼Œå³<a href="https://pip.pypa.io/en/stable/topics/vcs-support/">pip install from GIT</a>ã€‚<br>å¿…é¡»æŒ‡å®šä»¥ä¸‹å‚æ•°ï¼š<br>ï¼ˆ1ï¼‰<code>username</code>ï¼šGitHub å¸æˆ·çš„åç§°ã€‚<br>ï¼ˆ2ï¼‰<code>reponame</code>ï¼šGitHub å­˜å‚¨åº“çš„åç§°ã€‚<br>ï¼ˆ3ï¼‰<code>tagname</code>ï¼šå¯ä»¥åŠ ä¸Šæ ‡ç­¾ã€‚è¿™ä¸ªå‚æ•°å¯ä»¥æ˜¯ä¸€ä¸ªcommitçš„hash tagï¼Œä¸€ä¸ª<a href="https://git-scm.com/book/en/v2/Git-Basics-Tagging">Git tag</a>ï¼Œæˆ–<a href="https://help.github.com/articles/creating-releases/">GitHub release</a>ã€‚è¯¥å‚æ•°å¯ä»¥ç²¾ç¡®åœ°é€‰æ‹©ä»“åº“çš„ç‰ˆæœ¬ã€‚<br>ï¼ˆ4ï¼‰<code>eggname</code>ï¼šè¿™é€šå¸¸æ˜¯ä»“åº“çš„åç§°ã€‚è¿™ä¸ªå‚æ•°ä¼šå‘Šè¯‰pipè¿›è¡Œä¾èµ–é¡¹æ£€æŸ¥ã€‚<br>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸€æ—¦å®‰è£…äº†è½¯ä»¶åŒ…ï¼Œå®ƒå°†ä¸ä¼šè¢«å‡çº§ï¼Œé™¤éæŒ‡å®šä¸€ä¸ªæ–°æ ‡ç­¾ã€‚æœ‰å…³çš„å®Œæ•´è¯´æ˜ï¼Œè¯·å‚é˜… <a href="https://pip.pypa.io/en/latest/reference/pip_install/#git">pip æ–‡æ¡£</a>ã€‚<br>æµ‹è¯•èµ·è§çš„è¯ï¼Œå¯ä»¥åœ¨ç»ˆç«¯ä½¿ç”¨<code>pip</code>å‘½ä»¤åŠ ä¸Šä¸Šé¢æŒ‡å®šçš„å‚æ•°ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install git+https://github.com/&#123;username&#125;/&#123;reponame&#125;@&#123;tagname&#125;<span class="comment">#egg=&#123;reponame&#125;</span></span><br></pre></td></tr></table></figure></p><h2 id="æ’ä»¶ä¾èµ–çš„å…¸å‹åœºæ™¯"><a href="#æ’ä»¶ä¾èµ–çš„å…¸å‹åœºæ™¯" class="headerlink" title="æ’ä»¶ä¾èµ–çš„å…¸å‹åœºæ™¯"></a>æ’ä»¶ä¾èµ–çš„å…¸å‹åœºæ™¯</h2><p>ä»¥ä¸‹æè¿°äº†æ·»åŠ ä¾èµ–æ—¶çš„å…¸å‹åœºæ™¯ã€‚</p><h3 id="pipåº“"><a href="#pipåº“" class="headerlink" title="pipåº“"></a>pipåº“</h3><p>æƒ³æ·»åŠ çš„python æ¨¡å—åœ¨ pip ä»“åº“ï¼ˆ<code>pip.pypa.io</code>ï¼‰ä¸­ï¼Œæ­¤æ—¶éå¸¸ç®€å•ï¼Œå°†è¯¥pythonæ¨¡å—çš„ pip åç§°æ·»åŠ åˆ° <code>requirements</code> ä¸­å³å¯ï¼Œä¹Ÿå¯ä»¥æ·»åŠ ç‰ˆæœ¬å·ã€‚<br>ä¾‹å¦‚ï¼Œè¦æ·»åŠ  <code>scipy</code>çš„1.0 ç‰ˆæœ¬ï¼Œå¯ä»¥æŒ‡å®š<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;requirements&quot;: [&quot;pip:scipy==1.0&quot;]</span><br></pre></td></tr></table></figure></p><h3 id="å¸¦æœ‰-setup-py-çš„ä»“åº“"><a href="#å¸¦æœ‰-setup-py-çš„ä»“åº“" class="headerlink" title="å¸¦æœ‰ setup.py çš„ä»“åº“"></a>å¸¦æœ‰ <code>setup.py</code> çš„ä»“åº“</h3><p>å½“pythonåŒ…ä¸­å­˜åœ¨<code>setup.py</code> æ—¶ï¼Œ<code>pip</code> å‘½ä»¤å¯ä»¥ä» GitHub ä»“åº“å®‰è£…åŒ…åŠå…¶ä¾èµ–é¡¹ã€‚<br>ä¾‹å¦‚ï¼šå¸æˆ· <code>myUserName</code>åœ¨GitHubä¸Šæ‰˜ç®¡äº†<code>myRepo</code>ä»“åº“ï¼Œå…¶æœ€æ–°çš„ Git æ ‡ç­¾æ˜¯â€œv0.1.1â€ã€‚ç„¶åå¯ä»¥è¿™æ ·æ·»åŠ ï¼š<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;requirements&quot;: &quot;pip:git+https://github.com/myUserName/myRepo@v0.1.1#egg=myRepo&quot;</span><br></pre></td></tr></table></figure></p><h3 id="å¸¦æœ‰-requirements-txt-çš„ä»“åº“"><a href="#å¸¦æœ‰-requirements-txt-çš„ä»“åº“" class="headerlink" title="å¸¦æœ‰ requirements.txt çš„ä»“åº“"></a>å¸¦æœ‰ <code>requirements.txt</code> çš„ä»“åº“</h3><p>æ–‡ä»¶<code>requirements.txt</code>ä¸­åˆ—å‡ºäº†æŸä¸ªpythonåº“æ‰€ä¾èµ–çš„æ‰€æœ‰è½¯ä»¶åŒ…åŠå…¶ç‰ˆæœ¬ã€‚æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… <a href="https://pip.pypa.io/en/stable/user_guide/#requirements-files">æ­¤å¤„</a>ã€‚<br>ä¸‹é¢è¿™ä¸ªä¾‹å­ç»™å‡ºäº†å¦‚ä½•å¼•å…¥è¿™ç§å¸¦<code>requirements.txt</code>çš„pythonåº“ã€‚<br>æ¯”å¦‚ï¼Œå¸æˆ· <code>myUserName</code>æœ‰ä¸€ä¸ªGitHub ä»“åº“ <code>myRepo</code> ï¼Œå°†æ­¤ä»“åº“æ·»åŠ åˆ°æ’ä»¶å·¥ä½œåŒºï¼Œå¹¶å®‰è£…ä¾èµ–ï¼š<br> <figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;requirements&quot;: [&quot;repo:https://github.com/myUserName/myRepo&quot;, &quot;cmd: pip install -r myRepo/requirements.txt&quot;]</span><br></pre></td></tr></table></figure><br>ç„¶åï¼Œåœ¨è‡ªå·±è¦ç¼–å†™çš„ Python æ’ä»¶ä¸­ï¼Œå¯ä»¥å°†ä¸Šè¿°è·¯å¾„æ·»åŠ åˆ° Python ç³»ç»Ÿè·¯å¾„ä¸­ï¼Œè¿™æ ·å°±å¯ä»¥å¯¼å…¥æƒ³è¦çš„åº“ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sys.path.insert(<span class="number">0</span>, <span class="string">&#x27;./myRepo&#x27;</span>)</span><br><span class="line"><span class="keyword">from</span>  ... <span class="keyword">import</span> ...</span><br></pre></td></tr></table></figure></p><h3 id="å¸¦æœ‰-environment-yml-çš„ä»“åº“"><a href="#å¸¦æœ‰-environment-yml-çš„ä»“åº“" class="headerlink" title="å¸¦æœ‰ environment.yml çš„ä»“åº“"></a>å¸¦æœ‰ <code>environment.yml</code> çš„ä»“åº“</h3><p>yaml æ–‡ä»¶ <code>environment.yml</code> å®šä¹‰äº†ä¸€ä¸ªå¸¦æœ‰ conda å’Œ pip ä¾èµ–å…³ç³»çš„è™šæ‹Ÿç¯å¢ƒã€‚è¯¦ç»†çš„æ–‡ä»¶æ ¼å¼æè¿°å¯ä»¥åœ¨<a href="https://conda.io/projects/conda/en/latest/user-guide/tasks/manage-environments.html#create-env-file-manually">è¿™é‡Œ</a>æ‰¾åˆ°ã€‚<br>ä»ç„¶æ˜¯ä¸Šé¢çš„ä¾‹å­ï¼šå¸æˆ· <code>myUserName</code>æœ‰ä¸€ä¸ªGitHub ä»“åº“ <code>myRepo</code>ï¼Œå¯ä»¥è¿™æ ·æ·»åŠ ï¼š<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;requirements&quot;: [&quot;repo:https://github.com/myUserName/myRepo&quot;]</span><br></pre></td></tr></table></figure><br>å¹¶åœ¨<code>env</code>å­—æ®µä¸­å®‰è£…è™šæ‹Ÿç¯å¢ƒï¼š<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;env&quot;: [&quot;conda env create -f myRepo/environment.yml&quot;]</span><br></pre></td></tr></table></figure></p><h3 id="æ‰˜ç®¡åœ¨Dropboxä¸Šçš„ä»“åº“"><a href="#æ‰˜ç®¡åœ¨Dropboxä¸Šçš„ä»“åº“" class="headerlink" title="æ‰˜ç®¡åœ¨Dropboxä¸Šçš„ä»“åº“"></a>æ‰˜ç®¡åœ¨Dropboxä¸Šçš„ä»“åº“</h3><p>è¿˜å¯ä»¥åœ¨ dropbox ä¸Šæ‰˜ç®¡ä»£ç ï¼ˆä»¥åŠæ•°æ®ï¼‰å¹¶é€šè¿‡https è¯·æ±‚æ¥å®‰è£…å®ƒã€‚ä¸è¿‡å›½å†…ç”¨æˆ·åŸºæœ¬ç”¨ä¸åˆ°è¿™ç§åœºæ™¯ã€‚</p><h2 id="è™šæ‹Ÿç¯å¢ƒ"><a href="#è™šæ‹Ÿç¯å¢ƒ" class="headerlink" title="è™šæ‹Ÿç¯å¢ƒ"></a>è™šæ‹Ÿç¯å¢ƒ</h2><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¥è‡ªImJoyçš„Pythonæ’ä»¶å°†åœ¨é»˜è®¤çš„condaç¯å¢ƒä¸­æ‰§è¡Œã€‚ç„¶è€Œï¼Œè¿™äº›æ’ä»¶ä¹Ÿå¯ä»¥å…·æœ‰ç‰¹å®šçš„è™šæ‹Ÿcondaç¯å¢ƒï¼Œè¿™æä¾›äº†ä¸€ç§éš”ç¦»æ’ä»¶çš„æ–¹æ³•ã€‚è¿™æ ·ä¸€æ¥ï¼Œå°±å¯ä»¥ä½¿ç”¨ä¸åŒç‰ˆæœ¬çš„Pythonè¿è¡Œå®ƒä»¬ï¼Œæˆ–è€…ä½¿ç”¨ä¸åŒçš„condaæˆ–pipåŒ…ã€‚<br>å»ºè®®æ¯ä¸ªæ’ä»¶åŠä¸åŒçš„æ ‡ç­¾ä½¿ç”¨ç‹¬è‡ªçš„è™šæ‹Ÿç¯å¢ƒä»¥ä¿è¯ç¨³å®šæ€§ã€‚è¿›ä¸€æ­¥åœ°ï¼Œå»ºè®®ä¸ºpythonã€pipå’ŒcondaåŒ…æŒ‡å®šå®Œæ•´ç‰ˆæœ¬å·(X.X.X)ã€‚é€šè¿‡æŒ‡å®šå®Œæ•´ç‰ˆæœ¬ï¼Œcondaå°†å°è¯•è·¨è™šæ‹Ÿç¯å¢ƒé‡ç”¨ç›¸åŒç‰ˆæœ¬ï¼ˆå’Œpythonç‰ˆæœ¬ï¼‰çš„åŒ…ï¼Œä»è€Œå‡å°‘æ‰€éœ€çš„ç£ç›˜ç©ºé—´ã€‚<br>ä¾‹å¦‚ï¼Œä»¥ä¸‹ä¸¤ä¸ªç¯å¢ƒå°†é‡ç”¨æŒ‡å®šçš„ scipy åŒ…ï¼Œä½†ä¸ä¼šé‡ç”¨ numpy åŒ…ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">conda create -n test_env1 python&#x3D;3.6.8 scipy&#x3D;1.1.0 numpy&#x3D;1.16.1</span><br><span class="line">conda create -n test_env2 python&#x3D;3.6.8 scipy&#x3D;1.1.0 numpy&#x3D;1.15.4</span><br></pre></td></tr></table></figure><br>ä¸ºäº†åœ¨ç‰¹å®šçš„ conda ç¯å¢ƒä¸­è¿è¡Œæ’ä»¶ï¼Œå¯ä»¥é€šè¿‡åœ¨æ’ä»¶çš„ <code>&lt;config&gt;</code> éƒ¨åˆ†è®¾ç½® <code>env</code> å­—æ®µæ¥æŒ‡å®šå®ƒã€‚<br><code>env</code> å¯ä»¥æ˜¯å­—ç¬¦ä¸²æˆ–æ•°ç»„ã€‚åœ¨ä¸€è¡Œä¸­éœ€è¦æ‰§è¡Œå¤šä¸ªå‘½ä»¤æ—¶ï¼Œéœ€è¦ä½¿ç”¨ <code>&amp;&amp;</code> æˆ– <code>||</code>ï¼ˆæ³¨æ„æ“ä½œç³»ç»Ÿçš„å·®åˆ«ï¼‰ã€‚å¦‚æœæœ‰å¤šä¸ªç›¸äº’ç‹¬ç«‹çš„å‘½ä»¤ï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸ªæ•°ç»„æ¥å­˜å‚¨è¿™äº›å‘½ä»¤ã€‚ä¾‹å¦‚ï¼š<br><code>&quot;env&quot;: [&quot;export CUDA_VISIBLE_DEVICES=1&quot;, &quot;conda create -n XXXXX python=3.7&quot;]</code>ã€‚<br>è¿˜å¯ä»¥ç›´æ¥ä»â€œenvironment.ymlâ€æ–‡ä»¶åˆ›å»ºç¯å¢ƒï¼Œä¾‹å¦‚<br><code>&quot;env&quot;: &quot;conda env create -f ANNA-PALM/environment.yml&quot;</code>ã€‚<br>æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…ä¸“ç”¨çš„ <a href="https://conda.io/projects/conda/en/latest/user-guide/tasks/manage-environments.html#creating-an-environment-from-an-environment-yml-file">conda å¸®åŠ©é¡µé¢</a>ã€‚</p><h1 id="æ’ä»¶å¼€å‘"><a href="#æ’ä»¶å¼€å‘" class="headerlink" title="æ’ä»¶å¼€å‘"></a>æ’ä»¶å¼€å‘</h1><p>é…ç½®å¥½æ’ä»¶çš„å±æ€§åŠä¾èµ–åï¼Œæœ€é‡è¦çš„éƒ¨åˆ†æ˜¯åœ¨ <code>&lt;script&gt;</code> å—ä¸­ç¼–å†™å®é™…çš„æ’ä»¶ä»£ç ã€‚<br>ImJoyçš„æ’ä»¶ç³»ç»Ÿå»ºç«‹åœ¨è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼ˆRPCï¼‰ä¹‹ä¸Šï¼Œä½¿ç”¨ä¸€å¥—ç¼–ç å’Œè§£ç æ–¹æ¡ˆåœ¨æ’ä»¶ä¹‹é—´ä¼ è¾“æ•°æ®å’ŒåŠŸèƒ½ã€‚ImJoyå¼€å‘è€…å¼€å‘å‡ºäº†ä¸€ç»„ API å‡½æ•°ï¼ˆç§°ä¸º<code>ImJoy APIs</code>ï¼‰ï¼Œä»¥ä¾¿æ’ä»¶ä¸ä¸»åº”ç”¨ç¨‹åºä»¥åŠæ’ä»¶å½¼æ­¤ä¹‹é—´è¿›è¡Œäº¤äº’ã€‚<br>ä»»ä½• ImJoy æ’ä»¶éƒ½å¯ä»¥é€šè¿‡åä¸º<code>api</code>çš„é¢„å®šä¹‰å¯¹è±¡è®¿é—®<code>ImJoy APIs</code>ã€‚<a href="https://imjoy.io/docs/#/api">ImJoy API å‡½æ•°</a> è¿™ä¸€éƒ¨åˆ†å±•ç¤ºäº†è¿™äº›APIå¯ç”¨çš„å®Œæ•´åˆ—è¡¨ï¼ˆç¨åçš„åšå®¢ä¼šè¯¦ç»†ä»‹ç»ï¼‰ã€‚</p><h2 id="å¯¼å‡ºæ’ä»¶å‡½æ•°"><a href="#å¯¼å‡ºæ’ä»¶å‡½æ•°" class="headerlink" title="å¯¼å‡ºæ’ä»¶å‡½æ•°"></a>å¯¼å‡ºæ’ä»¶å‡½æ•°</h2><p>æ¯ä¸ªæ’ä»¶éƒ½éœ€è¦å¯¼å‡ºä¸€ä¸ªå¸¦æœ‰ä¸€ç»„å‡½æ•°çš„æ’ä»¶å¯¹è±¡ï¼Œè¿™äº›å‡½æ•°å°†è¢«æ³¨å†Œä¸ºæ’ä»¶ API å‡½æ•°ï¼ˆä¹Ÿç§°ä¸º<code>Plugin APIs</code>ï¼‰ã€‚è¿™æ˜¯é€šè¿‡åœ¨æ’ä»¶ä»£ç æœ«å°¾è°ƒç”¨<code>api.export</code>æ¥å®Œæˆçš„ã€‚ä¸€æ—¦å¯¼å‡ºï¼Œè¿™äº›å‡½æ•°å°±å¯ä»¥åœ¨ ImJoy ä¸­æ³¨å†Œï¼Œå¹¶ä¸”å¯ä»¥ç”±ç”¨æˆ·ä» ImJoy ç”¨æˆ·ç•Œé¢æˆ–å…¶ä»–æ’ä»¶è°ƒç”¨ã€‚é‡è¦çš„æ˜¯ï¼Œ<code>setup</code> å’Œ <code>run</code> æ˜¯ä¸¤ä¸ªå¿…é¡»è¢«å®šä¹‰å’Œå¯¼å‡ºçš„æ’ä»¶ API å‡½æ•°ã€‚</p><h2 id="å›è°ƒå‡½æ•°"><a href="#å›è°ƒå‡½æ•°" class="headerlink" title="å›è°ƒå‡½æ•°"></a>å›è°ƒå‡½æ•°</h2><p>æœªå¯¼å‡ºä¸º<code>Plugin API</code> å‡½æ•°çš„æ’ä»¶å‡½æ•°ï¼Œå¯ä»¥ä½œä¸ºå¯¹è±¡objectå‘é€ç»™å¦ä¸€ä¸ªæ’ä»¶æˆ– ImJoyä¸»ç¨‹åºã€‚è¿™äº›å‡½æ•°å°†è¢«è§†ä¸ºä¸€ä¸ªâ€œå›è°ƒâ€å‡½æ•°å¹¶ä¸”åªèƒ½è¢«è°ƒç”¨ä¸€æ¬¡ã€‚<br>ä¸€ä¸ªå…¸å‹çš„ä¾‹å­æ˜¯é€šçŸ¥å‡½æ•°ï¼Œå®ƒå¯ä»¥å‘Šè¯‰è°ƒç”¨å®ƒçš„æ’ä»¶â€è®¡ç®—å·²å®Œæˆâ€œã€‚è¿™æ ·çš„åŠŸèƒ½å¿…é¡»åªè°ƒç”¨ä¸€æ¬¡ã€‚</p><h2 id="æ’ä»¶èœå•"><a href="#æ’ä»¶èœå•" class="headerlink" title="æ’ä»¶èœå•"></a>æ’ä»¶èœå•</h2><p>å¤§å¤šæ•°æ’ä»¶éƒ½å¯ä»¥ä»æ’ä»¶èœå•è®¿é—®ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå½“ç”¨æˆ·å•å‡»æ’ä»¶èœå•ä¸­çš„æ’ä»¶åç§°æ—¶ï¼Œå°†è°ƒç”¨ <code>run</code> å‡½æ•°ã€‚åœ¨æ’ä»¶ï¼ˆæˆ–<code>op</code>ï¼Œä¸‹é¢ä¼šè¯¦è¿°ï¼‰çš„æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå®ƒå¯ä»¥ä»å®ƒçš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼ˆé€šå¸¸å‘½åä¸º<code>ctx</code>ï¼‰ä¸­è®¿é—®ä¸åŒçš„å­—æ®µï¼š<br>ï¼ˆ1ï¼‰<code>ctx.config</code>ï¼šGUI ä¸­ä½¿ç”¨ <code>ui</code> å­—æ®µå®šä¹‰çš„æ•°å€¼ï¼ˆæ¥è‡ªæ’ä»¶æ–‡ä»¶çš„<code>&lt;config&gt;</code> å—æˆ–æ¥è‡ªå•ç‹¬çš„æ“ä½œ<code>api.register</code>ï¼Œæ›´å¤šä¿¡æ¯å¦‚ä¸‹ï¼‰ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ åœ¨æ’ä»¶<code>&lt;config&gt;</code>ä¸­å®šä¹‰äº†ä¸€ä¸ªuiå­—ç¬¦ä¸²ï¼ˆä¾‹å¦‚<code>&quot;ui&quot;: &quot;option &#123;id: &#39;opt1&#39;, type: &#39;number&#39;&#125;&quot;</code>ï¼‰ï¼Œä½ å¯ä»¥é€šè¿‡<code>ctx.config.opt1</code>è®¿é—®å®ƒã€‚<br>ï¼ˆ2ï¼‰<code>ctx.data</code>ï¼šå®ƒå­˜å‚¨æ¥è‡ªå½“å‰æ´»åŠ¨çª—å£çš„æ•°æ®å’Œè¿è¡Œæ’ä»¶çš„çŠ¶æ€ã€‚è¯·æ³¨æ„ï¼Œä»…å½“æ•°æ®ä¸æ’ä»¶æˆ– op å®šä¹‰çš„ <code>inputs</code>å­—æ®µçš„ json æ¨¡æ¿è¯­æ³•åŒ¹é…æ—¶ï¼Œæ‰ä¼šå°†å…¶ä¼ é€’ç»™æ’ä»¶ã€‚æ¯”å¦‚æ‹–æ‹½è¿›æ¥åç¼€ä¸ºpngçš„æ–‡ä»¶æ—¶ï¼Œå®ƒä¼šåŒ¹é…åœ¨<code>inputs</code>å­—æ®µå®šä¹‰äº†pngæ ¼å¼çš„æ’ä»¶ï¼Œç„¶åè¯¥æ–‡ä»¶å°±ä¼ ç»™è¯¥æ’ä»¶è¿›è¡Œå¤„ç†ã€‚<br>ï¼ˆ3ï¼‰<code>ctx._variables</code>ï¼šå½“æ’ä»¶åœ¨å·¥ä½œæµä¸­æ‰§è¡Œæ—¶ï¼Œå·¥ä½œæµä¸­è®¾ç½®çš„å˜é‡å°†ä½œä¸º <code>ctx._variables</code> ä¼ é€’ã€‚å¦‚æœç”¨æˆ·ä½¿ç”¨è¯¸å¦‚â€œSet [number]â€ä¹‹ç±»çš„æ“ä½œï¼Œå®ƒå°†è¢«è®¾ç½®ä¸ºå®é™…å˜é‡å€¼ã€‚</p><p>ç»“æœå¯ä»¥ç›´æ¥è¢«è¿”å›ï¼Œå®ƒä»¬å°†æ˜¾ç¤ºä¸ºé€šç”¨ç»“æœçª—å£ã€‚å¦‚æœæƒ³å¯¹ç»“æœå®šä¹‰ç‰¹å®šçš„çª—å£ç±»å‹ï¼Œå¯ä»¥è¿”å›ä¸€ä¸ªè‡³å°‘æœ‰ä¸¤ä¸ªå­—æ®µ <code>type</code> å’Œ <code>data</code> çš„å¯¹è±¡ã€‚ImJoy å°†ä½¿ç”¨ <code>type</code> æ¥æŸ¥æ‰¾ç”¨äºæ¸²æŸ“å­˜å‚¨åœ¨ <code>data</code> ä¸­çš„ç»“æœçš„çª—å£ã€‚<br>åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œæ¥è‡ª url çš„å›¾åƒå°†æ˜¾ç¤ºåœ¨å›¾åƒçª—å£ä¸­æˆ–ä¼ é€’ç»™å·¥ä½œæµä¸­çš„ä¸‹ä¸€ä¸ªæ“ä½œã€‚<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> &#123; <span class="string">&quot;type&quot;</span>: <span class="string">&quot;imjoy/image&quot;</span>, <span class="string">&quot;data&quot;</span>: &#123;<span class="string">&quot;src&quot;</span>: <span class="string">&quot;https://imjoy.io/static/img/imjoy-icon.png&quot;</span>&#125; &#125;</span><br></pre></td></tr></table></figure><br>ImJoy ä½¿ç”¨ postMessage åœ¨æ’ä»¶ä¹‹é—´äº¤æ¢æ•°æ®ã€‚è¿™æ„å‘³ç€å¯¹äº JavaScriptæ’ä»¶ï¼Œå¯¹è±¡åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­è¢«å¤åˆ¶ã€‚å¦‚æœäº¤æ¢çš„æ•°æ®ç‰¹åˆ«å¤§ï¼Œé‚£ä¹ˆåˆ›å»ºçš„å¯¹è±¡å°±ä¸åº”è¯¥ç›´æ¥ä¼ è¾“ã€‚è¦å¯ç”¨è¿™ç§æ¨¡å¼ï¼Œå¯ä»¥åœ¨è¿”å›å¯¹è±¡æ—¶å°† <code>_transfer=true</code> æ·»åŠ åˆ°å¯¹è±¡ä¸­ã€‚åœ¨ä¸Šé¢ä¾‹å­ä¸­ï¼Œå¯ä»¥åœ¨è¿”å› <code>ctx</code> æ—¶è®¾ç½® <code>ctx._transfer = true</code>ã€‚ç„¶è€Œï¼Œå®ƒä¼šåªåŠ é€Ÿ <code>ArrayBuffers</code> æˆ– <code>ArrayBufferViews</code> çš„ä¼ è¾“ï¼ˆä»¥åŠndarrays ç”± Python ç”Ÿæˆï¼‰ï¼Œä¼ è¾“å®Œæ¯•åï¼Œå°†æ— æ³•è®¿é—®å®ƒã€‚<br>(æ³¨æ„ï¼šåœ¨Pythonä¸­ï¼Œ<code>ctx</code>çš„æ•°æ®ç±»å‹æ˜¯å­—å…¸ï¼ŒImJoyæ·»åŠ äº†å…è®¸ç‚¹è¡¨ç¤ºæ³•çš„æ¥å£ï¼Œå°±åƒåœ¨JavaScriptä¸­ä¸€æ ·ã€‚å¦‚æœæ„¿æ„ï¼Œä¹Ÿå¯ä»¥åœ¨ä¸¤ç§è¯­è¨€ä¸­ä½¿ç”¨<code>[]</code>è®¿é—®å­—å…¸æˆ–å¯¹è±¡ã€‚ï¼‰</p><h2 id="æ’ä»¶æ“ä½œç¬¦ï¼ˆæ“ä½œï¼‰"><a href="#æ’ä»¶æ“ä½œç¬¦ï¼ˆæ“ä½œï¼‰" class="headerlink" title="æ’ä»¶æ“ä½œç¬¦ï¼ˆæ“ä½œï¼‰"></a>æ’ä»¶æ“ä½œç¬¦ï¼ˆæ“ä½œï¼‰</h2><p>å¯ä»¥ä½¿ç”¨ Plugin API ä¸ºæ’ä»¶å®šä¹‰ç‹¬ç«‹çš„è¿ç®—ç¬¦ï¼ˆæˆ– <code>ops</code>ï¼‰ï¼ˆæœ‰å…³è¯¦ç»†ä¿¡æ¯å¯å‚è€ƒapi.registerï¼‰ã€‚è¿™äº›<code>ops</code> çš„å®šä¹‰æ–¹å¼ä¸<code>&lt;config&gt;</code>å—ç±»ä¼¼ï¼šå¯ä»¥å®šä¹‰ä¸€ä¸ªæ¥å£æ¥è®¾ç½®å‚æ•°ï¼Œå®ƒæœ‰ä¸€ä¸ªä¸“é—¨çš„è¿è¡ŒåŠŸèƒ½ã€‚å½“æŒ‰ä¸‹æ’ä»¶åˆ—è¡¨ä¸­çš„å‘ä¸‹ç®­å¤´æŒ‰é’®æ—¶ï¼Œä¼šæ˜¾ç¤ºè¿™äº›ä¸åŒçš„æ“ä½œ<code>ops</code>ã€‚</p><h2 id="æ•°æ®äº¤æ¢"><a href="#æ•°æ®äº¤æ¢" class="headerlink" title="æ•°æ®äº¤æ¢"></a>æ•°æ®äº¤æ¢</h2><h3 id="åŠ è½½-ä¿å­˜æ–‡ä»¶"><a href="#åŠ è½½-ä¿å­˜æ–‡ä»¶" class="headerlink" title="åŠ è½½/ä¿å­˜æ–‡ä»¶"></a>åŠ è½½/ä¿å­˜æ–‡ä»¶</h3><p>åœ¨ ImJoy ä¸­å¯ä»¥ä»¥ä¸åŒæ–¹å¼è®¿é—®å­˜å‚¨åœ¨æ–‡ä»¶ç³»ç»Ÿä¸Šçš„æ–‡ä»¶ã€‚<br>ä¸€æ–¹é¢ï¼Œåœ¨æ²¡æœ‰æ’ä»¶å¼•æ“çš„æƒ…å†µä¸‹ï¼Œè‹¥æƒ³è®¿é—®æœ¬åœ°æ–‡ä»¶ï¼Œç”¨æˆ·éœ€è¦æ‰“å¼€æˆ–æ‹–åŠ¨æ–‡ä»¶å¯¼å…¥ImJoyï¼Œå¯¹äºç»“æœæ–‡ä»¶åˆ™åªèƒ½é€šè¿‡è§¦å‘ä¸‹è½½æ¥ä¿å­˜ã€‚<br>å¦ä¸€æ–¹é¢ï¼Œæ’ä»¶å¼•æ“æ‹¥æœ‰å¯¹æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿçš„å®Œå…¨è®¿é—®æƒé™ï¼Œnative python æ’ä»¶å¯ä»¥ç›´æ¥ä»æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿè¯»å–å’Œå†™å…¥ã€‚<br><img src="https://user-images.githubusercontent.com/6218739/144711988-32c6ef87-129a-4942-a5b8-2a0bb1185085.png" alt="data-access"></p><p>å› æ­¤ï¼ŒImJoyæä¾›äº†å‡ ç§ä¸åŒçš„æ–¹æ³•æ¥å¤„ç†æ’ä»¶çš„åŠ è½½/ä¿å­˜æ–‡ä»¶ï¼š<br>ï¼ˆ1ï¼‰å¦‚æœPlugin Engineæ­£åœ¨è¿è¡Œï¼Œé‚£ä¹ˆå¯¹äºæ‰€æœ‰ç±»å‹æ’ä»¶ï¼Œæœ‰ 3 ä¸ªapiå‡½æ•°å¯ä»¥è®¿é—®æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿï¼š<code>api.showFileDialog</code>ã€<code>api.getFileUrl</code>ã€<code>api.requestUploadUrl</code>ã€‚ç‰¹åˆ«åœ°ï¼Œå¯¹äºåœ¨æ’ä»¶å¼•æ“ä¸Šè¿è¡Œçš„Pythonæ’ä»¶ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨æ ‡å‡†çš„ python æ–‡ä»¶æ“ä½œæ¥å°†æ–‡ä»¶åŠ è½½æˆ–å†™å…¥æ–‡ä»¶ç³»ç»Ÿã€‚<br>ï¼ˆ2ï¼‰å¦‚æœPlugin Engineæœªè¿è¡Œï¼ŒJavaScriptæˆ–Web Python æ’ä»¶è®¿é—®æ–‡ä»¶çš„å”¯ä¸€é€”å¾„æ˜¯è¦æ±‚ç”¨æˆ·å°†æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹ç›´æ¥æ‹–åˆ° ImJoy å·¥ä½œåŒºä¸­ã€‚è¿™å°†å‘ˆç°ä¸€ä¸ªåŒ…å«æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹å†…å®¹çš„çª—å£ã€‚ç„¶åè¿™äº›æ•°æ®å¯ä»¥è¢«æ’ä»¶è®¿é—®å¹¶è¿›è¡Œå¤„ç†ã€‚è¦å°†ç»“æœå¯¼å‡ºä¸ºæ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨<code>api.exportFile</code> å‡½æ•°æ¥è§¦å‘ä¸‹è½½ã€‚<br>ä¸é€šè¿‡æ’ä»¶å¼•æ“è¿è¡Œçš„æ’ä»¶ç›¸æ¯”ï¼Œåœ¨æµè§ˆå™¨ä¸­è¿è¡Œçš„webæ’ä»¶æ— æ³•ç›´æ¥è®¿é—®æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿï¼Œå› æ­¤å®ƒä»¬æä¾›æ¯” <code>native-python</code> æ’ä»¶æ›´é«˜çš„å®‰å…¨æ€§ã€‚</p><h3 id="é€šè¿‡å‡½æ•°è°ƒç”¨æ¥äº¤æ¢æ•°æ®"><a href="#é€šè¿‡å‡½æ•°è°ƒç”¨æ¥äº¤æ¢æ•°æ®" class="headerlink" title="é€šè¿‡å‡½æ•°è°ƒç”¨æ¥äº¤æ¢æ•°æ®"></a>é€šè¿‡å‡½æ•°è°ƒç”¨æ¥äº¤æ¢æ•°æ®</h3><p>å¯¹äºè¿è¡Œæ—¶ç”Ÿæˆçš„å°‘é‡æ•°æ®ï¼ˆä¾‹å¦‚ï¼šæ•°ç»„ã€å¯¹è±¡ç­‰ï¼‰ï¼Œå¯ä»¥å°†æ•°æ®å¯¹è±¡ä½œä¸ºå‚æ•°ä¼ é€’ç»™APIå‡½æ•°ï¼ˆæˆ–è€…ä»APIå‡½æ•°è¿”å›æ•°æ®å¯¹è±¡ï¼‰ï¼Œä»è€Œå°†å®ƒä»¬å‘é€åˆ°å¦ä¸€ä¸ªæ’ä»¶ã€‚<br>ä¾‹å¦‚ï¼Œå¯ä»¥å°†åŒ…å«å°å‹numpyæ•°ç»„ã€å­—ç¬¦ä¸²ã€å­—èŠ‚çš„æ•°æ®ï¼ˆ<10MBï¼‰ä»è¿œç¨‹æ’ä»¶å¼•æ“ä¸­è¿è¡Œçš„`native-python`æ’ä»¶ç›´æ¥å‘é€åˆ°åœ¨æµè§ˆå™¨ä¸­è¿è¡Œçš„`window`æ’ä»¶ã€‚ä¸ºäº†å¿«é€Ÿæ˜¾ç¤ºå°å›¾åƒï¼Œè¿˜å¯ä»¥å°†å…¶ä¿å­˜ä¸º png æ ¼å¼å¹¶å°†å…¶ç¼–ç ä¸º base64 å­—ç¬¦ä¸²ï¼Œç„¶åå¯ä»¥ä½¿ç”¨æ ‡å‡†çš„ HTML `ã€Šimg>` æ ‡ç­¾ç›´æ¥æ˜¾ç¤ºã€‚<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;output.png&quot;</span>, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    data = f.read()</span><br><span class="line">    result = base64.b64encode(data).decode(<span class="string">&#x27;ascii&#x27;</span>)</span><br><span class="line">    imgurl = <span class="string">&#x27;data:image/png;base64,&#x27;</span> + result</span><br><span class="line">    api.createWindow(name=<span class="string">&#x27;unet prediction&#x27;</span>, <span class="built_in">type</span>=<span class="string">&#x27;imjoy/image&#x27;</span>, w=<span class="number">7</span>, h=<span class="number">7</span>, data= &#123;<span class="string">&quot;src&quot;</span>: imgurl&#125;)</span><br></pre></td></tr></table></figure></p><h3 id="é€šè¿‡çª—å£ä¼ é€’æ•°æ®"><a href="#é€šè¿‡çª—å£ä¼ é€’æ•°æ®" class="headerlink" title="é€šè¿‡çª—å£ä¼ é€’æ•°æ®"></a>é€šè¿‡çª—å£ä¼ é€’æ•°æ®</h3><p>ImJoyä¸­æ˜¾ç¤ºçš„çª—å£å¯ä»¥åŒ…å«æ•°æ®ï¼Œä¾‹å¦‚å›¾åƒï¼Œå› æ­¤æ‚¨å¯ä»¥å°†çª—å£ç”¨ä½œå°†æ•°æ®ä»ä¸€ä¸ªæ’ä»¶ä¼ é€’åˆ°å¦ä¸€ä¸ªæ’ä»¶çš„ä¸€ç§æ–¹å¼ã€‚<br>é€‰æ‹©æ­¤ç±»çª—å£å¹¶æ‰§è¡Œæ’ä»¶æ—¶ï¼ˆé€šè¿‡å•å‡»æ’ä»¶èœå•ï¼‰ï¼Œæ‰€åŒ…å«çš„æ•°æ®å°†è¢«ä¼ é€åˆ°è¯¥æ’ä»¶ã€‚<br>é‡è¦çš„æ˜¯ï¼Œå¦‚æœçª—å£ä¸­åŒ…å«çš„æ•°æ®å¯¹è±¡åŒ¹é…æŸæ’ä»¶çš„ <code>&lt;config&gt;</code> ä¸­ <code>inputs</code> å®šä¹‰çš„ json æ¨¡å¼ï¼ŒImJoy å°±ä¼šå°†çª—å£ä¸­åŒ…å«çš„æ•°æ®ä¼ é€’ç»™è¯¥æ’ä»¶ã€‚ç„¶åæ’ä»¶å¯ä»¥é€šè¿‡è®¿é—® <code>ctx.data</code> æ¥å¤„ç†æ•°æ®ï¼ˆé€šå¸¸åœ¨ <code>run</code> å‡½æ•°å†…ï¼‰ã€‚<br>ImJoy åŸç”Ÿæ”¯æŒ Numpy æ•°ç»„å’ŒTensorFlowå¼ é‡çš„è½¬æ¢å’Œä¼ è¾“ã€‚æ’ä»¶å¼€å‘äººå‘˜å¯ä»¥ç›´æ¥ä½¿ç”¨è¿™äº›æ•°æ®ç±»å‹å¹¶åœ¨æ’ä»¶ä¹‹é—´è¿›è¡Œäº¤æ¢ï¼Œè€Œä¸ç”¨ç®¡å®ƒä»¬æ˜¯åœ¨ Python è¿˜æ˜¯ JavaScript ä¸­ã€‚</p><h3 id="å¤„ç†å¤§æ•°æ®é‡"><a href="#å¤„ç†å¤§æ•°æ®é‡" class="headerlink" title="å¤„ç†å¤§æ•°æ®é‡"></a>å¤„ç†å¤§æ•°æ®é‡</h3><p>å¯¹äºå¤§æ•°æ®é‡ï¼Œä¸€ç§æ–¹å¼æ˜¯ä»¥è¾ƒå°çš„å—chunksæ¥å‘é€å¤§æ–‡ä»¶ï¼Œä½†è¿™ä¸æ˜¯æœ€ä½³çš„ï¼Œå¹¶ä¸”å¯èƒ½ä¼šé˜»ç¢å¼•æ“å’ŒImJoyåº”ç”¨ç¨‹åºä¹‹é—´çš„æ­£å¸¸é€šä¿¡ã€‚å»ºè®®å°†æ•°æ®å­˜å‚¨åœ¨ç£ç›˜ä¸Šï¼ˆä¾‹å¦‚åœ¨å·¥ä½œåŒºç›®å½•ä¸­ï¼‰ï¼Œç„¶åä½¿ç”¨<code>api.getFileUrl</code> ç”Ÿæˆè®¿é—®æ–‡ä»¶çš„ urlã€‚ç„¶åå¯ä»¥å°†ç”Ÿæˆçš„ url å‘é€åˆ° Web åº”ç”¨ç¨‹åºï¼Œå¹¶é€šè¿‡ä¸‹è½½é“¾æ¥æˆ–ä½¿ç”¨ JavaScript åº“ï¼ˆå¦‚â€œaxiosâ€ï¼‰è¿›è¡Œè®¿é—®ã€‚å¾ˆå¤šåº“å¦‚ Three.jsã€Vega ç­‰éƒ½å¯ä»¥ç›´æ¥é€šè¿‡ url åŠ è½½æ–‡ä»¶ã€‚</p><h2 id="å·¥ä½œæµç®¡ç†"><a href="#å·¥ä½œæµç®¡ç†" class="headerlink" title="å·¥ä½œæµç®¡ç†"></a>å·¥ä½œæµç®¡ç†</h2><p>ImJoyåœ¨ <code>ctx</code> ä¸­æä¾›äº†é¢å¤–çš„å­—æ®µï¼Œå…è®¸è·Ÿè¸ªã€ç»´æŠ¤å’Œé‡å»ºæ•´ä¸ªåˆ†æå·¥ä½œæµç¨‹ã€‚<br>ï¼ˆ1ï¼‰<code>ctx._op</code>ï¼šç»™å‡ºæ­£åœ¨æ‰§è¡Œçš„æ“ä½œçš„åç§°ã€‚å½“ä¸€ä¸ªæ’ä»¶æ³¨å†Œäº†å¤šä¸ª op å¹¶ä¸”æ²¡æœ‰ä¸º op æŒ‡å®šå›è°ƒå‡½æ•°æ—¶ï¼Œ<code>run</code> å‡½æ•°å°†è¢«è°ƒç”¨ï¼Œå¯ä»¥ä½¿ç”¨ <code>ctx._op</code> æ¥ç¡®å®šæ­£åœ¨æ‰§è¡Œå“ªä¸ª opã€‚<br>ï¼ˆ2ï¼‰<code>ctx._source_op</code>ï¼šç»™å‡ºå¯åŠ¨å½“å‰åŠ¨ä½œçš„opçš„åç§°ã€‚<br>ï¼ˆ3ï¼‰<code>ctx._workflow_id</code>ï¼šå½“æ’ä»¶åœ¨å·¥ä½œæµä¸­æ‰§è¡Œæ—¶ï¼Œå®ƒçš„ id å°†è¢«ä¼ é€’åˆ°è¿™é‡Œã€‚å½“æ’ä»¶ä»æ’ä»¶èœå•æ‰§è¡Œæ—¶ï¼ŒImJoy å°†å°è¯•é‡ç”¨å½“å‰æ´»åŠ¨çª—å£ä¸­çš„å·¥ä½œæµ idï¼Œå¦‚æœæ²¡æœ‰çª—å£å¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œåˆ™ä¼šåˆ†é…ä¸€ä¸ªæ–°çš„å·¥ä½œæµ idã€‚æ‰€æœ‰å…·æœ‰ç›¸åŒ <code>_workflow_id</code> çš„æ•°æ®çª—å£åœ¨ç®¡é“æˆ–è®¡ç®—å›¾ä¸­è™šæ‹Ÿè¿æ¥ã€‚é‡è¦çš„æ˜¯ï¼Œé€šè¿‡å°† <code>_workflow_id</code> ä¸ <code>_op</code> å’Œ <code>_source_op</code> ç»“åˆèµ·æ¥ï¼Œ<code>_workflow_id</code>ã€<code>_variables</code>ã€<code>_op</code> å’Œ<code>_source_op</code> å¯ç”¨äºå®ç°æ’ä»¶ä¹‹é—´çš„äº¤äº’ï¼Œè¿™æ„å‘³ç€å¦‚æœç”¨æˆ·åœ¨ç»“æœçª—å£ä¸­æ›´æ”¹äº†çŠ¶æ€ï¼Œä¸‹æ¸¸å·¥ä½œæµå°†è‡ªåŠ¨æ›´æ–°ã€‚</p><h2 id="Native-Pythonæ’ä»¶çš„æ‰§è¡Œæ ‡å¿—"><a href="#Native-Pythonæ’ä»¶çš„æ‰§è¡Œæ ‡å¿—" class="headerlink" title="Native Pythonæ’ä»¶çš„æ‰§è¡Œæ ‡å¿—"></a>Native Pythonæ’ä»¶çš„æ‰§è¡Œæ ‡å¿—</h2><p>å¯ä»¥ä½¿ç”¨ <code>&lt;config&gt;</code> å—ä¸­çš„ <code>flags</code> å­—æ®µæ¥æ§åˆ¶ Python æ’ä»¶è¿›ç¨‹çš„æ‰§è¡Œã€‚æ¥ä¸‹æ¥ï¼Œå°†è§£é‡Šæ’ä»¶å¼•æ“ä¸Šè¿è¡Œçš„ Python è¿›ç¨‹å¦‚ä½•ä¸ ImJoy ç•Œé¢äº¤äº’ã€‚<br><img src="https://user-images.githubusercontent.com/6218739/144712604-1b9ba517-ea26-424f-ac87-9a5ffb2e98f1.png" alt="python-process"><br>ä¸Šå›¾ä¸­çš„å‡ ä¸ªæ¦‚å¿µï¼š</p><ul><li>Interfaceï¼šImJoy çš„webç•Œé¢ã€‚å¯ä»¥åœ¨å¤šä¸ªæµè§ˆå™¨çª—å£ï¼ˆå³å¤šä¸ªç•Œé¢ï¼‰ä¸Šè¿è¡Œ ImJoyã€‚</li><li>Plugin Engineï¼šåœ¨åå°è¿è¡Œä»¥æ‰§è¡Œæ¥è‡ªä¸åŒ Python æ’ä»¶çš„ Python ä»£ç ã€‚</li><li>Python Pluginï¼šåŒ…å« Python ä»£ç çš„æ’ä»¶ã€‚ä¸€äº›æ’ä»¶å¯èƒ½æœ‰<code>tags</code>æ¥è¿›ä¸€æ­¥æŒ‡å®šå®ƒä»¬çš„æ‰§è¡Œç»†èŠ‚ã€‚</li><li>Python Processï¼šåœ¨æ’ä»¶å¼•æ“ä¸Šè¿è¡Œçš„ç‰¹å®š Python æ’ä»¶ã€‚è¿›ç¨‹å¯ä»¥åœ¨ä»»åŠ¡ç®¡ç†å™¨ä¸Šçœ‹åˆ°ã€‚</li><li>Workspaceï¼šå·²å®‰è£…çš„ ImJoy æ’ä»¶çš„é›†åˆã€‚å¯¹äºå¸¦æœ‰<code>tags</code> çš„æ’ä»¶ï¼Œç”¨æˆ·é€‰æ‹©åˆé€‚çš„æ ‡ç­¾ã€‚å·¥ä½œåŒºä¸­çš„æ¯ä¸ª Python æ’ä»¶éƒ½æœ‰è‡ªå·±çš„è¿›ç¨‹ã€‚æ¯ä¸ªå·¥ä½œåŒºéƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„åç§°ã€‚</li><li>ImJoy instanceï¼šæ˜¯åœ¨ä¸€ä¸ª ImJoy ç•Œé¢ä¸­è¿è¡Œçš„å·¥ä½œåŒºã€‚</li></ul><p>ä¸‹é¢å°†ä»‹ç»æ§åˆ¶pythonæ’ä»¶æ‰§è¡Œçš„ä¸‰ä¸ªæ‰§è¡Œæ ‡å¿—ï¼š</p><ul><li>é»˜è®¤ï¼ˆæ²¡æœ‰è®¾ç½®ä»»ä½•æ ‡å¿—ï¼‰ï¼šæ¯ä¸ª ImJoy å®ä¾‹åœ¨æ’ä»¶å¼•æ“ä¸Šéƒ½æœ‰è‡ªå·±çš„è¿›ç¨‹ã€‚å¦‚æœå…³é—­è¯¥ç•Œé¢ï¼Œåˆ™ä¼šç»ˆæ­¢è¯¥è¿›ç¨‹ã€‚</li><li><code>single-instance</code>ï¼šè¯¥æ ‡å¿—å°†åªå…è®¸ä¸€ä¸ªè¿›ç¨‹ä¸ºæ•´ä¸ªæ’ä»¶å¼•æ“è¿è¡Œã€‚å¯¹äºå…·æœ‰ç›¸åŒåç§°å’Œæ ‡ç­¾çš„æ’ä»¶ï¼Œé‚£ä¹ˆ<code>single-instance</code> æ„å‘³ç€å®ƒä»¬è®¿é—®ç›¸åŒçš„è¿›ç¨‹ã€‚</li><li><code>allow-detach</code>ï¼š è¯¥æ ‡å¿—è¡¨ç¤ºè¿›ç¨‹åœ¨å…¶ ImJoy å®ä¾‹å…³é—­æ—¶ä¸ä¼šè¢«ç»ˆæ­¢ã€‚ä¾‹å¦‚ï¼Œè¿™å…è®¸åœ¨åå°æ‰§è¡Œé•¿æ—¶é—´çš„è®¡ç®—ä»»åŠ¡ï¼Œè¿™äº›ä»»åŠ¡ä¸éœ€è¦é¢å¤–çš„ç”¨æˆ·åé¦ˆå¹¶è‡ªåŠ¨ç»ˆæ­¢ã€‚è¿˜å¯ç”¨äºä¿æŠ¤é•¿æ—¶é—´çš„è®¡ç®—ä»»åŠ¡å…å—æµè§ˆå™¨ä¸ç¨³å®šçš„å½±å“ã€‚å¦‚æœå¸Œæœ›èƒ½å¤Ÿé™„åŠ åˆ°åˆ†ç¦»çš„è¿›ç¨‹ï¼Œå¯ä»¥ä»ç›¸åŒçš„æµè§ˆå™¨å’Œå·¥ä½œåŒºé‡æ–°è¿æ¥ï¼Œæˆ–è€…ç»“åˆä½¿ç”¨ <code>single-instance</code> æ ‡å¿—ï¼Œè¿™æ ·å°½ç®¡ä»ä¸åŒçš„æµè§ˆå™¨å’Œå·¥ä½œåŒºè¿æ¥ï¼Œä»ç„¶èƒ½è¿æ¥åˆ°ä¹‹å‰çš„è¿›ç¨‹ã€‚</li></ul><p>å½“ ImJoy å°è¯•é‡æ–°è¿æ¥ä¹‹å‰åˆ†ç¦»çš„æ’ä»¶è¿›ç¨‹æ—¶ï¼Œå¦‚æœåœ¨æ’ä»¶ç±»ä¸­å®šä¹‰äº†<code>resume()</code>ï¼Œé‚£ä¹ˆ<code>resume()</code>å°†è¢«è°ƒç”¨ï¼Œå¦åˆ™åƒå¾€å¸¸ä¸€æ ·è°ƒç”¨<code>setup()</code>ã€‚è¯·æ³¨æ„ï¼Œå½“å­˜åœ¨<code>resume</code>æ—¶ï¼Œåœ¨é‡æ–°é™„åŠ æœŸé—´ä¸ä¼šè°ƒç”¨ <code>setup</code>ã€‚<br>è¿™æ˜¯ <code>flags</code> é€‰é¡¹åœ¨ <code>&lt;config&gt;</code> å—ä¸­çš„æ ·å­ï¼š<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;config lang=&quot;json&quot;&gt;</span><br><span class="line"></span><br><span class="line">  ...</span><br><span class="line">  &quot;flags&quot;: [&quot;single-instance&quot;, &quot;allow-detach&quot;],</span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">&lt;/config&gt;</span><br></pre></td></tr></table></figure><br><code>flags</code> ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>tags</code> è¿›è¡Œé…ç½®ï¼Œä¾‹å¦‚ï¼š<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;config lang=&quot;json&quot;&gt;</span><br><span class="line"></span><br><span class="line">  ...</span><br><span class="line">  &quot;tags&quot;: [&quot;Single&quot;, &quot;Multi&quot;],</span><br><span class="line">  &quot;flags&quot;: &#123;&quot;Single&quot;: [&quot;single-instance&quot;, &quot;allow-detach&quot;], &quot;Multi&quot;: []&#125;,</span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">&lt;/config&gt;</span><br></pre></td></tr></table></figure><br>ä¸Šé¢çš„ <code>&lt;config&gt;</code> å—å°†åˆ›å»ºä¸€ä¸ªå¸¦æœ‰ä¸¤ä¸ªæ ‡ç­¾ï¼ˆ<code>Single</code> å’Œ <code>Multi</code>ï¼‰çš„æ’ä»¶ã€‚åœ¨å®‰è£…æœŸé—´ï¼Œç”¨æˆ·å¯ä»¥é€‰æ‹©å¸Œæœ›ä½¿ç”¨å“ªç§è¿è¡Œæ—¶è¡Œä¸ºï¼ˆæ’ä»¶è¿›ç¨‹çš„å•ä¸ªå®ä¾‹ï¼ˆ<code>Single</code>ï¼‰ï¼Œæˆ–è€…åœ¨åŒä¸€ä¸ªå·¥ä½œåŒºæ‰“å¼€å¤šä¸ª ImJoy ç•Œé¢å¯¹åº”çš„å¤šæ’ä»¶è¿›ç¨‹ï¼ˆ<code>Multi</code>ï¼‰ï¼‰ã€‚</p><h1 id="æ„å»ºç”¨æˆ·ç•Œé¢"><a href="#æ„å»ºç”¨æˆ·ç•Œé¢" class="headerlink" title="æ„å»ºç”¨æˆ·ç•Œé¢"></a>æ„å»ºç”¨æˆ·ç•Œé¢</h1><p>ImJoyçš„ä¸€ä¸ªé‡è¦éƒ¨åˆ†æ˜¯æä¾›ä¸€ç§çµæ´»çš„æ–¹å¼ä¸ç”¨æˆ·äº¤äº’ï¼Œä»¥ä¸°å¯Œçš„äº¤äº’æ–¹å¼æŒ‡å®šè¾“å…¥ä¿¡æ¯æˆ–ç”Ÿæˆè¾“å‡ºã€‚<br>ImJoyè‡ªå¸¦æœ‰ä¸€ç»„åŸºæœ¬å…ƒç´ ï¼Œä¾‹å¦‚è¡¨å•å’Œè¿›åº¦æ¡ï¼Œå®ƒä»¬æä¾›äº†ä¸€ç§ä¸ç”¨æˆ·äº¤äº’çš„æ–¹å¼ã€‚<br>è¿˜å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰çª—å£æ„å»ºæ›´å…ˆè¿›å’Œå¼ºå¤§çš„ç”¨æˆ·ç•Œé¢ï¼Œå¼€å‘äººå‘˜å¯ä»¥åˆ©ç”¨åŸºäºWebçš„UIåº“æ¥ç”Ÿæˆæ§ä»¶ã€äº¤äº’å¼å›¾è¡¨æˆ–å‘ˆç° 3D è§†å›¾ã€‚</p><h2 id="åŸºæœ¬çš„ç”¨æˆ·è¾“å…¥å’Œè¾“å‡º"><a href="#åŸºæœ¬çš„ç”¨æˆ·è¾“å…¥å’Œè¾“å‡º" class="headerlink" title="åŸºæœ¬çš„ç”¨æˆ·è¾“å…¥å’Œè¾“å‡º"></a>åŸºæœ¬çš„ç”¨æˆ·è¾“å…¥å’Œè¾“å‡º</h2><p>è·å–ç”¨æˆ·è¾“å…¥çš„æœ€ç®€å•æ–¹æ³•æ˜¯ä½¿ç”¨ ImJoy ç”Ÿæˆçš„è¡¨å•ã€‚<br>å¯ä»¥åœ¨ <code>&lt;config&gt;</code> å—ä¸­å®šä¹‰ä¸€ä¸ª <code>gui</code> å­—ç¬¦ä¸²ï¼Œå®ƒå°†åœ¨æ’ä»¶èœå•ä¸‹å‘ˆç°ä¸ºè¡¨å•ã€‚å¦‚æœæ’ä»¶ä½¿ç”¨äº†å¤šä¸ªæ’ä»¶æ“ä½œopï¼ˆå°†åœ¨APIä¸€æ–‡ä¸­è§£æï¼‰ï¼Œè¿˜å¯ä»¥ä¸ºæ¯ä¸ªæ’ä»¶æ“ä½œå•ç‹¬æä¾›<code>gui</code>å­—ç¬¦ä¸²ã€‚<br>å½“ç”¨æˆ·é€šè¿‡æ’ä»¶èœå•è¿è¡Œæ’ä»¶æˆ– op æ—¶ï¼Œ<code>gui</code> å­—ç¬¦ä¸²ä¸­å®šä¹‰çš„æ‰€æœ‰å­—æ®µå€¼å°†è¢«åŒ…è£…ä¸º <code>config</code> å¯¹è±¡å¹¶ä¼ é€’åˆ° <code>run</code> å‡½æ•°ä¸­ã€‚ç„¶åå¯ä»¥é€šè¿‡ <code>ctx.config.FIELD_ID</code> è®¿é—®å®ƒä»¬ã€‚<br>å¯¹äºå…¶ä»–ç±»å‹çš„è¾“å…¥ï¼Œå¯ä»¥ä½¿ç”¨å…¶ä»–ImJoy APIï¼Œä¾‹å¦‚å¼¹å‡ºä¸€ä¸ªæ–‡ä»¶å¯¹è¯æ¡†<code>api.showFileDialog</code>ã€‚<br>ä¸ºäº†æ˜¾ç¤ºç»“æœæˆ–å‘ç”¨æˆ·æä¾›åé¦ˆï¼ŒImJoy æä¾›äº†å¤šä¸ª API å‡½æ•°æ¥æ˜¾ç¤ºç»“æœï¼Œä¾‹å¦‚ä½¿ç”¨<code>api.alert()</code>æˆ–<code>api.showMessage()</code>æ˜¾ç¤ºæ¶ˆæ¯ï¼Œä½¿ç”¨<code>api.log()</code>æˆ–<code>api.error()</code>è®°å½•æ¶ˆæ¯æˆ–é”™è¯¯ï¼Œä»¥åŠ<code>api.showProgress</code>è¡¨ç¤ºè¿›åº¦ã€<code>api.showStatus</code>æ›´æ–°ImJoyçŠ¶æ€ç­‰ã€‚è¿™äº›APIå‡½æ•°å°†åœ¨APIä¸€èŠ‚ä¸­è¯¦ç»†è§£æã€‚</p><h2 id="è‡ªå®šä¹‰çª—å£çš„ç”¨æˆ·è¾“å…¥å’Œè¾“å‡º"><a href="#è‡ªå®šä¹‰çª—å£çš„ç”¨æˆ·è¾“å…¥å’Œè¾“å‡º" class="headerlink" title="è‡ªå®šä¹‰çª—å£çš„ç”¨æˆ·è¾“å…¥å’Œè¾“å‡º"></a>è‡ªå®šä¹‰çª—å£çš„ç”¨æˆ·è¾“å…¥å’Œè¾“å‡º</h2><p>å¯¹äºæ›´çµæ´»çš„ç”¨æˆ·ç•Œé¢ï¼Œå¼€å‘è€…å¯ä»¥åˆ¶ä½œä¸“é—¨çš„çª—å£æ’ä»¶ã€‚ç”±äºæ˜¯åŸºäº<code>iframe</code>ï¼Œæ‰€ä»¥å¤§éƒ¨åˆ†å‰ç«¯ï¼ˆHTML/CSS/JSï¼‰æ¡†æ¶éƒ½å¯ä»¥åœ¨<code>window</code>æ’ä»¶ä¸­ä½¿ç”¨ã€‚æ­¤å¤–ï¼Œè¿™æ ·çš„æ¥å£å¯ä»¥ä¸å¦ä¸€ä¸ªæ’ä»¶é€šä¿¡ï¼Œä¾‹å¦‚æ‰§è¡Œå®é™…åˆ†æçš„ Python æ’ä»¶ã€‚<br>ä½¿ç”¨<code>window</code>æ’ä»¶æ¨¡æ¿å¯ä»¥è½»æ¾åˆ›å»ºè¿™æ ·çš„æ’ä»¶ã€‚é™¤äº†å…¶ä»–æ’ä»¶ä¹‹å¤–ï¼Œ<code>window</code>æ’ä»¶è¿˜æœ‰ä¸¤ä¸ªé¢å¤–çš„ä»£ç å—ï¼š<code>&lt;window&gt;</code> å’Œ<code>&lt;style&gt;</code>ã€‚ç”¨æˆ·å¯ä»¥å°†å‰ç«¯ä»£ç æ·»åŠ åˆ°ç›¸åº”çš„ä»£ç å—ä¸­ã€‚åˆ›å»ºåï¼Œè¿™ä¸ªæ–°çš„<code>window</code>æ’ä»¶å°†ç”¨ä½œæ¨¡æ¿æ¥åˆ›å»ºæ–°çš„çª—å£å®ä¾‹ã€‚<br>ImJoyæä¾›äº†ä¸¤ä¸ªAPIå‡½æ•°ï¼Œç”¨äºä»<code>window</code>æ’ä»¶åˆ›å»ºçª—å£<code>api.createWindow</code>æˆ–æ˜¾ç¤ºå¯¹è¯æ¡†<code>api.showDialog</code>ã€‚<br>é™¤æ­¤ä¹‹å¤–ï¼Œå¯¹äºå¸¸ç”¨çš„çª—å£ç±»å‹ï¼ŒImJoy æ”¯æŒä¸€ç»„å†…éƒ¨çª—å£ç±»å‹ï¼Œè¯¦è§<code>api.createWindow</code>è¿™ä¸ªAPIã€‚</p><h2 id="æ›´å¤šç¤ºä¾‹æ’ä»¶"><a href="#æ›´å¤šç¤ºä¾‹æ’ä»¶" class="headerlink" title="æ›´å¤šç¤ºä¾‹æ’ä»¶"></a>æ›´å¤šç¤ºä¾‹æ’ä»¶</h2><p>è¯·å‰å¾€<a href="https://imjoy.io/docs/#/demos">Demos</a>ã€‚</p><h1 id="æ‰˜ç®¡å’Œéƒ¨ç½²æ’ä»¶"><a href="#æ‰˜ç®¡å’Œéƒ¨ç½²æ’ä»¶" class="headerlink" title="æ‰˜ç®¡å’Œéƒ¨ç½²æ’ä»¶"></a>æ‰˜ç®¡å’Œéƒ¨ç½²æ’ä»¶</h1><p>è¿™ä¸€éƒ¨åˆ†æä¾›äº†æœ‰å…³å¦‚ä½•æ‰˜ç®¡æˆ–éƒ¨ç½² ImJoy æ’ä»¶çš„è¯¦ç»†ä¿¡æ¯ã€‚<br>è¿™åŒ…æ‹¬ä»å­˜å‚¨å•ä¸ªæ–‡ä»¶åˆ°è®¾ç½®å¼€å‘è€…è‡ªå·±çš„ ImJoy æ’ä»¶åº“ã€‚ç„¶åæ’ä»¶å¯ä»¥ç›´æ¥ä½œä¸ºæ–‡ä»¶åˆ†å‘æˆ–ä½¿ç”¨ä¸“ç”¨çš„ url è¯­æ³•ä»è€Œå…è®¸è‡ªåŠ¨å®‰è£…ã€‚<br>ImJoy æ’ä»¶çš„é»˜è®¤æ–¹å¼åŠæ¨èæ–¹å¼éƒ½æ˜¯éƒ¨ç½²åœ¨ GitHub ä¸Šï¼ˆæˆ–ä½œä¸ºå•ä¸ªæ–‡ä»¶æˆ–åœ¨æ’ä»¶ä»“åº“ä¸­ï¼‰ï¼Œç„¶åä½¿ç”¨æ’ä»¶ url åˆ†å‘ã€‚<br>è¿™é‡Œæ¨è GitHubï¼Œå› ä¸ºå®ƒæä¾›ç¨³å®šæ€§å’Œç‰ˆæœ¬æ§åˆ¶ï¼Œä¿è¯äº†é‡ç°æ€§å’Œå¯è¿½æº¯æ€§ã€‚</p><h2 id="æ‰˜ç®¡å•ä¸ªæ’ä»¶æ–‡ä»¶"><a href="#æ‰˜ç®¡å•ä¸ªæ’ä»¶æ–‡ä»¶" class="headerlink" title="æ‰˜ç®¡å•ä¸ªæ’ä»¶æ–‡ä»¶"></a>æ‰˜ç®¡å•ä¸ªæ’ä»¶æ–‡ä»¶</h2><p>è¿™æ˜¯å¼€å‘è¿‡ç¨‹ä¸­çš„å…¸å‹æ¡ˆä¾‹ã€‚<br>æ’ä»¶ä»£ç å¯ä»¥æ‰˜ç®¡åœ¨ç½‘ç»œä¸Šï¼Œä¾‹å¦‚GitHubã€Gist æˆ– Dropboxã€‚</p><h2 id="è‡ªå®šä¹‰çš„ImJoyæ’ä»¶åº“"><a href="#è‡ªå®šä¹‰çš„ImJoyæ’ä»¶åº“" class="headerlink" title="è‡ªå®šä¹‰çš„ImJoyæ’ä»¶åº“"></a>è‡ªå®šä¹‰çš„ImJoyæ’ä»¶åº“</h2><p>å¯ä»¥è½»æ¾åœ°ä¸ºç°æœ‰ GitHub é¡¹ç›®åˆ›å»º ImJoy æ’ä»¶ä»“åº“ã€‚<br>å¯ä»¥åœ¨ <a href="https://github.com/imjoy-team/imjoy-project-template">æ­¤å¤„</a> æ‰¾åˆ°æ¨¡æ¿é¡¹ç›®ã€‚<br>ç„¶åå°† ImJoy æ’ä»¶ä¿å­˜åœ¨ä¸€ä¸ªä¸“ç”¨æ–‡ä»¶å¤¹ä¸­ï¼Œå¹¶æ·»åŠ ä¸€ä¸ªæ¸…å•æ–‡ä»¶ <code>manifest.imjoy.json</code> åˆ° GitHub æ ¹æ–‡ä»¶å¤¹ã€‚<br>æ­¤æ¸…å•æŒ‡å®šäº†ä»“åº“ä¸­æœ‰å“ªäº›æ’ä»¶ï¼Œä»¥åŠåœ¨å“ªé‡Œå¯ä»¥æ‰¾åˆ°å®ƒä»¬ã€‚è¯¥æ–‡ä»¶çš„æ¶æ„å¦‚ä¸‹æ‰€ç¤ºï¼Œå®Œæ•´çš„æ¨¡æ¿å¯ä»¥åœ¨<a href="https://github.com/imjoy-team/imjoy-project-template/blob/master/manifest.imjoy.json">è¿™é‡Œ</a>æ‰¾åˆ°ã€‚<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"> <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;NAME OF THE REPOSITORY&quot;</span>,</span><br><span class="line"> <span class="attr">&quot;description&quot;</span>: <span class="string">&quot;DESCRIBE THE REPOSITORY&quot;</span>,</span><br><span class="line"> <span class="attr">&quot;version&quot;</span>: <span class="string">&quot;0.1.0&quot;</span>,</span><br><span class="line"> <span class="attr">&quot;uri_root&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"> <span class="attr">&quot;plugins&quot;</span>: [</span><br><span class="line">   <span class="comment">//copy and paste the &lt;config&gt; block of your plugin here</span></span><br><span class="line"> ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>ç„¶åå°±å¯ä»¥è‡ªåŠ¨æˆ–æ‰‹åŠ¨æ›´æ–°æ­¤æ¸…å•ï¼š<br>ï¼ˆ1ï¼‰å¯¹äºè‡ªåŠ¨æ›´æ–°ï¼ŒImJoyæä¾›äº†ä¸€ä¸ª<a href="https://github.com/imjoy-team/imjoy-project-template/blob/master/update_manifest.js">nodeè„šæœ¬</a>ã€‚æ­¤è„šæœ¬éœ€è¦æ‰§è¡Œnode.jsã€‚ç„¶ååœ¨åŒ…å«<code>manifest.imjoy.json</code>æ–‡ä»¶çš„æ ¹æ–‡ä»¶å¤¹ä¸­ä½¿ç”¨å‘½ä»¤ <code>node update_manifest.js</code> è¿è¡Œå®ƒï¼Œå®ƒä¼šè‡ªåŠ¨æœç´¢ImJoyæ’ä»¶åŠç”Ÿæˆæ¸…å•ã€‚è¯·æ³¨æ„ï¼Œå½“ç¬¬ä¸€æ¬¡ä½¿ç”¨æ­¤nodejsè„šæœ¬æ—¶ï¼Œå¿…é¡»æ‰‹åŠ¨æ›´æ”¹æ’ä»¶ä»“åº“çš„åç§°<code>name</code>ã€‚å¯¹äºåç»­æ›´æ–°ï¼Œè¯¥åç§°å°†ä¿æŒä¸å˜ã€‚<br>ï¼ˆ2ï¼‰å¯¹äºæ‰‹åŠ¨æ›´æ–°ï¼ŒæŒ‰ç…§ä¸‹åˆ—æ­¥éª¤æ“ä½œï¼š<br>ï¼ˆ2.1ï¼‰å°†æ‰€æœ‰æ’ä»¶æ–‡ä»¶æ”¾åœ¨ GitHub ä»“åº“ä¸­çš„ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸­ã€‚ä¾‹å¦‚ä¸€ä¸ªåä¸º<a href="https://github.com/imjoy-team/imjoy-project-template/tree/master/imjoy-plugins">imjoy-plugins</a>çš„æ–‡ä»¶å¤¹ã€‚<br>ï¼ˆ2.2ï¼‰ä¿®æ”¹<code>manifest.imjoy.json</code>ã€‚å¯¹äºæ¯ä¸ªæ’ä»¶ï¼š<br>ï¼ˆ2.2.1ï¼‰ä»æ’ä»¶ä»£ç ä¸­å¤åˆ¶å¹¶ç²˜è´´<code>&lt;config&gt;</code>å—çš„å†…å®¹åˆ° <code>manifest.imjoy.json</code> ä¸­çš„ <code>plugins</code> å—ã€‚<br>ï¼ˆ2.2.2ï¼‰æ·»åŠ ä¸€ä¸ªåä¸º<code>&quot;uri&quot;</code>çš„å­—æ®µï¼Œå¹¶å°†å€¼è®¾ç½®ä¸ºæ’ä»¶çš„å®é™…æ–‡ä»¶åï¼ŒåŒ…æ‹¬ GitHub ä»“åº“ä¸­çš„ç›¸å¯¹è·¯å¾„ã€‚ä¾‹å¦‚ï¼Œå¯¹äºä¸€ä¸ªåä¸ºâ€œuntitledPlugin.imjoy.htmlâ€çš„æ’ä»¶æ–‡ä»¶ï¼Œè®¾å®š<code>&quot;uri&quot;: &quot;imjoy-plugins/untitledPlugin.imjoy.html&quot;</code>ã€‚å¦‚æœä½ å°†æ’ä»¶çš„åå­—è®¾ä¸ºä¸æ’ä»¶æ–‡ä»¶çš„åå­—ç›¸åŒï¼Œåˆ™å¯ä»¥è·³è¿‡æ­¤æ­¥éª¤ã€‚<br>åœ¨ImJoyä¸­ï¼Œå¯ä»¥ä»¥ä¸€ä¸ªç®€å•çš„urlå½¢å¼<code>http://imjoy.io/#/app?repo=GITHUB_USER_NAME/REPO_NAME</code>å‘ˆç°ä»“åº“ä¸­æ‰€æœ‰æ’ä»¶çš„åˆ—è¡¨ï¼Œå…¶ä¸­<code>GITHUB_USER_NAME</code>æ˜¯ç”¨æˆ·åï¼Œ<code>REPO_NAME</code>æ˜¯åŒ…å« ImJoy æ’ä»¶çš„GitHubä»“åº“çš„åç§°ã€‚ç„¶åç”¨æˆ·å°±å¯ä»¥é€šè¿‡æ­¤åˆ—è¡¨æ¥å®‰è£…æ’ä»¶ã€‚æœ‰å…³å¦‚ä½•ç”Ÿæˆæ­¤ url çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œå¹¶æŸ¥çœ‹å¦‚ä½•å¯ä»¥å®‰è£…ç‰¹å®šçš„æ’ä»¶ï¼Œå¯ä»¥å‚é˜…ä¸‹é¢çš„ä¸“é—¨éƒ¨åˆ†ã€‚</p><h2 id="å®˜æ–¹ImJoyæ’ä»¶åº“"><a href="#å®˜æ–¹ImJoyæ’ä»¶åº“" class="headerlink" title="å®˜æ–¹ImJoyæ’ä»¶åº“"></a>å®˜æ–¹ImJoyæ’ä»¶åº“</h2><p><code>ImJoy.io</code> ä¸Šæ˜¾ç¤ºçš„ ImJoy æ’ä»¶åº“é€šè¿‡<a href="https://github.com/imjoy-team/imjoy-plugins">GitHub</a>éƒ¨ç½²ã€‚<br>ä¸ºäº†å°†å¼€å‘è€…è‡ªå·±çš„æ’ä»¶éƒ¨ç½²åˆ°<a href="https://github.com/imjoy-team/imjoy-plugins">è¯¥æ’ä»¶åº“</a>ï¼Œå¯ä»¥forkè¯¥åº“ï¼Œæ·»åŠ æ’ä»¶å¹¶å‘é€pull requestã€‚PRè¢«æ¥å—åï¼Œç”¨æˆ·å°†èƒ½å¤Ÿä»å®˜æ–¹çš„æ’ä»¶ä»“åº“å®‰è£…è¿™ä¸ªæ’ä»¶ã€‚</p><h1 id="åˆ†å‘æ’ä»¶"><a href="#åˆ†å‘æ’ä»¶" class="headerlink" title="åˆ†å‘æ’ä»¶"></a>åˆ†å‘æ’ä»¶</h1><p>è¦åˆ†å‘è‡ªå·±å¼€å‘çš„æ’ä»¶ï¼Œæœ‰ä¸¤ä¸ªä¸»è¦é€‰é¡¹ã€‚<br>ï¼ˆ1ï¼‰å¯ä»¥åˆ›å»ºä¸€ä¸ªå®Œæ•´çš„urlåœ°å€ã€‚å•å‡»æ—¶ï¼ŒImJoy å°†è‡ªåŠ¨æ‰“å¼€å¹¶å®‰è£…æ’ä»¶ã€‚æ­¤é“¾æ¥å¯ç›´æ¥é€šè¿‡ç”µå­é‚®ä»¶æˆ–ç¤¾äº¤ç½‘ç»œåˆ†äº«ã€‚åœ¨ä¸‹é¢å°†è¯¦ç»†è¯´æ˜å¦‚ä½•åˆ›å»ºæ­¤é“¾æ¥ä»¥åŠæ”¯æŒå“ªäº›é€‰é¡¹ã€‚<br>ï¼ˆ2ï¼‰å¯ä»¥ç›´æ¥å‘é€æ’ä»¶æ–‡ä»¶ï¼ˆæ‰©å±•å<code>*.imjoy.html</code>ï¼‰ã€‚è¿™ä¸ªæ–‡ä»¶å¯ä»¥è¢«æ‹–å…¥ImJoyå·¥ä½œåŒºï¼Œæ­¤æ—¶å®ƒä¼šè¢«è‡ªåŠ¨è¯†åˆ«ä¸ºæ’ä»¶ã€‚</p><h2 id="ä½¿ç”¨è‡ªå®šä¹‰åº“åˆ†å‘æ’ä»¶"><a href="#ä½¿ç”¨è‡ªå®šä¹‰åº“åˆ†å‘æ’ä»¶" class="headerlink" title="ä½¿ç”¨è‡ªå®šä¹‰åº“åˆ†å‘æ’ä»¶"></a>ä½¿ç”¨è‡ªå®šä¹‰åº“åˆ†å‘æ’ä»¶</h2><p>å¦‚æœå¼€å‘çš„æ’ä»¶ä¾èµ–äºéæ ‡å‡†åº“å’Œæ¨¡å—ï¼Œé‚£ä¹ˆå¼€å‘è€…å¿…é¡»éšç€æ’ä»¶ä¸€å—æä¾›è¿™äº›åº“ã€‚å¯ä»¥å°†è¿™äº›åº“å’Œæ¨¡å—ä¸Šä¼ åˆ° GitHub ä»“åº“ã€GitHub Gist æˆ–å…¶ä»–æ•°æ®å…±äº«å¹³å°ï¼ˆä¾‹å¦‚ Dropboxï¼‰å¹¶å°†å®ƒä»¬é“¾æ¥åˆ°æ’ä»¶ä»£ç ä¸­ã€‚<br>ï¼ˆ1ï¼‰å¯¹äºJavaScriptæ’ä»¶ï¼Œéœ€è¦åˆ›å»ºä¸€ä¸ª Gist æˆ– GitHubã€‚å°†æ’ä»¶ï¼ˆä»¥<code>.imjoy.html</code> ç»“å°¾ï¼‰æ–‡ä»¶ä¸å…¶ä»– JavaScript æ–‡ä»¶ä¸€èµ·ä¸Šä¼ ã€‚åœ¨æ’ä»¶æ–‡ä»¶ä¸­ï¼Œå¯ä»¥å°† url æ·»åŠ åˆ°æ’ä»¶ <code>requirements</code> ä¸­ã€‚ä½†æ˜¯ç”±äº GitHub é™åˆ¶ï¼Œä¸èƒ½ç›´æ¥ä½¿ç”¨ GitHub urlï¼Œä¸è¿‡å¯ä»¥ä½¿ç”¨ <a href="https://combinatronics.com/">combinatronics.com</a> è¿›è¡Œè½¬æ¢ã€‚<br>ï¼ˆ2ï¼‰å¯¹äºPythonæ’ä»¶ï¼Œå»ºè®®å°†è¿™äº›éæ ‡å‡†åº“æ‰“åŒ…ä¸º pip æ¨¡å—ï¼Œå¹¶æ”¾åœ¨GitHubä¸Šã€‚</p><h2 id="å­˜å‚¨åœ¨-Dropbox-ä¸Šçš„ä»£ç -æ•°æ®çš„åˆ†å‘"><a href="#å­˜å‚¨åœ¨-Dropbox-ä¸Šçš„ä»£ç -æ•°æ®çš„åˆ†å‘" class="headerlink" title="å­˜å‚¨åœ¨ Dropbox ä¸Šçš„ä»£ç /æ•°æ®çš„åˆ†å‘"></a>å­˜å‚¨åœ¨ Dropbox ä¸Šçš„ä»£ç /æ•°æ®çš„åˆ†å‘</h2><p>æ­¤ç¤ºä¾‹æè¿°äº†å¦‚ä½•éƒ¨ç½²å’Œåˆ†å‘å­˜å‚¨åœ¨ Dropbox ä¸Šçš„ Python æ’ä»¶ã€‚<br>è¿™å…è®¸å…±äº«ç§æœ‰é¡¹ç›®ã€‚<br>ï¼ˆ1ï¼‰å°†codeæˆ–dataä»¥ zip æ–‡ä»¶çš„å½¢å¼å­˜å‚¨åœ¨ Dropbox ä¸Šã€‚è¿™å…è®¸é€šè¿‡æ›¿æ¢ zip æ–‡ä»¶æ¥æ›¿æ¢ä»£ç /æ•°æ®ï¼ˆè¯·å‚é˜…ä¸‹é¢çš„æ³¨é‡Šï¼‰ã€‚<br>ï¼ˆ2ï¼‰å°†ImJoy æ’ä»¶æ–‡ä»¶ (<code>.imjoy.html</code>) ä½¿ç”¨ç§æœ‰æˆ–å…¬å¼€çš„gistæ‰˜ç®¡ã€‚<br>å‡è®¾ Python ä»£ç ä½äºå­˜å‚¨åœ¨ Dropbox ä¸Šçš„ Zip å­˜æ¡£<code>testcode.zip</code>ä¸­ï¼Œå¹¶ä¸”å¯é€šè¿‡é“¾æ¥â€œDROPBOXLINK/testcode.zipâ€è·å¾—ã€‚ç„¶åï¼Œå¯ä»¥å°†ä»¥ä¸‹ä»£ç ç‰‡æ®µæ”¾åœ¨æ’ä»¶çš„ <code>setup()</code> å‡½æ•°ä¸­ä»¥ä½¿å…¶å¯ç”¨ã€‚è¯¥ç‰‡æ®µæ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š<br>ï¼ˆ1ï¼‰æ‰§è¡Œ <a href="http://docs.python-requests.org">http è¯·æ±‚</a>ã€‚æ³¨æ„æ­¤è¯·æ±‚ä¸­çš„<code>dl=1</code>é€‰é¡¹ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ­¤å€¼è®¾ç½®ä¸º 0ã€‚<br>ï¼ˆ2ï¼‰ä½¿ç”¨è¿”å›çš„è¯·æ±‚å¯¹è±¡åœ¨æœ¬åœ°ç”Ÿæˆzipæ–‡ä»¶ï¼Œè§£å‹ï¼Œæœ€ååˆ é™¤ã€‚<br>ï¼ˆ3ï¼‰å°†æœ¬åœ°è·¯å¾„æ·»åŠ åˆ°ç³»ç»Ÿè·¯å¾„ä¸­ã€‚<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> zipfile</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;https://DROPBOXLINK/testcode.zip?dl=1&#x27;</span></span><br><span class="line">r = requests.get(url, allow_redirects=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># download the zip file</span></span><br><span class="line">name_zip = os.path.join(<span class="string">&#x27;.&#x27;</span>,<span class="string">&#x27;testcode.zip&#x27;</span>)</span><br><span class="line"><span class="built_in">open</span>(name_zip, <span class="string">&#x27;wb&#x27;</span>).write(r.content)</span><br><span class="line"></span><br><span class="line"><span class="comment"># extract to the current folder (i.e. workspace)</span></span><br><span class="line"><span class="keyword">with</span> zipfile.ZipFile(name_zip, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.extractall(<span class="string">&#x27;./&#x27;</span>)</span><br><span class="line">os.remove(name_zip)</span><br><span class="line"></span><br><span class="line"><span class="comment"># If you want to import your python modules, append the folder to sys.path</span></span><br><span class="line">sys.path.append(os.path.join(<span class="string">&#x27;.&#x27;</span>,<span class="string">&#x27;testcode&#x27;</span>))</span><br></pre></td></tr></table></figure><br>ä¸€äº›æ³¨æ„ç‚¹ï¼š<br>ï¼ˆ1ï¼‰ä»£ç æœ¬åœ°å­˜å‚¨åœ¨<code>USER_HOME/ImJoyWorkspace/WORKSPACENAME/testcode</code>ä¸­ï¼Œå…¶ä¸­WORKSPACENAMEä¸ºå½“å‰ImJoyå·¥ä½œç©ºé—´çš„åç§°ã€‚å¯ä»¥åœ¨æä¾›çš„ URL ä¸­è‡ªåŠ¨è®¾ç½®å·¥ä½œåŒºä»¥åˆ†å‘æ’ä»¶ã€‚<br>ï¼ˆ2ï¼‰æ›´æ–°zipå­˜æ¡£æ—¶ï¼Œä¸è¦åˆ é™¤æ—§çš„ï¼Œç”¨æ–°ç‰ˆæœ¬æ›¿æ¢å®ƒã€‚è¿™ä¿è¯äº†ç›¸åŒçš„é“¾æ¥æ˜¯æœ‰æ•ˆçš„ã€‚<br>ï¼ˆ3ï¼‰è¯¥ä»£ç æ¯æ¬¡éƒ½ä¼šå®‰è£…å½“å‰ç‰ˆæœ¬çš„ZIPæ’ä»¶ã€‚</p><h2 id="ç”Ÿæˆç”¨äºå…±äº«çš„æ’ä»¶url"><a href="#ç”Ÿæˆç”¨äºå…±äº«çš„æ’ä»¶url" class="headerlink" title="ç”Ÿæˆç”¨äºå…±äº«çš„æ’ä»¶url"></a>ç”Ÿæˆç”¨äºå…±äº«çš„æ’ä»¶url</h2><p>åˆ†å‘æ’ä»¶çš„æœ€ç®€å•æ–¹æ³•æ˜¯åˆ›å»ºä¸€ä¸ªurlï¼Œå®ƒå¯ä»¥é€šè¿‡ç”µå­é‚®ä»¶æˆ–ç¤¾äº¤ç½‘ç»œå…±äº«ã€‚<br>åŸºæœ¬æ ¼å¼æ˜¯<code>http://imjoy.io/#/app?plugin=PLUGIN_URI</code>ã€‚æ³¨æ„è¦ç”¨å®é™…plugin URIï¼ˆç»Ÿä¸€èµ„æºæ ‡è¯†ç¬¦ï¼‰æ¥æ›¿æ¢<code>PLUGIN_URI</code>ã€‚ä¾‹å¦‚ï¼š<a href="https://imjoy.io/#/app?plugin=https://github.com/imjoy-team/imjoy-plugins/blob/master/repository/imageWindow.imjoy.html">https://imjoy.io/#/app?plugin=https://github.com/imjoy-team/imjoy-plugins/blob/master/repository/imageWindow.imjoy.html</a>ã€‚å½“ç”¨æˆ·ç‚¹å‡»æ­¤é“¾æ¥æ—¶ï¼Œå°†æ˜¾ç¤ºä¸€ä¸ªæ’ä»¶å®‰è£…å¯¹è¯æ¡†ï¼Œæç¤ºå®‰è£…æŒ‡å®šçš„æ’ä»¶ï¼Œç”¨æˆ·åªéœ€å•å‡»â€œå®‰è£…â€å³å¯ç¡®è®¤ã€‚<br>æ­¤ url æ”¯æŒä¸€äº›é¢å¤–å‚æ•°æ¥æ§åˆ¶æ’ä»¶åŠ è½½æ–¹å¼ã€‚è¿™äº›å‚æ•°å°†åœ¨ä¸‹é¢çš„ä¸“é—¨éƒ¨åˆ†ä¸­è¿›è¡Œæè¿°ã€‚<br>æœ‰ä¸¤ç§ç±»å‹çš„URIï¼Œå…·ä½“å–å†³äºæ’ä»¶çš„éƒ¨ç½²æ–¹å¼ï¼š<br>ï¼ˆ1ï¼‰å¦‚æœæ’ä»¶éƒ¨ç½²åœ¨<code>ImJoy Plugin Repository</code>ï¼ˆå¦‚ä¸Šæ‰€è¿°ï¼‰ï¼Œå°±å¯ä»¥ä½¿ç”¨æ ¼å¼ä¸ºâ€œGITHUB_USER_NAME/REPO_NAME:PLUGIN_NAMEâ€çš„ç®€çŸ­URIã€‚æ¯”å¦‚å¯ä»¥ç”¨<code>imjoy-team/imjoy-project-template:Untitled Plugin</code>æ¥è¡¨ç¤ºæ‰˜ç®¡åœ¨ <a href="https://github.com/oeway/DRFNS-Lite">https://github.com/oeway/DRFNS-Lite</a> ä¸Šçš„æ’ä»¶ã€‚<br>è¿˜å¯ä»¥é€šè¿‡åœ¨ <code>PLUGIN_NAME</code> åæ·»åŠ  <code>@TAG</code> æ¥æŒ‡å®špluginçš„æ ‡ç­¾ã€‚ä¾‹å¦‚ï¼š<code>oeway/DRFNS-Lite:DRFNS-Lite@GPU</code>ã€‚<br>å¦‚æœè¿˜æƒ³æŒ‡å®šä¸€ä¸ªgit commit hashtagæ¥å°†æ’ä»¶å›ºå®šä¸ºæŸäº›æäº¤ï¼Œå¯ä»¥åœ¨<code>REPO_NAME</code>ä¹‹åæ·»åŠ <code>@COMMIT_HASHTAG</code>ã€‚ä¾‹å¦‚ï¼š<code>oeway/DRFNS-Lite@4063b24:DRFNS-Lite</code>ï¼Œå…¶ä¸­<code>4063b24</code>æ˜¯<a href="https://github.com/oeway/DRFNS-Lite/tree/4063b24f01eab459718ba87678dd5c5db1e1eda1">4063b24f01eab459718ba87678dd5c5db1e1eda1</a>çš„çŸ­æ ¼å¼ã€‚<br>ï¼ˆ2ï¼‰è¿˜å¯ä»¥ä½¿ç”¨urlæŒ‡å‘ä»»ä½•æ‰˜ç®¡çš„æ’ä»¶ç½‘ç«™ï¼ŒåŒ…æ‹¬å¼€å‘è€…è‡ªå·±çš„é¡¹ç›®ç«™ç‚¹ã€åšå®¢ã€GitHubã€Gistæˆ–Dropboxã€‚æ³¨æ„ï¼Œæ’ä»¶æ–‡ä»¶éœ€è¦ä»¥<code>.imjoy.html</code> ç»“å°¾ã€‚ä¸‹é¢å°†ä»‹ç»å¦‚ä½•ä¸ºä¸åŒçš„æ‰˜ç®¡å¹³å°è·å–æ­¤ urlï¼š<br>ï¼ˆ2.1ï¼‰GitHubä¸Šçš„æ–‡ä»¶ï¼Œåªéœ€å¤åˆ¶æ–‡ä»¶é“¾æ¥å³å¯ã€‚ä¾‹å¦‚ï¼š<code>https://github.com/imjoy-team/imjoy-plugins/blob/master/repository/imageRecognition.imjoy.html</code>ã€‚<br>ï¼ˆ2.2ï¼‰å¯¹äºGistæˆ–å…¶ä»–Gitæä¾›è€…ï¼ˆå¦‚GitLabï¼‰ï¼Œå¦‚æœGistä¸­åªæœ‰ä¸€ä¸ªæ–‡ä»¶ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨Gisté“¾æ¥ï¼ˆä»æµè§ˆå™¨åœ°å€æ å¤åˆ¶ï¼‰æˆ–è·å–æ’ä»¶<code>raw</code>æ–‡ä»¶çš„é“¾æ¥ã€‚å¯¹äºå…·æœ‰å¤šä¸ªæ–‡ä»¶çš„ Gistï¼Œéœ€è¦ä¸ºè¦ä½¿ç”¨çš„æ’ä»¶æ–‡ä»¶æŒ‡å®š <code>raw</code> é“¾æ¥ã€‚è¦åˆ›å»º Gist <code>raw</code> é“¾æ¥ï¼š<br>ï¼ˆ2.2.1ï¼‰åœ¨è‡ªå·±çš„ GitHub è´¦æˆ·ä¸Šè®¿é—®Gist<a href="https://gist.github.com/">https://gist.github.com/</a><br>ï¼ˆ2.2.2ï¼‰åˆ›å»ºæ–°çš„ Gistï¼ŒæŒ‡å®šæ’ä»¶åç§°åè·Ÿ <code>.imjoy.html</code>ï¼Œç„¶åå¤åˆ¶å¹¶ç²˜è´´æ’ä»¶ä»£ç ã€‚<br>ï¼ˆ2.2.3ï¼‰åˆ›å»ºå…¬å…±æˆ–ç§æœ‰ Gistã€‚<br>ï¼ˆ2.2.4ï¼‰å¯ä»¥ä»<code>Raw</code>æŒ‰é’®è·å¾—Gistçš„é“¾æ¥ï¼ˆè¿™é“¾æ¥åˆ°æ–‡ä»¶çš„æœªå¤„ç†ç‰ˆæœ¬ï¼‰ã€‚è¯¥é“¾æ¥å¦‚ä¸‹æ‰€ç¤ºï¼š<code>https://gist.githubusercontent.com/oeway/aad257cd9aaab448766c6dc287cb8614/raw/909d0a86e45a9640c0e108adea5ecd7e78b81301/chartJSDemo.imjoy.html</code>ã€‚<br>ï¼ˆ2.2.5ï¼‰éœ€è¦æ³¨æ„ï¼Œå½“æ›´æ–°æ–‡ä»¶æ—¶ï¼Œæ­¤urlä¼šæ›´æ”¹ã€‚<br>ï¼ˆ2.3ï¼‰å¯¹äºDropboxï¼Œéœ€è¦ä¿®æ”¹å¯å…±äº«çš„urlå¦‚ä¸‹ï¼š<br>ï¼ˆ2.3.1ï¼‰å°†<code>dl=0</code>æ›¿æ¢ä¸º<code>dl=1</code>ï¼›<br>ï¼ˆ2.3.2ï¼‰å°† <code>https://www.dropbox.com/</code> æ›¿æ¢ä¸º <code>https://dl.dropboxusercontent.com/</code>ã€‚</p><p>è¦æŒ‡å®šæ’ä»¶æ ‡ç­¾ï¼Œåªéœ€åœ¨ <code>.imjoy.html</code> åé™„åŠ  <code>@TAG</code>ã€‚ä¾‹å¦‚ï¼š<br><code>https://raw.githubusercontent.com/oeway/DRFNS-Lite/master/DRFNS-Lite.imjoy.html@GPU</code>ã€‚<br>å¯ä»¥åœ¨ ImJoy ä¸­æµ‹è¯•æ’ä»¶ url æ˜¯å¦æœ‰æ•ˆï¼šå°†å…¶ç²˜è´´åˆ° <code>+ PLUGINS</code> å¯¹è¯æ¡†ä¸­ï¼Œï¼ˆ<code>Install from URL</code>ï¼‰å¹¶æŒ‰<code>Enter</code>ã€‚å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œåº”è¯¥èƒ½å¤ŸæŸ¥çœ‹ä½¿ç”¨æ’ä»¶å‘ˆç°çš„å¡ç‰‡ï¼Œç„¶åå¯ä»¥å•å‡»<code>INSTALL</code>ã€‚</p><h2 id="æ”¯æŒçš„urlå‚æ•°"><a href="#æ”¯æŒçš„urlå‚æ•°" class="headerlink" title="æ”¯æŒçš„urlå‚æ•°"></a>æ”¯æŒçš„urlå‚æ•°</h2><p>å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰å‚æ•°æ¥æ„å»º ImJoy urlï¼Œä»¥ä¾¿äºå®‰è£…ã€‚è¿™äº› url å‚æ•°å¯ä»¥åœ¨ <code>https://imjoy.io/#/app?</code> ä¹‹åä½¿ç”¨ï¼Œä½¿ç”¨ <code>PARAM=VALUE</code> è¯­æ³•ã€‚<br>è¿™äº›å‚æ•°ç›¸äº’ç‹¬ç«‹ï¼Œå¤šä¸ªå‚æ•°å¯ä»¥é€šè¿‡<code>&amp;</code>è¿æ¥ã€‚ä¾‹å¦‚æˆ‘ä»¬è¦æŒ‡å®š<code>par1=99</code>å’Œ<code>par2=hello</code>ï¼Œç›¸åº”çš„ url å°†æ˜¯ <code>https://imjoy.io/#/app?par1=99&amp;par2=hello</code>ã€‚<br>ç›®å‰æ”¯æŒä»¥ä¸‹ url å‚æ•°ï¼š<br>ï¼ˆ1ï¼‰<code>plugin</code> æˆ– <code>p</code>ï¼šåœ¨æ’ä»¶ç®¡ç†å¯¹è¯æ¡†ä¸­æ˜¾ç¤ºæŒ‡å®šçš„æ’ä»¶ã€‚å¦‚æœå­˜åœ¨å…·æœ‰ç›¸åŒåç§°å’Œç‰ˆæœ¬çš„æ’ä»¶ï¼Œåˆ™ä¸ä¼šæ˜¾ç¤ºè¯¥å¯¹è¯æ¡†ã€‚å¦‚æœéœ€è¦ï¼Œæ·»åŠ  <code>upgrade=1</code> ä»¥å¼ºåˆ¶æ˜¾ç¤ºæ’ä»¶å¯¹è¯æ¡†ã€‚ä¾‹å¦‚ï¼š<code>https://imjoy.io/#/app?p=imjoy-team/imjoy-demo-plugins:alert&amp;upgrade=1</code>ã€‚<br>ï¼ˆ2ï¼‰<code>workspace</code> æˆ– <code>w</code>ï¼šå·¥ä½œåŒºçš„åç§°ã€‚ ImJoy å°†åˆ‡æ¢åˆ°æŒ‡å®šçš„å·¥ä½œåŒºï¼ˆå¦‚æœå­˜åœ¨ï¼‰ï¼Œæˆ–åˆ›å»ºä¸€ä¸ªæ–°çš„å·¥ä½œåŒºã€‚ä¾‹å¦‚ï¼Œ<code>https://imjoy.io/#/app?workspace=test</code><br>ï¼ˆ3ï¼‰<code>engine</code> æˆ– <code>e</code>ï¼šå®šä¹‰æ’ä»¶å¼•æ“çš„urlã€‚ä¾‹å¦‚ï¼š<code>http://imjoy.io/#/app?engine=http://127.0.0.1:9527</code>ã€‚æ³¨æ„ï¼Œå¦‚æœæƒ³é€šè¿‡httpï¼ˆè€Œéhttpsï¼‰è¿æ¥åˆ°è¿œç¨‹æœºå™¨ï¼Œåˆ™åªèƒ½ä½¿ç”¨ <code>http://imjoy.io</code> è€Œä¸æ˜¯ <code>https://imjoy.io</code>ã€‚å¦‚æœåœ¨æŸäº›æµè§ˆå™¨ï¼ˆä¾‹å¦‚Firefoxï¼‰ä¸­ä½¿ç”¨localhostï¼Œåˆ™æ­¤é™åˆ¶ä¹Ÿå­˜åœ¨ã€‚ä¸ºé¿å…è¿™ç§æƒ…å†µï¼Œéœ€è¦ä½¿ç”¨ <code>http://127.0.0.1:9527</code> è€Œä¸æ˜¯ <code>http://localhost:9527</code>ï¼Œå› ä¸ºå¤§å¤šæ•°æµè§ˆå™¨ä¼šè®¤ä¸º <code>127.0.0.1</code> æ˜¯å®‰å…¨è¿æ¥ï¼Œè€Œ<code>localhost</code>ä¸æ˜¯ã€‚ä½†æ˜¯ï¼Œæœ‰ä¸€ä¸ªä¾‹å¤–ï¼Œåœ¨ Safari ä¸Šï¼Œä½¿ç”¨ <code>127.0.0.1</code> ä¸èµ·ä½œç”¨ï¼Œå› ä¸º<a href="https://bugs.webkit.org/show_bug.cgi?id=171934">æ­¤é™åˆ¶</a>ï¼Œè¯·ä½¿ç”¨Firefoxæˆ–Chromeã€‚<br>ï¼ˆ4ï¼‰<code>token</code> æˆ– <code>t</code>ï¼šå®šä¹‰è¿æ¥ä»¤ç‰Œã€‚ä¾‹å¦‚ï¼š<code>http://imjoy.io/#/app?token=2760239c-c0a7-4a53-a01e-d6da48b949bc</code><br>ï¼ˆ5ï¼‰<code>repo</code> æˆ– <code>r</code>ï¼šæŒ‡å®šæŒ‡å‘ ImJoy æ’ä»¶ä»“åº“çš„æ¸…å•æ–‡ä»¶ã€‚è¿™å¯ä»¥æ˜¯ä¸€ä¸ªå®Œæ•´çš„ repo é“¾æ¥ï¼Œä¾‹å¦‚ <code>repo=https://github.com/imjoy-team/imjoy-plugins</code>æˆ–ç®€åŒ–çš„ GitHub é“¾æ¥ <code>repo=imjoy-team/imjoy-plugins</code>ã€‚å¦‚æœä»éGitHubç½‘ç«™ï¼ˆä¾‹å¦‚GitLabï¼‰æ‰˜ç®¡æ’ä»¶åº“ï¼Œå°±ä½¿ç”¨æŒ‡å‘ <code>manifest.imjoy.json</code> æ–‡ä»¶çš„ <code>raw</code> é“¾æ¥ã€‚<br>ï¼ˆ6ï¼‰<code>start</code> æˆ– <code>s</code>ï¼šå®šä¹‰ä¸€ä¸ªå¯åŠ¨æ’ä»¶åç§°ï¼Œå®ƒä¼šåœ¨ ImJoy web åº”ç”¨ç¨‹åºåŠ è½½åè‡ªåŠ¨å¯åŠ¨ã€‚æ‰€æœ‰ url å‚æ•°å°†ä½œä¸º <code>ctx.config</code> ä¼ é€’ç»™æ’ä»¶åˆ° <code>run(ctx)</code> å‡½æ•°ã€‚è¿™å…è®¸æ·»åŠ è‡ªå®šä¹‰å‚æ•°å¹¶åœ¨ <code>run(ctx)</code> ä¸­ä½¿ç”¨å®ƒä»¬ã€‚ä¾‹å¦‚ï¼Œæ’ä»¶å¯ä»¥ä½¿ç”¨<code>load=URL</code> è‡ªåŠ¨åŠ è½½å›¾åƒï¼Œå¹¶ä½¿ç”¨<code>width=1024&amp;height=2048</code> è®¾ç½®å›¾åƒçš„å®½åº¦å’Œé«˜åº¦ã€‚ä¾‹å¦‚ï¼Œå°†<code>123</code>ä½œä¸º<code>ctx.data.x</code>ä¼ é€’ç»™æ’ä»¶çš„<code>run</code>å‡½æ•°ï¼š<code>https://imjoy.io/#/app?x=123&amp;start=AwesomePlugin</code>ã€‚å¦‚æœæ­£åœ¨å¯åŠ¨ä¸€ä¸ª<code>window</code>æ’ä»¶ï¼Œè¿˜å¯ä»¥å°†<code>standalone</code>æˆ–<code>fullscreen</code>è®¾ç½®ä¸º<code>1</code>ä»¥ä½¿çª—å£è„±ç¦»å·¥ä½œåŒºæˆ–å¤„äºå…¨å±æ¨¡å¼ã€‚ä¾‹å¦‚ï¼š<code>https://imjoy.io/#/app?x=123&amp;start=AwesomeWindowPlugin&amp;fullscreen=1</code>ã€‚<br>ï¼ˆ7ï¼‰<code>load</code> æˆ– <code>l</code>ï¼šå®šä¹‰ä¸€ä¸ªç”¨äºå‘èµ· http GET è¯·æ±‚çš„ URLï¼Œè¿™ä¸ªå‚æ•°åº”è¯¥åªåœ¨å®šä¹‰äº†ä¸€ä¸ªå¸¦æœ‰ <code>start</code> æˆ– <code>s</code> çš„å¯åŠ¨æ’ä»¶æ—¶ä½¿ç”¨ã€‚ä» URL è·å–çš„æ•°æ®å°†ä½œä¸º <code>ctx.data.loaded</code> ä¼ é€’ç»™å¯åŠ¨æ’ä»¶ <code>run(ctx)</code> å‡½æ•°ã€‚<br>ï¼ˆ8ï¼‰<code>expose</code>ï¼šå½“ imjoy åµŒå…¥åˆ° iframe ä¸­æ—¶ï¼Œè¯¥å‚æ•°æŒ‡å®šæ˜¯å¦åº”è¯¥å°†å…¶ API æš´éœ²ç»™å¤–éƒ¨ä¸Šä¸‹æ–‡ï¼ˆé»˜è®¤æƒ…å†µä¸‹ä¸ä¼šæš´éœ²ï¼‰ã€‚è¦å¯ç”¨ï¼Œå¯ä»¥å°† <code>expose=1</code> æ·»åŠ åˆ° URL æŸ¥è¯¢ã€‚</p><h2 id="æ·»åŠ ImJoyå¾½ç« "><a href="#æ·»åŠ ImJoyå¾½ç« " class="headerlink" title="æ·»åŠ ImJoyå¾½ç« "></a>æ·»åŠ ImJoyå¾½ç« </h2><p>å¦‚æœå¼€å‘è€…åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ ImJoyï¼Œå»ºè®®å°†ImJoyå¾½ç« ä¹‹ä¸€æ·»åŠ åˆ°é¡¹ç›®ä»“åº“ï¼ˆä¾‹å¦‚åœ¨ Github ä¸Šï¼‰æˆ–ç½‘ç«™ã€‚ImJoyæœ‰ä¸¤ä¸ªå®˜æ–¹å¾½ç« ï¼š<img src="https://imjoy.io/static/badge/launch-imjoy-badge.svg" alt="launch ImJoy">å’Œ<img src="https://imjoy.io/static/badge/powered-by-imjoy-badge.svg" alt="powered by ImJoy">ã€‚<br>å¯¹äºå­˜å‚¨ ImJoy æ’ä»¶çš„ä»“åº“ï¼Œå¯ä»¥ä½¿ç”¨<img src="https://imjoy.io/static/badge/launch-imjoy-badge.svg" alt="launch ImJoy">å¾½ç« ã€‚<br>Markdownï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[![launch ImJoy](https:&#x2F;&#x2F;imjoy.io&#x2F;static&#x2F;badge&#x2F;launch-imjoy-badge.svg)](https:&#x2F;&#x2F;imjoy.io&#x2F;#&#x2F;app?plugin&#x3D;&lt;YOUR PLUGIN URL&gt;)</span><br></pre></td></tr></table></figure><br>reStructuredTextï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.. image:: https:&#x2F;&#x2F;imjoy.io&#x2F;static&#x2F;badge&#x2F;launch-imjoy-badge.svg</span><br><span class="line"> :target: https:&#x2F;&#x2F;imjoy.io&#x2F;#&#x2F;app?plugin&#x3D;&lt;YOUR PLUGIN URL&gt;</span><br></pre></td></tr></table></figure></p><p>å¯¹äºå…¶ä»–æƒ…å†µï¼Œä¾‹å¦‚ï¼Œå¦‚æœåªæ˜¯æƒ³æ„Ÿè°¢ImJoyï¼Œåˆ™å¯ä»¥ä½¿ç”¨<img src="https://imjoy.io/static/badge/powered-by-imjoy-badge.svg" alt="powered by ImJoy">ã€‚<br>Markdown:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[![powered by ImJoy](https:&#x2F;&#x2F;imjoy.io&#x2F;static&#x2F;badge&#x2F;powered-by-imjoy-badge.svg)](https:&#x2F;&#x2F;imjoy.io&#x2F;)</span><br></pre></td></tr></table></figure></p><p>reStructuredText:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.. image:: https:&#x2F;&#x2F;imjoy.io&#x2F;static&#x2F;badge&#x2F;powered-by-imjoy-badge.svg</span><br><span class="line"> :target: https:&#x2F;&#x2F;imjoy.io&#x2F;</span><br></pre></td></tr></table></figure></p>]]></content>
    
    
    <summary type="html">å‚è€ƒæ–‡çŒ®
Developing Plugins for ImJoy

ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ä»‹ç»äº†æ’ä»¶çš„æ–‡ä»¶æ ¼å¼ï¼Œè¿™ä¸€ç¯‡ä»‹ç»å¦‚ä½•è¿›è¡Œå®é™…çš„æ’ä»¶å¼€å‘ã€‚

æŒ‡å®šä¾èµ–
å¯¹äºä¸€ä¸ªæ’ä»¶ï¼Œå…¶å¾€å¾€ä¸æ˜¯å•ä¸€çš„åŠŸèƒ½å®ç°ï¼Œå¾€å¾€éœ€è¦å…¶ä»–è½¯ä»¶åº“çš„é…åˆã€‚
æ’ä»¶çš„ä¾èµ–åœ¨å…¶æ–‡ä»¶çš„config å—çš„requirementså­—æ®µä¸­è¿›è¡ŒæŒ‡å®šã€‚
æ ¹æ®ä¸åŒçš„æ’ä»¶ç±»å‹ï¼Œå¯ä»¥æŒ‡å®šä¸ä¸€æ ·çš„ä¾èµ–ã€‚

Web Worker å’Œ Window æ’ä»¶
å¯¹äºè¿™ä¸¤ç±»æ’ä»¶ï¼Œå¯ä»¥é€šè¿‡ä¸€ä¸ªJavaScriptåº“çš„urlæ•°ç»„æ¥æŒ‡å®šä¾èµ–ã€‚è¿™äº›åº“ä¼šè¢«importScriptsæ–¹æ³•å¯¼å…¥ã€‚
ä¾‹å¦‚ï¼Œè¦æŒ‡å®šæœ€æ–°çš„ plotly.js åº“ï¼Œå¯ä»¥è¿™æ ·å†™ï¼š
1


&quot;requireme</summary>
    
    
    
    <category term="computer vision" scheme="http://qixinbo.github.io/categories/computer-vision/"/>
    
    
    <category term="ImJoy" scheme="http://qixinbo.github.io/tags/ImJoy/"/>
    
  </entry>
  
  <entry>
    <title>å¼€æºæ·±åº¦å­¦ä¹ è®¡ç®—å¹³å°ImJoyè§£æï¼š4 -- æ’ä»¶æ–‡ä»¶æ ¼å¼</title>
    <link href="http://qixinbo.github.io/2021/12/04/ImJoy_4/"/>
    <id>http://qixinbo.github.io/2021/12/04/ImJoy_4/</id>
    <published>2021-12-03T16:00:00.000Z</published>
    <updated>2021-12-04T08:26:24.680Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h1><p><a href="https://imjoy.io/docs/#/development">Developing Plugins for ImJoy</a></p><h1 id="æ¦‚è§ˆ"><a href="#æ¦‚è§ˆ" class="headerlink" title="æ¦‚è§ˆ"></a>æ¦‚è§ˆ</h1><p>ImJoyæ’ä»¶æ–‡ä»¶æœ¬è´¨ä¸Šæ˜¯åŒ…æ‹¬ä¸€ç³»åˆ—è‡ªå®šä¹‰å—çš„htmlæ–‡ä»¶ï¼ˆå—<code>.vue</code> æ ¼å¼å¯å‘ï¼‰ã€‚<br>å¦‚ä¸‹æ˜¯ä¸€ä¸ªæ’ä»¶æ–‡ä»¶çš„å…¸å‹ç»„æˆã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™äº›å—çš„é¡ºåºæ— å…³ç´§è¦ï¼Œå› æ­¤å¯ä»¥å°†å—æ‰“ä¹±ã€‚<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">config</span> <span class="attr">lang</span>=<span class="string">&quot;json&quot;</span>&gt;</span></span><br><span class="line">   ** è¯¥ä»£ç å—ä»¥Jsonæ ¼å¼å®šä¹‰æ’ä»¶çš„å±æ€§**</span><br><span class="line"><span class="tag">&lt;/<span class="name">config</span>&gt;</span></span><br><span class="line"></span><br><span class="line">ã€Šscript lang=&quot;javascript&quot;&gt;</span><br><span class="line">   ** è¯¥ä»£ç å—ä»¥JavaScript æˆ– Python æ ¼å¼ç¼–å†™æ’ä»¶åŠŸèƒ½**</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">window</span> <span class="attr">lang</span>=<span class="string">&quot;html&quot;</span>&gt;</span></span><br><span class="line">   ** è¯¥ä»£ç å—ä»¥HTML æ ¼å¼ç¼–å†™ç•Œé¢**ï¼ˆé€‚ç”¨äºwindowç±»å‹æ’ä»¶ï¼‰</span><br><span class="line"><span class="tag">&lt;/<span class="name">window</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">lang</span>=<span class="string">&quot;css&quot;</span>&gt;</span></span><br><span class="line">   ** è¯¥ä»£ç å—ä»¥CSS æ ¼å¼å®šä¹‰ç•Œé¢æ ·å¼**ï¼ˆé€‚ç”¨äºwindowç±»å‹æ’ä»¶ï¼‰</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">docs</span> <span class="attr">lang</span>=<span class="string">&quot;markdown&quot;</span>&gt;</span></span><br><span class="line">   ** è¯¥ä»£ç å—ä»¥Markdown æ ¼å¼ç¼–å†™æ’ä»¶æ–‡æ¡£ **</span><br><span class="line"><span class="tag">&lt;/<span class="name">docs</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">attachment</span> <span class="attr">name</span>=<span class="string">&quot;XXXXX&quot;</span>&gt;</span></span><br><span class="line">   ** è¯¥ä»£ç å—ç”¨äºå­˜å‚¨æ–‡æœ¬æ•°æ®**</span><br><span class="line"><span class="tag">&lt;/<span class="name">attachment</span>&gt;</span></span><br></pre></td></tr></table></figure><br>å…¶ä¸­ï¼Œåªæœ‰<code>&lt;config&gt;</code>å’Œ<code>ã€Šscript&gt;</code>è¿™ä¸¤ä¸ªä»£ç å—æ˜¯å¿…é¡»çš„ï¼Œå…¶ä»–å—éƒ½æ˜¯å¯é€‰çš„ã€‚</p><h1 id="configå—"><a href="#configå—" class="headerlink" title="configå—"></a>configå—</h1><p>ä½¿ç”¨ <a href="https://www.json.org/">JSON</a> æˆ– <a href="https://yaml.org/">YAML</a> æ ¼å¼çš„å­—æ®µæ¥å®šä¹‰æ’ä»¶çš„é€šç”¨å±æ€§ã€‚<br><code>json</code>æ ¼å¼çš„é…ç½®ä¸ºï¼ˆæ³¨æ„JSONæœ¬èº«ä¸æ”¯æŒæ³¨é‡Šï¼Œæ‰€ä»¥ä¸‹é¢#å·ä»¥åçš„å†…å®¹åªæ˜¯ä¸ºäº†è¿™é‡Œæ–¹ä¾¿è¯´æ˜ï¼Œå®é™…è¦å»é™¤ï¼›ä¸€äº›éœ€è¦è¯¦ç»†è§£é‡Šçš„å­—æ®µä¼šåœ¨ä¸‹é¢å•ç‹¬è¯´æ˜ï¼‰ï¼š<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">config</span> <span class="attr">lang</span>=<span class="string">&quot;json&quot;</span>&gt;</span></span><br><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;: &quot;Untitled Plugin&quot;, # æ’ä»¶åç§°ã€‚å®ƒå¿…é¡»æ˜¯å”¯ä¸€çš„ï¼Œä»¥é¿å…ä¸å…¶ä»–æ’ä»¶å†²çª</span><br><span class="line">  &quot;type&quot;: &quot;web-worker&quot;, # æ’ä»¶ç±»å‹ï¼Œé€‰é¡¹æœ‰ï¼š`web-worker`ã€`window`ã€`native-python` å’Œ`web-python`</span><br><span class="line">  &quot;ui&quot;: &quot;image processing&quot;, # é…ç½®åœ¨æ’ä»¶ä¸‹æ–¹æ˜¾ç¤ºçš„å†…å®¹ï¼Œè¯¦ç»†ç”¨æ³•å°†åœ¨ä¸‹é¢è¯¦è¿°</span><br><span class="line">  &quot;url&quot;: &quot;&quot;, # å½“å‰æ–‡ä»¶çš„è·¯å¾„ï¼Œç”¨æˆ·ä»æ’ä»¶å­˜å‚¨åº“å®‰è£…æ’ä»¶æ—¶éœ€ä½¿ç”¨è¯¥urlæ¥ä¸‹è½½è¯¥æ’ä»¶</span><br><span class="line">  &quot;cover&quot;: &quot;&quot;, # æ’ä»¶å°é¢å›¾ç‰‡çš„urlï¼Œè¯¦ç»†ç”¨æ³•å°†åœ¨ä¸‹é¢è¯¦è¿°</span><br><span class="line">  &quot;labels&quot;: [], # å®šä¹‰ä¸€ä¸ªâ€œlabelsâ€åˆ—è¡¨æ¥åˆ†ç±»æ’ä»¶ä»¥å…è®¸åŸºäºè¯­ä¹‰æ ‡ç­¾è¿›è¡Œæœç´¢æˆ–è¿‡æ»¤ã€‚</span><br><span class="line">  &quot;authors&quot;: [], # ä½œè€…å§“ååˆ—è¡¨ã€‚</span><br><span class="line">  &quot;license&quot;: &quot;&quot;, # æ’ä»¶æ‰€é‡‡ç”¨çš„è®¸å¯è¯</span><br><span class="line">  &quot;repository&quot;: &quot;&quot;, # æ’ä»¶é¡¹ç›®å­˜å‚¨åº“çš„urlè·¯å¾„</span><br><span class="line">  &quot;website&quot;: &quot;&quot;, # æ’ä»¶é¡¹ç›®ç½‘ç«™çš„url</span><br><span class="line">  &quot;tags&quot;: [], # æ’ä»¶æ‰€æ”¯æŒçš„é…ç½®æ ‡ç­¾ï¼Œè¯¦ç»†ç”¨æ³•å°†åœ¨ä¸‹é¢è¯¦è¿°</span><br><span class="line">  &quot;version&quot;: &quot;0.1.0&quot;, # æŒ‡å®šæ’ä»¶ç‰ˆæœ¬</span><br><span class="line">  &quot;api_version&quot;: &quot;0.1.6&quot;, # æŒ‡å®šæ’ä»¶æ‰€åŸºäºçš„ ImJoy çš„ api ç‰ˆæœ¬ã€‚</span><br><span class="line">  &quot;description&quot;: &quot;A plugin for image processing.&quot;, # æ’ä»¶çš„ç®€çŸ­æè¿°</span><br><span class="line">  &quot;flags&quot;: [&quot;functional&quot;], # ç”¨æ¥æ§åˆ¶æ’ä»¶è¡Œä¸ºï¼Œè¯¦ç»†ç”¨æ³•å°†åœ¨ä¸‹é¢è¯¦è¿°</span><br><span class="line">  &quot;icon&quot;: &quot;extension&quot;, # å®šä¹‰æ’ä»¶èœå•çš„å›¾æ ‡ï¼Œè¯¦ç»†ç”¨æ³•å°†åœ¨ä¸‹é¢è¯¦è¿°</span><br><span class="line">  &quot;inputs&quot;: null, # å®šä¹‰ç”¨æ¥è§¦å‘æ’ä»¶çš„è¾“å…¥æ¡ä»¶ï¼Œæ¯”å¦‚æ‹–è¿›æ¥ä¸€ä¸ªæ–‡ä»¶ï¼Œè¯¦ç»†ç”¨æ³•å°†åœ¨ä¸‹é¢è¯¦è¿°</span><br><span class="line">  &quot;outputs&quot;: null, # å®šä¹‰æ’ä»¶çš„è¾“å‡ºï¼Œè¯¦ç»†ç”¨æ³•å°†åœ¨ä¸‹é¢è¯¦è¿°</span><br><span class="line">  &quot;cmd&quot;: &quot;python&quot;, # ä»…é€‚ç”¨äºpythonæ’ä»¶ï¼Œç”¨äºè¿è¡Œæ’ä»¶çš„å‘½ä»¤ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒå°†ä½¿ç”¨`python`è¿è¡Œã€‚æ ¹æ®å®‰è£…çš„ä¸åŒï¼Œå®ƒä¹Ÿå¯èƒ½æ˜¯â€œpython3â€æˆ–â€œpython27â€ç­‰ã€‚</span><br><span class="line">  &quot;env&quot;: null, # ä»…é€‚ç”¨äºpythonæ’ä»¶ï¼Œè™šæ‹Ÿç¯å¢ƒæˆ–dockeré•œåƒå‘½ä»¤ï¼Œç”¨äºåˆ›å»ºæ’ä»¶è¿è¡Œçš„ç¯å¢ƒã€‚å…·ä½“ç”¨æ³•è§å¦ä¸€ç¯‡åšå®¢çš„â€œæŒ‡å®šä¾èµ–â€ä¸€èŠ‚</span><br><span class="line">  &quot;permissions&quot;: [], # æŒ‡å®šæƒé™ï¼Œè¯¦ç»†ç”¨æ³•å°†åœ¨ä¸‹é¢è¯¦è¿°</span><br><span class="line">  &quot;requirements&quot;: [], # å®šä¹‰æ’ä»¶ä¾èµ–ï¼Œå…·ä½“ç”¨æ³•è§å¦ä¸€ç¯‡åšå®¢çš„â€œæŒ‡å®šä¾èµ–â€ä¸€èŠ‚</span><br><span class="line">  &quot;dependencies&quot;: [], # æŒ‡å®šå½“å‰æ’ä»¶ä¾èµ–çš„å…¶ä»–ImJoyæ’ä»¶ï¼Œè¯¦ç»†ç”¨æ³•å°†åœ¨ä¸‹é¢è¯¦è¿°</span><br><span class="line">  &quot;default&quot;: &#123;&#125;, # ä»…é€‚ç”¨äºwindowæ’ä»¶ï¼Œå®šä¹‰çª—å£çš„é»˜è®¤å€¼ï¼Œè¯¦ç»†ç”¨æ³•å°†åœ¨ä¸‹é¢è¯¦è¿°</span><br><span class="line">  &quot;base_frame&quot;: null, # ä»…é€‚ç”¨äºwindowæ’ä»¶ï¼Œå®šä¹‰åœ¨è¯¥çª—å£æ’ä»¶ä¸­å†…åµŒçš„å¤–éƒ¨htmlçš„urlè·¯å¾„ï¼Œè¯¦ç»†ç”¨æ³•å°†åœ¨ä¸‹é¢è¯¦è¿°</span><br><span class="line">  &quot;runnable&quot;: true # å®šä¹‰æ’ä»¶æ˜¯å¦å¯ä»¥é€šè¿‡ç‚¹å‡»æ’ä»¶èœå•æ¥æ‰§è¡Œï¼Œè¯¦ç»†ç”¨æ³•å°†åœ¨ä¸‹é¢è¯¦è¿°</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">config</span>&gt;</span></span><br></pre></td></tr></table></figure><br>è€Œ<code>yaml</code>æ ¼å¼çš„é…ç½®ä¸º:<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">config</span> <span class="attr">lang</span>=<span class="string">&quot;yaml&quot;</span>&gt;</span></span><br><span class="line">name: Untitled Plugin</span><br><span class="line">type: web-worker</span><br><span class="line">tags: []</span><br><span class="line">ui: image processing</span><br><span class="line">cover: &#x27;&#x27;</span><br><span class="line">version: 0.1.0</span><br><span class="line">api_version: 0.1.6</span><br><span class="line">description: A plugin for image processing.</span><br><span class="line">icon: extension</span><br><span class="line">inputs: </span><br><span class="line">outputs: </span><br><span class="line">env: </span><br><span class="line">permissions: []</span><br><span class="line">requirements: []</span><br><span class="line">dependencies: []</span><br><span class="line"><span class="tag">&lt;/<span class="name">config</span>&gt;</span></span><br></pre></td></tr></table></figure></p><h2 id="coverå­—æ®µ"><a href="#coverå­—æ®µ" class="headerlink" title="coverå­—æ®µ"></a>coverå­—æ®µ</h2><p><code>cover</code>å­—æ®µç”¨æ¥æŒ‡å®šæ’ä»¶å°é¢å›¾ç‰‡çš„urlï¼Œå®ƒå°†æ˜¾ç¤ºåœ¨å›¾åƒå®‰è£…å¯¹è¯æ¡†ä¸­ï¼Œä»¥åŠæ’ä»¶æ–‡æ¡£çš„é¡¶éƒ¨ã€‚<br>ç¤ºä¾‹ï¼š<code>&quot;cover&quot;:&quot;https://imjoy.io/static/img/imjoy-card-plain.png&quot;</code>ã€‚<br>å»ºè®®å°é¢å›¾ç‰‡çš„çºµæ¨ªæ¯”ä¸º 16:9ã€‚ å®ƒå¯ä»¥æ‰˜ç®¡åœ¨ GitHub å­˜å‚¨åº“ä¸­ï¼Œæ­¤æ—¶åº”è¯¥ä½¿ç”¨å›¾åƒçš„ç»å¯¹è·¯å¾„URLã€‚<br>å¯ä»¥ä½¿ç”¨å¤šä¸ªå›¾åƒï¼Œå°† <code>cover</code> è®¾ç½®ä¸ºä¸€ä¸ªæ•°ç»„å³å¯ï¼š<code>&quot;cover&quot;: [&quot;url_to_image1&quot;, &quot;url_to_image2&quot;, &quot;url_to_image3&quot;]</code>ã€‚</p><h2 id="tagså­—æ®µ"><a href="#tagså­—æ®µ" class="headerlink" title="tagså­—æ®µ"></a>tagså­—æ®µ</h2><p><code>tags</code>å­—æ®µç”¨æ¥å®šä¹‰æ’ä»¶æ‰€æ”¯æŒçš„é…ç½®æ ‡ç­¾ã€‚<br>ï¼ˆæ³¨æ„ï¼šè¿™é‡Œçš„<code>tags</code>ä¸æ˜¯ç”¨äºåˆ†ç±»æˆ–åˆ†ç»„ç›®çš„ï¼Œåˆ†ç±»æˆ–åˆ†ç»„å¯ä»¥ä½¿ç”¨<code>labels</code>å­—æ®µå®ç°ã€‚ï¼‰<br>è¿™äº›å®šä¹‰çš„æ ‡ç­¾ä¸ºæ’ä»¶æ‰§è¡Œæä¾›äº†çµæ´»çš„å¯é…ç½®çš„æ¨¡å¼ï¼Œæ¯”å¦‚å¯ä»¥é…ç½®æ’ä»¶æ˜¯åœ¨ CPU æˆ– GPU ä¸Šè¿è¡Œã€‚<br>ä»¥Unet Segmentationè¿™ä¸ªæ’ä»¶ä¸ºä¾‹ï¼Œå¦‚ä¸‹æ˜¯å®‰è£…è¯¥æ’ä»¶æ—¶çš„ç•Œé¢åŠå…¶æºä»£ç ï¼š<br><img src="https://user-images.githubusercontent.com/6218739/144185494-b3db5ddc-de2d-4d3b-a9fe-6e8549e062a5.png" alt="unet-tags"><br>å¯ä»¥çœ‹å‡ºï¼Œè¯¥æ’ä»¶åœ¨tagså­—æ®µä¸­å®šä¹‰äº†<code>CPU</code>ã€<code>GPU</code>ã€<code>Windows-CPU</code>ã€<code>Windows-GPU</code>å››ä¸ªæ ‡ç­¾ï¼Œé‚£ä¹ˆç›¸åº”åœ°ï¼Œå°±å¯ä»¥åœ¨åé¢çš„ç¯å¢ƒé…ç½®å’Œä¾èµ–åº“è§£ææ—¶ï¼Œå¯¹å…¶è¿›è¡Œä¸åŒçš„è¦æ±‚ï¼š<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;env&quot;</span>: </span><br><span class="line">&#123;<span class="string">&quot;CPU&quot;</span>: [<span class="string">&quot;conda config --add channels conda-forge&quot;</span>, <span class="string">&quot;conda create -n tf-cpu python=3.6&quot;</span>],</span><br><span class="line"><span class="string">&quot;GPU&quot;</span>: [<span class="string">&quot;conda config --add channels conda-forge&quot;</span>, <span class="string">&quot;conda create -n tf-gpu python=3.6&quot;</span>],</span><br><span class="line"><span class="string">&quot;Windows-CPU&quot;</span>: [<span class="string">&quot;conda config --add channels conda-forge&quot;</span>, <span class="string">&quot;conda create -n tf-cpu python=3.6&quot;</span>],</span><br><span class="line"><span class="string">&quot;Windows-GPU&quot;</span>: [<span class="string">&quot;conda config --add channels conda-forge&quot;</span>, <span class="string">&quot;conda create -n tf-gpu python=3.6&quot;</span>]</span><br><span class="line">&#125;,</span><br><span class="line"><span class="string">&quot;requirements&quot;</span>: </span><br><span class="line">&#123;<span class="string">&quot;CPU&quot;</span>: [<span class="string">&quot;repo:https://github.com/zhixuhao/unet&quot;</span>, <span class="string">&quot;pip:h5py scikit-image keras==2.1.4 numpy==1.18.0 tensorflow==1.15.4&quot;</span>],</span><br><span class="line"><span class="string">&quot;GPU&quot;</span>: [<span class="string">&quot;repo:https://github.com/zhixuhao/unet&quot;</span>, <span class="string">&quot;pip:h5py scikit-image keras==2.1.4 numpy==1.18.0 tensorflow-gpu==1.15.4&quot;</span>],</span><br><span class="line"><span class="string">&quot;Windows-CPU&quot;</span>: [<span class="string">&quot;repo:https://github.com/zhixuhao/unet&quot;</span>, <span class="string">&quot;pip:h5py scikit-image keras==2.1.4 numpy==1.18.0 tensorflow==1.15.4&quot;</span>],</span><br><span class="line"><span class="string">&quot;Windows-GPU&quot;</span>: [<span class="string">&quot;repo:https://github.com/zhixuhao/unet&quot;</span>, <span class="string">&quot;pip:h5py scikit-image keras==2.1.4 numpy==1.18.0 tensorflow-gpu==1.15.4&quot;</span>]</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><br>å¦‚æœæ’ä»¶å®šä¹‰äº†tagsï¼Œå®ƒä»¬å°†å‡ºç°åœ¨ä»£ç ç¼–è¾‘å™¨çš„é¡¶éƒ¨ä»¥åŠå®‰è£…è¿‡ç¨‹ä¸­ã€‚å¦‚æœä½¿ç”¨<code>url</code>åˆ†å‘æ’ä»¶ï¼Œè¿˜å¯ä»¥å…·ä½“æŒ‡å®šæ’ä»¶å°†ä½¿ç”¨å“ªä¸ªæ ‡ç­¾å®‰è£…ã€‚<br>åœ¨<code>&lt;config&gt;</code>ä»£ç å—ä¸­ï¼Œä»¥ä¸‹å­—æ®µå¯ä»¥è¢«tagsæ‰€é…ç½®ï¼š<code>env</code>ã€<code>requirements</code>ã€<code>dependencies</code>ã€<code>icon</code>ã€<code>ui</code>ã€<code>type</code>ã€<code>flags</code>ã€<code>cover</code>ã€‚<br><code>&lt;script&gt;</code>ä»£ç å—ä¹Ÿå¯ä»¥è¢«tagsé…ç½®ï¼Œæ­¤æ—¶å¿…é¡»æŠŠ<code>tags</code>å­—æ®µä½œä¸ºå±æ€§æ”¾åˆ°<code>&lt;script&gt;</code>ä¸­ï¼ŒåŒæ—¶æ³¨æ„åŸæ¥çš„<code>lang</code>å±æ€§è¿˜è¦ä¿ç•™ã€‚æ¯”å¦‚ï¼šå¼€å‘è€…å¯èƒ½æƒ³åœ¨æ’ä»¶çš„ç¨³å®šç‰ˆå’Œå¼€å‘ç‰ˆä¹‹é—´è‡ªç”±åˆ‡æ¢ã€‚é‚£ä¹ˆå¯ä»¥å®šä¹‰è¿™æ ·çš„æ ‡ç­¾ï¼š <code>&quot;tags&quot;: [&quot;stable&quot;, &quot;dev&quot;]</code>ï¼ŒåŒæ—¶å®šä¹‰ä¸¤ä¸ªè„šæœ¬å—ï¼š<code>&lt;script lang=&quot;python&quot; tag=&quot;stable&quot;&gt;</code> å’Œ <code>&lt;script lang=&quot;python &quot;tag=&quot;dev&quot;&gt;</code>ã€‚åœ¨å¼€å‘å’Œæµ‹è¯•æ’ä»¶æ—¶ï¼ŒImJoy ç¼–è¾‘å™¨ä¼šè¯†åˆ«æ’ä»¶æœ‰å¤šä¸ªæ ‡ç­¾ï¼Œæ­¤æ—¶é€‰æ‹©å…¶ä¸­ä¸€ä¸ªæ ‡ç­¾ï¼Œé‚£ä¹ˆåŠ è½½æ’ä»¶æ—¶å°±ä¼šåŠ è½½æ­¤æ ‡ç­¾ä¸‹çš„ç›¸åº”ä»£ç ã€‚</p><h2 id="uiå­—æ®µ"><a href="#uiå­—æ®µ" class="headerlink" title="uiå­—æ®µ"></a>uiå­—æ®µ</h2><p><code>ui</code>å­—æ®µæ˜¯ä¸ºäº†é…ç½®åœ¨æ’ä»¶ä¸‹æ–¹æ˜¾ç¤ºçš„å†…å®¹ã€‚<br>ä»¥HPA Classificationæ’ä»¶ä¸ºä¾‹ï¼Œå®‰è£…å®Œæˆåï¼Œåœ¨ImJoyçš„å·¦ä¾§æ’ä»¶åŒºï¼Œç‚¹å‡»æ’ä»¶å³ä¾§çš„ç®­å¤´ï¼Œä¼šçœ‹åˆ°<code>ui</code>å­—æ®µå®šä¹‰çš„å†…å®¹ï¼š<br><img src="https://user-images.githubusercontent.com/6218739/144191940-48d0ab2b-5c8c-4607-9543-b05daf28a1ee.png" alt="hpa-ui"></p><p>ä»¥ä¸‹æ˜¯<code>ui</code>å­—æ®µçš„ä¸€ä¸ªè¯¦ç»†ç”¨æ³•ç¤ºä¾‹ï¼š<br><img src="https://user-images.githubusercontent.com/6218739/144377959-51a13531-9ce3-4752-8c13-7d841bcec51d.png" alt="ui-full"><br>åŒ…å«äº†å„ç§è¾“å…¥æ¡†çš„ç”¨æ³•ï¼Œä»¥åŠåŒä¸€ä¸ªuiçš„ä¸‰ç§å†™æ³•ï¼š<code>option1</code>ã€<code>option11</code>ã€<code>option12</code>ã€‚<br>å¯¹äºæ¯ä¸ªå…ƒç´ ï¼Œéƒ½å®šä¹‰äº†ä¸€ä¸ªå”¯ä¸€çš„<code>id</code>ï¼Œç„¶åå¯ä»¥ä½¿ç”¨ <code>ctx.config.id</code>æ¥è®¿é—®æ’ä»¶ä¸­æ­¤å…ƒç´ çš„å€¼ã€‚</p><h2 id="flagså­—æ®µ"><a href="#flagså­—æ®µ" class="headerlink" title="flagså­—æ®µ"></a>flagså­—æ®µ</h2><p><code>flags</code>å­—æ®µå®šä¹‰ä¸€ä¸ªæ ‡å¿—æ•°ç»„ï¼Œç”¨æ¥æ§åˆ¶æ’ä»¶çš„è¡Œä¸ºã€‚<br>ä¸€ä¸ªé‡è¦çš„flagæ˜¯ <code>functional</code>ï¼š<code>functional</code>æ ‡å¿—è¡¨ç¤ºæ’ä»¶æš´éœ²çš„æ‰€æœ‰apiå‡½æ•°éƒ½æ˜¯<a href="https://segmentfault.com/a/1190000039807327">çº¯å‡½æ•°</a>ã€‚è¿™æ„å‘³ç€å®ƒä»¬çš„è¾“å‡ºå°†ä»…å–å†³äºè¾“å…¥ã€‚åŒæ—¶çº¯å‡½æ•°ä¿è¯åœ¨è°ƒç”¨ä»»ä½•æ’ä»¶ api å‡½æ•°ä¹‹åå¯¹æ’ä»¶æ²¡æœ‰å‰¯ä½œç”¨ã€‚è¿™æ„å‘³ç€åº”è¯¥é¿å…ä¿®æ”¹æ’ä»¶å‡½æ•°ä¸­çš„å…¨å±€å˜é‡ï¼ˆä¸è¿‡ä¸€ä¸ªä¾‹å¤–æ˜¯<code>setup()</code> å‡½æ•°ï¼‰ã€‚<br>ä½¿ä¸€ä¸ªæ’ä»¶å…·æœ‰<code>functional</code>æ ‡å¿—ï¼Œå¯ä»¥ä½¿è°ƒè¯•æ›´å®¹æ˜“ï¼Œé‡è¦çš„æ˜¯å…¶ä»–æ’ä»¶æˆ–å·¥ä½œæµè°ƒç”¨<code>functional</code>æ’ä»¶æ—¶èƒ½ä¸¥æ ¼é‡ç°å…¶è¡Œä¸ºã€‚<code>functional</code>æ’ä»¶å¯¹äº ImJoy åœ¨å°†æ¥æ‰§è¡Œå¹¶è¡ŒåŒ–å’Œæ‰¹å¤„ç†æ—¶è‡³å…³é‡è¦ã€‚<br>ä½œè€…è¿˜æ²¡æœ‰ç¼–å†™çœŸæ­£çš„æµ‹è¯•æ¥éªŒè¯æ’ä»¶æ˜¯å¦æ˜¯<code>functional</code>ï¼Œæ‰€ä»¥å½“å‰éœ€è¦ç¡®å®šè‡ªå·±çš„æ’ä»¶ä»…åŒ…å«çº¯å‡½æ•°æ—¶æ‰æ·»åŠ  <code>functional</code> æ ‡å¿—ã€‚<br>æ­¤å¤–ï¼Œ<code>flags</code>è¿˜æ”¯æŒè¿è¡Œæ—¶æ§åˆ¶ã€‚è¿™äº›æ ‡å¿—å…è®¸ç”¨æˆ·ç•Œé¢å’Œæ’ä»¶å¼•æ“å¦‚ä½•å¤„ç† ImJoy å®ä¾‹ï¼š</p><ul><li><code>single-instance</code>ï¼ˆä»…é€‚ç”¨äº python æ’ä»¶ï¼‰ï¼šåœ¨æ­¤æ ‡å¿—ä¸‹ï¼ŒPythonå¼•æ“åªä¼šè¿è¡Œä¸€ä¸ªæ’ä»¶è¿›ç¨‹ï¼Œå³ä½¿ä»ä¸åŒçš„æµè§ˆå™¨æˆ–å·¥ä½œåŒºè°ƒç”¨äº†è¯¥æ’ä»¶ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸åŒçš„ ImJoy å®ä¾‹å°†å…±äº«ç›¸åŒçš„æ’ä»¶è¿›ç¨‹ã€‚å½“æ’ä»¶éœ€è¦ç‹¬å æœ‰é™çš„èµ„æºï¼ˆä¾‹å¦‚ GPUï¼‰æ—¶ï¼Œè¿™å°¤å…¶æœ‰ç”¨ã€‚</li><li><code>allow-detach</code>ï¼ˆä»…é€‚ç”¨äº python æ’ä»¶ï¼‰ï¼šåœ¨æ­¤æ ‡å¿—ä¸‹ï¼Œå…è®¸æ’ä»¶è¿›ç¨‹ä¸ç”¨æˆ·ç•Œé¢åˆ†ç¦»ã€‚è¿™æ„å‘³ç€å½“ç”¨æˆ·ç•Œé¢æ–­å¼€æˆ–å…³é—­æ—¶ï¼Œæ’ä»¶ä¸ä¼šè¢«æ€æ­»ã€‚ç„¶è€Œï¼Œä¸ºäº†é‡æ–°è¿æ¥åˆ°è¿™ä¸ªè¿›ç¨‹ï¼Œéœ€è¦ä»åŒä¸€ä¸ªæµè§ˆå™¨å’Œç›¸åŒçš„å·¥ä½œåŒºé‡æ–°è¿æ¥ï¼Œæˆ–æ·»åŠ  <code>single-instance</code> æ ‡å¿—ã€‚æ¯”å¦‚ï¼šå¦‚æœæƒ³åˆ¶ä½œä¸€ä¸ªæ’ä»¶ï¼Œå®ƒå¯ä»¥åœ¨æ²¡æœ‰ç”¨æˆ·ç•Œé¢çš„æƒ…å†µä¸‹åœ¨åå°è¿è¡Œï¼Œé‚£å°±å¯¹è¯¥æ’ä»¶èµ‹äºˆ<code>&quot;flags&quot;: [&quot;single-instance&quot;, &quot;allow-detach&quot;]</code>ã€‚é‚£ä¹ˆé‡æ–°å¯åŠ¨æ—¶ï¼Œç”¨æˆ·ç•Œé¢å°†è‡ªåŠ¨é‡æ–°è¿æ¥åˆ°æ­¤è¿›ç¨‹ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœå¤šä¸ª ImJoy å®ä¾‹é™„åŠ åˆ°æ­¤æ’ä»¶è¿›ç¨‹ï¼Œæ¯ä¸ªå®ä¾‹éƒ½ä¼šè°ƒç”¨ <code>setup()</code> å‡½æ•°ã€‚è¿™å¯èƒ½ä¼šå¯¼è‡´å†²çªï¼Œå› æ­¤å»ºè®® (1) å°†ä¸æ¥å£ç›¸å…³çš„ä»£ç ä¿ç•™åœ¨ <code>setup()</code> ä¸­ï¼Œä¾‹å¦‚<code>api.register()</code>; (2)å°†åªæƒ³æ¯ä¸ªè¿›ç¨‹è¿è¡Œä¸€æ¬¡çš„ä»£ç ç§»åŠ¨åˆ°æ’ä»¶ç±»çš„<code>__init__</code> å‡½æ•°ä¸­ã€‚</li></ul><h2 id="iconå­—æ®µ"><a href="#iconå­—æ®µ" class="headerlink" title="iconå­—æ®µ"></a>iconå­—æ®µ</h2><p>å®šä¹‰æ’ä»¶èœå•ä¸­ä½¿ç”¨çš„å›¾æ ‡ã€‚å¯ä»¥é€‰æ‹©ä»¥ä¸‹æ ¼å¼ï¼š<br>ï¼ˆ1ï¼‰åœ¨<a href="https://material.io/tools/icons/">https://material.io/tools/icons/</a>æ‰¾åˆ°å›¾æ ‡ï¼Œç›´æ¥ä½¿ç”¨æŒ‡å®šçš„åç§°å³å¯ï¼›<br><img src="https://user-images.githubusercontent.com/6218739/144605127-ece26296-0933-4534-a798-cba6c4f0ace5.png" alt="icon"><br>å®æµ‹ä½¿ç”¨è¯¥ç½‘ç«™ä¸Šçš„å›¾æ ‡åç§°æ—¶ï¼Œä¸èƒ½ä½¿ç”¨å¸¦ç©ºæ ¼çš„åç§°ï¼Œä»¥åŠå…¨éƒ¨è¦ç”¨å°å†™ã€‚<br>ï¼ˆ2ï¼‰å¯ä»¥ç›´æ¥å¤åˆ¶ç²˜è´´emojiç¬¦å·ï¼Œä¾‹å¦‚ä»<a href="https://getemoji.com/">è¿™é‡Œ</a>ã€‚<br><img src="https://user-images.githubusercontent.com/6218739/144605559-f3a9798b-23e1-4427-8185-3de397873d6c.png" alt="emoji"><br>ï¼ˆ3ï¼‰æŒ‡å®š JPEGã€PNG æˆ– GIF æ ¼å¼å›¾åƒçš„ URLï¼Œæ¨èå¤§å°ï¼š64x64ã€‚<br><img src="https://user-images.githubusercontent.com/6218739/144605914-ada14870-30c1-45f8-b563-db5439a4710f.png" alt="gif-icon"><br>ï¼ˆ4ï¼‰å¦‚æœè®¾ç½®ä¸º<code>null</code>æˆ–<code>&quot;&quot;</code>ï¼Œå®ƒä¼šé»˜è®¤ä½¿ç”¨ç¬¬ä¸€æ¡çš„material iconçš„<code>extension</code>å›¾æ ‡ã€‚</p><h2 id="inputså­—æ®µ"><a href="#inputså­—æ®µ" class="headerlink" title="inputså­—æ®µ"></a>inputså­—æ®µ</h2><p>å®šä¹‰ç”¨äºè§¦å‘æ’ä»¶çš„è¾“å…¥æ¡ä»¶ï¼ŒåŒ…æ‹¬æ–‡ä»¶è¾“å…¥æˆ–æ•°æ®åŒ¹é…æ¨¡å¼ã€‚ä¾‹å¦‚ï¼Œå½“ç”¨æˆ·å°†æŸä¸ªåç¼€çš„æ–‡ä»¶æ‹–æ”¾åˆ°å·¥ä½œåŒºæ—¶ï¼Œç›¸åº”çš„æ’ä»¶è¢«æ¿€æ´»ã€‚<br>åŸºæœ¬ä¸Šå¯ä»¥ä½¿ç”¨æ ‡å‡†çš„ json æ¨¡å¼ï¼ˆ<a href="http://json-schema.org/ï¼‰æ¥éªŒè¯è¾“å…¥æ•°æ®å¯¹è±¡ã€‚ä¾‹å¦‚ï¼Œè¦å®šä¹‰æ’ä»¶ä½¿ç”¨">http://json-schema.org/ï¼‰æ¥éªŒè¯è¾“å…¥æ•°æ®å¯¹è±¡ã€‚ä¾‹å¦‚ï¼Œè¦å®šä¹‰æ’ä»¶ä½¿ç”¨</a> png æ–‡ä»¶ï¼Œå¯ä»¥æŒ‡å®š <code>&quot;inputs&quot;: &#123;&quot;type&quot;: &quot;object&quot;, &quot;properties&quot;: &#123;&quot;name&quot;: &#123;&quot;type&quot;: &quot;string&quot;, &quot;maxLength&quot; : 100&#125;&#125;, &quot;required&quot;: [&quot;name&quot;]&#125;</code>ã€‚åœ¨åå°ï¼ŒImJoyä½¿ç”¨ <a href="https://github.com/epoberezkin/ajv">ajv</a> åº“æ¥éªŒè¯å¯¹è±¡ã€‚ä¸ºäº†ç®€åŒ–æ¨¡å¼çš„ä½¿ç”¨ï¼Œè¿˜ä½¿ç”¨ä»¥ä¸‹å…³é”®å­—æ‰©å±•äº†æ ‡å‡†çš„ json æ¨¡å¼ï¼š<br>ï¼ˆ1ï¼‰<code>file</code>ï¼šå¯¹äºæ–‡ä»¶å¯¹è±¡ï¼Œä½¿ç”¨ <a href="https://en.wikipedia.org/wiki/Media_type">mime types</a> æˆ–æ–‡ä»¶æ‰©å±•åã€‚å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å…³é”®å­—ä¹‹ä¸€ï¼š</p><ul><li><code>mime</code>ï¼šå¸¸è§çš„ mime ç±»å‹å­—ç¬¦ä¸²ï¼ˆæˆ–åˆ—è¡¨ï¼‰ã€‚ä¾‹å¦‚<code>&#123;&quot;file&quot;: &#123;&quot;mime&quot;: &quot;image/png&quot;&#125;&#125;</code>ã€‚è¿˜å¯ä»¥æŒ‡å®šä¸€ä¸ª mime ç±»å‹åˆ—è¡¨ï¼š<code>&quot;mime&quot;: [&quot;image/png&quot;, &quot;image/jpeg&quot;, &quot;image/tiff&quot;]</code>ã€‚</li><li><code>ext</code>ï¼šæ–‡ä»¶æ‰©å±•åå­—ç¬¦ä¸²ï¼ˆæˆ–åˆ—è¡¨ï¼‰ã€‚ä¾‹å¦‚<code>&#123;&quot;file&quot;: &#123;&quot;ext&quot;: &quot;png&quot;&#125;&#125;</code>ï¼Œæˆ–è€…å¯ä»¥æŒ‡å®šä¸€ä¸ªæ‰©å±•ååˆ—è¡¨ï¼š<code>&#123;&quot;file&quot;: &#123;&quot;ext&quot;: [&quot;png&quot;, &quot;jpg&quot;, &quot; jpeg&quot;]&#125;&#125;</code>ã€‚</li></ul><p>ï¼ˆ2ï¼‰<code>ndarray</code>ï¼šä¾‹å¦‚<code>&#123;&quot;ndarray&quot;: &#123;&quot;shape&quot;: [10, 10], &quot;dtype&quot;: &quot;uint8&quot;&#125;&#125;</code>ã€‚</p><ul><li><code>shape</code>ï¼šæ•°ç»„çš„å½¢çŠ¶ã€‚éœ€è¦ä¸ºæ¯ä¸ªç»´åº¦æŒ‡å®šä¸€ä¸ªæ•°å­—ï¼Œæˆ–è€…ä½¿ç”¨ <code>null</code> è¡¨ç¤ºè¯¥ç»´åº¦çš„ä»»ä½•å¤§å°ã€‚ä¾‹å¦‚ï¼š<code>&#123;&quot;type&quot;: &quot;ndarray&quot;, &quot;shape&quot;: [10, 10]&#125;</code>ï¼Œæˆ–è€…å¦‚æœç¬¬ä¸€ç»´å¯ä»¥æ˜¯ä»»æ„å¤§å°ï¼š<code>&#123;&quot;type&quot;: &quot;ndarray&quot;, &quot;shape&quot;: [nullï¼Œ10]&#125;</code></li><li><code>dtype</code>ï¼šæ•°ç»„çš„æ•°æ®ç±»å‹ã€‚ä¾‹å¦‚ï¼š<code>&#123;&quot;ndarray&quot;: &#123;&quot;dtype&quot;: &quot;uint8&quot;&#125;&#125;</code> æˆ–è€…å¦‚æœåŒæ—¶æ”¯æŒ <code>uint8</code> å’Œ <code>float32</code>ï¼š<code>&#123;&quot;ndarray&quot;: &#123;&quot;dtype&quot;: [&quot;uint8&quot;, &quot; float32&quot;]&#125;&#125;</code>ã€‚æ”¯æŒçš„ <code>dtype</code> æ˜¯ï¼š<code>[&quot;int8&quot;, &quot;int16&quot;, &quot;int32&quot;, &quot;uint8&quot;, &quot;uint16&quot;, &quot;uint32&quot;, &quot;float32&quot;, &quot;float64&quot;, &quot;array&quot;]</code>ã€‚</li><li><code>ndim</code>ï¼šç»´æ•°ã€‚ä¾‹å¦‚ï¼š<code>&#123;&quot;ndarray&quot;: &#123;&quot;ndim&quot;: 2&#125;&#125;</code> æˆ–è€…å¦‚æœåŒæ—¶æ”¯æŒ 2D å’Œ 3Dï¼š<code>&#123;&quot;ndarray&quot;: &#123;&quot;ndim&quot;: [2, 3]&#125;&#125;</code></li></ul><p>ï¼ˆ3ï¼‰å¯¹äºé€šè¿‡ http æˆ–å…¶ä»–åè®®æš´éœ²çš„è¿œç¨‹ urlï¼Œ<code>&#123;&quot;type&quot;: &quot;url&quot;, &quot;extension&quot;: &quot;zarr&quot;&#125;</code>ã€‚<br>å¦å¤–éœ€æ³¨æ„ï¼Œå¦‚æœåœ¨æ¨¡å¼ä¸­ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ¥éªŒè¯å­—ç¬¦ä¸²ï¼Œå¯èƒ½éœ€è¦è®¾ç½® <code>maxLength</code>ï¼Œå¦åˆ™å®ƒä¼šéå¸¸æ…¢ï¼Œç”šè‡³åœ¨éªŒè¯é•¿å­—ç¬¦ä¸²æ—¶å¯èƒ½ä¼šå´©æºƒã€‚ä¾‹å¦‚ï¼Œå¦‚æœæƒ³åŒ¹é…ä¸€ä¸ªåŒ…å«ä»¥<code>.tiff</code>ç»“å°¾çš„<code>file_name</code>çš„å¯¹è±¡ï¼Œé‚£ä¹ˆå¯ä»¥è¿™æ ·è®¾ç½®ï¼š<code>&#123;&quot;properties&quot;: &#123;&quot;file_name&quot;: &#123;&quot;type&quot;: &quot;string&quot;,&quot;pattern&quot;: &quot;.*\\.tiff$&quot;, &quot;maxLength&quot;: 1024&#125;&#125;&#125;</code>ã€‚</p><h2 id="outputså­—æ®µ"><a href="#outputså­—æ®µ" class="headerlink" title="outputså­—æ®µ"></a>outputså­—æ®µ</h2><p>ä½¿ç”¨ json-schema è¯­æ³• (<a href="http://json-schema.org/">http://json-schema.org/</a>) å®šä¹‰è¾“å‡ºã€‚<br>æ ¼å¼ä¸<code>inputs</code>ç›¸åŒã€‚</p><h2 id="permissionså­—æ®µ"><a href="#permissionså­—æ®µ" class="headerlink" title="permissionså­—æ®µ"></a>permissionså­—æ®µ</h2><p>å¯¹äº <code>window</code> æ’ä»¶ï¼Œå¯ä»¥å£°æ˜ä»¥ä¸‹æƒé™ï¼š</p><ul><li>æ‘„åƒå¤´camera</li><li>éŸ³ä¹æ•°å­—æ¥å£midi</li><li>åœ°ç†ä½ç½®geolocation</li><li>éº¦å…‹é£microphone</li><li>åŠ å¯†åª’ä½“encryted-media</li><li>å…¨å±full-screen</li><li>æ”¯ä»˜è¯·æ±‚payment-request</li></ul><p>ä¾‹å¦‚ï¼Œå¦‚æœæŸä¸ª<code>window</code>æ’ä»¶éœ€è¦ç½‘ç»œæ‘„åƒå¤´çš„è®¿é—®æƒé™ï¼Œéœ€è¦æ·»åŠ ä»¥ä¸‹æƒé™ï¼š<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">â€œpermissionsâ€ï¼š[â€œcameraâ€]ï¼Œ</span><br></pre></td></tr></table></figure><br>æ³¨æ„ï¼Œæ‘„åƒå¤´å’Œéº¦å…‹é£ç­‰è®¾å¤‡åªæœ‰åœ¨ ImJoy ä¸º <code>https</code> æ—¶æ‰èƒ½å·¥ä½œï¼Œè¿™æ„å‘³ç€å¦‚æœæ˜¯ä»<a href="https://imjoy.io">https://imjoy.io</a> è¿è¡Œè¿™ä¸ªæ’ä»¶ï¼Œé‚£ä¹ˆæ˜¯å¯ä»¥å·¥ä½œçš„ï¼Œä½†å¦‚æœä½¿ç”¨çš„æ˜¯è‡ªå·±æ‰˜ç®¡çš„ä»¥<code>http</code>åè®®è®¿é—®çš„ImJoyæœåŠ¡å™¨ï¼Œé‚£ä¹ˆå®ƒå°±ä¸ä¼šè¿è¡Œã€‚è§£å†³æ–¹æ³•æ˜¯ä½¿ç”¨éš§é“æœåŠ¡ï¼Œä¾‹å¦‚ä½¿ç”¨ <a href="https://telebit.cloud">Telebit</a> æˆ– <a href="https://ngrok.com">ngrok</a> å°† <code>http</code> url è½¬æ¢ä¸º <code>https</code>ã€‚</p><h2 id="dependencieså­—æ®µ"><a href="#dependencieså­—æ®µ" class="headerlink" title="dependencieså­—æ®µ"></a>dependencieså­—æ®µ</h2><p>è¯¥å­—æ®µæŒ‡å®šå½“å‰æ’ä»¶ä¾èµ–çš„å…¶ä»–ImJoyæ’ä»¶ã€‚è¿™äº›æ‰€ä¾èµ–çš„æ’ä»¶å°†åœ¨å®‰è£…è¿‡ç¨‹ä¸­è‡ªåŠ¨å®‰è£…ã€‚<br>è¦å®šä¹‰ä¾èµ–é¡¹ï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹æ ¼å¼ï¼š<br>1) å¯¹äºæ²¡æœ‰tagçš„ä¾èµ–ï¼Œä½¿ç”¨ <code>REPOSITORY:PLUGIN_NAME</code> æˆ– <code>PLUGIN_URL</code>ï¼Œä¾‹å¦‚ï¼š<code>imjoy-team/imjoy-plugins:Image Window</code>ï¼›<br>2) å¯¹äºå¸¦æœ‰æŒ‡å®štagçš„ä¾èµ–ï¼Œä½¿ç”¨<code>REPOSITORY:PLUGIN_NAME@TAG</code> æˆ–<code>PLUGIN_URL@TAG</code>ï¼Œä¾‹å¦‚ï¼š<code>imjoy-team/imjoy-plugins:Unet Segmentation@GPU</code>ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ ‡ç­¾â€œGPUâ€ç”¨äºæŒ‡å®šæ‰˜ç®¡åœ¨ GitHub å­˜å‚¨åº“<code>imjoy-team/imjoy-plugins</code>ï¼ˆ<a href="https://github.com/imjoy-team/ï¼‰ä¸Šçš„åä¸º`Unet">https://github.com/imjoy-team/ï¼‰ä¸Šçš„åä¸º`Unet</a> Segmentation<code>çš„æ’ä»¶ã€‚å¦‚æœæ’ä»¶æ²¡æœ‰æ‰˜ç®¡åœ¨GitHubä¸Šæˆ–è€…è¯¥GitHubä»“åº“ä¸æ˜¯ImJoyæ’ä»¶ä»“åº“çš„æ ‡å‡†æ ¼å¼ï¼ˆå³åœ¨ä»“åº“çš„æ ¹ç›®å½•ä¸­æ²¡æœ‰å®šä¹‰</code>manifest.imjoy.json<code>æ–‡ä»¶ï¼‰ï¼Œåˆ™å¯ä»¥ç›´æ¥ä½¿ç”¨ urlï¼Œä¾‹å¦‚ï¼š</code><a href="https://github.com/imjoy-team/imjoy-demo-plugins/blob/master/repository/3dDemos.imjoy.html`ï¼ˆæ ‡ç­¾å¯ä»¥ç”¨`@TAG`æ·»åŠ ï¼‰ã€‚">https://github.com/imjoy-team/imjoy-demo-plugins/blob/master/repository/3dDemos.imjoy.html`ï¼ˆæ ‡ç­¾å¯ä»¥ç”¨`@TAG`æ·»åŠ ï¼‰ã€‚</a></p><h2 id="defaultå­—æ®µ"><a href="#defaultå­—æ®µ" class="headerlink" title="defaultå­—æ®µ"></a>defaultå­—æ®µ</h2><p>ä»…é€‚ç”¨äº<code>window</code>æ’ä»¶ï¼Œç”¨äºå®šä¹‰ä¸€ä¸ªå¯¹è±¡çš„é»˜è®¤å€¼ã€‚<br>ä¾‹å¦‚ï¼Œå¯ä»¥é€šè¿‡è®¾ç½® <code>&quot;defaults&quot;: &#123;&quot;w&quot;: 10, &quot;h&quot;: 7&#125;</code> æ¥æŒ‡å®šé»˜è®¤çª—å£å¤§å°ã€‚<br>æˆ–è€…ï¼Œå¯ä»¥ä½¿ç”¨ <code>&quot;defaults&quot;: &#123;&quot;fullscreen&quot;: true&#125;</code> é»˜è®¤ä½¿çª—å£å¤„äºå…¨å±æ¨¡å¼ã€‚<br>è¦ä½¿çª—å£é»˜è®¤å¤„äºç‹¬ç«‹æ¨¡å¼ï¼ˆå…¨å±å¹¶ä¸å·¥ä½œåŒºåˆ†ç¦»ï¼‰ï¼Œå¯ä»¥è®¾ç½® <code>&quot;defaults&quot;: &#123;&quot;standalone&quot;: true&#125;</code>ã€‚<br>å¦‚æœè¦å°†çª—å£æ˜¾ç¤ºä¸ºå¯¹è¯æ¡†ï¼Œè®¾ç½® <code>&quot;defaults&quot;: &#123;&quot;as_dialog&quot;: true&#125;</code>ã€‚</p><h2 id="base-frameå­—æ®µ"><a href="#base-frameå­—æ®µ" class="headerlink" title="base_frameå­—æ®µ"></a>base_frameå­—æ®µ</h2><p>ä»…é€‚ç”¨äºwindowæ’ä»¶ï¼Œå®šä¹‰åœ¨è¯¥çª—å£æ’ä»¶ä¸­å†…åµŒçš„å¤–éƒ¨htmlçš„urlè·¯å¾„ã€‚<br>è™½ç„¶å¯ä»¥åœ¨<code>base_frame</code>å­—æ®µä¸­ä½¿ç”¨ä»»ä½•å…¶ä»–ç½‘ç«™çš„urlï¼Œä½†æ˜¯ä¸ºäº†Imjoyå†…æ ¸å¯ä»¥ä¸è¯¥htmlè¿›è¡Œé€šä¿¡ï¼Œå®ƒéœ€è¦æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š<br>ï¼ˆ1ï¼‰è¯¥ç½‘ç«™éœ€è¦å…è®¸åµŒå…¥ï¼Œä¸è¿‡è¿™å¹¶ä¸æ€»æ˜¯èƒ½å¤Ÿæœ‰æ•ˆï¼Œå› ä¸ºå®ƒä»¬å¯èƒ½æœ‰ä¸¥æ ¼çš„ <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP">å†…å®¹å®‰å…¨ç­–ç•¥</a>çš„é™åˆ¶ï¼Œé€šå¸¸æ˜¯é€šè¿‡<code>X-Content-Security-Policy</code>çš„headerï¼Œæˆ–é¡µé¢ä¸­çš„ <code>&lt;meta&gt;</code> å…ƒç´ æ¥å®ç°è¯¥é™åˆ¶ã€‚è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¦‚æœä½ å¯ä»¥æ§åˆ¶è¯¥ç«™ç‚¹ï¼Œéœ€è¦å°† <code>*.imjoy.io</code> æ·»åŠ åˆ°headerä¸­ã€‚<br>ï¼ˆ2ï¼‰åœ¨<code>base_frame</code>é‡Œé¢ï¼Œéœ€è¦å¼€å¯<code>imjoy-rpc</code>åè®®ã€‚è¿™å¯ä»¥æŒ‰ç…§ <a href="https://github.com/imjoy-team/ImJoy-core">imjoy-core</a> ä»“åº“ä¸­çš„è¯´æ˜è½»æ¾æå®šã€‚å‚è€ƒâ€œImJoy RPC library to your websiteâ€è¿™ä¸€éƒ¨åˆ†è¿›è¡Œæ“ä½œï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯éœ€è¦å¯¼å…¥<code>imjoy-loader</code>ï¼Œå¹¶åŠ è½½imjoy RPCåº“ï¼Œç„¶åå¯¼å‡ºæƒ³å…¬å¼€ç»™å…¶ä»–ImJoyæ’ä»¶çš„apiã€‚<br>å®Œæˆä¸Šè¿°æ“ä½œåï¼Œå°±å¯ä»¥å°†ç¬¬ä¸‰æ–¹ç½‘ç«™é›†æˆä¸ºä¸€ä¸ªImJoyæ’ä»¶ã€‚</p><h2 id="runnable"><a href="#runnable" class="headerlink" title="runnable"></a>runnable</h2><p>å®šä¹‰æ’ä»¶æ˜¯å¦å¯ä»¥é€šè¿‡ç‚¹å‡»æ’ä»¶èœå•æ¥æ‰§è¡Œï¼ˆé»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰æ’ä»¶éƒ½æ˜¯<code>runnable</code>ï¼‰ã€‚<br>å¯¹äºä¸å•ç‹¬è¿è¡Œçš„è¾…åŠ©æ’ä»¶ï¼Œï¼ˆä¾‹å¦‚ï¼Œ<code>native-python</code> æ’ä»¶å¯ä»¥è¢«<code>window</code> æ’ä»¶è°ƒç”¨ï¼Œä¸ä¸€å®šç”±ç”¨æˆ·ç›´æ¥æ‰§è¡Œï¼‰ï¼Œè®¾ç½®<code>&quot;runnable&quot;: false</code> ä¼šå‘ä¸‹ç§»åŠ¨æ’ä»¶åˆ°æ’ä»¶èœå•çš„åº•éƒ¨ï¼Œå¹¶ä½¿å…¶ä¸å¯ç‚¹å‡»ã€‚</p><h1 id="docså—"><a href="#docså—" class="headerlink" title="docså—"></a>docså—</h1><p>åœ¨è¯¥å—ä¸­ï¼Œä½¿ç”¨ Markdown è¯­è¨€æ¥ç¼–å†™æ’ä»¶æ–‡æ¡£ã€‚<br>Markdownè¯­è¨€çš„ä»‹ç»è§<a href="https://guides.github.com/features/mastering-markdown/">è¿™é‡Œ</a>ã€‚<br>æ³¨æ„ï¼Œå¦‚æœåœ¨æ–‡æ¡£ä¸­æä¾›çš„é“¾æ¥å°†åœ¨å¦ä¸€ä¸ªé€‰é¡¹å¡ä¸­æ‰“å¼€ï¼Œåˆ™ ImJoy å®ä¾‹å°†ç»§ç»­è¿è¡Œã€‚</p><h1 id="windowå—"><a href="#windowå—" class="headerlink" title="windowå—"></a>windowå—</h1><p>åœ¨è¯¥å—ä¸­ï¼Œä½¿ç”¨HTML ä»£ç æ¥ç¼–å†™çª—å£çš„æ˜¾ç¤ºå†…å®¹ã€‚<br>ImJoy ä½¿ç”¨ vue.js æ¥è§£ææ’ä»¶æ–‡ä»¶ï¼Œå®ƒå¼ºåˆ¶è¦æ±‚ä»…æœ‰æ ¹å…ƒç´ å­˜åœ¨äºæ¨¡æ¿ä¸­ã€‚è¿™æ„å‘³ç€åœ¨<code>&lt;window&gt;</code>å—ä¸­å¿…é¡»ä½¿ç”¨ä¸€ä¸ª<code>div</code>æ¥åŒ…è£…æ‰€æœ‰èŠ‚ç‚¹ï¼š<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">window</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span> line 1<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span> line 2<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">window</span>&gt;</span></span><br></pre></td></tr></table></figure><br>å¦‚ä¸‹åˆ™ä¸å¯ä»¥ï¼š<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">window</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span> line 1<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span> line 2<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">window</span>&gt;</span></span><br></pre></td></tr></table></figure></p><h1 id="styleå—"><a href="#styleå—" class="headerlink" title="styleå—"></a>styleå—</h1><p>åœ¨è¯¥å—ä¸­ï¼Œä½¿ç”¨CSS ä»£ç æ¥ç¼–å†™çª—å£æ˜¾ç¤ºå†…å®¹çš„æ ·å¼ã€‚</p><p>ä»¥MNIST CNNæ’ä»¶ä¸ºä¾‹ï¼Œç»™å‡ºä»¥ä¸Š<code>&lt;window&gt;</code>å—å’Œ<code>style</code>å—çš„ä¸€ä¸ªè¯´æ˜ï¼š<br><img src="https://user-images.githubusercontent.com/6218739/144701434-77ef0f5c-f952-4bdf-aec7-c5c7209ae7cb.png" alt="html-css"></p><h1 id="scriptå—"><a href="#scriptå—" class="headerlink" title="scriptå—"></a>scriptå—</h1><p>è¯¥å—ä¸­åŒ…å«å®é™…çš„æ’ä»¶ä»£ç ã€‚<br>æ’ä»¶å¯ä»¥ç”¨ JavaScript æˆ– Python ç¼–å†™ï¼Œä¸€ä¸ªæœ€å°çš„æ’ä»¶éœ€è¦å®ç°ä¸¤ä¸ªå‡½æ•°ï¼š<code>setup()</code> å’Œ <code>run()</code>ã€‚æœ‰ä¸€ä¸ªä¾‹å¤–æ˜¯é‚£ç§è¾…åŠ©æ’ä»¶ï¼ˆç”¨ <code>&quot;runnable&quot;: false</code> æŒ‡å®šï¼‰ï¼Œå®ƒä¸éœ€è¦ <code>run()</code> å‡½æ•°ã€‚<br>ï¼ˆ1ï¼‰<code>setup()</code> å‡½æ•°ï¼šåœ¨æ’ä»¶ç¬¬ä¸€æ¬¡åŠ è½½å’Œåˆå§‹åŒ–æ—¶æ‰§è¡Œå®ƒã€‚<br>ï¼ˆ2ï¼‰<code>run()</code> å‡½æ•°ï¼šæ¯æ¬¡æ‰§è¡Œæ’ä»¶æ—¶éƒ½ä¼šè°ƒç”¨ã€‚æ‰§è¡Œæ—¶ï¼Œä¸€ä¸ªå¸¦æœ‰ä¸Šä¸‹æ–‡ï¼ˆåä¸ºâ€œctxâ€ï¼‰çš„å¯¹è±¡objectï¼ˆJavascriptæ’ä»¶ï¼‰æˆ–å­—å…¸dictionaryï¼ˆPythonæ’ä»¶ï¼‰å°†è¢«ä¼ é€’åˆ°å‡½æ•°ä¸­ã€‚è¿”å›çš„ç»“æœå°†æ˜¾ç¤ºä¸ºä¸€ä¸ªæ–°çª—å£æˆ–ä¼ é€’ç»™å·¥ä½œæµä¸­çš„ä¸‹ä¸€ä¸ª <code>op</code>ã€‚æ›´å¤šå†…å®¹è¯·å‚è§å¦ä¸€ç¯‡åšå®¢çš„ <a href="development?id=plugin-during-runtime">è¿è¡Œæ—¶æ’ä»¶</a> éƒ¨åˆ†ã€‚<br>ï¼ˆ3ï¼‰å¯é€‰ï¼š<code>resume()</code> å‡½æ•°ï¼šä»…é€‚ç”¨äºå¸¦æœ‰ <code>allow-detach</code> æ ‡å¿—çš„å¯åˆ†ç¦» <code>native-python</code> æ’ä»¶ã€‚å½“ImJoy é‡æ–°è¿æ¥åˆ°æ­£åœ¨è¿è¡Œçš„æ’ä»¶è¿›ç¨‹æ—¶ï¼Œ<code>resume()</code> å°†è¢«è°ƒç”¨ï¼ˆè€Œä¸æ˜¯ <code>setup()</code>ï¼‰ ã€‚<br>ï¼ˆ4ï¼‰å¯é€‰ï¼š<code>update()</code> å‡½æ•°ï¼šå°†åœ¨æ“ä½œçš„ä»»ä½•è®¾ç½®æ›´æ”¹æ—¶è°ƒç”¨ã€‚<br>ï¼ˆ5ï¼‰å¯é€‰ï¼š<code>exit()</code>å‡½æ•°ï¼šå½“æ’ä»¶è¢«æ€æ­»æ—¶ï¼Œå‡½æ•°<code>exit</code> å°†è¢«è°ƒç”¨ã€‚</p><p><code>&lt;script&gt;</code> å—çš„ <code>lang</code> å±æ€§ç”¨äºæŒ‡å®šä½¿ç”¨çš„ç¼–ç¨‹è¯­è¨€ï¼š<br>ï¼ˆ1ï¼‰å¯¹äº Javascriptï¼Œä½¿ç”¨ <code>&lt;script lang=&quot;javascript&quot;&gt; ... &lt;/script&gt;</code><br>ï¼ˆ2ï¼‰å¯¹äº Pythonï¼Œä½¿ç”¨ <code>&lt;script lang=&quot;python&quot;&gt; ... &lt;/script&gt;</code><br>å¯¹äº Javascript æ’ä»¶ï¼Œè¿˜æ”¯æŒ ES æ¨¡å—ï¼Œè¦å¯ç”¨å®ƒï¼Œå°† <code>type=&quot;module&quot;</code> æ·»åŠ åˆ°<code>&lt;script&gt;</code>æ ‡ç­¾ä¸­ã€‚ä¾‹å¦‚ï¼š<code>&lt;script type=&quot;module&quot; lang=&quot;javascript&quot;&gt;...&lt;/script&gt;</code>ã€‚<br><code>&lt;script&gt;</code> ä¹Ÿæ”¯æŒ <code>tags</code>ï¼Œæœ‰å…³ä¿¡æ¯å‚è€ƒä¸Šé¢çš„<code>tags</code>å­—æ®µçš„è§£æã€‚</p>]]></content>
    
    
    <summary type="html">å‚è€ƒæ–‡çŒ®
Developing Plugins for ImJoy

æ¦‚è§ˆ
ImJoyæ’ä»¶æ–‡ä»¶æœ¬è´¨ä¸Šæ˜¯åŒ…æ‹¬ä¸€ç³»åˆ—è‡ªå®šä¹‰å—çš„htmlæ–‡ä»¶ï¼ˆå—.vue æ ¼å¼å¯å‘ï¼‰ã€‚
å¦‚ä¸‹æ˜¯ä¸€ä¸ªæ’ä»¶æ–‡ä»¶çš„å…¸å‹ç»„æˆã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™äº›å—çš„é¡ºåºæ— å…³ç´§è¦ï¼Œå› æ­¤å¯ä»¥å°†å—æ‰“ä¹±ã€‚
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23


&lt;config lang=&quot;json&quot;&gt;
   ** è¯¥ä»£ç å—ä»¥Jsonæ ¼å¼å®šä¹‰æ’ä»¶çš„å±æ€§**
&lt;/config&gt;

ã€Šscript lang=&quot;javascript&quot;&gt;
   ** è¯¥ä»£ç å—ä»¥JavaScript æˆ– Pyth</summary>
    
    
    
    <category term="computer vision" scheme="http://qixinbo.github.io/categories/computer-vision/"/>
    
    
    <category term="ImJoy" scheme="http://qixinbo.github.io/tags/ImJoy/"/>
    
  </entry>
  
  <entry>
    <title>å¼€æºæ·±åº¦å­¦ä¹ è®¡ç®—å¹³å°ImJoyè§£æï¼š3 -- æ’ä»¶æ¦‚è§ˆ</title>
    <link href="http://qixinbo.github.io/2021/12/01/ImJoy_3/"/>
    <id>http://qixinbo.github.io/2021/12/01/ImJoy_3/</id>
    <published>2021-11-30T16:00:00.000Z</published>
    <updated>2021-12-01T02:12:53.574Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h1><p><a href="https://imjoy.io/docs/#/i2k_tutorial?id=_2-make-your-first-imjoy-plugin">I2K Workshop Tutorial</a><br><a href="https://imjoy.io/docs/#/development">Developing Plugins for ImJoy</a></p><h1 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h1><p>å¼€å‘ImJoyæ’ä»¶æ—¢ç®€å•åˆå¿«é€Ÿï¼Œå¯ç›´æ¥ä½¿ç”¨è¿è¡Œåœ¨webä¸Šçš„å†…ç½®çš„ä»£ç ç¼–è¾‘å™¨ï¼Œè€Œä¸éœ€è¦é¢å¤–çš„ IDE æˆ–ç¼–è¯‘å™¨ã€‚<br>ImJoy æ’ä»¶ç³»ç»Ÿçš„ä¸»è¦åŠŸèƒ½æœ‰ï¼š<br>ï¼ˆ1ï¼‰æ”¯æŒ Python å’Œ JavaScript</p><ul><li>JavaScript æ’ä»¶ä¸å®‰å…¨æ²™ç®±éš”ç¦»</li><li>Python æ’ä»¶åœ¨è‡ªå·±çš„è¿›ç¨‹ä¸­è¿è¡Œ</li><li>ä½¿ç”¨ <code>async/await</code> è¯­æ³•æ”¯æŒå¹¶å‘ API è°ƒç”¨</li><li>æ”¯æŒ Python çš„è™šæ‹Ÿç¯å¢ƒå’Œ pip åŒ…</li><li>æ”¯æŒæ‰˜ç®¡åœ¨ GitHub æˆ– CDN ä¸Šçš„ JavaScript åº“</li></ul><p>ï¼ˆ2ï¼‰åŸç”Ÿæ”¯æŒ n ç»´æ•°ç»„å’Œå¼ é‡</p><ul><li>æ”¯æŒæ¥è‡ª Numpy æˆ– Numjs çš„ ndarrays è¿›è¡Œæ•°æ®äº¤æ¢</li><li>æ”¯æŒç”¨äºæ·±åº¦å­¦ä¹ çš„ Tensorflow.js å’ŒåŸç”Ÿ Tensorflowã€PyTorchã€MxNetç­‰æ·±åº¦å­¦ä¹ åº“</li></ul><p>ï¼ˆ3ï¼‰ä½¿ç”¨ webGLã€Three.js ç­‰3Dåº“æ¸²æŸ“å¤šç»´æ•°æ®<br>ï¼ˆ4ï¼‰ä½¿ç”¨ GitHub éƒ¨ç½²è‡ªå®šä¹‰çš„æ’ä»¶</p><h1 id="ImJoyæ¶æ„"><a href="#ImJoyæ¶æ„" class="headerlink" title="ImJoyæ¶æ„"></a>ImJoyæ¶æ„</h1><p>Imjoy åŒ…å«<strong>ä¸¤ä¸ªä¸»è¦ç»„ä»¶</strong>ï¼š<br>ï¼ˆ1ï¼‰<strong>ImJoy Web App</strong>ï¼šè¿™æ˜¯ImJoy çš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œå®ƒæ˜¯ä¸€ä¸ªwebåº”ç”¨ï¼Œæ‰€ä»¥å¯åœ¨ä¸åŒæ“ä½œç³»ç»Ÿå’Œè®¾å¤‡çš„æµè§ˆå™¨ä¸­è¿è¡Œã€‚å®ƒæä¾›äº†ä¸€ä¸ªçµæ´»çš„æ’ä»¶ç³»ç»Ÿï¼Œå…·æœ‰å·¥ä½œæµå’Œçª—å£ç®¡ç†åŠŸèƒ½ã€‚æ’ä»¶å¯ä»¥ç”¨ä¸åŒçš„ç¼–ç¨‹è¯­è¨€å¼€å‘ï¼ŒåŒ…æ‹¬ JavaScript å’Œ Pythonã€‚æ’ä»¶åŠå…¶æºä»£ç å¯ä»¥ç»„ç»‡åˆ°å·¥ä½œåŒºä¸­å¹¶å­˜å‚¨åœ¨æµè§ˆå™¨æ•°æ®åº“ä¸­ã€‚ Web æ’ä»¶åœ¨ <code>iframe</code> æˆ– <code>webworker</code> ä¸­è¿è¡Œï¼Œå› æ­¤å¼€å‘è€…åŸåˆ™ä¸Šå¯ä»¥ä¸ºæ¯ä¸ªæ’ä»¶ç‹¬ç«‹ä½¿ç”¨ä»»ä½•å‰ç«¯æ¡†æ¶æˆ– javascript åº“ã€‚<br>ï¼ˆ2ï¼‰<strong>Plugin Engine</strong>ï¼šè¿™æ˜¯ä¸€ä¸ªå¯é€‰é¡¹ï¼Œå…¶ç”¨äºåœ¨ CPython ä¸­è¿è¡Œè®¡ç®—ä»»åŠ¡ï¼Œä»¥åˆ©ç”¨æœ¬æœºç¡¬ä»¶ï¼ˆä¾‹å¦‚ GPUï¼‰å’ŒPythonè½¯ä»¶åº“ï¼ˆä¾‹å¦‚ï¼šnumpyã€Tensorflowã€PyTorch ç­‰ï¼‰çš„å¼ºå¤§åŠŸèƒ½ã€‚å®é™…ä¸Šï¼Œè¯¥æ’ä»¶å¼•æ“æ˜¯ä¸€ä¸ªåœ¨åå°è¿è¡Œå¹¶é€šè¿‡ websocket è¿æ¥åˆ° ImJoy Web App çš„ Python åŒ… (<a href="https://github.com/imjoy-team/imjoy-engine">GitHub</a>)ã€‚å®ƒä½¿ç”¨ <a href="https://conda.io/">conda</a> æ¥ç®¡ç†è½¯ä»¶åŒ…ï¼ˆä¸ä»…æ˜¯ Pythonï¼Œè¿˜æœ‰ C++ã€Java ç­‰ï¼‰å’Œè™šæ‹Ÿç¯å¢ƒã€‚ç„¶åå¼€å‘è€…å¯ä»¥å°†å…·ä½“çš„<code>conda</code> æˆ– <code>pypi</code> åŒ…ä½œä¸ºéœ€æ±‚æ·»åŠ åˆ°æ’ä»¶ä¸­ï¼Œå®ƒä»¬å¯ä»¥ç”±æ’ä»¶å¼•æ“è‡ªåŠ¨è§£æã€‚åŒæ ·ï¼Œå¼€å‘äººå‘˜å¯ä»¥åœ¨ Python æ’ä»¶ä¸­ä½¿ç”¨ä»»ä½• Python åº“ç”šè‡³é Python åº“ã€‚<br><img src="https://user-images.githubusercontent.com/6218739/144013956-2be625bd-3a30-4c10-be13-c138513d25be.png" alt="full-arch"></p><p>Plugin Engine é€šè¿‡ websockets ä¸ ImJoy Web App è¿æ¥ï¼Œ å¹¶ä¸ä¸€ä¸ªåŸºäº <a href="https://github.com/miguelgrinberg/python-socketio">socket.io</a> å®šåˆ¶åŒ–çš„RPCï¼ˆremote procedure callsï¼‰è¿›è¡Œé€šä¿¡ã€‚</p><h1 id="ä»€ä¹ˆæ˜¯ImJoyæ’ä»¶"><a href="#ä»€ä¹ˆæ˜¯ImJoyæ’ä»¶" class="headerlink" title="ä»€ä¹ˆæ˜¯ImJoyæ’ä»¶"></a>ä»€ä¹ˆæ˜¯ImJoyæ’ä»¶</h1><p>ç®€è€Œè¨€ä¹‹ï¼ŒImJoyæ’ä»¶æ˜¯ä¸€ä¸ªè„šæœ¬ï¼Œå®ƒç”Ÿæˆä¸€ç»„å¯ä»¥è¢«ImJoyå†…æ ¸æˆ–å…¶ä»–æ’ä»¶è°ƒç”¨çš„æœåŠ¡å‡½æ•°ï¼ˆåˆåæ’ä»¶ API å‡½æ•°ï¼‰ã€‚<br>ç›®å‰æœ‰ 4 ç§å¸¸è§çš„æ’ä»¶ç±»å‹ï¼š<code>window</code>ã€<code>web-worker</code>ã€<code>web-python</code>ã€<code>native-python</code>ã€‚<br>ï¼ˆ1ï¼‰Web æ’ä»¶ç›´æ¥åœ¨æµè§ˆå™¨ä¸­è¿è¡Œï¼Œæ”¯æŒå¦‚ä¸‹ä¸‰ç§ç±»å‹ï¼š</p><ul><li>Window (HTML/CSS/JS)(<code>type=window</code>) æ’ä»¶ï¼Œç”¨äºä½¿ç”¨ HTML5/CSS å’Œ JavaScript æ„å»ºä¸°å¯Œçš„äº¤äº’å¼ç”¨æˆ·ç•Œé¢ï¼›</li><li>Web Worker (JS)(type=<code>web-worker</code>) æ’ä»¶ï¼Œç”¨äºä½¿ç”¨ JavaScript æˆ– WebAssembly æ‰§è¡Œè®¡ç®—ä»»åŠ¡ï¼›</li><li>Web Python(type=<code>web-python</code>) æ’ä»¶ï¼Œç”¨äºåœ¨æµè§ˆå™¨ä¸­é€šè¿‡ WebAssembly å’Œ <a href="https://github.com/iodide-project/pyodide">pyodide</a> ä½¿ç”¨ Python æ‰§è¡Œè®¡ç®—ä»»åŠ¡ã€‚è¿™æ ·çš„æ’ä»¶ç”¨å°è›‡ğŸå›¾æ ‡è¡¨ç¤ºã€‚è¿™å¤„äºå¼€å‘é˜¶æ®µï¼Œç›®å‰ä»…æ”¯æŒé€‰å®šæ•°é‡çš„ Python åº“ã€‚</li></ul><p>ï¼ˆ2ï¼‰Nativeæ’ä»¶åœ¨æ’ä»¶å¼•æ“ä¸­è¿è¡Œï¼Œç›®å‰æ”¯æŒï¼š</p><ul><li>Native Python(type=<code>native-python</code>) æ’ä»¶ï¼Œå¯ä½¿ç”¨ Python åŠå…¶å¤§é‡åº“å‡½æ•°æ¥æ‰§è¡Œç¹é‡è®¡ç®—ä»»åŠ¡ï¼Œä¸è¿‡è¿™éœ€è¦é¢å¤–å®‰è£…æ’ä»¶å¼•æ“ã€‚è¿™äº›æ’ä»¶ç”¨ç«ç®­ğŸš€å›¾æ ‡è¡¨ç¤ºã€‚</li></ul><h2 id="Windowæ’ä»¶"><a href="#Windowæ’ä»¶" class="headerlink" title="Windowæ’ä»¶"></a>Windowæ’ä»¶</h2><p>Window æ’ä»¶ç”¨äºåˆ›å»ºä¸€ä¸ªåŒ…å« HTML/CSS å’Œ JavaScript çš„æ–° Web ç•Œé¢ã€‚å…¶æ˜¯åœ¨<code>iframe</code>æ¨¡å¼ä¸‹åˆ›å»ºçš„ï¼Œå°†æ˜¾ç¤ºä¸ºä¸€ä¸ªçª—å£ã€‚ <code>&lt;window&gt;</code> å’Œ <code>&lt;style&gt;</code>å—ï¼ˆè§ä»¥åæ’ä»¶æ–‡ä»¶æ ¼å¼çš„è¯¦ç»†è§£æï¼‰å¯ç”¨äºå®šä¹‰çª—å£çš„å®é™…å†…å®¹ã€‚<br>ä¸åŒäºå…¶ä»–æ’ä»¶ä¼šåœ¨ ImJoy å¯åŠ¨æ—¶åŠ è½½å’Œåˆå§‹åŒ–ï¼Œåªæœ‰åœ¨ä½¿ç”¨<code>api.createWindow</code>åˆ›å»ºå®é™…æ’ä»¶æˆ–ç”¨æˆ·åœ¨èœå•ä¸­å•å‡»æ—¶ï¼Œæ‰ä¼šåŠ è½½<code>window</code>æ’ä»¶ã€‚åœ¨<code>api.createWindow</code>æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œ<code>setup</code>å’Œ<code>run</code>ä¼šè¢«é¦–å…ˆè°ƒç”¨ï¼Œå¹¶è¿”å›ä¸€ä¸ªçª—å£apiå¯¹è±¡ï¼ˆåŒ…å«çª—å£çš„æ‰€æœ‰apiå‡½æ•°ï¼ŒåŒ…æ‹¬<code>setup</code>ã€<code>run</code>å’Œå…¶ä»–åŠŸèƒ½ï¼ˆå¦‚æœå·²å®šä¹‰ï¼‰ï¼‰ã€‚ç„¶åå°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªwindow api å¯¹è±¡æ¥è®¿é—®æ‰€æœ‰çš„å‡½æ•°ï¼Œä¾‹å¦‚é€šè¿‡<code>win_obj.run(&#123;&#39;data&#39;: ... &#125;)</code> æ¥æ›´æ–°çª—å£çš„å†…å®¹ã€‚</p><h2 id="Web-Workeræ’ä»¶"><a href="#Web-Workeræ’ä»¶" class="headerlink" title="Web Workeræ’ä»¶"></a>Web Workeræ’ä»¶</h2><p>Web Workeræ’ä»¶ç”¨äºåœ¨å¦ä¸€ä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œè®¡ç®—ä»»åŠ¡ï¼Œå…·ä½“é€”å¾„æ˜¯ä½¿ç”¨ä¸€ä¸ªåä¸º <a href="https://en.wikipedia.org/wiki/Web_worker">web worker</a> çš„æ–°å…ƒç´ ã€‚<br>å®ƒæ²¡æœ‰æ¥å£ï¼Œæ˜¯åœ¨ä¸€ä¸ªæ–°çº¿ç¨‹ä¸­è¿è¡Œï¼Œå¹¶ä¸”åœ¨è¿è¡Œè¿‡ç¨‹ä¸­ä¸ä¼šæŒ‚èµ·ä¸»çº¿ç¨‹ã€‚å®ƒåŸºæœ¬ä¸Šæ˜¯ JavaScript å®ç°å¤šçº¿ç¨‹çš„ä¸€ç§æ–¹å¼ã€‚<br>ç”±äº Web Worker æ—¨åœ¨æ‰§è¡Œè®¡ç®—ä»»åŠ¡ï¼Œå®ƒä»¬æ— æƒè®¿é—® <a href="https://www.w3schools.com/whatis/whatis_htmldom.asp">html dom</a>ï¼Œä½†æ˜¯å¼€å‘è€…å¯ä»¥ä½¿ç”¨<code>ImJoy API</code>æ¥ä¸ImJoyçš„å›¾å½¢ç•Œé¢æˆ–å…¶ä»–å¯ä»¥è§¦å‘ç”¨æˆ·ç•Œé¢æ›´æ”¹çš„æ’ä»¶è¿›è¡Œäº¤äº’ã€‚</p><h2 id="Web-Pythonæ’ä»¶"><a href="#Web-Pythonæ’ä»¶" class="headerlink" title="Web Pythonæ’ä»¶"></a>Web Pythonæ’ä»¶</h2><p>Web Pythonæ’ä»¶å¯ä»¥å®Œå…¨åœ¨æµè§ˆå™¨ä¸­è¿è¡Œ python ä»£ç å’Œç§‘å­¦åº“ã€‚ImJoy ä½¿ç”¨ <a href="https://github.com/iodide-project/pyodide/">pyodide</a> æ¥è¿è¡Œ python æ’ä»¶ï¼Œå®ƒæ”¯æŒé€šè¿‡ WebAssembly è¿è¡Œå¸¦æœ‰ç§‘å­¦åº“ï¼ˆåŒ…æ‹¬ numpyã€scipyã€scikit-learn ç­‰ï¼‰çš„ Python3 ä»£ç ã€‚</p><h2 id="Native-Pythonæ’ä»¶"><a href="#Native-Pythonæ’ä»¶" class="headerlink" title="Native Pythonæ’ä»¶"></a>Native Pythonæ’ä»¶</h2><p>Native Pythonæ’ä»¶ç”¨äºè¿è¡ŒåŸç”Ÿ Python ä»£ç ä»¥å®Œå…¨è®¿é—®ç”µè„‘ç¡¬ä»¶ï¼ˆä¾‹å¦‚ GPUã€NVLINKï¼‰å’Œè½¯ä»¶ï¼ˆä¾‹å¦‚ CUDA å’Œ CUDNNï¼‰ç¯å¢ƒã€‚è¿™éœ€è¦åœ¨ä½¿ç”¨æ’ä»¶ä¹‹å‰å®‰è£…å¹¶å¯åŠ¨<strong>Python Plugin Engine</strong>ã€‚<br>ä¸ Web Worker æ’ä»¶ç±»ä¼¼ï¼ŒNative Python æ’ä»¶æ— æ³•è®¿é—® html domï¼Œä½†å¯ä»¥ä½¿ç”¨ <code>ImJoy API</code> ä¸ImJoy çš„å›¾å½¢ç•Œé¢æˆ–å…¶ä»–å¯ä»¥è§¦å‘ç”¨æˆ·ç•Œé¢æ›´æ”¹çš„æ’ä»¶è¿›è¡Œäº¤äº’ã€‚</p><h2 id="æ›´å¤šæ’ä»¶ç±»å‹"><a href="#æ›´å¤šæ’ä»¶ç±»å‹" class="headerlink" title="æ›´å¤šæ’ä»¶ç±»å‹"></a>æ›´å¤šæ’ä»¶ç±»å‹</h2><p>æ’ä»¶ç±»å‹å¯ä»¥é€šè¿‡æ’ä»¶è¿›ä¸€æ­¥æ‰©å±•ã€‚ä¾‹å¦‚ï¼Œä½œè€…æ–°åˆ›å»ºä¸€ä¸ªæ–°çš„æ’ä»¶ç±»å‹æ¥æ‰§è¡ŒFiji/Scijavaè„šæœ¬ï¼Œå‚è§ <a href="https://forum.image.sc/t/making-imjoy-plugins-with-fiji-scripts-for-running-remotely/39503">è¿™ç¯‡æ–‡ç« </a>ã€‚</p><h2 id="ImJoy-Appå’ŒPlugin-Engineä¸æ’ä»¶çš„å…³ç³»"><a href="#ImJoy-Appå’ŒPlugin-Engineä¸æ’ä»¶çš„å…³ç³»" class="headerlink" title="ImJoy Appå’ŒPlugin Engineä¸æ’ä»¶çš„å…³ç³»"></a>ImJoy Appå’ŒPlugin Engineä¸æ’ä»¶çš„å…³ç³»</h2><p>ä½¿ç”¨ ImJoy App çš„æ¨èæ–¹å¼æ˜¯é€šè¿‡ <a href="https://imjoy.io">https://imjoy.io</a>ã€‚<br>ä¸è¿‡ImJoyè¿˜ä¸æ˜¯æ™®é€šçš„webåº”ç”¨ï¼Œå®ƒæ˜¯é‡‡ç”¨äº†ç§°ä¸ºæ¸è¿›å¼ Web åº”ç”¨ (PWA) çš„æ–°æ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œåœ¨ Chrome ä¸­ï¼Œç”¨æˆ·å¯ä»¥å°† ImJoy å®‰è£…åˆ° <a href="chrome://apps/">chrome://apps/</a> å¹¶ä»è¿™ä¸ªä»ªè¡¨æ¿ä¸­å¯åŠ¨ImJoyï¼ˆåŒæ—¶ç”Ÿæˆæ¡Œé¢å¿«æ·æ–¹å¼ï¼‰ã€‚ä¸€æ—¦å®‰è£…ï¼ŒImJoy å°±å¯ä»¥åœ¨ç‹¬ç«‹çš„æµè§ˆå™¨çª—å£ä¸­è¿è¡Œï¼ˆæ²¡æœ‰åœ°å€æ ï¼‰ã€‚ ImJoy çš„å†…æ ¸éƒ¨åˆ†æ”¯æŒç¦»çº¿ï¼Œä½†æ’ä»¶ç›®å‰è¿˜ä¸æ”¯æŒï¼ˆä½œè€…è¯´åé¢å°†æ”¯æŒï¼‰ã€‚<br>å¯ä»¥ä½¿ç”¨ImJoy Appè¿è¡Œæ‰€æœ‰webæ’ä»¶ï¼ˆ<code>web-worker</code>ã€<code>window</code>ã€<code>web-python</code>ï¼‰ï¼Œä½†æ˜¯ï¼Œå¯¹äºæœ¬æœºæ’ä»¶ï¼ˆ<code>native-python</code>ï¼‰ï¼Œéœ€è¦è¿æ¥åˆ°æ’ä»¶å¼•æ“åœ¨æœ¬åœ°æˆ–è¿œç¨‹è¿è¡Œã€‚<br>ä»¥ä¸‹æ˜¯å®‰è£…æ’ä»¶å¼•æ“çš„ä¸¤ä¸ªé€‰é¡¹ï¼š<br>ï¼ˆ1ï¼‰æœ¬åœ°å®‰è£…ï¼šä¸‹è½½å¹¶å®‰è£… Anaconda æˆ– Miniconda with Python3ï¼Œç„¶åè¿è¡Œ<code>pip install imjoy</code>ã€‚ç„¶åå¯ä»¥é€šè¿‡ <code>imjoy --jupyter</code> å‘½ä»¤å¯åŠ¨æ’ä»¶å¼•æ“ã€‚æ›´å¤šè¯¦ç»†ä¿¡æ¯å¯åœ¨ <a href="https://github.com/imjoy-team/imjoy-engine/">æ­¤å¤„</a> è·å¾—ã€‚<br>ï¼ˆ2ï¼‰ä½¿ç”¨Jupyteræ‰˜ç®¡æœåŠ¡ï¼šä½¿ç”¨<a href="https://mybinder.org/">binder</a>æä¾›çš„å…è´¹JupyteræœåŠ¡å™¨ï¼Œè¯¥æœåŠ¡æ˜¯è¿œç¨‹çš„ï¼Œæ‰€ä»¥ä¸éœ€è¦é¢å¤–å®‰è£…ã€‚ç„¶è€Œï¼Œå…¶æä¾›çš„ç®—åŠ›ä¹Ÿæœ‰é™ï¼ˆæ¯”å¦‚1GBå†…å­˜ã€æ— GPUæ”¯æŒç­‰ï¼‰ã€‚<br><img src="https://user-images.githubusercontent.com/6218739/144159316-243a6048-fb9e-4201-965c-fa11db4c9ded.png" alt="engines"></p><h1 id="ImJoyä»£ç ç¼–è¾‘å™¨å’Œå¼€å‘äººå‘˜å·¥å…·"><a href="#ImJoyä»£ç ç¼–è¾‘å™¨å’Œå¼€å‘äººå‘˜å·¥å…·" class="headerlink" title="ImJoyä»£ç ç¼–è¾‘å™¨å’Œå¼€å‘äººå‘˜å·¥å…·"></a>ImJoyä»£ç ç¼–è¾‘å™¨å’Œå¼€å‘äººå‘˜å·¥å…·</h1><p>ImJoyæä¾›äº†ä¸€ä¸ªå†…ç½®çš„ä»£ç ç¼–è¾‘å™¨ä¾›ç¼–å†™æ’ä»¶ã€‚ç»“åˆæµè§ˆå™¨æä¾›çš„è°ƒè¯•å·¥å…·ï¼ˆä¾‹å¦‚ï¼šGoogle Chrome å¼€å‘è€…å·¥å…·ï¼‰ï¼Œä¸éœ€è¦é¢å¤–çš„ IDE æˆ–å·¥å…·ã€‚<br>å¯ä»¥é€šè¿‡å•å‡»æ’ä»¶èœå•ï¼ˆæ’ä»¶åç§°æ—è¾¹çš„å›¾æ ‡ï¼‰ä¸­çš„â€œEditâ€æ¥æŸ¥çœ‹å’Œä¿®æ”¹ä»»ä½•ç°æœ‰æ’ä»¶çš„æ’ä»¶ä»£ç ã€‚<br><img src="https://user-images.githubusercontent.com/6218739/144052196-ace51e31-757c-4519-988d-904bb3a1d89a.png" alt="editor"></p><p><a href="https://developers.google.com/web/tools/chrome-devtools">Chrome å¼€å‘è€…å·¥å…·</a> æä¾›äº†ä¸åŒçš„è°ƒè¯•HTML/CSS/Javascriptã€ç½‘ç»œç­‰çš„å·¥å…·ã€‚å»ºè®®ä½¿ç”¨å®ƒæ¥è°ƒè¯•Webæ’ä»¶ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥åƒæ­£å¸¸JavaScriptå¼€å‘é‚£æ ·åœ¨JavaScriptä¸­ä½¿ç”¨ <code>console.log()</code>ã€<code>console.error()</code>ç­‰ï¼Œç„¶ååœ¨æµè§ˆå™¨æ§åˆ¶å°ä¸­æ£€æŸ¥æ—¥å¿—å’Œé”™è¯¯ã€‚åœ¨Pythonæ’ä»¶ä¸­ï¼Œé”™è¯¯è¿½æº¯ä¹Ÿä¼šè½¬å‘åˆ°æµè§ˆå™¨æ§åˆ¶å°ã€‚<br><img src="https://user-images.githubusercontent.com/6218739/144053608-0dd72e3b-752f-4f66-98e7-52ac4ade46c5.png" alt="chrome"><br>é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ImJoy APIå‡½æ•°ï¼ŒåŒ…æ‹¬ <code>api.log()</code>ã€<code>api.error()</code>ã€<code>api.alert()</code>ã€<code>api.showMessage()</code> ç­‰æ¥å‘ImJoyåº”ç”¨ç¨‹åºæ˜¾ç¤ºæ¶ˆæ¯ã€‚<br>ç‰¹åˆ«åœ°ï¼Œå¯¹äºPythonæ’ä»¶ï¼Œ<code>print()</code>åªä¼šåœ¨å¯åŠ¨æ’ä»¶å¼•æ“çš„ç»ˆç«¯ä¸­çœ‹åˆ°ï¼Œå› æ­¤å»ºè®®å¼€å‘Pythonæ’ä»¶æ—¶ä½¿ç”¨è¿™äº›APIå‡½æ•°æ¥è¾…åŠ©debugã€‚</p><h1 id="ImJoyæ’ä»¶æ–‡ä»¶æ ¼å¼"><a href="#ImJoyæ’ä»¶æ–‡ä»¶æ ¼å¼" class="headerlink" title="ImJoyæ’ä»¶æ–‡ä»¶æ ¼å¼"></a>ImJoyæ’ä»¶æ–‡ä»¶æ ¼å¼</h1><p>ImJoyæ’ä»¶é€šå¸¸æ˜¯ä¸€ä¸ªæ‰©å±•åä¸º<code>*.imjoy.html</code>çš„æ–‡æœ¬æ–‡ä»¶ã€‚å…¶ä¸­ä½¿ç”¨HTML/XMLæ ‡ç­¾ï¼Œä¾‹å¦‚ <code>&lt;config&gt;</code>ã€<code>&lt;script&gt;</code>ã€<code>&lt;window&gt;</code> æ¥å­˜å‚¨ä»£ç å—ã€‚<br>å¤§å¤šæ•°æ’ä»¶ç±»å‹è‡³å°‘éœ€è¦ä¸¤ä¸ªä»£ç å—ï¼š<code>&lt;config&gt;</code> å’Œ<code>&lt;script&gt;</code>ï¼Œä¾‹å¦‚<code>web-worker</code>ã€<code>web-python</code> å’Œ<code>native-python</code>ã€‚å¯¹äº<code>window</code> æ’ä»¶ï¼Œä»£ç ä¸­éœ€è¦é¢å¤–ä¸€ä¸ª<code>&lt;window&gt;</code> å—ï¼Œä»¥åŠä¸€ä¸ªå¯é€‰<code>&lt;style&gt;</code> å—ç”¨äºCSSå®šä¹‰ã€‚</p><p>å¯¹äº<code>&lt;script&gt;</code>ä»£ç å—ï¼Œå¤§å¤šæ•°æ’ä»¶è‡³å°‘ä¼šæš´éœ²ä¸¤ä¸ªç‰¹æ®Šå‡½æ•°ï¼š<code>setup</code>ï¼ˆç”¨äºåˆå§‹åŒ–ï¼‰å’Œ<code>run</code>ï¼ˆå½“ç”¨æˆ·ç‚¹å‡»æ’ä»¶èœå•æŒ‰é’®æ—¶è°ƒç”¨ï¼‰ã€‚åœ¨åŠ è½½æ’ä»¶æ—¶ï¼Œä¸€ä¸ªåŒ…å«æ‰€æœ‰ImJoyAPIå‡½æ•°çš„<code>api</code>å¯¹è±¡å°†è¢«ä¼ é€’ç»™æ’ä»¶ï¼Œç„¶åæ’ä»¶å¯ä»¥æ„å»ºæœåŠ¡å‡½æ•°å¹¶é€šè¿‡è°ƒç”¨ <code>api.export(...)</code> å‡½æ•°æ¥æ³¨å†Œå®ƒä»¬ã€‚</p><p>æ¯”å¦‚ä»¥ä¸‹æ’ä»¶ä¸­å®šä¹‰äº† 3 ä¸ª API å‡½æ•°ï¼šä¸€ä¸ªç©ºçš„ <code>setup</code> å‡½æ•°ï¼Œä¸€ä¸ª <code>choosePokemon</code> å‡½æ•°ï¼Œä»¥åŠä¸€ä¸ªå¯ä¾›è°ƒç”¨çš„ <code>run</code> å‡½æ•°ï¼ˆç”± ImJoyå†…æ ¸è°ƒç”¨æˆ–ç”¨æˆ·ç‚¹å‡»æ’ä»¶èœå•æ—¶ï¼‰ï¼š<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ImJoyPlugin</span></span>&#123;</span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">setup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">choosePokemon</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">const</span> pokemon = <span class="keyword">await</span> api.prompt(<span class="string">&quot;What is your favorite PokÃ©mon?&quot;</span>, <span class="string">&quot;Pikachu&quot;</span>)</span><br><span class="line">        <span class="keyword">await</span> api.showMessage(<span class="string">&quot;Your have chose &quot;</span> + pokemon + <span class="string">&quot; as your PokÃ©mon.&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">run</span>(<span class="params">ctx</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">await</span> <span class="built_in">this</span>.choosePokemon()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">api.export(<span class="keyword">new</span> ImJoyPlugin())</span><br></pre></td></tr></table></figure><br>å…³äº ImJoy æ’ä»¶æ–‡ä»¶çš„è¯¦ç»†è¯´æ˜å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°ï¼š<a href="https://imjoy.io/docs/#/development?id=plugin-file-format">æ’ä»¶æ–‡ä»¶æ ¼å¼</a>ã€‚</p><h1 id="ImJoyçš„Hello-Worldæ’ä»¶"><a href="#ImJoyçš„Hello-Worldæ’ä»¶" class="headerlink" title="ImJoyçš„Hello Worldæ’ä»¶"></a>ImJoyçš„Hello Worldæ’ä»¶</h1><p>è¦åˆ¶ä½œç¬¬ä¸€ä¸ª ImJoy æ’ä»¶ï¼Œå³ImJoyçš„Hello Worldï¼Œå¯ä»¥å•å‡»<code>+ PLUGINS</code>ï¼Œç„¶åä»<code>+ CREATE A NEW PLUGIN</code>ä¸‹æ‹‰èœå•ä¸­é€‰æ‹©é»˜è®¤æ¨¡æ¿<code>Default template</code>ã€‚<br><img src="https://user-images.githubusercontent.com/6218739/144052725-44768110-a754-4cce-a9fb-8f70a2bcbfc7.png" alt="helloworld"><br>ç”Ÿæˆçš„æ’ä»¶ä»£ç ä¸ºï¼š<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&lt;docs&gt;</span><br><span class="line">[TODO: write documentation <span class="keyword">for</span> <span class="built_in">this</span> plugin.]</span><br><span class="line">&lt;/docs&gt;</span><br><span class="line">&lt;config lang=<span class="string">&quot;json&quot;</span>&gt;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Untitled Plugin&quot;</span>,</span><br><span class="line">  <span class="string">&quot;type&quot;</span>: <span class="string">&quot;web-worker&quot;</span>,</span><br><span class="line">  <span class="string">&quot;tags&quot;</span>: [],</span><br><span class="line">  <span class="string">&quot;ui&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="string">&quot;version&quot;</span>: <span class="string">&quot;0.1.0&quot;</span>,</span><br><span class="line">  <span class="string">&quot;cover&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="string">&quot;description&quot;</span>: <span class="string">&quot;[TODO: describe this plugin with one sentence.]&quot;</span>,</span><br><span class="line">  <span class="string">&quot;icon&quot;</span>: <span class="string">&quot;extension&quot;</span>,</span><br><span class="line">  <span class="string">&quot;inputs&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="string">&quot;outputs&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="string">&quot;api_version&quot;</span>: <span class="string">&quot;0.1.8&quot;</span>,</span><br><span class="line">  <span class="string">&quot;env&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="string">&quot;permissions&quot;</span>: [],</span><br><span class="line">  <span class="string">&quot;requirements&quot;</span>: [],</span><br><span class="line">  <span class="string">&quot;dependencies&quot;</span>: []</span><br><span class="line">&#125;</span><br><span class="line">&lt;/config&gt;</span><br><span class="line">&lt;script lang=<span class="string">&quot;javascript&quot;</span>&gt;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ImJoyPlugin</span> </span>&#123;</span><br><span class="line">  <span class="keyword">async</span> <span class="function"><span class="title">setup</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    api.log(<span class="string">&#x27;initialized&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">async</span> <span class="function"><span class="title">run</span>(<span class="params">ctx</span>)</span> &#123;</span><br><span class="line">    api.alert(<span class="string">&#x27;hello world.&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">api.export(<span class="keyword">new</span> ImJoyPlugin())</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><br>ä¸Šè¿°ä»£ç çš„å…·ä½“è¯­æ³•ä¼šåœ¨åé¢å…·ä½“è¯¦è¿°ã€‚<br>åœ¨ä¸æ›´æ”¹ä»£ç çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥é€šè¿‡å•å‡»ä¿å­˜å›¾æ ‡æ¥ä¿å­˜å®ƒï¼Œæ­¤æ—¶ä¼šåœ¨æ’ä»¶èœå•ä¸­æ·»åŠ ä¸€ä¸ªåä¸ºâ€œUntitled Pluginâ€çš„æ–°æ¡ç›®ã€‚<br>è¦è¿è¡Œè¿™ä¸ªæ’ä»¶ï¼Œå¯ä»¥å•å‡»â€œUntitled Pluginâ€æŒ‰é’®ã€‚æ­¤æ—¶å°†çœ‹åˆ°ä¸€ä¸ªå¸¦æœ‰â€œHello Worldâ€çš„å¼¹å‡ºå¯¹è¯æ¡†ã€‚<br><img src="https://user-images.githubusercontent.com/6218739/144055127-ffd19736-bcde-4f58-9c15-e7a976bb82ae.png" alt="hello"></p><p>å¦‚æœæ˜¯åœ¨æœ¬åœ°ç”µè„‘ç¼–è¾‘çš„ImJoyæ’ä»¶æ–‡ä»¶ï¼ˆæ‰©å±•åä¸º <code>*.imjoy.html</code>ï¼‰ï¼Œé‚£ä¹ˆå¯é€šè¿‡ä¸‹é¢æ“ä½œåŠ è½½åˆ°ImJoy Web Appä¸­ï¼š<br>1) è½¬åˆ° <a href="https://imjoy.io/#/app">https://imjoy.io/#/app</a><br>2) å°†è¯¥æ–‡ä»¶æ‹–æ”¾åˆ°æµè§ˆå™¨ä¸­å³å¯ã€‚</p><p>å¯¹äº Python å¼€å‘ï¼Œå¯ä»¥ä½¿ç”¨ <a href="https://github.com/imjoy-team/imjoy-jupyter-extension">jupyter notebook æ‰©å±•</a>ã€‚è¯¥éƒ¨åˆ†ä¼šåœ¨ä»¥åè¯¦ç»†è§£æã€‚</p><h1 id="éƒ¨ç½²å’Œå…±äº«æ’ä»¶"><a href="#éƒ¨ç½²å’Œå…±äº«æ’ä»¶" class="headerlink" title="éƒ¨ç½²å’Œå…±äº«æ’ä»¶"></a>éƒ¨ç½²å’Œå…±äº«æ’ä»¶</h1><p>å¦‚æœä½ æƒ³ä¸ä»–äººåˆ†äº«ä½ çš„æ’ä»¶ï¼Œå¯ä»¥ç›´æ¥å‘é€æ’ä»¶æ–‡ä»¶ï¼Œæˆ–è€…å°†æ’ä»¶ä¸Šä¼ åˆ° Github/Gistã€‚å»ºè®®ä½¿ç”¨åè€…ï¼Œå› ä¸ºå®ƒä¼šæ›´å¤§èŒƒå›´åœ°åˆ†å‘æ’ä»¶ã€‚<br>ä»¥ä¸‹æ­¥éª¤å¯ä»¥å¸®åŠ©ç¼–å†™åŠéƒ¨ç½²æ’ä»¶ï¼š<br>ï¼ˆ1ï¼‰åœ¨ Github ä¸Š <a href="https://github.com/imjoy-team/imjoy-starter/fork">fork imjoy-starter repo</a>ï¼ˆæˆ–è€…ï¼Œå¦‚æœä½ æ„¿æ„ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªç©ºçš„ï¼‰ã€‚imjoy-starterä»“åº“åŒ…å«ä¸€ä¸ª<a href="https://github.com/imjoy-team/imjoy-starter/tree/master/docs">docs æ–‡ä»¶å¤¹</a>ï¼Œå¼€å‘è€…å¯ä»¥åœ¨ Markdown ä¸­åšç¬”è®°ï¼Œå®ƒå°†æ¸²æŸ“ä¸ºåƒè¿™æ ·çš„<a href="https://imjoy-team.github.io/imjoy-starter/">äº¤äº’å¼çš„ç½‘ç«™</a>ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://docsify.js.org/#/"><strong>æ­¤å¤„</strong></a>ã€‚å¯ä»¥åœ¨Markdownä¸­æ·»åŠ å¸¦æœ‰ä¸€äº›ç‰¹æ®Šæ ‡è®°çš„æ’ä»¶ä»£ç ï¼Œç„¶åå°±å¯ä»¥çœ‹åˆ°<strong>Run</strong>å’Œ<strong>Edit</strong>æŒ‰é’®ã€‚<br>ï¼ˆ2ï¼‰ç„¶åå¯ä»¥å°†è‡ªå·±çš„æ’ä»¶å‘½åä¸ºï¼Œä¾‹å¦‚ï¼Œ<code>hello.imjoy.html</code> å¹¶ä½¿ç”¨ git å‘½ä»¤å°†å…¶ä¸Šä¼ åˆ°ä½ æ‰€forkçš„ä»“åº“çš„ <code>plugins</code> æ–‡ä»¶å¤¹æˆ–ç›´æ¥ä¸Šä¼ åˆ°ä»“åº“ã€‚<br>ï¼ˆ3ï¼‰ç„¶åå•å‡»æ’ä»¶æ–‡ä»¶å¹¶å¤åˆ¶åœ°å€æ ä¸­çš„urlï¼Œå®ƒåº”è¯¥ç±»ä¼¼äºï¼š<code>https://github.com/&lt;YOUR-GITHUB-USERNAME&gt;/imjoy-starter/blob/master/plugins/hello.imjoy.html</code><br>æ­¤è·¯å¾„å¯ç”¨äºåœ¨ImJoyä¸­å®‰è£…æ’ä»¶ã€‚<br>ï¼ˆ4ï¼‰å•å‡»<strong>Run</strong>æ‰“å¼€ImJoy Web Appã€‚è¦å®‰è£…æ’ä»¶ï¼Œå•å‡»<code>+PLUGINS</code>å¹¶å°†URLç²˜è´´åˆ°<code>Install from URL</code>è¾“å…¥æ¡†ä¸­ï¼Œç„¶åæŒ‰ Enterã€‚<br>ï¼ˆ5ï¼‰ç°åœ¨å¯ä»¥æ„å»ºä¸€ä¸ªURLä¸ä»–äººå…±äº«ï¼Œåªéœ€åœ¨ <code>https://imjoy.io/#/app?plugin=</code> åé¢æ·»åŠ  URL å³å¯ï¼Œæ¯”å¦‚è¿™æ ·ï¼š<code>https://imjoy.io/#/app?plugin=https://github.com/&lt;YOUR-GITHUB-USERNAME&gt;/imjoy-starter/blob/master/plugins/hello.imjoy.html</code>ã€‚<br>å¦‚æœç”¨æˆ·å•å‡»è¿™ä¸ªæ’ä»¶URLï¼Œå®ƒå°†ç›´æ¥åœ¨ImJoyä¸­æ‰“å¼€æ’ä»¶å¹¶æç¤ºç”¨æˆ·å®‰è£…å®ƒã€‚</p>]]></content>
    
    
    <summary type="html">å‚è€ƒæ–‡çŒ®
I2K Workshop Tutorial
Developing Plugins for ImJoy

æ¦‚è¿°
å¼€å‘ImJoyæ’ä»¶æ—¢ç®€å•åˆå¿«é€Ÿï¼Œå¯ç›´æ¥ä½¿ç”¨è¿è¡Œåœ¨webä¸Šçš„å†…ç½®çš„ä»£ç ç¼–è¾‘å™¨ï¼Œè€Œä¸éœ€è¦é¢å¤–çš„ IDE æˆ–ç¼–è¯‘å™¨ã€‚
ImJoy æ’ä»¶ç³»ç»Ÿçš„ä¸»è¦åŠŸèƒ½æœ‰ï¼š
ï¼ˆ1ï¼‰æ”¯æŒ Python å’Œ JavaScript

 * JavaScript æ’ä»¶ä¸å®‰å…¨æ²™ç®±éš”ç¦»
 * Python æ’ä»¶åœ¨è‡ªå·±çš„è¿›ç¨‹ä¸­è¿è¡Œ
 * ä½¿ç”¨ async/await è¯­æ³•æ”¯æŒå¹¶å‘ API è°ƒç”¨
 * æ”¯æŒ Python çš„è™šæ‹Ÿç¯å¢ƒå’Œ pip åŒ…
 * æ”¯æŒæ‰˜ç®¡åœ¨ GitHub æˆ– CDN ä¸Šçš„ JavaScript</summary>
    
    
    
    <category term="computer vision" scheme="http://qixinbo.github.io/categories/computer-vision/"/>
    
    
    <category term="ImJoy" scheme="http://qixinbo.github.io/tags/ImJoy/"/>
    
  </entry>
  
  <entry>
    <title>å¼€æºæ·±åº¦å­¦ä¹ è®¡ç®—å¹³å°ImJoyè§£æï¼š2 -- æ ¸å¿ƒæ¦‚å¿µ</title>
    <link href="http://qixinbo.github.io/2021/11/30/ImJoy_2/"/>
    <id>http://qixinbo.github.io/2021/11/30/ImJoy_2/</id>
    <published>2021-11-29T16:00:00.000Z</published>
    <updated>2021-12-18T04:11:22.413Z</updated>
    
    <content type="html"><![CDATA[<p>è¿™ä¸€ç¯‡ä¸»è¦ä»‹ç»ImJoyä¸­çš„æ ¸å¿ƒæ¦‚å¿µã€‚<br>å‚è€ƒæ–‡çŒ®ï¼š<br><a href="https://imjoy.io/docs/#/i2k_tutorial">I2K Workshop Tutorial</a></p><h1 id="ImJoyæ’ä»¶"><a href="#ImJoyæ’ä»¶" class="headerlink" title="ImJoyæ’ä»¶"></a>ImJoyæ’ä»¶</h1><p>ImJoy æä¾›äº†ä¸€ä¸ªçµæ´»çš„æ¡†æ¶æ¥å¼€å‘å…·æœ‰ä¸åŒç±»å‹çš„ Web æˆ– Python ç¼–ç¨‹è¯­è¨€çš„æ’ä»¶ã€‚<br><img src="https://user-images.githubusercontent.com/6218739/143839866-7d945048-055f-4898-b65b-64af66d4d316.png" alt="plugins"><br>æœ‰å››ç§ç±»å‹çš„æ’ä»¶ï¼Œå…¶å¯ç”¨äºä¸åŒçš„ç›®çš„ï¼š<br>ï¼ˆ1ï¼‰Web æ’ä»¶ç›´æ¥åœ¨æµè§ˆå™¨ä¸­è¿è¡Œï¼Œæ”¯æŒå¦‚ä¸‹ä¸‰ç§ç±»å‹ï¼š</p><ul><li>Window (HTML/CSS/JS)(<code>type=window</code>) æ’ä»¶ï¼Œç”¨äºä½¿ç”¨ HTML5/CSS å’Œ JavaScript æ„å»ºä¸°å¯Œçš„äº¤äº’å¼ç”¨æˆ·ç•Œé¢ï¼›</li><li>Web Worker (JS)(type=<code>web-worker</code>) æ’ä»¶ï¼Œç”¨äºä½¿ç”¨ JavaScript æˆ– WebAssembly æ‰§è¡Œè®¡ç®—ä»»åŠ¡ï¼›</li><li>Web Python(type=<code>web-python</code>) æ’ä»¶ï¼Œç”¨äºåœ¨æµè§ˆå™¨ä¸­é€šè¿‡ WebAssembly å’Œ <a href="https://github.com/iodide-project/pyodide">pyodide</a> ä½¿ç”¨ Python æ‰§è¡Œè®¡ç®—ä»»åŠ¡ã€‚è¿™æ ·çš„æ’ä»¶ç”¨å°è›‡ğŸå›¾æ ‡è¡¨ç¤ºã€‚è¿™å¤„äºå¼€å‘é˜¶æ®µï¼Œç›®å‰ä»…æ”¯æŒé€‰å®šæ•°é‡çš„ Python åº“ã€‚</li></ul><p>ï¼ˆ2ï¼‰Nativeæ’ä»¶åœ¨æ’ä»¶å¼•æ“ä¸­è¿è¡Œï¼Œç›®å‰æ”¯æŒï¼š</p><ul><li>Native Python(type=<code>native-python</code>) æ’ä»¶ï¼Œå¯ä½¿ç”¨ Python åŠå…¶å¤§é‡åº“å‡½æ•°æ¥æ‰§è¡Œç¹é‡è®¡ç®—ä»»åŠ¡ï¼Œä¸è¿‡è¿™éœ€è¦é¢å¤–å®‰è£…æ’ä»¶å¼•æ“ã€‚è¿™äº›æ’ä»¶ç”¨ç«ç®­ğŸš€å›¾æ ‡è¡¨ç¤ºã€‚</li></ul><p>å¯ä»¥é€šè¿‡å•å‡» <code>+ PLUGINS</code> æŒ‰é’®ï¼Œç„¶åä»â€œåˆ›å»ºæ–°æ’ä»¶â€ä¸‹æ‹‰èœå•ä¸­è®¿é—®ä¸Šè¿°æ’ä»¶çš„æ¨¡æ¿ï¼Œå¦‚å›¾ï¼š<br><img src="https://user-images.githubusercontent.com/6218739/144004594-0ccaac1d-6fb0-4c83-a42d-8dc1c565f823.png" alt="4plugins"></p><p>å…³äºæ’ä»¶å…·ä½“æ€æ ·ç¼–å†™ï¼Œä¼šåœ¨åé¢åšæ–‡ä¸­å…·ä½“è§£æã€‚</p><h1 id="ImJoy-API"><a href="#ImJoy-API" class="headerlink" title="ImJoy API"></a>ImJoy API</h1><p>ä¸ºäº†å…è®¸åŸºæœ¬çš„ç”¨æˆ·äº¤äº’ï¼ŒImJoy æä¾›äº†ä¸€ç»„ APIï¼ˆåº”ç”¨ç¨‹åºç¼–ç¨‹æ¥å£ï¼‰å‡½æ•°ï¼Œè¿™äº›å‡½æ•°å¯ä»¥åœ¨æ‰€æœ‰æ’ä»¶ç±»å‹å’Œæ”¯æŒçš„ç¼–ç¨‹è¯­è¨€ä¸­ä»¥ç›¸åŒçš„æ–¹å¼è°ƒç”¨ã€‚<br>ä¾‹å¦‚ï¼Œä¸ Javascript å‡½æ•° <code>alert()</code>ç­‰æ•ˆçš„ ImJoy API å‡½æ•°æ˜¯ <code>api.alert()</code>ã€‚</p><p>å¯ä»¥ç›´æ¥è®¿é—® Javascript æ’ä»¶ä¸­çš„ <code>api</code> å¯¹è±¡ï¼ˆä½¿ç”¨ type=<code>window</code> æˆ– <code>web-worker</code>ï¼‰ï¼š<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">api.alert(<span class="string">&quot;Hello from ImJoy!&quot;</span>)</span><br></pre></td></tr></table></figure><br>åœ¨ Python æ’ä»¶ï¼ˆtype=<code>web-python</code> æˆ– <code>native-python</code>ï¼‰ä¸­ï¼Œéœ€è¦å…ˆæ·»åŠ  <code>from imjoy import api</code>ï¼Œç„¶åæ‰èƒ½è®¿é—® <code>api</code> å¯¹è±¡ã€‚<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># import api object</span></span><br><span class="line"><span class="keyword">from</span> imjoy <span class="keyword">import</span> api</span><br><span class="line">...</span><br><span class="line"><span class="comment"># use api object</span></span><br><span class="line">api.alert(<span class="string">&quot;Hello from ImJoy!&quot;</span>)</span><br></pre></td></tr></table></figure></p><p>å¯ä»¥åœ¨ <a href="https://imjoy.io/docs/#/api">æ­¤å¤„</a> ä¸­æ‰¾åˆ°æ‰€æœ‰ ImJoy API åŠŸèƒ½çš„è¯¦ç»†è¯´æ˜ã€‚åŒæ ·ï¼Œåé¢ä¼šå¯¹è¿™äº›APIè¯¦ç»†è§£æã€‚</p><h1 id="è¿œç¨‹è¿‡ç¨‹è°ƒç”¨RPC"><a href="#è¿œç¨‹è¿‡ç¨‹è°ƒç”¨RPC" class="headerlink" title="è¿œç¨‹è¿‡ç¨‹è°ƒç”¨RPC"></a>è¿œç¨‹è¿‡ç¨‹è°ƒç”¨RPC</h1><p>é¦–å…ˆæ¥çœ‹ä¸€ä¸‹ä»€ä¹ˆæ˜¯è¿œç¨‹è¿‡ç¨‹è°ƒç”¨<strong>Remote Procedure Calls (RPC)</strong>ã€‚<br>æ´ªæ˜¥æ¶›çš„<a href="https://www.zhihu.com/question/25536695/answer/221638079">è¿™ä¸ªçŸ¥ä¹å›ç­”</a>éå¸¸è¨€ç®€æ„èµ…ã€‚ä»¥ä¸‹æ˜¯å¯¹è¯¥å›ç­”çš„æ‘˜å¼•ã€‚</p><h2 id="æœ¬åœ°è¿‡ç¨‹è°ƒç”¨"><a href="#æœ¬åœ°è¿‡ç¨‹è°ƒç”¨" class="headerlink" title="æœ¬åœ°è¿‡ç¨‹è°ƒç”¨"></a>æœ¬åœ°è¿‡ç¨‹è°ƒç”¨</h2><p>RPCå°±æ˜¯è¦åƒè°ƒç”¨æœ¬åœ°çš„å‡½æ•°ä¸€æ ·å»è°ƒè¿œç¨‹å‡½æ•°ã€‚åœ¨ç ”ç©¶RPCå‰ï¼Œæˆ‘ä»¬å…ˆçœ‹çœ‹æœ¬åœ°è°ƒç”¨æ˜¯æ€ä¹ˆè°ƒçš„ã€‚å‡è®¾æˆ‘ä»¬è¦è°ƒç”¨å‡½æ•°Multiplyæ¥è®¡ç®—<code>lvalue * rvalue</code>çš„ç»“æœ:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> <span class="built_in">int</span> Multiply(<span class="built_in">int</span> l, <span class="built_in">int</span> r) &#123;</span><br><span class="line"><span class="number">2</span>    <span class="built_in">int</span> y = l * r;</span><br><span class="line"><span class="number">3</span>    <span class="keyword">return</span> y;</span><br><span class="line"><span class="number">4</span> &#125;</span><br><span class="line"><span class="number">5</span> </span><br><span class="line"><span class="number">6</span> <span class="built_in">int</span> lvalue = <span class="number">10</span>;</span><br><span class="line"><span class="number">7</span> <span class="built_in">int</span> rvalue = <span class="number">20</span>;</span><br><span class="line"><span class="number">8</span> <span class="built_in">int</span> l_times_r = Multiply(lvalue, rvalue);</span><br></pre></td></tr></table></figure><br>é‚£ä¹ˆåœ¨ç¬¬8è¡Œæ—¶ï¼Œæˆ‘ä»¬å®é™…ä¸Šæ‰§è¡Œäº†ä»¥ä¸‹æ“ä½œï¼š<br>ï¼ˆ1ï¼‰å°†lvalueå’Œrvalueçš„å€¼å‹æ ˆ<br>ï¼ˆ2ï¼‰è¿›å…¥Multiplyå‡½æ•°ï¼Œå–å‡ºæ ˆä¸­çš„å€¼10å’Œ20ï¼Œå°†å…¶èµ‹äºˆlå’Œr<br>ï¼ˆ3ï¼‰æ‰§è¡Œç¬¬2è¡Œä»£ç ï¼Œè®¡ç®—<code>l*r</code>ï¼Œå¹¶å°†ç»“æœå­˜åœ¨y<br>ï¼ˆ4ï¼‰å°†yçš„å€¼å‹æ ˆï¼Œç„¶åä»Multiplyè¿”å›<br>ï¼ˆ5ï¼‰ç¬¬8è¡Œï¼Œä»æ ˆä¸­å–å‡ºè¿”å›å€¼200 ï¼Œå¹¶èµ‹å€¼ç»™<code>l_times_r</code><br>ä»¥ä¸Š5æ­¥å°±æ˜¯æ‰§è¡Œæœ¬åœ°è°ƒç”¨çš„è¿‡ç¨‹ã€‚ï¼ˆ20190116æ³¨ï¼šä»¥ä¸Šæ­¥éª¤åªæ˜¯ä¸ºäº†è¯´æ˜åŸç†ã€‚äº‹å®ä¸Šç¼–è¯‘å™¨ç»å¸¸ä¼šåšä¼˜åŒ–ï¼Œå¯¹äºå‚æ•°å’Œè¿”å›å€¼å°‘çš„æƒ…å†µä¼šç›´æ¥å°†å…¶å­˜æ”¾åœ¨å¯„å­˜å™¨ï¼Œè€Œä¸éœ€è¦å‹æ ˆå¼¹æ ˆçš„è¿‡ç¨‹ï¼Œç”šè‡³éƒ½ä¸éœ€è¦è°ƒç”¨callï¼Œè€Œç›´æ¥åšinlineæ“ä½œã€‚ä»…å°±åŸç†æ¥è¯´ï¼Œè¿™5æ­¥æ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚ï¼‰</p><h2 id="è¿œç¨‹è¿‡ç¨‹è°ƒç”¨å¸¦æ¥çš„æ–°é—®é¢˜"><a href="#è¿œç¨‹è¿‡ç¨‹è°ƒç”¨å¸¦æ¥çš„æ–°é—®é¢˜" class="headerlink" title="è¿œç¨‹è¿‡ç¨‹è°ƒç”¨å¸¦æ¥çš„æ–°é—®é¢˜"></a>è¿œç¨‹è¿‡ç¨‹è°ƒç”¨å¸¦æ¥çš„æ–°é—®é¢˜</h2><p>åœ¨è¿œç¨‹è°ƒç”¨æ—¶ï¼Œæˆ‘ä»¬éœ€è¦æ‰§è¡Œçš„å‡½æ•°ä½“æ˜¯åœ¨è¿œç¨‹çš„æœºå™¨ä¸Šçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒMultiplyæ˜¯åœ¨å¦ä¸€ä¸ªè¿›ç¨‹ä¸­æ‰§è¡Œçš„ã€‚è¿™å°±å¸¦æ¥äº†å‡ ä¸ªæ–°é—®é¢˜ï¼š<br>ï¼ˆ1ï¼‰Call IDæ˜ å°„ã€‚æˆ‘ä»¬æ€ä¹ˆå‘Šè¯‰è¿œç¨‹æœºå™¨æˆ‘ä»¬è¦è°ƒç”¨Multiplyï¼Œè€Œä¸æ˜¯Addæˆ–è€…FooBarå‘¢ï¼Ÿåœ¨æœ¬åœ°è°ƒç”¨ä¸­ï¼Œå‡½æ•°ä½“æ˜¯ç›´æ¥é€šè¿‡å‡½æ•°æŒ‡é’ˆæ¥æŒ‡å®šçš„ï¼Œæˆ‘ä»¬è°ƒç”¨Multiplyï¼Œç¼–è¯‘å™¨å°±è‡ªåŠ¨å¸®æˆ‘ä»¬è°ƒç”¨å®ƒç›¸åº”çš„å‡½æ•°æŒ‡é’ˆã€‚ä½†æ˜¯åœ¨è¿œç¨‹è°ƒç”¨ä¸­ï¼Œå‡½æ•°æŒ‡é’ˆæ˜¯ä¸è¡Œçš„ï¼Œå› ä¸ºä¸¤ä¸ªè¿›ç¨‹çš„åœ°å€ç©ºé—´æ˜¯å®Œå…¨ä¸ä¸€æ ·çš„ã€‚æ‰€ä»¥ï¼Œåœ¨RPCä¸­ï¼Œæ‰€æœ‰çš„å‡½æ•°éƒ½å¿…é¡»æœ‰è‡ªå·±çš„ä¸€ä¸ªIDã€‚è¿™ä¸ªIDåœ¨æ‰€æœ‰è¿›ç¨‹ä¸­éƒ½æ˜¯å”¯ä¸€ç¡®å®šçš„ã€‚å®¢æˆ·ç«¯åœ¨åšè¿œç¨‹è¿‡ç¨‹è°ƒç”¨æ—¶ï¼Œå¿…é¡»é™„ä¸Šè¿™ä¸ªIDã€‚ç„¶åæˆ‘ä»¬è¿˜éœ€è¦åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯åˆ†åˆ«ç»´æŠ¤ä¸€ä¸ª<code>&#123;å‡½æ•° &lt;--&gt; Call ID&#125;</code>çš„å¯¹åº”è¡¨ã€‚ä¸¤è€…çš„è¡¨ä¸ä¸€å®šéœ€è¦å®Œå…¨ç›¸åŒï¼Œä½†ç›¸åŒçš„å‡½æ•°å¯¹åº”çš„Call IDå¿…é¡»ç›¸åŒã€‚å½“å®¢æˆ·ç«¯éœ€è¦è¿›è¡Œè¿œç¨‹è°ƒç”¨æ—¶ï¼Œå®ƒå°±æŸ¥ä¸€ä¸‹è¿™ä¸ªè¡¨ï¼Œæ‰¾å‡ºç›¸åº”çš„Call IDï¼Œç„¶åæŠŠå®ƒä¼ ç»™æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯ä¹Ÿé€šè¿‡æŸ¥è¡¨ï¼Œæ¥ç¡®å®šå®¢æˆ·ç«¯éœ€è¦è°ƒç”¨çš„å‡½æ•°ï¼Œç„¶åæ‰§è¡Œç›¸åº”å‡½æ•°çš„ä»£ç ã€‚<br>ï¼ˆ2ï¼‰åºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚å®¢æˆ·ç«¯æ€ä¹ˆæŠŠå‚æ•°å€¼ä¼ ç»™è¿œç¨‹çš„å‡½æ•°å‘¢ï¼Ÿåœ¨æœ¬åœ°è°ƒç”¨ä¸­ï¼Œæˆ‘ä»¬åªéœ€è¦æŠŠå‚æ•°å‹åˆ°æ ˆé‡Œï¼Œç„¶åè®©å‡½æ•°è‡ªå·±å»æ ˆé‡Œè¯»å°±è¡Œã€‚ä½†æ˜¯åœ¨è¿œç¨‹è¿‡ç¨‹è°ƒç”¨æ—¶ï¼Œå®¢æˆ·ç«¯è·ŸæœåŠ¡ç«¯æ˜¯ä¸åŒçš„è¿›ç¨‹ï¼Œä¸èƒ½é€šè¿‡å†…å­˜æ¥ä¼ é€’å‚æ•°ã€‚ç”šè‡³æœ‰æ—¶å€™å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä½¿ç”¨çš„éƒ½ä¸æ˜¯åŒä¸€ç§è¯­è¨€ï¼ˆæ¯”å¦‚æœåŠ¡ç«¯ç”¨C++ï¼Œå®¢æˆ·ç«¯ç”¨Javaæˆ–è€…Pythonï¼‰ã€‚è¿™æ—¶å€™å°±éœ€è¦å®¢æˆ·ç«¯æŠŠå‚æ•°å…ˆè½¬æˆä¸€ä¸ªå­—èŠ‚æµï¼Œä¼ ç»™æœåŠ¡ç«¯åï¼Œå†æŠŠå­—èŠ‚æµè½¬æˆè‡ªå·±èƒ½è¯»å–çš„æ ¼å¼ã€‚è¿™ä¸ªè¿‡ç¨‹å«åºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚åŒç†ï¼Œä»æœåŠ¡ç«¯è¿”å›çš„å€¼ä¹Ÿéœ€è¦åºåˆ—åŒ–ååºåˆ—åŒ–çš„è¿‡ç¨‹ã€‚<br>ï¼ˆ3ï¼‰ç½‘ç»œä¼ è¾“ã€‚è¿œç¨‹è°ƒç”¨å¾€å¾€ç”¨åœ¨ç½‘ç»œä¸Šï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯æ˜¯é€šè¿‡ç½‘ç»œè¿æ¥çš„ã€‚æ‰€æœ‰çš„æ•°æ®éƒ½éœ€è¦é€šè¿‡ç½‘ç»œä¼ è¾“ï¼Œå› æ­¤å°±éœ€è¦æœ‰ä¸€ä¸ªç½‘ç»œä¼ è¾“å±‚ã€‚ç½‘ç»œä¼ è¾“å±‚éœ€è¦æŠŠCall IDå’Œåºåˆ—åŒ–åçš„å‚æ•°å­—èŠ‚æµä¼ ç»™æœåŠ¡ç«¯ï¼Œç„¶åå†æŠŠåºåˆ—åŒ–åçš„è°ƒç”¨ç»“æœä¼ å›å®¢æˆ·ç«¯ã€‚åªè¦èƒ½å®Œæˆè¿™ä¸¤è€…çš„ï¼Œéƒ½å¯ä»¥ä½œä¸ºä¼ è¾“å±‚ä½¿ç”¨ã€‚å› æ­¤ï¼Œå®ƒæ‰€ä½¿ç”¨çš„åè®®å…¶å®æ˜¯ä¸é™çš„ï¼Œèƒ½å®Œæˆä¼ è¾“å°±è¡Œã€‚å°½ç®¡å¤§éƒ¨åˆ†RPCæ¡†æ¶éƒ½ä½¿ç”¨TCPåè®®ï¼Œä½†å…¶å®UDPä¹Ÿå¯ä»¥ï¼Œè€ŒgRPCå¹²è„†å°±ç”¨äº†HTTP2ã€‚Javaçš„Nettyä¹Ÿå±äºè¿™å±‚çš„ä¸œè¥¿ã€‚</p><h2 id="RPCçš„å®ç°"><a href="#RPCçš„å®ç°" class="headerlink" title="RPCçš„å®ç°"></a>RPCçš„å®ç°</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">// Clientç«¯ </span><br><span class="line">//    <span class="built_in">int</span> l_times_r = Call(ServerAddr, Multiply, lvalue, rvalue)</span><br><span class="line"><span class="number">1.</span> å°†è¿™ä¸ªè°ƒç”¨æ˜ å°„ä¸ºCall IDã€‚è¿™é‡Œå‡è®¾ç”¨æœ€ç®€å•çš„å­—ç¬¦ä¸²å½“Call IDçš„æ–¹æ³•</span><br><span class="line"><span class="number">2.</span> å°†Call IDï¼Œlvalueå’Œrvalueåºåˆ—åŒ–ã€‚å¯ä»¥ç›´æ¥å°†å®ƒä»¬çš„å€¼ä»¥äºŒè¿›åˆ¶å½¢å¼æ‰“åŒ…</span><br><span class="line"><span class="number">3.</span> æŠŠ<span class="number">2</span>ä¸­å¾—åˆ°çš„æ•°æ®åŒ…å‘é€ç»™ServerAddrï¼Œè¿™éœ€è¦ä½¿ç”¨ç½‘ç»œä¼ è¾“å±‚</span><br><span class="line"><span class="number">4.</span> ç­‰å¾…æœåŠ¡å™¨è¿”å›ç»“æœ</span><br><span class="line"><span class="number">5.</span> å¦‚æœæœåŠ¡å™¨è°ƒç”¨æˆåŠŸï¼Œé‚£ä¹ˆå°±å°†ç»“æœååºåˆ—åŒ–ï¼Œå¹¶èµ‹ç»™l_times_r</span><br><span class="line"></span><br><span class="line">// Serverç«¯</span><br><span class="line"><span class="number">1.</span> åœ¨æœ¬åœ°ç»´æŠ¤ä¸€ä¸ªCall IDåˆ°å‡½æ•°æŒ‡é’ˆçš„æ˜ å°„call_id_mapï¼Œå¯ä»¥ç”¨std::<span class="built_in">map</span>&lt;std::string, std::function&lt;&gt;&gt;</span><br><span class="line"><span class="number">2.</span> ç­‰å¾…è¯·æ±‚</span><br><span class="line"><span class="number">3.</span> å¾—åˆ°ä¸€ä¸ªè¯·æ±‚åï¼Œå°†å…¶æ•°æ®åŒ…ååºåˆ—åŒ–ï¼Œå¾—åˆ°Call ID</span><br><span class="line"><span class="number">4.</span> é€šè¿‡åœ¨call_id_mapä¸­æŸ¥æ‰¾ï¼Œå¾—åˆ°ç›¸åº”çš„å‡½æ•°æŒ‡é’ˆ</span><br><span class="line"><span class="number">5.</span> å°†lvalueå’Œrvalueååºåˆ—åŒ–åï¼Œåœ¨æœ¬åœ°è°ƒç”¨Multiplyå‡½æ•°ï¼Œå¾—åˆ°ç»“æœ</span><br><span class="line"><span class="number">6.</span> å°†ç»“æœåºåˆ—åŒ–åé€šè¿‡ç½‘ç»œè¿”å›ç»™Client</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥è¦å®ç°ä¸€ä¸ªRPCæ¡†æ¶ï¼Œå…¶å®åªéœ€è¦æŒ‰ä»¥ä¸Šæµç¨‹å®ç°å°±åŸºæœ¬å®Œæˆäº†ã€‚</p><p>å…¶ä¸­ï¼š<br>ï¼ˆ1ï¼‰Call IDæ˜ å°„å¯ä»¥ç›´æ¥ä½¿ç”¨å‡½æ•°å­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨æ•´æ•°IDã€‚æ˜ å°„è¡¨ä¸€èˆ¬å°±æ˜¯ä¸€ä¸ªå“ˆå¸Œè¡¨ã€‚<br>ï¼ˆ2ï¼‰åºåˆ—åŒ–ååºåˆ—åŒ–å¯ä»¥è‡ªå·±å†™ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨Protobufæˆ–è€…FlatBuffersä¹‹ç±»çš„ã€‚<br>ï¼ˆ3ï¼‰ç½‘ç»œä¼ è¾“åº“å¯ä»¥è‡ªå·±å†™socketï¼Œæˆ–è€…ç”¨asioï¼ŒZeroMQï¼ŒNettyä¹‹ç±»ã€‚</p><h2 id="ImJoyä¸­çš„è¿œç¨‹è¿‡ç¨‹è°ƒç”¨"><a href="#ImJoyä¸­çš„è¿œç¨‹è¿‡ç¨‹è°ƒç”¨" class="headerlink" title="ImJoyä¸­çš„è¿œç¨‹è¿‡ç¨‹è°ƒç”¨"></a>ImJoyä¸­çš„è¿œç¨‹è¿‡ç¨‹è°ƒç”¨</h2><p>å°½ç®¡è°ƒç”¨ <code>alert()</code> å’Œ <code>api.alert()</code> ä¼šäº§ç”Ÿç›¸åŒçš„ç»“æœï¼ˆéƒ½æ˜¯å¼¹å‡ºæ¶ˆæ¯ï¼‰ï¼Œä½†è¦æ³¨æ„çš„æ˜¯å…¶åº•å±‚è¿‡ç¨‹æ˜¯ä¸åŒçš„ã€‚å½“è°ƒç”¨<code>alert()</code>æ—¶ï¼Œç›´æ¥ä»æ’ä»¶å¯åŠ¨å¼¹å‡ºå¯¹è¯æ¡†ï¼Œè€Œè°ƒç”¨<code>api.alert()</code>ä¼šä»ImJoyå†…æ ¸ï¼ˆImJoy coreï¼‰ä¸­å¯åŠ¨å¼¹å‡ºå¯¹è¯æ¡†ã€‚<br>éœ€è¦æ—¶åˆ»æ³¨æ„çš„æ˜¯ï¼ŒImJoy æ˜¯åœ¨ç‹¬ç«‹æˆ–æ²™ç›’ç¯å¢ƒï¼ˆå³sandboxed iframeã€webworkerã€conda è™šæ‹Ÿç¯å¢ƒæˆ– docker å®¹å™¨ï¼‰ä¸­è¿è¡Œæ¯ä¸ªæ’ä»¶ã€‚ç®€è€Œè¨€ä¹‹ï¼Œè¿™æ„å‘³ç€é»˜è®¤æƒ…å†µä¸‹ï¼Œå‡½æ•°å’Œå˜é‡ä¸ä¼šåœ¨æ’ä»¶ä¹‹é—´æˆ–æ’ä»¶ä¸ImJoyå†…æ ¸ä¹‹é—´è¿›è¡Œå…±äº«ã€‚<br>å½“ä»æ’ä»¶ä¸­è°ƒç”¨ ImJoy API å‡½æ•°æ—¶ï¼Œè¯¥å‡½æ•°å°†åœ¨ ImJoy å†…æ ¸ä¸­æ‰§è¡Œã€‚ç”±äºæ’ä»¶è¿è¡Œåœ¨ä¸åŒçš„ç¯å¢ƒä¸­ï¼Œæ‰€ä»¥ImJoyå†…æ ¸ä¸­å®šä¹‰çš„æ‰€æœ‰åŠŸèƒ½éƒ½æ˜¯â€œè¿œç¨‹â€åŠŸèƒ½ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼ŒåŒä¸€ä¸ªæ’ä»¶ä¸­å®šä¹‰çš„æ‰€æœ‰å‡½æ•°éƒ½æ˜¯â€œæœ¬åœ°â€çš„ã€‚<br>å› æ­¤ï¼Œè°ƒç”¨ImJoy APIå‡½æ•°æ„å‘³ç€æ‰§è¡Œè¿œç¨‹è¿‡ç¨‹è°ƒç”¨ã€‚<br>ï¼ˆImJoyæ”¯æŒåŒå‘RPCï¼Œä¸ä»…åœ¨æ’ä»¶å’Œ ImJoyå†…æ ¸ä¹‹é—´ï¼Œè€Œä¸”åœ¨æ’ä»¶ä¹‹é—´ä¹Ÿæ˜¯å¦‚æ­¤ã€‚RPCå¯ä»¥åœ¨ä¸åŒç¼–ç¨‹è¯­è¨€å’Œä¸åŒä¸»æœºä¹‹é—´ç»Ÿä¸€åœ°ä½¿ç”¨ï¼‰<br>æ¯”å¦‚ï¼Œå½“ä¸€ä¸ªåœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šè¿è¡Œçš„Pythonæ’ä»¶è¿›è¡Œè°ƒç”¨<code>api.alert()</code>æ—¶ï¼Œå¼¹å‡ºå¯¹è¯æ¡†åˆ™æ˜¯ç”±ç”¨æˆ·æµè§ˆå™¨ä¸­çš„ImJoyå†…æ ¸ï¼ˆç”¨Javascriptå®ç°ï¼‰æ¥å¯åŠ¨çš„ã€‚<br>RPCå…è®¸å°†ä»»åŠ¡åˆ†å‘åˆ°ä»¥ä¸åŒè¯­è¨€å’Œä¸åŒä½ç½®è¿è¡Œçš„ä¸åŒæ’ä»¶ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¼ºå¤§çš„UIåº“ï¼ˆä¾‹å¦‚<a href="https://d3js.org/">D3</a> å’Œ <a href="https://kitware.github.io/itk-vtk-viewer/">ITK/VTK Viewer</a>)æ¥æ„å»ºç”¨æˆ·ç•Œé¢ï¼Œå¹¶ç”¨<a href="https://www.tensorflow.org/js">Tensorflow. js</a>ä¸­çš„<a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Using_web_workers">Web Worker</a> æ¥è¿è¡Œæ·±åº¦å­¦ä¹ æ¨¡å‹ ã€‚å¯¹äºä½¿ç”¨GPUæ¥è®­ç»ƒæ¨¡å‹è¿™ç§é‡å‹è®¡ç®—ä»»åŠ¡ï¼Œå¯ä»¥åœ¨æœ¬åœ°æˆ–è¿œç¨‹ï¼ˆä¾‹å¦‚åœ¨GPU é›†ç¾¤æˆ–å®éªŒå®¤å·¥ä½œç«™ä¸Šï¼‰çš„Jupyterç¬”è®°æœ¬æœåŠ¡å™¨ï¼ˆå³ImJoyæ’ä»¶å¼•æ“ Plugin Engineï¼‰ä¸Šç¼–å†™Python æ’ä»¶æ¥å®ç°ã€‚<br>è¿™ç¯‡åšæ–‡(<a href="http://tomerfiliba.com/blog/RPCs-Life-And-All/">RPCs, Life and All</a>) è§£é‡Šäº†ç”¨äºPythonè¿œç¨‹è¿‡ç¨‹è°ƒç”¨çš„åº“(<a href="https://rpyc.readthedocs.io/en/latest/">RPyC</a>)èƒŒåçš„æƒ³æ³• ï¼Œè¯¥åº“ä¸ImJoyä¸­æä¾›çš„ç±»ä¼¼ã€‚</p><h1 id="å¼‚æ­¥ç¼–ç¨‹"><a href="#å¼‚æ­¥ç¼–ç¨‹" class="headerlink" title="å¼‚æ­¥ç¼–ç¨‹"></a>å¼‚æ­¥ç¼–ç¨‹</h1><p>ç”±äº ImJoy API å‡½æ•°æ˜¯è¿œç¨‹å‡½æ•°ï¼Œå®ƒä»¬çš„æ“ä½œä¸åŒä¸€æ’ä»¶ä¸­å®šä¹‰çš„æœ¬åœ°å‡½æ•°ç•¥æœ‰ä¸åŒã€‚æ›´å…·ä½“åœ°è¯´ï¼Œè¿œç¨‹å‡½æ•°æ˜¯å¼‚æ­¥çš„ã€‚<br>åœ¨ImJoyä¸­è°ƒç”¨å¼‚æ­¥å‡½æ•°æœ‰ä¸€ä¸ªç®€åŒ–çš„è§„åˆ™ï¼šImJoyä¸­çš„æ‰€æœ‰è¿œç¨‹åŠŸèƒ½éƒ½æ˜¯å¼‚æ­¥çš„ï¼Œå¯ä»¥åƒå…¶ä»–æœ¬åœ°å‡½æ•°ä¸€æ ·ä½¿ç”¨å®ƒä»¬ï¼Œåªéœ€åœ¨å‡½æ•°è°ƒç”¨å‰æ·»åŠ  <code>await</code>ã€‚<br>å³åº”è¯¥æ‰§è¡Œ <code>await api.alert(&#39;hello&#39;)</code> æ¥è°ƒç”¨ä¸Šé¢çš„alertå‡½æ•°ã€‚<br>å¦‚æœAPIå‡½æ•°æœ‰è¿”å›å€¼ï¼Œä¾‹å¦‚<a href="https://imjoy.io/docs/#/api?id=apiprompt"><code>api.prompt</code></a>ï¼Œåº”è¯¥å†™æˆï¼š<code>result = await api.prompt( &#39;type a number&#39;)</code>ã€‚</p><p>ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœç›´æ¥æ‰§è¡Œ <code>await api.alert(&#39;hello&#39;)</code>ï¼Œä¼šå¯¼è‡´è¯­æ³•é”™è¯¯è€Œä¸èƒ½æ‰§è¡Œã€‚<br>è¦ä¿®å¤é”™è¯¯ï¼Œéœ€è¦å°†ä»£ç å°è£…åœ¨ä¸€ä¸ªå¼‚æ­¥å‡½æ•°ä¸­ï¼š<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Javascript ä¸­çš„å¼‚æ­¥/ç­‰å¾…ç¤ºä¾‹</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="title">sayHello</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">await</span> api.alert(<span class="string">&quot;Hello from ImJoy!&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">sayHello()</span><br></pre></td></tr></table></figure><br>å› æ­¤ï¼Œå¦ä¸€ä¸ªä½¿ç”¨ <code>async/await</code> çš„ç®€å•è§„åˆ™æ˜¯ï¼š<br>åœ¨å‡½æ•°ä¸­ä½¿ç”¨<code>await</code>æ—¶ï¼Œåœ¨å‡½æ•°å®šä¹‰å‰æ·»åŠ <code>async</code>ã€‚</p><p>å†ä¸¾ä¸€ä¸ªä¾‹å­ï¼Œä½¿ç”¨å¦ä¸€ä¸ª ImJoy API å‡½æ•° <a href="https://imjoy.io/docs/#/api?id=apiprompt"><code>api.prompt</code></a> åœ¨å¼¹å‡ºå¯¹è¯æ¡†ä¸­è·å–ç”¨æˆ·çš„è¾“å…¥ï¼Œå¹¶ä½¿ç”¨è¿™ä¸ªAPI <a href="https://imjoy.io/docs/#/api?id=apishowmessage"><code>api.showMessage</code></a>æ¥æ˜¾ç¤ºæ¶ˆæ¯ã€‚<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">choosePokemon</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> pokemon = <span class="keyword">await</span> api.prompt(<span class="string">&quot;What is your favorite PokÃ©mon?&quot;</span>,<span class="string">&quot;Pikachu&quot;</span>)</span><br><span class="line">    <span class="keyword">await</span> api.showMessage(<span class="string">&quot;Your have chose &quot;</span>+pokemon +<span class="string">&quot; as your PokÃ©mon.&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">choosePokemon()</span><br></pre></td></tr></table></figure></p><h2 id="Pythonçš„Async-Await"><a href="#Pythonçš„Async-Await" class="headerlink" title="Pythonçš„Async/Await"></a>Pythonçš„Async/Await</h2><p><code>async/await</code> è¯­æ³•åœ¨ Python ä¸­ç±»ä¼¼ã€‚ä¾‹å¦‚ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Python ä¸­çš„å¼‚æ­¥/ç­‰å¾…ç¤ºä¾‹</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">say_hello</span>():</span></span><br><span class="line">    <span class="keyword">await</span> api.alert(<span class="string">&quot;Hello from ImJoy!&quot;</span>)</span><br></pre></td></tr></table></figure></p><p>åœ¨ Python ä¸­ä½¿ç”¨ asyncio æ—¶ï¼Œä¸€ä¸ªå¥½çš„åšæ³•æ˜¯é¿å…ç›´æ¥åœ¨ä¸»çº¿ç¨‹ä¸­è¿è¡Œç¹é‡çš„è®¡ç®—ï¼Œè€Œæ˜¯å¯ä»¥ä½¿ç”¨<a href="https://pymotw.com/3/asyncio/executors.html">Executors</a> (çº¿ç¨‹å’Œè¿›ç¨‹ï¼‰ã€‚<br>è¿˜å¯ä»¥é€šè¿‡æ‰§è¡Œä»¥ä¸‹æ“ä½œæ¥ä½¿ç”¨é»˜è®¤çº¿ç¨‹æ‰§è¡Œå™¨ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">loop.run_in_executor(<span class="literal">None</span>, my_heavy_computation, arg1, arg2...)</span><br></pre></td></tr></table></figure></p><h2 id="Callbackã€Promiseå’ŒAsync-Await"><a href="#Callbackã€Promiseå’ŒAsync-Await" class="headerlink" title="Callbackã€Promiseå’ŒAsync/Await"></a>Callbackã€Promiseå’ŒAsync/Await</h2><p>å¦‚å‰æ‰€è¿°ï¼Œé€šè¿‡ RPC å°†ä»»åŠ¡åˆ†é…ç»™ä¸åŒæ’ä»¶çš„ä¸€ä¸ªä¼˜åŠ¿æ˜¯å¯ä»¥å¹¶è¡Œè°ƒåº¦å’Œè¿è¡Œä»»åŠ¡ï¼ˆé€šå¸¸åœ¨ Pythonã€Java å’Œè®¸å¤šå…¶ä»–ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œè¿˜æœ‰è®¸å¤šå…¶ä»–æŠ€æœ¯å¯ä»¥å®ç°å¹¶å‘æ€§ï¼ŒåŒ…æ‹¬å¤šçº¿ç¨‹å’Œå¤šè¿›ç¨‹ï¼‰ã€‚å¼‚æ­¥ç¼–ç¨‹æ˜¯ä¸€ç§è¶Šæ¥è¶Šæµè¡Œçš„ä»¥æ›´å…·å¯æ‰©å±•æ€§çš„æ–¹å¼å®ç°å¹¶å‘çš„æ–¹å¼ã€‚<br>å…¶åŸºæœ¬æ€æƒ³æ˜¯ï¼Œæˆ‘ä»¬ä¸å¿…æ€»æ˜¯ç­‰å¾…ä¸€é¡¹ä»»åŠ¡å®Œæˆï¼Œç„¶åæ‰ç§»åŠ¨åˆ°ä¸‹ä¸€é¡¹ã€‚æ¯”å¦‚ï¼Œå½“æˆ‘ä»¬å»ä¸€å®¶å’–å•¡åº—ï¼Œç‚¹ä¸€æ¯å¡å¸ƒå¥‡è¯ºå’–å•¡å¹¶è·å¾—ä¸€å¼ å–é¤å·ï¼Œåœ¨åˆ¶ä½œå’–å•¡çš„åŒæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥æ‹¨æ‰“ç”µè¯æˆ–é˜…è¯»æŠ¥çº¸ã€‚å‡ åˆ†é’Ÿåï¼Œå¯ä»¥é€šè¿‡å‡ºç¤ºå–é¤å·æ¥è·å–å¡å¸ƒå¥‡è¯ºå’–å•¡ã€‚<br>å¼‚æ­¥ç¼–ç¨‹ä¸å¤šçº¿ç¨‹ç­‰å…¶ä»–æŠ€æœ¯çš„ä¸€å¤§åŒºåˆ«åœ¨äºç¨‹åºæ˜¯åœ¨ä¸€ä¸ªçº¿ç¨‹å’Œè¿›ç¨‹ä¸­è¿è¡Œã€‚å› æ­¤ï¼Œåœ¨ ImJoy ä¸­ï¼Œå¼‚æ­¥ç¼–ç¨‹é€šå¸¸ç”¨äºå°†ä»»åŠ¡è°ƒåº¦åˆ°å…¶ä»–æ’ä»¶ï¼Œè€Œä¸æ˜¯åœ¨åŒä¸€æ’ä»¶å†…å¹¶è¡Œè¿è¡Œç¹é‡çš„è®¡ç®—ä»»åŠ¡ã€‚<br><code>async/await</code> å¹¶ä¸æ˜¯è¿›è¡Œå¼‚æ­¥ç¼–ç¨‹çš„å”¯ä¸€æ–¹å¼ï¼Œäº‹å®ä¸Šï¼Œå®ƒåœ¨æœ€è¿‘å‡ å¹´æ‰å˜å¾—æ›´åŠ æµè¡Œã€‚ä¾‹å¦‚ï¼Œ Python 3 ä¹‹åæ‰å¼•å…¥äº†å®ƒã€‚<br>å…³äºå¼‚æ­¥ç¼–ç¨‹ï¼Œå¯ä»¥åé¢å†è¯¦ç»†è§£æã€‚</p><h2 id="å°†-RPC-ä¸-Async-Await-ç»“åˆä½¿ç”¨"><a href="#å°†-RPC-ä¸-Async-Await-ç»“åˆä½¿ç”¨" class="headerlink" title="å°† RPC ä¸ Async/Await ç»“åˆä½¿ç”¨"></a>å°† RPC ä¸ Async/Await ç»“åˆä½¿ç”¨</h2><p>å¦ä¸€ç§ç†è§£<code>await</code> å’Œ<code>async</code> å‡½æ•°çš„è§’åº¦æ˜¯ï¼š<br>1) å¼‚æ­¥å‡½æ•°ä¸€æ—¦è°ƒç”¨å°†ç«‹å³è¿”å›ï¼›<br>2) è¿”å›çš„å¯¹è±¡ä¸æ˜¯å®é™…ç»“æœï¼Œè€Œæ˜¯Javascript ä¸­ç§°ä¸º<code>Promise</code> æˆ–Pythonä¸­ç§°ä¸º<code>Future</code> çš„ç‰¹æ®Šå¯¹è±¡ã€‚ç›´è§‰ä¸Šï¼Œè¿™å°±åƒä½ ç‚¹äº†ä¸€æ¯å’–å•¡åå¾—åˆ°çš„å–é¤å·ï¼›<br>3) å¦‚æœå°† <code>await</code> åº”ç”¨åˆ° <code>Promise</code> æˆ– <code>Future</code> å¯¹è±¡ï¼Œå°±ä¼šå¾—åˆ°å®é™…çš„ç»“æœã€‚<br>å¦‚ä¸‹ä¸¤ç§å¼‚æ­¥å‡½æ•°æ˜¯ç­‰ä»·çš„ï¼š<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">choosePokemon1</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">// ç›´æ¥ç”³è¯·awaitï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°å®é™…çš„ç»“æœ</span></span><br><span class="line">    <span class="keyword">const</span> pokemon = <span class="keyword">await</span> api.prompt(<span class="string">&quot;What is your favorite Pokemon?&quot;</span>, <span class="string">&quot;Pikachu&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> pokemon</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">choosePokemon2</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">// å¦‚æœä¸ä½¿ç”¨ `await`ï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°ä¸€ä¸ªå¯¹å®é™…ç»“æœçš„æ‰¿è¯ºpromise</span></span><br><span class="line">    <span class="keyword">const</span> promise = api.prompt(<span class="string">&quot;What is your favorite Pokemon?&quot;</span>, <span class="string">&quot;Pikachu&quot;</span><span class="string">&quot;)</span></span><br><span class="line"><span class="string">    // è¦æ£€ç´¢å®é™…ç»“æœï¼Œå°† await åº”ç”¨äº Promise</span></span><br><span class="line"><span class="string">    const pokemon = await promise</span></span><br><span class="line"><span class="string">    return pokemon</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure><br>è™½ç„¶ä¸Šé¢çš„ä¾‹å­æ˜¯ç”¨ Javascript å†™çš„ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥åœ¨ Python ä¸­åšåŒæ ·çš„äº‹æƒ…ã€‚<br>ç®€å•åœ°ä¸ºæ‰€æœ‰å¼‚æ­¥å‡½æ•°åº”ç”¨<code>await</code> å°†å¯¼è‡´é¡ºåºæ‰§è¡Œã€‚è¦å¹¶è¡Œè¿è¡Œä»»åŠ¡ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸ç«‹å³åº”ç”¨ <code>await</code> çš„æƒ…å†µä¸‹è°ƒç”¨å‡½æ•°ï¼Œè€Œæ˜¯å¯ä»¥å…ˆæ”¶é›†æ‰€æœ‰çš„ <code>Promise</code> å¯¹è±¡ï¼Œç„¶åä¸€å—<code>await</code>ã€‚<br>å‡è®¾æˆ‘ä»¬æœ‰ taskAï¼ˆéœ€è¦ 10 åˆ†é’Ÿï¼‰ã€taskBï¼ˆéœ€è¦ 5 åˆ†é’Ÿï¼‰å’Œ taskCï¼ˆéœ€è¦ 3 åˆ†é’Ÿï¼‰ï¼Œæˆ‘ä»¬æƒ³ä½¿ç”¨ä» A å’Œ B è¿”å›çš„ç»“æœæ¥å®Œæˆä»»åŠ¡ Cã€‚ä»¥ä¸‹æ˜¯ä¸åŒçš„å®ç°æ–¹å¼ï¼š<br>ï¼ˆ1ï¼‰åœ¨æ‰€æœ‰å‡½æ•°ä¹‹å‰åº”ç”¨ <code>await</code>ï¼Œéœ€è¦ 18(<code>10+5+3</code>) åˆ†é’Ÿ<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">doTasks</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="comment">// åœ¨ A ä¹‹åæ‰§è¡Œä»»åŠ¡ B</span></span><br><span class="line">        <span class="keyword">const</span> resultA = <span class="keyword">await</span> doTaskA() <span class="comment">// éœ€è¦ 10 åˆ†é’Ÿ</span></span><br><span class="line">        <span class="keyword">const</span> resultB = <span class="keyword">await</span> doTaskB() <span class="comment">// éœ€è¦ 5 åˆ†é’Ÿ</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">await</span> doTaskC(resultA, resultB) <span class="comment">// éœ€è¦ 3 åˆ†é’Ÿ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>ï¼ˆ2ï¼‰è°ƒåº¦è¿™ä¸¤ä¸ªä»»åŠ¡ï¼Œç„¶åå¯¹ä¸¤è€…<code>await</code>ï¼Œéœ€è¦ 13 (<code>max(10, 5) + 3</code>) åˆ†é’Ÿã€‚<br>åœ¨ Javascript ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ <code>Promise.all</code> å°†ä¸¤ä¸ª promise åˆäºŒä¸ºä¸€ï¼š<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">doTasks</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">// å¹¶è¡Œè¿è¡Œä»»åŠ¡ A å’Œ B</span></span><br><span class="line">    <span class="keyword">const</span> promiseA = doTaskA()</span><br><span class="line">    <span class="keyword">const</span> promiseB = doTaskB()</span><br><span class="line">    <span class="comment">// æ”¶é›†ç»“æœ</span></span><br><span class="line">    <span class="keyword">const</span> [resultA, resultB] = <span class="keyword">await</span> <span class="built_in">Promise</span>.all([promiseA, promiseB])</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">await</span> doTaskC(resultA, resultB)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>åœ¨ Python ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ <code>asyncio.gather</code> æ¥æ”¶é›†ä¸¤ä¸ª promiseï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">doTasks</span>():</span></span><br><span class="line">    <span class="comment"># å¹¶è¡Œè¿è¡Œä»»åŠ¡ A å’Œ B</span></span><br><span class="line">    promiseA = doTaskA()</span><br><span class="line">    promiseB = doTaskB()</span><br><span class="line">    <span class="comment"># æ”¶é›†ç»“æœ</span></span><br><span class="line">    [resultA, resultB] = <span class="keyword">await</span> asyncio.gather(promiseA, promiseB)</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">await</span> doTaskC(resultA, resultB)</span><br></pre></td></tr></table></figure></p><h1 id="å¤–éƒ¨é›†æˆ"><a href="#å¤–éƒ¨é›†æˆ" class="headerlink" title="å¤–éƒ¨é›†æˆ"></a>å¤–éƒ¨é›†æˆ</h1><p>ImJoy æ’ä»¶ç”Ÿæ€ç³»ç»Ÿæ—¨åœ¨ä»¥ä¸¤ç§æ–¹å¼å¼€æ”¾ï¼š<br>ï¼ˆ1ï¼‰å…¶ä»–è½¯ä»¶å·¥å…·å’Œç½‘ç«™åº”è¯¥èƒ½å¤Ÿè½»æ¾ä½¿ç”¨ ImJoy åŠå…¶æ’ä»¶ï¼›<br>ï¼ˆ2ï¼‰å…¶ä»–è½¯ä»¶å·¥å…·åº”è¯¥å¯ä»¥åœ¨ ImJoy ä¸­è½»æ¾ä½¿ç”¨ï¼Œé€šå¸¸æ˜¯ä»¥æ’ä»¶çš„å½¢å¼ã€‚<br>ä¸€èˆ¬æ¥è¯´ï¼Œä»»ä½•ä½¿ç”¨ImJoy RPCåè®®æ¥æä¾›æœåŠ¡åŠŸèƒ½çš„è½¯ä»¶éƒ½å¯ä»¥è¢«è§†ä¸ºImJoyæ’ä»¶ã€‚è¿™åŒ…æ‹¬ ImJoy Web åº”ç”¨ç¨‹åºæœ¬èº«ï¼Œå®ƒå¯ä»¥è¯»å–æ’ä»¶æ–‡ä»¶å¹¶ç”Ÿæˆæ’ä»¶ APIã€‚åŒæ—¶ï¼Œä½œè€…è¿˜æä¾›äº† <a href="https://github.com/imjoy-team/imjoy-rpc">imjoy-rpc</a> åº“ï¼Œç›®å‰æ”¯æŒ Python å’Œ Javascirptï¼Œä¾›å…¶ä»–è½¯ä»¶æˆ– Web åº”ç”¨ç¨‹åºç›´æ¥ä¸ ImJoy å†…æ ¸é€šä¿¡ã€‚<br>ç›®å‰å·²ç»æœ‰å‡ ä¸ªweb åº”ç”¨ç¨‹åºå¯ä»¥åœ¨ç‹¬ç«‹æ¨¡å¼ä¸‹è¿è¡Œï¼Œä¹Ÿå¯ä»¥ä½œä¸º ImJoy æ’ä»¶ï¼š</p><ul><li><a href="https://kitware.github.io/itk-vtk-viewer/docs/imjoy.html">ITK/VTK æŸ¥çœ‹å™¨</a> ç”± <a href="https://github.com/thewtex">Matt McCormick</a> ç­‰äººæ’°å†™ã€‚</li><li><a href="https://github.com/hms-dbmi/vizarr">vizarr</a> ç”± <a href="https://github.com/manzt">Trevor Manz</a> ç­‰äººæ’°å†™ã€‚</li><li><a href="https://kaibu.org/#/app">Kaibu</a> ç”± ImJoy å›¢é˜Ÿæä¾›ã€‚</li><li><a href="https://ij.imjoy.io">ImageJ.JS</a> ç”± ImJoy å›¢é˜Ÿæä¾›ã€‚</li></ul><p>ä¾‹å¦‚ï¼Œ<a href="https://kitware.github.io/itk-vtk-viewer/docs/imjoy.html">ITK/VTK Viewer</a> æ˜¯ä¸€ä¸ªå¼€æºè½¯ä»¶ç³»ç»Ÿï¼Œç”¨äºåŒ»å­¦å’Œç§‘å­¦å›¾åƒã€ç½‘æ ¼å’Œç‚¹é›†å¯è§†åŒ–ã€‚è™½ç„¶å®ƒå¯ä»¥<a href="https://kitware.github.io/itk-vtk-viewer/app/?fileToLoad=https://data.kitware.com/api/v1/file/564a65d58d777f7522dbfb61/ download/data.nrrd">ä½œä¸ºç‹¬ç«‹åº”ç”¨ç¨‹åºè¿è¡Œ</a>ï¼Œä¹Ÿå¯ä»¥<a href="https://kitware.github.io/itk-vtk-viewer/docs/imjoy.html">ä½œä¸º ImJoy æ’ä»¶</a>è¿è¡Œ ã€‚<br>å¯ä»¥ç‚¹å‡»<a href="http://imjoy.io/#/app?plugin=https://kitware.github.io/itk-vtk-viewer/app/">è¿™ä¸ªé“¾æ¥</a>è¿›è¡Œè¯•ç”¨ã€‚</p><p><a href="https://ij.imjoy.io">ImageJ.JS</a>æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ç½‘ç»œåº”ç”¨ç¨‹åºï¼Œå®ƒä»¥ä¸¤ç§æ–¹å¼æ”¯æŒImJoyï¼š1) å¤§å¤šæ•°ImJoyæ’ä»¶å¯ä»¥åœ¨ImageJ.JSä¸­ç›´æ¥è¿è¡Œï¼› 2) ImageJ.JSå¯ä»¥é€šè¿‡å…¶URLç”¨ä½œImJoyçš„æ’ä»¶ã€‚<br>æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… <a href="https://github.com/imjoy-team/imagej.js">é¡¹ç›®å­˜å‚¨åº“</a>ã€‚</p><p>æ¯”å¦‚ï¼Œå¯ä»¥åœ¨ImageJ.JSçš„å·¦ä¸Šè§’å•å‡»ImJoyå›¾æ ‡ï¼Œç„¶åé€‰æ‹©åŠ è½½æ’ä»¶ï¼Œç²˜è´´æ’ä»¶çš„Github/Gist URLï¼Œå³å¯å°†è‡ªå·±çš„æ’ä»¶åŠ è½½åˆ°ImageJ.JSä¸­ã€‚<br><img src="https://user-images.githubusercontent.com/6218739/144003370-395d9e87-7469-4f51-9753-4bc7b6e5e00a.png" alt="imagej"></p>]]></content>
    
    
    <summary type="html">è¿™ä¸€ç¯‡ä¸»è¦ä»‹ç»ImJoyä¸­çš„æ ¸å¿ƒæ¦‚å¿µã€‚
å‚è€ƒæ–‡çŒ®ï¼š
I2K Workshop Tutorial

ImJoyæ’ä»¶
ImJoy æä¾›äº†ä¸€ä¸ªçµæ´»çš„æ¡†æ¶æ¥å¼€å‘å…·æœ‰ä¸åŒç±»å‹çš„ Web æˆ– Python ç¼–ç¨‹è¯­è¨€çš„æ’ä»¶ã€‚

æœ‰å››ç§ç±»å‹çš„æ’ä»¶ï¼Œå…¶å¯ç”¨äºä¸åŒçš„ç›®çš„ï¼š
ï¼ˆ1ï¼‰Web æ’ä»¶ç›´æ¥åœ¨æµè§ˆå™¨ä¸­è¿è¡Œï¼Œæ”¯æŒå¦‚ä¸‹ä¸‰ç§ç±»å‹ï¼š

 * Window (HTML/CSS/JS)(type=window) æ’ä»¶ï¼Œç”¨äºä½¿ç”¨ HTML5/CSS å’Œ JavaScript æ„å»ºä¸°å¯Œçš„äº¤äº’å¼ç”¨æˆ·ç•Œé¢ï¼›
 * Web Worker (JS)(type=web-worker) æ’ä»¶ï¼Œç”¨äºä½¿ç”¨ JavaScript æˆ– WebA</summary>
    
    
    
    <category term="computer vision" scheme="http://qixinbo.github.io/categories/computer-vision/"/>
    
    
    <category term="ImJoy" scheme="http://qixinbo.github.io/tags/ImJoy/"/>
    
  </entry>
  
  <entry>
    <title>å¼€æºæ·±åº¦å­¦ä¹ è®¡ç®—å¹³å°ImJoyè§£æï¼š1 -- ä»‹ç»</title>
    <link href="http://qixinbo.github.io/2021/11/28/ImJoy_1/"/>
    <id>http://qixinbo.github.io/2021/11/28/ImJoy_1/</id>
    <published>2021-11-27T16:00:00.000Z</published>
    <updated>2021-11-29T08:38:33.670Z</updated>
    
    <content type="html"><![CDATA[<p>ä»è¯¥åšæ–‡å¼€å§‹ï¼Œå°†ä¼šå¯¹ImJoyè¿™ä¸€å¼€æºæ·±åº¦å­¦ä¹ è®¡ç®—å¹³å°åšä¸€è¯¦ç»†è§£æã€‚</p><h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><p>ï¼ˆè¿™éƒ¨åˆ†æ˜¯å¯¹å®˜æ–¹æ–‡æ¡£ï¼ˆåœ¨<a href="https://imjoy.io/docs/#/">è¿™é‡Œ</a>ï¼‰çš„ç¿»è¯‘ç†è§£ï¼‰<br>ImJoyæ˜¯ä¸€ä¸ªç”±æ’ä»¶é©±åŠ¨çš„æ··åˆè®¡ç®—å¹³å°ï¼Œç”¨äºéƒ¨ç½²æ·±åº¦å­¦ä¹ åº”ç”¨ç¨‹åºï¼Œä¾‹å¦‚é«˜çº§å›¾åƒåˆ†æå·¥å…·ã€‚<br>ImJoyå¯ä»¥è¿è¡Œåœ¨è·¨æ“ä½œç³»ç»Ÿçš„ç§»åŠ¨å’Œæ¡Œé¢ç¯å¢ƒä¸­ï¼Œå…¶ä¸­çš„æ’ä»¶å¯ä»¥è¿è¡Œåœ¨æµè§ˆå™¨ã€æœ¬åœ°ä¸»æœºã€è¿œç¨‹å’Œäº‘æœåŠ¡å™¨ä¸­ã€‚<br>å€ŸåŠ© ImJoyï¼Œå‡­å€Ÿå…¶çµæ´»çš„æ’ä»¶ç³»ç»Ÿå’Œå¯å…±äº«çš„æ’ä»¶ URLï¼Œå¯ä»¥éå¸¸ç®€å•åœ°å‘æœ€ç»ˆç”¨æˆ·æä¾›æ·±åº¦å­¦ä¹ å·¥å…·ï¼Œå…å»äº†ç”¨æˆ·è‡ªå·±é…ç½®æ·±åº¦å­¦ä¹ ç¯å¢ƒã€å®‰è£…åº”ç”¨ç¨‹åºçš„ç¹çå’Œç—›è‹¦ã€‚å¯¹äºå¼€å‘äººå‘˜æ¥è¯´ï¼Œä¹Ÿå¯ä»¥è½»æ¾åœ°å¯¹è‡ªå·±ç°æœ‰çš„Pythonä»£ç æ·»åŠ ä¸°å¯Œçš„äº¤äº’å¼ Web ç•Œé¢ï¼Œä»è€Œè®©è‡ªå·±çš„ç¨‹åºæ›´åŠ â€œè§¦æ‰‹å¯åŠâ€ã€‚<br>ä¸‹é¢æ˜¯ImJoyçš„æ•´ä½“æ¶æ„å›¾ï¼š<br><img src="https://user-images.githubusercontent.com/6218739/143673530-061125ed-4f2c-4bbd-8cef-b8ea12921c92.png" alt="arch"><br>å¯ä»¥çœ‹å‡ºï¼ŒImJoyç³»ç»Ÿéå¸¸çµæ´»ï¼Œä½“ç°åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š<br>ï¼ˆ1ï¼‰è·¨å¹³å°è·å–ï¼šå› ä¸ºImJoyæ˜¯åŸºäºwebçš„ï¼Œæ‰€ä»¥åªè¦æ˜¯æœ‰æµè§ˆå™¨çš„åœ°æ–¹ï¼ŒImJoyå°±å¯ä»¥ä½¿ç”¨ï¼Œæ¯”å¦‚æ¡Œé¢ç«¯ã€ç§»åŠ¨ç«¯è°ƒç”¨ç­‰ï¼›<br>ï¼ˆ2ï¼‰æ’ä»¶å½¢å¼çµæ´»ï¼šå¯ä»¥ä½¿ç”¨JavaScriptã€Pythonç­‰ç¼–ç¨‹è¯­è¨€ï¼›<br>ï¼ˆ3ï¼‰æ’ä»¶è¿è¡Œç¯å¢ƒå¤šæ ·ï¼šå¯¹äºä¸åŒé‡çº§çš„æ’ä»¶ï¼Œå¯ä»¥é€‰æ‹©å…¶åº”ç”¨ç¯å¢ƒï¼Œæ¯”å¦‚ä¸€ä¸ªç®€å•çš„æ’ä»¶ï¼Œå¯ä»¥ç›´æ¥åœ¨æµè§ˆå™¨ä¸­è¿è¡Œï¼›å¦‚æœæ˜¯ä¸€ä¸ªé‡å‹çš„æ·±åº¦å­¦ä¹ åº”ç”¨ï¼Œå¯ä»¥åœ¨æœ¬åœ°å·¥ä½œç«™ä¸­è¿è¡Œï¼Œä¹Ÿå¯ä»¥åœ¨è¿œç¨‹æœåŠ¡å™¨æˆ–è€…äº‘æœåŠ¡å™¨ä¸­è¿è¡Œã€‚</p><h1 id="ImJoyç‰¹ç‚¹"><a href="#ImJoyç‰¹ç‚¹" class="headerlink" title="ImJoyç‰¹ç‚¹"></a>ImJoyç‰¹ç‚¹</h1><p>ï¼ˆ1ï¼‰å°å·§ä¸”çµæ´»çš„æ’ä»¶é©±åŠ¨çš„ Web åº”ç”¨ç¨‹åº<br>ï¼ˆ2ï¼‰å…·æœ‰ç¦»çº¿æ”¯æŒçš„æ— æœåŠ¡å™¨æ¸è¿›å¼ Web åº”ç”¨ç¨‹åºï¼ˆPWAæŠ€æœ¯ï¼‰<br>ï¼ˆ3ï¼‰æ”¯æŒç§»åŠ¨è®¾å¤‡<br>ï¼ˆ4ï¼‰åŸºäºWebçš„ä¸°å¯Œçš„äº¤äº’å¼ç”¨æˆ·ç•Œé¢ï¼šå¯ä»¥ä½¿ç”¨ä»»ä½•ç°æœ‰çš„ç½‘é¡µè®¾è®¡åº“ã€ä½¿ç”¨ webGLã€Three.js ç­‰ä»¥ 3D å½¢å¼å‘ˆç°å¤šç»´æ•°æ®ã€‚<br>ï¼ˆ5ï¼‰æ˜“äºä½¿ç”¨çš„å·¥ä½œæµç»„åˆ<br>ï¼ˆ6ï¼‰ç”¨äºåˆ†ç»„æ’ä»¶çš„ç‹¬ç«‹å·¥ä½œåŒº<br>ï¼ˆ7ï¼‰æ–¹ä¾¿çš„æ’ä»¶åŸå‹è®¾è®¡å’Œå¼€å‘ï¼šå†…ç½®ä»£ç ç¼–è¾‘å™¨ï¼Œå¼€å‘ä¸éœ€è¦é¢å¤–çš„IDE<br>ï¼ˆ8ï¼‰å¼ºå¤§ä¸”å¯æ‰©å±•çš„è®¡ç®—åç«¯ï¼Œå¯ç”¨äºæµè§ˆå™¨å†…è®¡ç®—ã€æœ¬åœ°è®¡ç®—å’Œäº‘è®¡ç®—</p><ul><li>æ”¯æŒ Javascriptã€åŸç”Ÿ Python å’Œ web Pythonï¼ˆå³ç›´æ¥åœ¨ç½‘é¡µä¸­è¿è¡ŒPythonç¨‹åºï¼Œåº•å±‚æŠ€æœ¯æ˜¯Pyodideï¼‰</li><li>é€šè¿‡å¼‚æ­¥ç¼–ç¨‹å¹¶å‘æ’ä»¶æ‰§è¡Œ</li><li>ä½¿ç”¨ Webassembly åœ¨æµè§ˆå™¨ä¸­è¿è¡Œ Python æ’ä»¶</li><li>æµè§ˆå™¨æ’ä»¶ä¸å®‰å…¨æ²™ç®±éš”ç¦»</li><li>æ”¯æŒPython3 å’Œ Javascript çš„async/awaitè¯­æ³•</li><li>æ”¯æŒ Python çš„ Conda è™šæ‹Ÿç¯å¢ƒå’Œ pip åŒ…</li><li>æ”¯æŒæ‰˜ç®¡åœ¨ Github æˆ– CDN ä¸Šçš„ JavaScript åº“</li><li>é€šè¿‡ GitHub æˆ– Gist è½»æ¾éƒ¨ç½²å’Œå…±äº«æ’ä»¶</li><li>å°†å¼€å‘è€…è‡ªå·±çš„æ’ä»¶ä»“åº“éƒ¨ç½²åˆ° Github</li><li>åŸç”Ÿæ”¯æŒ n ç»´æ•°ç»„å’Œå¼ é‡</li><li>æ”¯æŒ Numpy çš„ ndarrays ç”¨äºæ•°æ®äº¤æ¢</li></ul><p>ImJoy å¤§å¤§åŠ å¿«äº†æ–°å·¥å…·çš„å¼€å‘å’Œä¼ æ’­ã€‚å¼€å‘è€…å¯ä»¥åœ¨ ImJoy ä¸­å¼€å‘æ’ä»¶ï¼Œå°†æ’ä»¶æ–‡ä»¶éƒ¨ç½²åˆ° Githubï¼Œå¹¶é€šè¿‡ç¤¾äº¤ç½‘ç»œåˆ†äº«æ’ä»¶ URLã€‚ç”¨æˆ·å¯ä»¥é€šè¿‡å¤šç§æ–¹å¼ä½¿ç”¨è¿™äº›æ’ä»¶ï¼Œæ¯”å¦‚åœ¨æ‰‹æœºä¸Šå•å‡»ä¸€ä¸‹å³å¯è°ƒç”¨ã€‚<br><img src="https://user-images.githubusercontent.com/6218739/143677962-526c570c-e61e-423e-8092-e78a013ef231.png" alt="deploy"></p><h1 id="ä¾èµ–åº“"><a href="#ä¾èµ–åº“" class="headerlink" title="ä¾èµ–åº“"></a>ä¾èµ–åº“</h1><p>ImJoyä¸»è¦ä½¿ç”¨çš„å¼€æºåº“æœ‰ï¼š</p><ul><li>Joy.jsï¼ˆè¿™å°±æ˜¯ImJoyçš„åå­—ç”±æ¥ï¼ï¼‰</li><li>Jailedï¼ˆç”¨äºéš”ç¦»æ’ä»¶ï¼‰</li><li>Vue.jsï¼ˆä¸»è¦çš„å‰ç«¯UIä½¿ç”¨ Vue.js ç¼–å†™ï¼‰</li><li>vue-grid-layoutï¼ˆç”¨äºçª—å£ç®¡ç†ï¼‰</li><li>python-socketioï¼ˆä½¿å¾—æ’ä»¶å¼•æ“å¯ä»¥ä¸ ImJoyä¸»ç¨‹åºè¿›è¡Œé€šä¿¡ï¼‰</li><li>pyodideï¼ˆä½¿ç”¨ WebAssembly å¯ç”¨ web python æ¨¡å¼ï¼‰</li><li>condaï¼ˆæ’ä»¶å¼•æ“ä½¿ç”¨ Conda æ¥ç®¡ç†è™šæ‹Ÿç¯å¢ƒå’ŒåŒ…ï¼‰</li><li>docsifyï¼ˆImJoy æ–‡æ¡£æ˜¯ç”¨ docsify åˆ›å»ºçš„ï¼‰</li></ul><h1 id="å‘è¡¨è®ºæ–‡"><a href="#å‘è¡¨è®ºæ–‡" class="headerlink" title="å‘è¡¨è®ºæ–‡"></a>å‘è¡¨è®ºæ–‡</h1><p>ImJoyçš„ç ”ç©¶å·¥ä½œä¹Ÿå‘è¡¨åœ¨äº†Natureå­åˆŠ Nature Methodsä¸Šï¼Œå¤§ä½¬å°±æ˜¯å¤§ä½¬ã€‚<br>æ–‡ç« é“¾æ¥è§ï¼š<a href="https://www.nature.com/articles/s41592-019-0627-0">ImJoy: an open-source computational platform for the deep learning era</a><br>ä¹Ÿå¯ä»¥é€šè¿‡<a href="https://rdcu.be/bYbGO">è¿™ä¸ªé“¾æ¥</a>å…è´¹è·å–è¯¥è®ºæ–‡ã€‚</p><h1 id="å¿«é€Ÿä¸Šæ‰‹"><a href="#å¿«é€Ÿä¸Šæ‰‹" class="headerlink" title="å¿«é€Ÿä¸Šæ‰‹"></a>å¿«é€Ÿä¸Šæ‰‹</h1><h2 id="å‰ç«¯ç•Œé¢"><a href="#å‰ç«¯ç•Œé¢" class="headerlink" title="å‰ç«¯ç•Œé¢"></a>å‰ç«¯ç•Œé¢</h2><p>å¯ä»¥ç›´æ¥åœ¨æµè§ˆå™¨ä¸­ä½¿ç”¨ImJoyï¼Œç½‘ç«™åœ¨<a href="https://imjoy.io/#/app">è¿™é‡Œ</a>ã€‚<br>ï¼ˆä¹Ÿå¯ä»¥è‡ªå·±æ‰˜ç®¡ImJoyï¼Œå³ä½¿ç”¨GitHubä¸Šçš„<a href="https://github.com/imjoy-team/ImJoy">è¿™ä¸ªä»“åº“</a>ï¼‰<br>æ•´ä¸ªåº”ç”¨çš„å‰ç«¯ç•Œé¢å¦‚ä¸‹ï¼š<br><img src="https://user-images.githubusercontent.com/6218739/143802507-b85944e6-4a5d-49d6-82d8-fcceb76991a3.png" alt="UI"><br>åŒ…æ‹¬äº†æ’ä»¶ç®¡ç†åŒºã€å·¥ä½œåŒºã€çŠ¶æ€æ ã€å·¥å…·æ ã€æ’ä»¶çª—å£ç­‰å¤šä¸ªéƒ¨åˆ†ã€‚</p><h2 id="ä¸Šæ‰‹ä½“éªŒ"><a href="#ä¸Šæ‰‹ä½“éªŒ" class="headerlink" title="ä¸Šæ‰‹ä½“éªŒ"></a>ä¸Šæ‰‹ä½“éªŒ</h2><p>å®˜æ–¹æä¾›çš„ä¸€ä¸ªdemoæ˜¯ä½¿ç”¨ä¸€ä¸ªé¢„è®­ç»ƒçš„ç¥ç»ç½‘ç»œæ¥è¿›è¡Œå›¾åƒè¯†åˆ«ã€‚<br>è¿™ä¸ªæ’ä»¶å¯ä»¥é€šè¿‡åœ¨<a href="https://imjoy.io/repo/">æ’ä»¶åº“</a>ä¸­å®‰è£…æ’ä»¶Image Recognitionæ¥è·å¾—ï¼Œ<br>ä¹Ÿå¯ä»¥ç›´æ¥ç‚¹å‡»<a href="https://imjoy.io/#/app?plugin=imjoy-team/imjoy-plugins:Image%20Recognition&amp;w=getting-started">è¯¥é“¾æ¥</a>æ¥ä½¿ç”¨ã€‚<br>å®‰è£…æ’ä»¶åï¼Œå®ƒå°†å‡ºç°åœ¨å·¦ä¾§çš„æ’ä»¶å¯¹è¯æ¡†ä¸­ã€‚ç„¶åå•å‡»å…¶åç§°å¯åŠ¨æ’ä»¶ã€‚è¿™å°†æ‰“å¼€ä¸€ä¸ªçª—å£å¹¶åŠ è½½è®­ç»ƒå¥½çš„ç½‘ç»œã€‚<br>ç„¶åå°±å¯ä»¥é€šè¿‡ä¸Šä¼ æ–‡ä»¶æ¥é¢„æµ‹å›¾åƒä¸­çš„ç‰©ä½“ã€‚<br>æ³¨æ„ï¼Œå¦‚æœæ˜¯åœ¨ç”µè„‘ä¸Šä½¿ç”¨è¯¥æ’ä»¶ï¼Œåˆ™æ˜¯ä¸Šä¼ ç”µè„‘ä¸­çš„æ–‡ä»¶ï¼Œå¦‚æœæ˜¯åœ¨æ‰‹æœºä¸Šä½¿ç”¨è¯¥æ’ä»¶ï¼Œåˆ™è°ƒç”¨æ‘„åƒå¤´æ¥è·å–å›¾åƒã€‚<br>å¦‚ä¸‹æ˜¯æˆ‘åœ¨æ‰‹æœºä¸Šè¯•ç”¨çš„æˆªå›¾ï¼š<br><img src="https://user-images.githubusercontent.com/6218739/143830446-897d525c-c84e-4e85-a689-8d1fcab75b0e.jpg" alt="test"></p><p>é€šè¿‡æ­¤ä¾‹ä¹Ÿå¯ä»¥çœ‹å‡ºï¼ŒImJoyæä¾›äº†ä¸€ç§éå¸¸æ–¹ä¾¿åœ°è·å–æœ€æ–°æ·±åº¦å­¦ä¹ æŠ€æœ¯çš„æ–¹å¼ï¼Œèƒ½æå¤§åœ°é™ä½æŠ€æœ¯çš„åº”ç”¨é—¨æ§›ã€‚</p>]]></content>
    
    
    <summary type="html">ä»è¯¥åšæ–‡å¼€å§‹ï¼Œå°†ä¼šå¯¹ImJoyè¿™ä¸€å¼€æºæ·±åº¦å­¦ä¹ è®¡ç®—å¹³å°åšä¸€è¯¦ç»†è§£æã€‚

ç®€ä»‹
ï¼ˆè¿™éƒ¨åˆ†æ˜¯å¯¹å®˜æ–¹æ–‡æ¡£ï¼ˆåœ¨è¿™é‡Œï¼‰çš„ç¿»è¯‘ç†è§£ï¼‰
ImJoyæ˜¯ä¸€ä¸ªç”±æ’ä»¶é©±åŠ¨çš„æ··åˆè®¡ç®—å¹³å°ï¼Œç”¨äºéƒ¨ç½²æ·±åº¦å­¦ä¹ åº”ç”¨ç¨‹åºï¼Œä¾‹å¦‚é«˜çº§å›¾åƒåˆ†æå·¥å…·ã€‚
ImJoyå¯ä»¥è¿è¡Œåœ¨è·¨æ“ä½œç³»ç»Ÿçš„ç§»åŠ¨å’Œæ¡Œé¢ç¯å¢ƒä¸­ï¼Œå…¶ä¸­çš„æ’ä»¶å¯ä»¥è¿è¡Œåœ¨æµè§ˆå™¨ã€æœ¬åœ°ä¸»æœºã€è¿œç¨‹å’Œäº‘æœåŠ¡å™¨ä¸­ã€‚
å€ŸåŠ© ImJoyï¼Œå‡­å€Ÿå…¶çµæ´»çš„æ’ä»¶ç³»ç»Ÿå’Œå¯å…±äº«çš„æ’ä»¶ URLï¼Œå¯ä»¥éå¸¸ç®€å•åœ°å‘æœ€ç»ˆç”¨æˆ·æä¾›æ·±åº¦å­¦ä¹ å·¥å…·ï¼Œå…å»äº†ç”¨æˆ·è‡ªå·±é…ç½®æ·±åº¦å­¦ä¹ ç¯å¢ƒã€å®‰è£…åº”ç”¨ç¨‹åºçš„ç¹çå’Œç—›è‹¦ã€‚å¯¹äºå¼€å‘äººå‘˜æ¥è¯´ï¼Œä¹Ÿå¯ä»¥è½»æ¾åœ°å¯¹è‡ªå·±ç°æœ‰çš„Pythonä»£ç æ·»åŠ ä¸°å¯Œçš„äº¤äº’å¼ Web ç•Œé¢ï¼Œä»è€Œè®©è‡ªå·±çš„ç¨‹åºæ›´åŠ â€œè§¦æ‰‹</summary>
    
    
    
    <category term="computer vision" scheme="http://qixinbo.github.io/categories/computer-vision/"/>
    
    
    <category term="ImJoy" scheme="http://qixinbo.github.io/tags/ImJoy/"/>
    
  </entry>
  
  <entry>
    <title>å›¾ç¥ç»ç½‘ç»œå…¥é—¨è¯¦è§£</title>
    <link href="http://qixinbo.github.io/2021/11/24/gnn/"/>
    <id>http://qixinbo.github.io/2021/11/24/gnn/</id>
    <published>2021-11-23T16:00:00.000Z</published>
    <updated>2021-11-24T06:47:19.043Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡åŸºæœ¬æ˜¯å¯¹<a href="https://distill.pub/2021/gnn-intro/">A Gentle Introduction to Graph Neural Networks</a>è¿™ç¯‡æ–‡ç« çš„ç¿»è¯‘ç†è§£ã€‚<br>ï¼ˆæ³¨æ„ï¼šåŸæ–‡ä¸­æœ‰å¾ˆå¤šå¯äº¤äº’çš„åŠ¨ç”»ï¼Œæ›´æœ‰å¯å‘æ€§ã€‚æœ¬æ–‡å¯¹åŸæ–‡ä¸­çš„æœ‰äº›å›¾åƒè¿›è¡Œäº†è°ƒæ•´ï¼Œæ–¹ä¾¿åˆå­¦è€…ç†è§£ï¼‰</p><h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><p>ï¼ˆè¿™éƒ¨åˆ†å¤§éƒ½æ¥è‡ªäº<a href="https://zhuanlan.zhihu.com/p/75307407">è¿™ç¯‡å‚è€ƒæ–‡çŒ®</a>ï¼‰<br>æ›¾æœ‰å­¦è€…å°†æœ¬æ¬¡äººå·¥æ™ºèƒ½æµªæ½®çš„å…´èµ·å½’å› äºä¸‰ä¸ªæ¡ä»¶ï¼Œåˆ†åˆ«æ˜¯ï¼š<br>ï¼ˆ1ï¼‰è®¡ç®—èµ„æºçš„å¿«é€Ÿå‘å±•ï¼ˆå¦‚GPUï¼‰<br>ï¼ˆ2ï¼‰å¤§é‡è®­ç»ƒæ•°æ®çš„å¯ç”¨æ€§<br>ï¼ˆ3ï¼‰æ·±åº¦å­¦ä¹ ä»æ¬§æ°ç©ºé—´æ•°æ®ä¸­æå–æ½œåœ¨ç‰¹å¾çš„æœ‰æ•ˆæ€§<br>å°½ç®¡ä¼ ç»Ÿçš„æ·±åº¦å­¦ä¹ æ–¹æ³•è¢«åº”ç”¨åœ¨æå–æ¬§æ°ç©ºé—´æ•°æ®çš„ç‰¹å¾æ–¹é¢å–å¾—äº†å·¨å¤§çš„æˆåŠŸï¼Œä½†è®¸å¤šå®é™…åº”ç”¨åœºæ™¯ä¸­çš„æ•°æ®æ˜¯ä»éæ¬§å¼ç©ºé—´ç”Ÿæˆçš„ï¼Œä¼ ç»Ÿçš„æ·±åº¦å­¦ä¹ æ–¹æ³•åœ¨å¤„ç†éæ¬§å¼ç©ºé—´æ•°æ®ä¸Šçš„è¡¨ç°å´ä»éš¾ä»¥ä½¿äººæ»¡æ„ã€‚<br>å¸¸è§çš„æ¬§å‡ é‡Œå¾—ç»“æ„åŒ–æ•°æ®ä¸»è¦åŒ…å«ï¼š<br>ï¼ˆ1ï¼‰1Dï¼šå£°éŸ³ï¼Œæ—¶é—´åºåˆ—ç­‰ï¼›<br>ï¼ˆ2ï¼‰2Dï¼šå›¾åƒç­‰ï¼›<br>ï¼ˆ3ï¼‰3Dï¼šè§†é¢‘ï¼Œé«˜å…‰è°±å›¾åƒç­‰ã€‚<br>å¸¸è§çš„éæ¬§å‡ é‡Œå¾—ç»“æ„åŒ–æ•°æ®æœ‰ï¼š<br>ï¼ˆ1ï¼‰1Dï¼šç¤¾äº¤ç½‘ç»œ(å¦‚Facebookï¼ŒTwitter)ç­‰ï¼›<br>ï¼ˆ2ï¼‰2Dï¼šç”Ÿç‰©ç½‘ç»œ(åŸºå› ï¼Œåˆ†å­ï¼Œå¤§è„‘è¿æ¥)ç­‰ï¼›<br>ï¼ˆ3ï¼‰3Dï¼šåŸºç¡€è®¾æ–½ç½‘ç»œ(å¦‚èƒ½æºï¼Œäº¤é€šï¼Œäº’è”ç½‘ï¼Œé€šä¿¡ç­‰ã€‚</p><p>ä¾‹å¦‚ï¼Œåœ¨ç”µå­å•†åŠ¡ä¸­ï¼Œä¸€ä¸ªåŸºäºå›¾ï¼ˆGraphï¼‰çš„å­¦ä¹ ç³»ç»Ÿèƒ½å¤Ÿåˆ©ç”¨ç”¨æˆ·å’Œäº§å“ä¹‹é—´çš„äº¤äº’æ¥åšå‡ºéå¸¸å‡†ç¡®çš„æ¨èï¼Œä½†å›¾çš„å¤æ‚æ€§ä½¿å¾—ç°æœ‰çš„æ·±åº¦å­¦ä¹ ç®—æ³•åœ¨å¤„ç†æ—¶é¢ä¸´ç€å·¨å¤§çš„æŒ‘æˆ˜ã€‚è¿™æ˜¯å› ä¸ºå›¾æ˜¯ä¸è§„åˆ™çš„ï¼Œæ¯ä¸ªå›¾éƒ½æœ‰ä¸€ä¸ªå¤§å°å¯å˜çš„æ— åºèŠ‚ç‚¹ï¼Œå›¾ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸åŒæ•°é‡çš„ç›¸é‚»èŠ‚ç‚¹ï¼Œå¯¼è‡´ä¸€äº›é‡è¦çš„æ“ä½œï¼ˆä¾‹å¦‚å·ç§¯ï¼‰åœ¨å›¾åƒï¼ˆImageï¼‰ä¸Šå¾ˆå®¹æ˜“è®¡ç®—ï¼Œä½†ä¸å†é€‚åˆç›´æ¥ç”¨äºå›¾ã€‚æ­¤å¤–ï¼Œç°æœ‰æ·±åº¦å­¦ä¹ ç®—æ³•çš„ä¸€ä¸ªæ ¸å¿ƒå‡è®¾æ˜¯æ•°æ®æ ·æœ¬ä¹‹é—´å½¼æ­¤ç‹¬ç«‹ã€‚ç„¶è€Œï¼Œå¯¹äºå›¾æ¥è¯´ï¼Œæƒ…å†µå¹¶éå¦‚æ­¤ï¼Œå›¾ä¸­çš„æ¯ä¸ªæ•°æ®æ ·æœ¬ï¼ˆèŠ‚ç‚¹ï¼‰éƒ½ä¼šæœ‰è¾¹ä¸å›¾ä¸­å…¶ä»–å®æ•°æ®æ ·æœ¬ï¼ˆèŠ‚ç‚¹ï¼‰ç›¸å…³ï¼Œè¿™äº›ä¿¡æ¯å¯ç”¨äºæ•è·å®ä¾‹ä¹‹é—´çš„ç›¸äº’ä¾èµ–å…³ç³»ã€‚</p><p>è¿‘å¹´æ¥ï¼Œäººä»¬å¯¹æ·±åº¦å­¦ä¹ æ–¹æ³•åœ¨å›¾ä¸Šçš„æ‰©å±•è¶Šæ¥è¶Šæ„Ÿå…´è¶£ã€‚åœ¨å¤šæ–¹å› ç´ çš„æˆåŠŸæ¨åŠ¨ä¸‹ï¼Œç ”ç©¶äººå‘˜å€Ÿé‰´äº†å·ç§¯ç½‘ç»œã€å¾ªç¯ç½‘ç»œå’Œæ·±åº¦è‡ªåŠ¨ç¼–ç å™¨çš„æ€æƒ³ï¼Œå®šä¹‰å’Œè®¾è®¡äº†ç”¨äºå¤„ç†å›¾æ•°æ®çš„ç¥ç»ç½‘ç»œç»“æ„ï¼Œç”±æ­¤ä¸€ä¸ªæ–°çš„ç ”ç©¶çƒ­ç‚¹â€”â€”å›¾ç¥ç»ç½‘ç»œï¼ˆGraph Neural Networksï¼ŒGNNï¼‰ã€‚</p><h1 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h1><p>ä»€ä¹ˆæ˜¯å›¾ï¼Ÿå›¾ï¼ˆgraphï¼‰æ˜¯ä¸€ç³»åˆ—å®ä½“ï¼ˆnodesï¼‰ä¹‹é—´çš„å…³ç³»ï¼ˆedgesï¼‰ã€‚<br><img src="https://user-images.githubusercontent.com/6218739/142832766-879eefb5-ebb6-4edb-979a-2b8318c880a4.png" alt="graph"><br>é»„è‰²çš„æ˜¯èŠ‚ç‚¹æˆ–ç§°é¡¶ç‚¹ï¼Œå…¶å±æ€§åŒ…æ‹¬èŠ‚ç‚¹æ ‡è¯†ã€é‚»å±…æ•°é‡ç­‰ï¼›<br>è“è‰²çš„æ˜¯è¾¹æˆ–ç§°é“¾æ¥ï¼Œå…¶å±æ€§åŒ…æ‹¬è¾¹çš„æ ‡è¯†ã€è¾¹çš„æƒé‡ç­‰ï¼›<br>çº¢è‰²çº¿æ¡†åŒ…å›´çš„å°±æ˜¯æ•´å¼ å›¾ï¼Œæˆ–ç§°å…¨å±€ï¼Œè¯¥å…¨å±€å±æ€§åŒ…æ‹¬èŠ‚ç‚¹æ•°é‡ã€å›¾ä¸­çš„æœ€é•¿è·¯å¾„ç­‰ç‰¹å¾ã€‚<br>å…¶ä¸­ï¼Œæ ¹æ®è¾¹çš„æ–¹å‘æ€§è¿˜æœ‰ä¸¤ç§æƒ…å½¢ï¼Œæœ‰å‘å›¾å’Œæ— å‘å›¾ï¼š<br><img src="https://user-images.githubusercontent.com/6218739/142834186-f97f87f4-afb1-46c4-a5ed-6e1f22c6d68e.png" alt="edge"></p><h1 id="å“ªäº›æ˜¯å›¾"><a href="#å“ªäº›æ˜¯å›¾" class="headerlink" title="å“ªäº›æ˜¯å›¾"></a>å“ªäº›æ˜¯å›¾</h1><h2 id="ç¤¾äº¤ç½‘ç»œä½œä¸ºå›¾"><a href="#ç¤¾äº¤ç½‘ç»œä½œä¸ºå›¾" class="headerlink" title="ç¤¾äº¤ç½‘ç»œä½œä¸ºå›¾"></a>ç¤¾äº¤ç½‘ç»œä½œä¸ºå›¾</h2><p>å›¾graphç»“æ„æœ€ç®€å•æ˜äº†çš„ä¸€ç§çœŸå®åº”ç”¨åœºæ™¯å°±æ˜¯ç¤¾äº¤ç½‘ç»œã€‚<br>ç¤¾äº¤ç½‘ç»œæ˜¯ç”¨æ¥ç ”ç©¶äººåœ¨æœºæ„ã€ç»„ç»‡ç­‰é›†ä½“ä¸­çš„è¡Œä¸ºæ¨¡å¼çš„å·¥å…·ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡å°†ä¸ªäººå»ºæ¨¡ä¸ºèŠ‚ç‚¹ã€å°†äººä¸äººä¹‹é—´çš„å…³ç³»å»ºæ¨¡ä¸ºè¾¹æ¥æ„å»ºè¡¨ç¤ºç¤¾äº¤ç½‘ç»œçš„å›¾ã€‚<br>æ¯”å¦‚å¦‚ä¸‹æ˜¯èå£«æ¯”äºšçš„æˆå‰§ã€Šå¥¥èµ›ç½—ã€‹ä¸­çš„ç¤¾äº¤ç½‘ç»œçš„å›¾è¡¨è¾¾ï¼š<br><img src="https://user-images.githubusercontent.com/6218739/142959871-586a3938-6432-4b59-a5b5-c1dbf605a7c7.png" alt="social"><br>ä¸€ç§å¯è§†åŒ–å›¾çš„è¿é€šæ€§çš„æ–¹æ³•æ˜¯é€šè¿‡å…¶é‚»æ¥çŸ©é˜µã€‚å¦‚æœäººä¸äººä¹‹é—´æœ‰å…³ç³»ï¼Œåˆ™åœ¨è¯¥çŸ©é˜µä¸­å¡«å……æ•°å€¼ï¼š<br><img src="https://user-images.githubusercontent.com/6218739/142960047-1590c3f0-9058-4275-8f09-4f9fef2f3b1d.png" alt="othello-matrix"></p><h2 id="å¼•æ–‡ç½‘ç»œä½œä¸ºå›¾"><a href="#å¼•æ–‡ç½‘ç»œä½œä¸ºå›¾" class="headerlink" title="å¼•æ–‡ç½‘ç»œä½œä¸ºå›¾"></a>å¼•æ–‡ç½‘ç»œä½œä¸ºå›¾</h2><p>ç§‘å­¦å®¶åœ¨å‘è¡¨è®ºæ–‡æ—¶ç»å¸¸å¼•ç”¨å…¶ä»–ç§‘å­¦å®¶çš„å·¥ä½œã€‚æˆ‘ä»¬å¯ä»¥å°†è¿™äº›å¼•æ–‡ç½‘ç»œå¯è§†åŒ–ä¸ºä¸€ä¸ªå›¾ï¼Œå…¶ä¸­æ¯ç¯‡è®ºæ–‡éƒ½æ˜¯ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ¯ä¸ªæœ‰å‘è¾¹æ˜¯ä¸€ç¯‡è®ºæ–‡å’Œå¦ä¸€ç¯‡è®ºæ–‡ä¹‹é—´çš„å¼•ç”¨ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ¯ç¯‡è®ºæ–‡çš„ä¿¡æ¯æ·»åŠ åˆ°æ¯ä¸ªèŠ‚ç‚¹ä¸­ï¼Œä¾‹å¦‚æ‘˜è¦çš„è¯åµŒå…¥ã€‚</p><h2 id="åˆ†å­ä½œä¸ºå›¾"><a href="#åˆ†å­ä½œä¸ºå›¾" class="headerlink" title="åˆ†å­ä½œä¸ºå›¾"></a>åˆ†å­ä½œä¸ºå›¾</h2><p>åˆ†å­æ˜¯ç‰©è´¨çš„åŸºçŸ³ï¼Œç”±3Dç©ºé—´ä¸­çš„åŸå­å’Œç”µå­æ„æˆã€‚æ‰€æœ‰ç²’å­éƒ½åœ¨ç›¸äº’ä½œç”¨ï¼Œä½†æ˜¯å½“ä¸€å¯¹åŸå­å½¼æ­¤ä¿æŒç¨³å®šçš„è·ç¦»æ—¶ï¼Œæˆ‘ä»¬è¯´å®ƒä»¬å…±äº«ä¸€ä¸ªå…±ä»·é”®ã€‚ä¸åŒçš„åŸå­å¯¹å’Œé”®æœ‰ä¸åŒçš„è·ç¦»ï¼ˆä¾‹å¦‚å•é”®ã€åŒé”®ï¼‰ã€‚å°†è¿™ä¸ª3Då¯¹è±¡æè¿°ä¸ºå›¾æ˜¯ä¸€ç§éå¸¸æ–¹ä¾¿å’Œå¸¸è§çš„æŠ½è±¡ï¼Œå…¶ä¸­èŠ‚ç‚¹æ˜¯åŸå­ï¼Œè¾¹æ˜¯å…±ä»·é”®ã€‚<br>å¦‚ä¸‹æ˜¯å’–å•¡å› å› å­çš„3Dè¡¨ç¤ºï¼ŒåŠå°†å®ƒå»ºæ¨¡ä¸ºå›¾ã€‚<br><img src="https://user-images.githubusercontent.com/6218739/142960475-a26bf1b8-1275-4073-9135-81c4d99eb652.png" alt="Caffeine"></p><p>ä»¥ä¸Šä¸‰ä¾‹çš„æ•°æ®éƒ½æ˜¯å¼‚æ„çš„ï¼Œç”±å…¶æ‰€å»ºçš„å›¾graphä¸­çš„èŠ‚ç‚¹çš„é‚»å±…æ•°é‡æ˜¯å¯å˜çš„ã€‚ä¸‹é¢å°†å±•ç¤ºä¸¤ç§å¯èƒ½è®¤ä¸ºæ— æ³•å»ºæ¨¡ä¸ºå›¾çš„æ•°æ®ç±»å‹ï¼šå›¾åƒå’Œæ–‡æœ¬ã€‚è¿™ä¸¤ç±»çš„æ•°æ®å°±éå¸¸è§„æ•´ï¼Œè¡¨ç°åœ¨å…¶é‚»å±…æ•°é‡æ˜¯å›ºå®šçš„ï¼Œä½†æ˜¯å®ƒä»¬ä»ç„¶å¯ä»¥å»ºæ¨¡ä¸ºå›¾è¿™ä¸€ç§æ•°æ®ç»“æ„ã€‚</p><h3 id="å›¾åƒä½œä¸ºå›¾"><a href="#å›¾åƒä½œä¸ºå›¾" class="headerlink" title="å›¾åƒä½œä¸ºå›¾"></a>å›¾åƒä½œä¸ºå›¾</h3><p>é€šå¸¸å°†å›¾åƒè§†ä¸ºå…·æœ‰å›¾åƒé€šé“çš„çŸ©å½¢ç½‘æ ¼ï¼Œå¹¶å°†å®ƒä»¬è¡¨ç¤ºä¸ºæ•°ç»„ï¼ˆä¾‹å¦‚ï¼Œ244x244x3 æµ®ç‚¹æ•°ï¼‰ã€‚<br>å¦ä¸€ç§æ–¹å¼å°±æ˜¯å°†å›¾åƒè§†ä¸ºå…·æœ‰è§„åˆ™ç»“æ„çš„å›¾ï¼Œå…¶ä¸­æ¯ä¸ªåƒç´ ä»£è¡¨ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¹¶é€šè¿‡è¾¹è¿æ¥åˆ°ç›¸é‚»åƒç´ ã€‚æ¯ä¸ªéè¾¹ç•Œåƒç´ æ­£å¥½æœ‰ 8 ä¸ªé‚»å±…ï¼Œæ¯ä¸ªèŠ‚ç‚¹å­˜å‚¨çš„ä¿¡æ¯æ˜¯ä¸€ä¸ª 3 ç»´å‘é‡ï¼Œè¡¨ç¤ºåƒç´ çš„ RGB å€¼ã€‚å¦‚ä¸‹é¢çš„ 5x5 ç¬‘è„¸å›¾åƒï¼š<br><img src="https://user-images.githubusercontent.com/6218739/142835438-5437aebb-e206-4165-8abc-ba0393d0f0a3.png" alt="imageasgraph"><br>åœ¨é‚»æ¥çŸ©é˜µä¸­ï¼Œæˆ‘ä»¬å¯¹25ä¸ªèŠ‚ç‚¹è¿›è¡Œæ’åºï¼Œå¹¶å½¢æˆä¸€ä¸ª $ n_{nodes} \times n_{nodes} $ çš„çŸ©é˜µï¼Œå¦‚æœä¸¤ä¸ªèŠ‚ç‚¹å…±äº«ä¸€æ¡è¾¹ï¼Œåˆ™åœ¨çŸ©é˜µä¸­å¡«å……æ•°å€¼ï¼Œå¦‚ä¸‹ï¼š<br><img src="https://user-images.githubusercontent.com/6218739/142958394-555a75ae-67ce-49a2-8210-3950f08ca9b7.png" alt="matrix"></p><h2 id="æ–‡æœ¬ä½œä¸ºå›¾"><a href="#æ–‡æœ¬ä½œä¸ºå›¾" class="headerlink" title="æ–‡æœ¬ä½œä¸ºå›¾"></a>æ–‡æœ¬ä½œä¸ºå›¾</h2><p>é¦–å…ˆå°†æ–‡æœ¬è¿›è¡Œâ€œæ•°å­—åŒ–â€ï¼šæ¯”å¦‚å¯¹æ¯ä¸ªå­—ç¬¦characterã€å•è¯wordæˆ–tokenéƒ½å…³è”ä¸€ä¸ªç´¢å¼•ï¼Œç„¶åæ–‡æœ¬å°±å¯ä»¥è¡¨ç¤ºä¸ºä¸€ç³»åˆ—çš„ç´¢å¼•ï¼ˆè¿™ç§æ–¹å¼æ˜¯æ–‡æœ¬åœ¨å¾ªç¯ç¥ç»ç½‘ç»œRNN ä¸­ç»å¸¸è¡¨ç¤ºçš„æ–¹å¼ï¼‰ã€‚<br>è¿™å°†åˆ›å»ºä¸€ä¸ªç®€å•çš„æœ‰å‘å›¾ï¼Œå…¶ä¸­æ¯ä¸ªç´¢å¼•éƒ½æ˜¯ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¹¶é€šè¿‡ä¸€æ¡è¾¹è¿æ¥åˆ°å®ƒåé¢çš„èŠ‚ç‚¹ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="https://user-images.githubusercontent.com/6218739/142958918-f8780d03-7f99-4794-9971-844de5c9f4c4.png" alt="text"></p><p>å½“ç„¶ï¼Œåœ¨å®è·µä¸­ï¼Œè¿™é€šå¸¸ä¸æ˜¯æ–‡æœ¬å’Œå›¾åƒçš„ç¼–ç æ–¹å¼ï¼šè¿™ç§å›¾graphçš„è¡¨è¾¾æ˜¯å†—ä½™çš„ï¼Œå› ä¸ºæ‰€æœ‰å›¾åƒå’Œæ‰€æœ‰æ–‡æœ¬éƒ½å…·æœ‰éå¸¸è§„åˆ™çš„ç»“æ„ã€‚ä¾‹å¦‚ï¼Œå›¾åƒåœ¨å…¶é‚»æ¥çŸ©é˜µä¸­å…·æœ‰å¸¦çŠ¶ç»“æ„ï¼Œè¿™æ˜¯å› ä¸ºæ‰€æœ‰èŠ‚ç‚¹ï¼ˆåƒç´ ï¼‰éƒ½åœ¨ä¸€ä¸ªè§„åˆ™ç½‘æ ¼ä¸­ç›¸äº’è¿æ¥ã€‚æ–‡æœ¬çš„é‚»æ¥çŸ©é˜µåªæ˜¯ä¸€æ¡å¯¹è§’çº¿ï¼Œå› ä¸ºæ¯ä¸ªå•è¯åªè¿æ¥åˆ°å‰ä¸€ä¸ªå•è¯å’Œä¸‹ä¸€ä¸ªå•è¯ã€‚</p><h2 id="å…¶ä»–ä¾‹å­"><a href="#å…¶ä»–ä¾‹å­" class="headerlink" title="å…¶ä»–ä¾‹å­"></a>å…¶ä»–ä¾‹å­</h2><p>åœ¨è®¡ç®—æœºè§†è§‰ä¸­ï¼Œæˆ‘ä»¬æœ‰æ—¶æƒ³æ ‡è®°è§†è§‰åœºæ™¯ä¸­çš„å¯¹è±¡ã€‚ç„¶åå¯ä»¥é€šè¿‡å°†è¿™äº›å¯¹è±¡è§†ä¸ºèŠ‚ç‚¹ï¼Œå°†å®ƒä»¬çš„å…³ç³»è§†ä¸ºè¾¹æ¥æ„å»ºå›¾ã€‚<br>æœºå™¨å­¦ä¹ æ¨¡å‹ï¼Œç¼–ç¨‹ä»£ç å’Œæ•°å­¦æ–¹ç¨‹ä¹Ÿå¯ä»¥è¡¨è¿°ä¸ºå›¾ï¼Œå…¶ä¸­å˜é‡æ˜¯èŠ‚ç‚¹ï¼Œè¾¹æ˜¯å°†è¿™äº›å˜é‡ä½œä¸ºè¾“å…¥å’Œè¾“å‡ºçš„æ“ä½œã€‚æœ¯è¯­â€œæ•°æ®æµå›¾â€dataflow graphå°±æ˜¯è¿™ä¸ªæ„æ€ã€‚</p><h1 id="å›¾èƒ½å¹²ä»€ä¹ˆ"><a href="#å›¾èƒ½å¹²ä»€ä¹ˆ" class="headerlink" title="å›¾èƒ½å¹²ä»€ä¹ˆ"></a>å›¾èƒ½å¹²ä»€ä¹ˆ</h1><p>å›¾ä¸Šçš„é¢„æµ‹ä»»åŠ¡ä¸€èˆ¬åˆ†ä¸ºä¸‰ç§ç±»å‹ï¼šå›¾çº§graph-levelã€èŠ‚ç‚¹çº§node-levelå’Œè¾¹çº§edge-levelã€‚<br>åœ¨å›¾çº§ä»»åŠ¡ä¸­ï¼Œæˆ‘ä»¬é¢„æµ‹æ•´ä¸ªå›¾çš„å•ä¸ªå±æ€§ã€‚å¯¹äºèŠ‚ç‚¹çº§ä»»åŠ¡ï¼Œæˆ‘ä»¬é¢„æµ‹å›¾ä¸­æ¯ä¸ªèŠ‚ç‚¹çš„ä¸€äº›å±æ€§ã€‚å¯¹äºè¾¹çº§ä»»åŠ¡ï¼Œæˆ‘ä»¬å¸Œæœ›é¢„æµ‹å›¾ä¸­è¾¹çš„å±æ€§æˆ–å­˜åœ¨ã€‚</p><h2 id="å›¾çº§ä»»åŠ¡"><a href="#å›¾çº§ä»»åŠ¡" class="headerlink" title="å›¾çº§ä»»åŠ¡"></a>å›¾çº§ä»»åŠ¡</h2><p>åœ¨å›¾çº§ä»»åŠ¡ä¸­ï¼Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯é¢„æµ‹æ•´ä¸ªå›¾çš„å±æ€§ã€‚ä¾‹å¦‚ï¼Œå¯¹äºè¡¨ç¤ºä¸ºå›¾çš„åˆ†å­ï¼Œæˆ‘ä»¬å¯èƒ½æƒ³è¦é¢„æµ‹è¯¥åˆ†å­çš„æ°”å‘³ï¼Œæˆ–è€…å®ƒæ˜¯å¦ä¼šä¸ä¸ç–¾ç—…æœ‰å…³çš„å—ä½“ç»“åˆã€‚<br>æ¯”å¦‚ä¸‹é¢ä¾‹å­ï¼Œå°±æ˜¯åˆ¤æ–­å“ªäº›åˆ†å­ç»“æ„æœ‰ä¸¤ä¸ªç¯ã€‚<br><img src="https://user-images.githubusercontent.com/6218739/142964879-87631629-7c46-4183-88e4-7d2160966d70.png" alt="graph-level"><br>è¿™ç±»ä¼¼äº MNIST å’Œ CIFAR çš„å›¾åƒåˆ†ç±»é—®é¢˜ï¼Œæˆ‘ä»¬å¸Œæœ›å°†æ ‡ç­¾ä¸æ•´ä¸ªå›¾åƒç›¸å…³è”ã€‚å¯¹äºæ–‡æœ¬ï¼Œä¸€ä¸ªç±»ä¼¼çš„é—®é¢˜æ˜¯æƒ…æ„Ÿåˆ†æï¼Œæˆ‘ä»¬å¸Œæœ›ä¸€æ¬¡è¯†åˆ«æ•´ä¸ªå¥å­çš„æƒ…ç»ªæˆ–æƒ…æ„Ÿã€‚</p><h2 id="èŠ‚ç‚¹çº§ä»»åŠ¡"><a href="#èŠ‚ç‚¹çº§ä»»åŠ¡" class="headerlink" title="èŠ‚ç‚¹çº§ä»»åŠ¡"></a>èŠ‚ç‚¹çº§ä»»åŠ¡</h2><p>èŠ‚ç‚¹çº§ä»»åŠ¡ä¸é¢„æµ‹å›¾ä¸­æ¯ä¸ªèŠ‚ç‚¹çš„èº«ä»½æˆ–è§’è‰²æœ‰å…³ã€‚<br>èŠ‚ç‚¹çº§é¢„æµ‹é—®é¢˜çš„ä¸€ä¸ªç»å…¸ç¤ºä¾‹æ˜¯ Zach çš„ç©ºæ‰‹é“ä¿±ä¹éƒ¨ã€‚è¯¥æ•°æ®é›†æ˜¯ä¸€ä¸ªå•ä¸€çš„ç¤¾äº¤ç½‘ç»œå›¾ï¼Œæ•´ä¸ªå›¾ç”±åœ¨æ”¿æ²»åˆ†æ­§åå®£èª“æ•ˆå¿ ä¸¤ä¸ªç©ºæ‰‹é“ä¿±ä¹éƒ¨ä¹‹ä¸€çš„ä¸ªäººç»ƒä¹ è€…ç»„æˆã€‚æ•…äº‹æ˜¯è¿™æ ·çš„ï¼ŒHi å…ˆç”Ÿï¼ˆè®²å¸ˆï¼‰å’Œ John Hï¼ˆç®¡ç†å‘˜ï¼‰ä¹‹é—´çš„ä¸å’Œå¯¼è‡´äº†ç©ºæ‰‹é“ä¿±ä¹éƒ¨çš„åˆ†è£‚ã€‚èŠ‚ç‚¹ä»£è¡¨ä¸ªäººç©ºæ‰‹é“ç»ƒä¹ è€…ï¼Œè¾¹ä»£è¡¨è¿™äº›æˆå‘˜ä¹‹é—´åœ¨ç©ºæ‰‹é“ä¹‹å¤–çš„äº’åŠ¨ã€‚é¢„æµ‹é—®é¢˜æ˜¯å¯¹ç»™å®šæˆå‘˜åœ¨å‘ç”Ÿäº‰æ‰§åæ˜¯å˜å¾—å¿ è¯šäº Mr. Hi è¿˜æ˜¯ John H è¿›è¡Œåˆ†ç±»ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ­¤åˆ†ç±»æ ‡ç­¾ä¸èŠ‚ç‚¹åˆ°è®²å¸ˆæˆ–ç®¡ç†å‘˜ä¹‹é—´çš„è·ç¦»é«˜åº¦ç›¸å…³ã€‚<br><img src="https://user-images.githubusercontent.com/6218739/142966298-4f66bdd6-e14e-489f-87c4-0e125d3ec9fc.png" alt="zach"><br>ï¼ˆåœ¨å·¦è¾¹æˆ‘ä»¬æœ‰é—®é¢˜çš„åˆå§‹æ¡ä»¶ï¼Œåœ¨å³è¾¹æˆ‘ä»¬æœ‰ä¸€ä¸ªå¯èƒ½çš„è§£å†³æ–¹æ¡ˆï¼Œå…¶ä¸­æ¯ä¸ªèŠ‚ç‚¹éƒ½åŸºäºè”ç›Ÿè¿›è¡Œäº†åˆ†ç±»ã€‚è¯¥æ•°æ®é›†å¯ç”¨äºå…¶ä»–å›¾é—®é¢˜ï¼Œå¦‚æ— ç›‘ç£å­¦ä¹ ã€‚ï¼‰</p><p>æŒ‰ç…§å›¾åƒç±»æ¯”ï¼ŒèŠ‚ç‚¹çº§é¢„æµ‹é—®é¢˜ç±»ä¼¼äºå›¾åƒåˆ†å‰²ï¼Œæˆ‘ä»¬è¯•å›¾æ ‡è®°å›¾åƒä¸­æ¯ä¸ªåƒç´ çš„ä½œç”¨ã€‚å¯¹äºæ–‡æœ¬ï¼Œç±»ä¼¼çš„ä»»åŠ¡æ˜¯é¢„æµ‹å¥å­ä¸­æ¯ä¸ªå•è¯çš„è¯æ€§ï¼ˆä¾‹å¦‚åè¯ã€åŠ¨è¯ã€å‰¯è¯ç­‰ï¼‰ã€‚</p><h2 id="è¾¹çº§ä»»åŠ¡"><a href="#è¾¹çº§ä»»åŠ¡" class="headerlink" title="è¾¹çº§ä»»åŠ¡"></a>è¾¹çº§ä»»åŠ¡</h2><p>è¾¹çº§æ¨ç†çš„ä¸€ä¸ªä¾‹å­æ˜¯å›¾åƒåœºæ™¯ç†è§£ã€‚é™¤äº†è¯†åˆ«å›¾åƒä¸­çš„å¯¹è±¡å¤–ï¼Œæ·±åº¦å­¦ä¹ æ¨¡å‹è¿˜å¯ç”¨äºé¢„æµ‹å®ƒä»¬ä¹‹é—´çš„å…³ç³»ã€‚æˆ‘ä»¬å¯ä»¥å°†å…¶è¡¨è¿°ä¸ºè¾¹çº§åˆ†ç±»ï¼šç»™å®šä»£è¡¨å›¾åƒä¸­å¯¹è±¡çš„èŠ‚ç‚¹ï¼Œæˆ‘ä»¬å¸Œæœ›é¢„æµ‹è¿™äº›èŠ‚ç‚¹ä¸­çš„å“ªäº›å…±äº«ä¸€æ¡è¾¹æˆ–è¯¥è¾¹çš„å€¼æ˜¯ä»€ä¹ˆã€‚å¦‚æœæˆ‘ä»¬å¸Œæœ›å‘ç°å®ä½“ï¼ˆèŠ‚ç‚¹ï¼‰ä¹‹é—´çš„è”ç³»ï¼Œå¯ä»¥è€ƒè™‘å›¾å®Œå…¨è¿æ¥åå†æ ¹æ®å®ƒä»¬çš„é¢„æµ‹å€¼ä¿®å‰ªè¾¹ä»¥å¾—åˆ°ç¨€ç–å›¾ã€‚<br><img src="https://user-images.githubusercontent.com/6218739/142966575-d4257640-7739-43c6-9178-dbf09a1680b0.png" alt="edge-task"><br>ï¼ˆåœ¨ä¸Šé¢çš„ (b) ä¸­ï¼ŒåŸå§‹å›¾åƒ (a) è¢«åˆ†å‰²ä¸ºäº”ä¸ªå®ä½“ï¼šä¸¤ä¸ªæ ¼æ–—è€…ã€è£åˆ¤ã€è§‚ä¼—å’Œå«å­ã€‚(C) æ˜¾ç¤ºäº†è¿™äº›å®ä½“ä¹‹é—´çš„å…³ç³»ã€‚ï¼‰<br><img src="https://user-images.githubusercontent.com/6218739/142966943-6f5556f6-8bf3-49d4-9fac-b1cf5d8fb2bf.png" alt="edge-2"><br>ï¼ˆå·¦ä¾§æ˜¯æ ¹æ®ä¹‹å‰çš„è§†è§‰åœºæ™¯æ„å»ºçš„åˆå§‹å›¾ï¼Œå³ä¾§æ˜¯æ ¹æ®æ¨¡å‹çš„è¾“å‡ºå¯¹æŸäº›è¿æ¥è¿›è¡Œä¿®å‰ªåå¾—åˆ°çš„è¯¥å›¾å¯èƒ½çš„è¾¹æ ‡è®°ã€‚ï¼‰</p><h1 id="åœ¨æœºå™¨å­¦ä¹ ä¸­ä½¿ç”¨å›¾çš„æŒ‘æˆ˜"><a href="#åœ¨æœºå™¨å­¦ä¹ ä¸­ä½¿ç”¨å›¾çš„æŒ‘æˆ˜" class="headerlink" title="åœ¨æœºå™¨å­¦ä¹ ä¸­ä½¿ç”¨å›¾çš„æŒ‘æˆ˜"></a>åœ¨æœºå™¨å­¦ä¹ ä¸­ä½¿ç”¨å›¾çš„æŒ‘æˆ˜</h1><p>é‚£ä¹ˆï¼Œæˆ‘ä»¬å¦‚ä½•ç”¨ç¥ç»ç½‘ç»œè§£å†³è¿™äº›ä¸åŒçš„å›¾ä»»åŠ¡å‘¢ï¼Ÿç¬¬ä¸€æ­¥æ˜¯è€ƒè™‘æˆ‘ä»¬å°†å¦‚ä½•è¡¨ç¤ºå›¾ä»¥ä¸ç¥ç»ç½‘ç»œå…¼å®¹ã€‚<br>æœºå™¨å­¦ä¹ æ¨¡å‹é€šå¸¸é‡‡ç”¨çŸ©å½¢æˆ–ç½‘æ ¼çŠ¶é˜µåˆ—ä½œä¸ºè¾“å…¥ã€‚å› æ­¤ï¼Œå¦‚ä½•ä»¥ä¸æ·±åº¦å­¦ä¹ å…¼å®¹çš„æ ¼å¼è¡¨ç¤ºå®ƒä»¬å¹¶ä¸æ˜¯å¾ˆç›´è§‚ã€‚å›¾æœ‰å¤šè¾¾å››ç§ç±»å‹çš„ä¿¡æ¯å¯èƒ½æƒ³è¦ç”¨æ¥è¿›è¡Œé¢„æµ‹ï¼šèŠ‚ç‚¹ã€è¾¹ã€å…¨å±€ä¸Šä¸‹æ–‡å’Œè¿é€šæ€§ã€‚å‰ä¸‰ä¸ªæ¯”è¾ƒç®€å•ï¼šæ¯”å¦‚å¯¹äºèŠ‚ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸ºæ¯ä¸ªèŠ‚ç‚¹åˆ†é…ä¸€ä¸ªç´¢å¼•$i$ä»è€Œç»„æˆä¸€ä¸ªèŠ‚ç‚¹ç‰¹å¾çŸ©é˜µ$N$ï¼Œç„¶ååœ¨$N$ä¸­å­˜å‚¨ç‰¹å¾$node_i$ã€‚è™½ç„¶è¿™äº›çŸ©é˜µå…·æœ‰å¯å˜æ•°é‡çš„å®ä¾‹ï¼Œä½†å¤„ç†çŸ©é˜µä¸éœ€è¦ä»»ä½•ç‰¹æ®Šçš„æŠ€å·§ã€‚<br>ç„¶è€Œï¼Œè¡¨ç¤ºå›¾çš„è¿é€šæ€§æ›´ä¸ºå¤æ‚ã€‚ä¹Ÿè®¸æœ€æ˜æ˜¾çš„é€‰æ‹©æ˜¯ä½¿ç”¨é‚»æ¥çŸ©é˜µï¼Œå› ä¸ºå®ƒå¾ˆå®¹æ˜“å¼ é‡åŒ–ã€‚ç„¶è€Œï¼Œè¿™ç§è¡¨ç¤ºæœ‰ä¸€äº›ç¼ºç‚¹ã€‚<br>å¦‚ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹æ•°æ®é›†è¡¨ï¼š<br><img src="https://user-images.githubusercontent.com/6218739/142975690-bfdcacd4-8364-4dd1-94c8-f093f5711b87.png" alt="table"><br>ä»ç¤ºä¾‹æ•°æ®é›†è¡¨ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°å›¾ä¸­çš„èŠ‚ç‚¹æ•°é‡å¯èƒ½è¾¾åˆ°æ•°ç™¾ä¸‡ï¼Œæ¯ä¸ªèŠ‚ç‚¹çš„è¾¹æ•°å¯èƒ½å˜åŒ–å¾ˆå¤§ã€‚é€šå¸¸ï¼Œè¿™ä¼šå¯¼è‡´éå¸¸ç¨€ç–çš„é‚»æ¥çŸ©é˜µï¼Œè¿™æ˜¯ç©ºé—´æ•ˆç‡ä½ä¸‹çš„ã€‚<br>å¦ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œæœ‰å¾ˆå¤šé‚»æ¥çŸ©é˜µå¯ä»¥ç¼–ç ç›¸åŒçš„è¿é€šæ€§ï¼Œå¹¶ä¸èƒ½ä¿è¯è¿™äº›ä¸åŒçš„çŸ©é˜µåœ¨æ·±åº¦ç¥ç»ç½‘ç»œä¸­ä¼šäº§ç”Ÿç›¸åŒçš„ç»“æœï¼ˆä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒä»¬ä¸æ˜¯æ’åˆ—ä¸å˜çš„ï¼‰ã€‚<br>ä¾‹å¦‚ï¼Œå‰é¢çš„å¥¥èµ›ç½—å›¾å¯ä»¥ç”¨å¦‚ä¸‹è¿™ä¸¤ä¸ªé‚»æ¥çŸ©é˜µç­‰ä»·åœ°æè¿°ã€‚å®ƒä¹Ÿå¯ä»¥ç”¨èŠ‚ç‚¹çš„æ‰€æœ‰å…¶ä»–å¯èƒ½çš„æ’åˆ—æ¥æè¿°ã€‚<br><img src="https://user-images.githubusercontent.com/6218739/142975871-caa24e50-a2e0-496d-8be8-adc7c2120b92.png" alt="two-adjacent"><br>æ›´ç›´è§‚ä¸€ç‚¹ï¼Œä¸‹é¢çš„è¿™ä¸ªå°å›¾ç”±å››ä¸ªèŠ‚ç‚¹ç»„æˆï¼Œå¯ä»¥è¡¨ç¤ºå®ƒçš„é‚»æ¥çŸ©é˜µå¦‚ä¸‹ï¼š<br><img src="https://user-images.githubusercontent.com/6218739/142976045-3d08ec6b-b460-471c-9712-69a4d6175b17.png" alt="simple-demo-adj"><br>å¯ä»¥çœ‹å‡ºï¼Œå¯¹äºè¿™ä¹ˆç®€å•çš„ä¸€ä¸ªå°å›¾ï¼Œå¯ä»¥è¡¨ç¤ºåŒæ ·ä¿¡æ¯çš„é‚»æ¥çŸ©é˜µå°±å¾ˆå¤šäº†ï¼Œæ›´ä¸å¿…è¯´æœ‰æ›´å¤šèŠ‚ç‚¹çš„å¥¥èµ›ç½—å›¾ã€‚</p><p>è¡¨ç¤ºç¨€ç–çŸ©é˜µçš„ä¸€ç§ä¼˜é›…ä¸”èŠ‚çœå†…å­˜çš„æ–¹æ³•æ˜¯é‚»æ¥åˆ—è¡¨ã€‚å®ƒæŠŠèŠ‚ç‚¹$n_i$å’ŒèŠ‚ç‚¹$n_j$ä¹‹é—´çš„è¾¹$e_k$çš„è¿é€šæ€§è¡¨è¾¾ä¸ºé‚»æ¥è¡¨çš„ç¬¬kä¸ªå…ƒç´ ä¸­çš„å…ƒç»„$(i,j)$ã€‚ç”±äºé€šå¸¸æƒ…å†µä¸‹è¾¹çš„æ•°é‡è¿œä½äºé‚»æ¥çŸ©é˜µçš„å…ƒç´ æ•°é‡ï¼ˆ$n_{nodes}^2$)ï¼Œå› æ­¤å¯ä»¥é¿å…åœ¨å›¾çš„æ–­å¼€éƒ¨åˆ†ï¼ˆå³æ²¡æœ‰è¾¹çš„éƒ¨åˆ†ï¼‰è¿›è¡Œè®¡ç®—å’Œå­˜å‚¨ã€‚<br>ä¸¾ä¸€ä¸ªä¾‹å­ï¼š<br><img src="https://user-images.githubusercontent.com/6218739/142979027-73439a11-218d-4cc3-8910-4e91e2036e5c.png" alt="adjacent-list"><br>å¯ä»¥çœ‹å‡ºï¼Œæ•´ä¸ªå›¾graphä¸­æœ‰8ä¸ªèŠ‚ç‚¹å’Œ7ä¸ªè¾¹ã€‚<br>Nodesåˆ—è¡¨é‡Œç»™å‡ºäº†8ä¸ªèŠ‚ç‚¹çš„å±æ€§ï¼Œå–å€¼åªæœ‰ä¸¤ä¸ª0å’Œ1ï¼›Edgesåˆ—è¡¨é‡Œç»™å‡ºäº†7ä¸ªè¾¹çš„å±æ€§ï¼Œå–å€¼ä¸º1æˆ–2ï¼›ä¸´ç•Œåˆ—è¡¨é‡Œåˆ™ç»™å‡ºäº†è¿™äº›è¾¹ç”±å“ªä¸¤ä¸ªèŠ‚ç‚¹å½¢æˆï¼Œæ¯”å¦‚Edgesé‡Œçš„å€’æ•°ç¬¬äºŒæ¡è¾¹å°±æ˜¯è¿æ¥çš„7å·èŠ‚ç‚¹å’Œ4å·èŠ‚ç‚¹ã€‚Globalç»™å‡ºäº†æ•´ä¸ªå›¾çš„æ ‡è¯†ï¼Œè¿™é‡Œæ ‡è¯†ä¸º0ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¯¥å›¾ä¸­æ¯ä¸ªèŠ‚ç‚¹/è¾¹/å…¨å±€çš„å±æ€§éƒ½æ˜¯æ ‡é‡ï¼Œå³éƒ½åªæœ‰ä¸€ä¸ªå€¼ï¼Œä½†å¤§å¤šæ•°çœŸå®çš„å›¾ä¸­çš„å±æ€§éƒ½æ˜¯å‘é‡ï¼ˆæˆ–ç§°ç‰¹å¾å‘é‡æˆ–åµŒå…¥ï¼‰ã€‚æ¯”å¦‚å¯¹äºä¸€ä¸ªèŠ‚ç‚¹ï¼Œä¸Šä¾‹ä¸­èŠ‚ç‚¹åˆ—è¡¨æ˜¯$[n_{nodes}]$ï¼Œä½†çœŸå®æƒ…å†µå¤§æ¦‚ç‡æ˜¯è¿™æ ·çš„å½¢çŠ¶$[n_{nodes}, node_{dim}]$ã€‚å¯¹äºè¾¹çš„å±æ€§ã€å…¨å±€å±æ€§ä¹ŸåŒç†ã€‚</p><p>ä¸Šè¿°è¿™ç§å¯¹äºå›¾çš„æè¿°æ–¹å¼å…·æœ‰æ’åˆ—ä¸å˜æ€§ã€‚</p><h1 id="å›¾ç¥ç»ç½‘ç»œ"><a href="#å›¾ç¥ç»ç½‘ç»œ" class="headerlink" title="å›¾ç¥ç»ç½‘ç»œ"></a>å›¾ç¥ç»ç½‘ç»œ</h1><p>å›¾ç¥ç»ç½‘ç»œGNNæ˜¯å¯¹å›¾çš„æ‰€æœ‰å±æ€§ï¼ˆèŠ‚ç‚¹ã€è¾¹ã€å…¨å±€ä¸Šä¸‹æ–‡ï¼‰è¿›è¡Œä¼˜åŒ–çš„å˜æ¢ï¼Œå®ƒä¿ç•™äº†å›¾çš„å¯¹ç§°æ€§ï¼ˆç½®æ¢ä¸å˜æ€§ï¼‰ã€‚è¿™é‡Œä½¿ç”¨ Gilmer ç­‰äººæå‡ºçš„â€œæ¶ˆæ¯ä¼ é€’ç¥ç»ç½‘ç»œâ€æ¡†æ¶æ„å»º GNNã€‚<br>GNN é‡‡ç”¨â€œå›¾å…¥å›¾å‡ºâ€æ¶æ„ï¼Œè¿™æ„å‘³ç€è¿™äº›æ¨¡å‹ç±»å‹æ¥å—å›¾ä½œä¸ºè¾“å…¥ï¼Œå°†ä¿¡æ¯åŠ è½½åˆ°å…¶èŠ‚ç‚¹ã€è¾¹å’Œå…¨å±€ä¸Šä¸‹æ–‡ä¸­ï¼Œå¹¶é€æ­¥è½¬æ¢è¿™äº›åµŒå…¥ï¼Œè€Œä¸ä¼šæ”¹å˜è¾“å…¥å›¾çš„è¿é€šæ€§ã€‚</p><h2 id="æœ€ç®€å•çš„GNN"><a href="#æœ€ç®€å•çš„GNN" class="headerlink" title="æœ€ç®€å•çš„GNN"></a>æœ€ç®€å•çš„GNN</h2><p>ä¸€ä¸ªæœ€ç®€å•çš„ GNNæ¶æ„å¦‚ä¸‹ï¼š<br><img src="https://user-images.githubusercontent.com/6218739/142980841-566452d1-6626-4de6-a739-88a659a09fae.png" alt="gnn"><br>è¯¥GNNåœ¨å›¾çš„æ¯ä¸ªç»„ä»¶ä¸Šä½¿ç”¨å•ç‹¬çš„å¤šå±‚æ„ŸçŸ¥å™¨ (MLP)ï¼ˆæˆ–å…¶ä»–å¯å¾®æ¨¡å‹ï¼‰ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º GNN å±‚ã€‚æ¯”å¦‚ï¼Œå¯¹äºæ¯ä¸ªèŠ‚ç‚¹å‘é‡ï¼Œæˆ‘ä»¬åº”ç”¨ MLP å¹¶è¿”å›ä¸€ä¸ªå­¦ä¹ åˆ°çš„èŠ‚ç‚¹å‘é‡ï¼›å¯¹æ¯æ¡è¾¹åšåŒæ ·çš„äº‹æƒ…ï¼Œå­¦ä¹ æ¯æ¡è¾¹çš„åµŒå…¥ï¼ˆæˆ–ç§°æ–°çš„ç‰¹å¾å‘é‡ï¼‰ï¼›ä»¥åŠå…¨å±€ä¸Šä¸‹æ–‡å‘é‡ï¼Œä¸ºæ•´ä¸ªå›¾å­¦ä¹ ä¸€ä¸ªåµŒå…¥ã€‚ï¼ˆåœ¨è¯¥æ¶æ„ä¸­å­¦ä¹ äº†æ‰€æœ‰å›¾å±æ€§ï¼ˆèŠ‚ç‚¹ã€è¾¹ã€å…¨å±€ï¼‰çš„æ–°åµŒå…¥ï¼Œä½†å°šæœªä½¿ç”¨å›¾çš„è¿é€šæ€§ã€‚ï¼‰<br>ç„¶åå°†è¿™äº›GNNå±‚å †å åœ¨ä¸€èµ·ã€‚<br>å› ä¸º GNN ä¸ä¼šæ›´æ–°è¾“å…¥å›¾çš„è¿é€šæ€§ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç”¨ä¸è¾“å…¥å›¾ç›¸åŒçš„é‚»æ¥è¡¨å’Œç›¸åŒæ•°é‡çš„ç‰¹å¾å‘é‡æ¥æè¿° GNN çš„è¾“å‡ºå›¾ã€‚ä½†æ˜¯ï¼Œè¾“å‡ºå›¾æ›´æ–°äº†åµŒå…¥ï¼Œå› ä¸º GNN æ›´æ–°äº†æ¯ä¸ªèŠ‚ç‚¹ã€è¾¹å’Œå…¨å±€ä¸Šä¸‹æ–‡è¡¨ç¤ºã€‚</p><h2 id="é€šè¿‡æ±‡é›†ä¿¡æ¯è¿›è¡Œ-GNN-é¢„æµ‹"><a href="#é€šè¿‡æ±‡é›†ä¿¡æ¯è¿›è¡Œ-GNN-é¢„æµ‹" class="headerlink" title="é€šè¿‡æ±‡é›†ä¿¡æ¯è¿›è¡Œ GNN é¢„æµ‹"></a>é€šè¿‡æ±‡é›†ä¿¡æ¯è¿›è¡Œ GNN é¢„æµ‹</h2><p>ä¸Šé¢å·²ç»æ„å»ºäº†ä¸€ä¸ªç®€å•çš„ GNNï¼Œä½†æ˜¯å¦‚ä½•åœ¨ä¸Šè¿°ä»»ä½•ä»»åŠ¡ä¸­è¿›è¡Œé¢„æµ‹å‘¢ï¼Ÿ<br>è¿™é‡Œè€ƒè™‘ä¸€ä¸ªäºŒå…ƒåˆ†ç±»çš„æƒ…å†µï¼ˆä½†è¿™ä¸ªæ¡†æ¶å¯ä»¥å¾ˆå®¹æ˜“åœ°æ‰©å±•åˆ°å¤šç±»æˆ–å›å½’çš„æƒ…å†µï¼‰ã€‚å¦‚æœä»»åŠ¡æ˜¯å¯¹èŠ‚ç‚¹è¿›è¡ŒäºŒå…ƒé¢„æµ‹ï¼Œå¹¶ä¸”å›¾å½¢å·²ç»åŒ…å«èŠ‚ç‚¹ä¿¡æ¯ï¼Œåˆ™è¯¥æ–¹æ³•å¾ˆç®€å•â€”â€”å¯¹äºæ¯ä¸ªèŠ‚ç‚¹åµŒå…¥ï¼Œåº”ç”¨çº¿æ€§åˆ†ç±»å™¨ã€‚<br><img src="https://user-images.githubusercontent.com/6218739/142982195-8b262b41-61ff-4191-9b1a-dbe4384b56cb.png" alt="v-class"><br>ç„¶è€Œï¼Œäº‹æƒ…å¹¶ä¸æ€»æ˜¯é‚£ä¹ˆç®€å•ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯èƒ½å°†å›¾ä¸­çš„ä¿¡æ¯å­˜å‚¨åœ¨è¾¹ä¸­ï¼Œä½†èŠ‚ç‚¹ä¸­æ²¡æœ‰ä¿¡æ¯ï¼Œä½†ä»éœ€è¦å¯¹èŠ‚ç‚¹è¿›è¡Œé¢„æµ‹ã€‚å¯ä»¥æƒ³è±¡ä¸€ä¸ªç¤¾äº¤ç½‘ç»œï¼Œæˆ‘ä»¬å¸Œæœ›åŒ¿ååŒ–ç”¨æˆ·æ•°æ®ï¼ˆèŠ‚ç‚¹ï¼‰ï¼Œä¸ä½¿ç”¨è¿™äº›ç”¨æˆ·ä¿¡æ¯ï¼Œè€Œä»…ä½¿ç”¨å…³ç³»æ•°æ®ï¼ˆè¾¹ï¼‰æ¥è¾¾åˆ°æˆ‘ä»¬çš„é¢„æµ‹ç›®çš„ã€‚è¿™ç§åœºæ™¯çš„ä¸€ä¸ªå®ä¾‹å°±æ˜¯ä¹‹å‰åœ¨ç©ºæ‰‹é“ä¿±ä¹éƒ¨ç¤ºä¾‹ä¸­ï¼Œä»…ä½¿ç”¨äººä¸äººä¹‹é—´çš„ä¼šé¢æ¬¡æ•°ï¼Œè€Œä¸ä½¿ç”¨ä»»ä½•å…·ä½“çš„äººçš„ä¿¡æ¯ï¼Œæ¥ç¡®å®šæ•ˆå¿ äºMr. Hiè¿˜æ˜¯John H.ã€‚<br>æ­¤æ—¶å°±éœ€è¦ä¸€ç§ä»è¾¹æ”¶é›†ä¿¡æ¯å¹¶å°†å®ƒä»¬æä¾›ç»™èŠ‚ç‚¹è¿›è¡Œé¢„æµ‹çš„æ–¹æ³•ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡æ± åŒ–ï¼ˆæˆ–ç§°æ±‡é›†poolingï¼‰æ¥åšåˆ°è¿™ä¸€ç‚¹ã€‚æ± åŒ–åˆ†ä¸¤æ­¥è¿›è¡Œï¼š<br>ï¼ˆ1ï¼‰å¯¹äºè¦æ±‡é›†çš„æ¯ä¸ªé¡¹ç›®ï¼Œæ”¶é›†å®ƒä»¬çš„æ¯ä¸ªåµŒå…¥å¹¶å°†å®ƒä»¬è¿æ¥æˆä¸€ä¸ªçŸ©é˜µã€‚<br>ï¼ˆ2ï¼‰ç„¶åèšåˆæ”¶é›†åˆ°çš„åµŒå…¥ï¼Œé€šå¸¸é€šè¿‡æ±‚å’Œè¿ç®—æ¥å®ç°ã€‚</p><p>ç”¨å­—æ¯$\rho$è¡¨ç¤ºæ± åŒ–æ“ä½œï¼Œç„¶åç”¨$p_{E_n \to V_{n}}$è¡¨ç¤ºä»è¾¹ä¸Šæ”¶é›†ä¿¡æ¯åˆ°èŠ‚ç‚¹ä¸Šã€‚<br><img src="https://user-images.githubusercontent.com/6218739/142982910-046a91f3-06e9-4e3c-9f52-8d38afb8b726.png" alt="pool"><br>å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬åªæœ‰è¾¹ä¸Šçš„ç‰¹å¾ï¼Œå¹¶ä¸”æƒ³å°è¯•é¢„æµ‹èŠ‚ç‚¹çš„äºŒå…ƒåˆ†ç±»ä¿¡æ¯ï¼Œé‚£å¯ä»¥ä½¿ç”¨æ± åŒ–å°†ä¿¡æ¯è·¯ç”±ï¼ˆæˆ–ä¼ é€’ï¼‰åˆ°éœ€è¦å»çš„åœ°æ–¹ã€‚<br>è¯¥æ¨¡å‹å¦‚ä¸‹ã€‚<br><img src="https://user-images.githubusercontent.com/6218739/142983257-cff12488-0713-4529-be70-803427f57b2e.png" alt="pool-class"></p><p>åè¿‡æ¥ï¼Œå¦‚æœæˆ‘ä»¬åªæœ‰èŠ‚ç‚¹çº§ç‰¹å¾ï¼Œå¹¶è¯•å›¾é¢„æµ‹è¾¹ä¸Šçš„äºŒå…ƒåˆ†ç±»ä¿¡æ¯ï¼ˆè¿™ç§åœºæ™¯çš„ä¸€ä¸ªä¾‹å­æ¯”å¦‚ä¸Šé¢çš„è¾¹çº§ä»»åŠ¡ï¼ŒèŠ‚ç‚¹å°±æ˜¯å›¾åƒå®ä½“ï¼Œæƒ³é¢„æµ‹è¿™äº›å®ä½“æ˜¯å¦å…±äº«å…³ç³»ï¼Œå³äºŒå…ƒè¾¹ï¼‰ã€‚æ­¤æ—¶æ¨¡å‹çœ‹èµ·æ¥åƒè¿™æ ·ã€‚<br><img src="https://user-images.githubusercontent.com/6218739/142983667-4b88c3ac-b273-43d9-baee-eb51a60993ec.png" alt="pool-v2e"></p><p>å¦‚æœæˆ‘ä»¬åªæœ‰èŠ‚ç‚¹çº§åˆ«çš„ç‰¹å¾ï¼Œå¹¶ä¸”éœ€è¦é¢„æµ‹ä¸€ä¸ªå…¨å±€çš„äºŒè¿›åˆ¶å±æ€§ï¼Œæ­¤æ—¶éœ€è¦å°†æ‰€æœ‰å¯ç”¨çš„èŠ‚ç‚¹ä¿¡æ¯æ”¶é›†åœ¨ä¸€èµ·å¹¶èšåˆå®ƒä»¬ã€‚è¿™ç±»ä¼¼äºCNN ä¸­çš„å…¨å±€å¹³å‡æ± åŒ–å±‚ã€‚è¾¹ç¼˜åˆ°å…¨å±€çš„ä¿¡æ¯ä¹Ÿå¯ä»¥è¿™æ ·åšã€‚<br>ï¼ˆè¿™æ˜¯é¢„æµ‹åˆ†å­ç‰¹æ€§çš„å¸¸è§åœºæ™¯ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬æœ‰åŸå­ä¿¡æ¯åŠå…¶è¿é€šæ€§ï¼Œæˆ‘ä»¬æƒ³çŸ¥é“ä¸€ä¸ªåˆ†å­çš„æ¯’æ€§ï¼ˆæœ‰æ¯’/æ— æ¯’ï¼‰ï¼Œæˆ–è€…å®ƒæ˜¯å¦æœ‰ç‰¹å®šçš„æ°”å‘³ï¼ˆç«ç‘°/éç«ç‘°ï¼‰ï¼‰<br><img src="https://user-images.githubusercontent.com/6218739/142983974-8e481cd7-b2f1-4dd0-b917-4213fc657673.png" alt="v2u"></p><p>åœ¨ä¸Šé¢ä¾‹å­ä¸­ï¼Œåˆ†ç±»æ¨¡å‹$c$å¯ä»¥å¾ˆå®¹æ˜“åœ°æ›¿æ¢ä¸ºä»»ä½•å¯å¾®æ¨¡å‹ï¼Œæˆ–ä½¿ç”¨å¹¿ä¹‰çº¿æ€§æ¨¡å‹æ¥åšå¤šåˆ†ç±»é—®é¢˜ã€‚<br><img src="https://user-images.githubusercontent.com/6218739/142984209-6bd326ae-2a1f-416f-a908-831d536e4d08.png" alt="e2egnn"></p><p>ä¸Šé¢æ„å»ºäº†ä¸€ä¸ªç®€å•çš„ GNN æ¨¡å‹ï¼Œå¹¶é€šè¿‡åœ¨å›¾çš„ä¸åŒéƒ¨åˆ†ä¹‹é—´è·¯ç”±ä¿¡æ¯æ¥è¿›è¡ŒäºŒå…ƒé¢„æµ‹ã€‚è¿™ç§æ± åŒ–æŠ€æœ¯å°†ä½œä¸ºæ„å»ºæ›´å¤æ‚ GNN æ¨¡å‹çš„åŸºçŸ³ã€‚å¦‚æœæˆ‘ä»¬æœ‰æ–°çš„å›¾å±æ€§ï¼Œåªéœ€è¦å®šä¹‰å¦‚ä½•å°†ä¿¡æ¯ä»ä¸€ä¸ªå±æ€§ä¼ é€’åˆ°å¦ä¸€ä¸ªå±æ€§å³å¯ã€‚<br>è¯·æ³¨æ„ï¼Œåœ¨è¿™ä¸ªæœ€ç®€å•çš„ GNN å…¬å¼ä¸­ï¼Œæ²¡æœ‰åœ¨ GNN å±‚å†…éƒ¨ä½¿ç”¨å›¾çš„è¿é€šæ€§ã€‚æ¯ä¸ªèŠ‚ç‚¹éƒ½æ˜¯ç‹¬ç«‹å¤„ç†çš„ï¼Œæ¯ä¸ªè¾¹ä»¥åŠå…¨å±€ä¸Šä¸‹æ–‡ä¹Ÿæ˜¯å¦‚æ­¤ã€‚æˆ‘ä»¬åªæ˜¯åœ¨æ±‡é›†ä¿¡æ¯è¿›è¡Œé¢„æµ‹æ—¶ä½¿ç”¨è¿é€šæ€§ã€‚</p><h2 id="åœ¨å›¾çš„å„ä¸ªéƒ¨åˆ†ä¹‹é—´ä¼ é€’æ¶ˆæ¯"><a href="#åœ¨å›¾çš„å„ä¸ªéƒ¨åˆ†ä¹‹é—´ä¼ é€’æ¶ˆæ¯" class="headerlink" title="åœ¨å›¾çš„å„ä¸ªéƒ¨åˆ†ä¹‹é—´ä¼ é€’æ¶ˆæ¯"></a>åœ¨å›¾çš„å„ä¸ªéƒ¨åˆ†ä¹‹é—´ä¼ é€’æ¶ˆæ¯</h2><p>å¦‚ä¸Šæ‰€è¿°ï¼Œæˆ‘ä»¬ä»…åœ¨æœ€åé¢„æµ‹æ—¶ä½¿ç”¨äº†æ± åŒ–æ¥æ±‡èšæ¶ˆæ¯ã€‚è‡ªç„¶åœ°ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨ GNN å±‚ä¹‹é—´ä½¿ç”¨æ± åŒ–æ¥è¿›è¡Œæ›´å¤æ‚çš„é¢„æµ‹ï¼Œä»¥ä½¿ä¸­é—´å­¦ä¹ çš„åµŒå…¥ï¼ˆæˆ–ç§°ç‰¹å¾å‘é‡ï¼‰çŸ¥é“å›¾çš„è¿é€šæ€§ã€‚<br>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ¶ˆæ¯ä¼ é€’æ¥åšåˆ°è¿™ä¸€ç‚¹ï¼Œå…¶ä¸­ç›¸é‚»çš„èŠ‚ç‚¹æˆ–è¾¹äº¤æ¢ä¿¡æ¯ï¼Œå¹¶å½±å“å½¼æ­¤æ›´æ–°åçš„åµŒå…¥ã€‚<br>æ¶ˆæ¯ä¼ é€’åˆ†ä¸‰æ­¥è¿›è¡Œï¼š<br>ï¼ˆ1ï¼‰å¯¹äºå›¾ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹ï¼Œæ”¶é›†æ‰€æœ‰ç›¸é‚»èŠ‚ç‚¹åµŒå…¥ï¼ˆæˆ–æ¶ˆæ¯ï¼‰ï¼›<br>ï¼ˆ2ï¼‰é€šè¿‡èšåˆå‡½æ•°ï¼ˆå¦‚ sumï¼‰èšåˆæ‰€æœ‰æ¶ˆæ¯ï¼›<br>ï¼ˆ3ï¼‰æ‰€æœ‰æ±‡é›†çš„æ¶ˆæ¯éƒ½é€šè¿‡ä¸€ä¸ªæ›´æ–°å‡½æ•°ï¼Œè¯¥å‡½æ•°é€šå¸¸æ˜¯ä¸€ä¸ªå¯å­¦ä¹ çš„ç¥ç»ç½‘ç»œã€‚<br>ï¼ˆç¬¬äºŒæ­¥å’Œç¬¬ä¸‰æ­¥é¡ºåºå¯ä»¥è°ƒæ•´ï¼Œå³å…ˆæ›´æ–°å†èšåˆï¼Œè¿™ç§æ–¹å¼ä¹Ÿå…·æœ‰ç½®æ¢ä¸å˜æ€§ï¼‰</p><p>æ•´ä¸ªè¿‡ç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼š<br><img src="https://user-images.githubusercontent.com/6218739/142985277-0ffce405-5353-42b7-977e-f95861a0309b.png" alt="message"></p><p>æ­£å¦‚æ± åŒ–å¯ä»¥åº”ç”¨äºèŠ‚ç‚¹æˆ–è¾¹ä¸€æ ·ï¼Œæ¶ˆæ¯ä¼ é€’å¯ä»¥å‘ç”Ÿåœ¨èŠ‚ç‚¹æˆ–è¾¹ä¹‹é—´ã€‚<br>è¿™äº›æ­¥éª¤æ˜¯åˆ©ç”¨å›¾å½¢è¿é€šæ€§çš„å…³é”®ã€‚æˆ‘ä»¬å°†åœ¨ GNN å±‚ä¸­æ„å»ºæ›´ç²¾ç»†çš„æ¶ˆæ¯ä¼ é€’å˜ä½“ï¼Œä»è€Œäº§ç”Ÿå…·æœ‰å¢åŠ è¡¨ç°åŠ›å’Œèƒ½åŠ›çš„ GNN æ¨¡å‹ã€‚</p><p>è¿™ä¸€ç³»åˆ—æ“ä½œï¼Œå½“åº”ç”¨ä¸€æ¬¡æ—¶ï¼Œå°±æ˜¯æ¶ˆæ¯ä¼ é€’ GNN å±‚çš„æœ€ç®€å•å½¢å¼ã€‚<br>è¿™è·Ÿå›¾åƒå¤„ç†ä¸­çš„æ ‡å‡†å·ç§¯æ“ä½œç±»ä¼¼ï¼šæœ¬è´¨ä¸Šï¼Œæ¶ˆæ¯ä¼ é€’å’Œå·ç§¯æ˜¯èšåˆå’Œå¤„ç†å…ƒç´ é‚»å±…çš„ä¿¡æ¯ä»¥æ›´æ–°å…ƒç´ å€¼çš„æ“ä½œã€‚åœ¨å›¾ä¸­ï¼Œå…ƒç´ æ˜¯ä¸€ä¸ªèŠ‚ç‚¹ï¼Œè€Œåœ¨å›¾åƒä¸­ï¼Œå…ƒç´ æ˜¯ä¸€ä¸ªåƒç´ ã€‚ç„¶è€Œï¼Œå›¾ä¸­ç›¸é‚»èŠ‚ç‚¹çš„æ•°é‡å¯ä»¥æ˜¯å¯å˜çš„ï¼Œè¿™ä¸æ¯ä¸ªåƒç´ å…·æœ‰ä¸€ç»„å›ºå®šæ•°é‡ç›¸é‚»å…ƒç´ çš„å›¾åƒä¸åŒã€‚<br>é€šè¿‡å°†ä¼ é€’ GNN å±‚çš„æ¶ˆæ¯å †å åœ¨ä¸€èµ·ï¼Œä¸€ä¸ªèŠ‚ç‚¹æœ€ç»ˆå¯ä»¥åˆå¹¶æ¥è‡ªæ•´ä¸ªå›¾çš„ä¿¡æ¯ï¼šåœ¨ä¸‰å±‚ä¹‹åï¼Œä¸€ä¸ªèŠ‚ç‚¹æ‹¥æœ‰è·ç¦»å®ƒä¸‰æ­¥è¿œçš„èŠ‚ç‚¹çš„ä¿¡æ¯ã€‚ï¼ˆè¿™è·Ÿå›¾åƒä¸­çš„æ„Ÿå—é‡ç±»ä¼¼ï¼‰</p><p>äºæ˜¯ï¼Œå‰é¢æœ€ç®€å•çš„GNNæ¶æ„å›¾å¯ä»¥å¢åŠ ä¸Šé¢è¿™ä¸€éƒ¨åˆ†å†…å®¹ï¼Œå³åŒ…å«æ–°çš„èŠ‚ç‚¹æ¶ˆæ¯æºï¼Œå½¢æˆä¸€ä¸ªæ›´å¤æ‚çš„GNNæ¶æ„ï¼š<br><img src="https://user-images.githubusercontent.com/6218739/142985721-2aa3d0de-13af-4188-8ac2-85893ca8174f.png" alt="updated-gnn-arch"></p><h2 id="å­¦ä¹ è¾¹çš„è¡¨ç¤º"><a href="#å­¦ä¹ è¾¹çš„è¡¨ç¤º" class="headerlink" title="å­¦ä¹ è¾¹çš„è¡¨ç¤º"></a>å­¦ä¹ è¾¹çš„è¡¨ç¤º</h2><p>æˆ‘ä»¬çš„æ•°æ®é›†å¹¶ä¸æ€»æ˜¯åŒ…å«æ‰€æœ‰ç±»å‹çš„ä¿¡æ¯ï¼ˆèŠ‚ç‚¹ã€è¾¹å’Œå…¨å±€ä¸Šä¸‹æ–‡ï¼‰ã€‚å½“æˆ‘ä»¬æƒ³å¯¹èŠ‚ç‚¹è¿›è¡Œé¢„æµ‹ï¼Œä½†æˆ‘ä»¬çš„æ•°æ®é›†åªæœ‰è¾¹ä¿¡æ¯æ—¶ï¼Œæˆ‘ä»¬åœ¨ä¸Šé¢å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨æ± åŒ–å°†ä¿¡æ¯ä»è¾¹è·¯ç”±åˆ°èŠ‚ç‚¹ï¼Œä½†ä»…é™äºæ¨¡å‹çš„æœ€åé¢„æµ‹æ­¥éª¤ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ¶ˆæ¯ä¼ é€’åœ¨ GNN å±‚å†…çš„èŠ‚ç‚¹å’Œè¾¹ä¹‹é—´å…±äº«ä¿¡æ¯ã€‚<br>æˆ‘ä»¬å¯ä»¥ä»¥ä¸ä¹‹å‰ä½¿ç”¨ç›¸é‚»èŠ‚ç‚¹ä¿¡æ¯ç›¸åŒçš„æ–¹å¼åˆå¹¶æ¥è‡ªç›¸é‚»è¾¹çš„ä¿¡æ¯ï¼Œé¦–å…ˆå°†è¾¹ä¿¡æ¯æ± åŒ–ï¼Œç”¨æ›´æ–°å‡½æ•°å¯¹å…¶è¿›è¡Œè½¬æ¢ï¼Œç„¶åå­˜å‚¨å®ƒã€‚<br>ä½†æ˜¯ï¼Œå›¾ä¸­å­˜å‚¨çš„èŠ‚ç‚¹å’Œè¾¹ä¿¡æ¯ä¸ä¸€å®šå…·æœ‰ç›¸åŒçš„å¤§å°æˆ–å½¢çŠ¶ï¼Œå› æ­¤å¦‚ä½•å°†å®ƒä»¬ç»„åˆèµ·æ¥è¿˜ä¸æ˜¯å¾ˆæ¸…æ¥šã€‚ä¸€ç§æ–¹æ³•æ˜¯å­¦ä¹ ä»è¾¹ç©ºé—´åˆ°èŠ‚ç‚¹ç©ºé—´çš„çº¿æ€§æ˜ å°„ï¼Œåä¹‹äº¦ç„¶ã€‚æˆ–è€…ï¼Œå¯ä»¥åœ¨æ›´æ–°å‡½æ•°ä¹‹å‰å°†å®ƒä»¬è¿æ¥åœ¨ä¸€èµ·ã€‚æ¨¡å‹å¦‚ä¸‹ï¼š<br><img src="https://user-images.githubusercontent.com/6218739/142986481-f4cf8094-d378-4690-94f6-8c87e9a9337c.png" alt="message-v-e"><br>æ„å»ºGNNæ—¶ä¸€ä¸ªéœ€è¦è®¾è®¡çš„åœ°æ–¹åœ¨äºï¼šæ›´æ–°å“ªäº›å›¾å±æ€§ä»¥åŠæ›´æ–°å®ƒä»¬çš„é¡ºåºã€‚æˆ‘ä»¬å¯ä»¥é€‰æ‹©æ˜¯åœ¨ç¼˜åµŒå…¥ä¹‹å‰æ›´æ–°èŠ‚ç‚¹åµŒå…¥ï¼Œæˆ–è€…ä»¥ç›¸åçš„é¡ºåºã€‚<br>è¯¥é¢†åŸŸä»åœ¨æ´»è·ƒç ”ç©¶ä¸­ï¼Œç›®å‰æœ‰å¤šç§è§£å†³æ–¹æ¡ˆã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ä»¥â€œç¼–ç»‡â€æ–¹å¼è¿›è¡Œæ›´æ–°ï¼š<br><img src="https://user-images.githubusercontent.com/6218739/142986915-9a7204b5-d4d3-4940-94bf-aa00cece8f1e.png" alt="weave"></p><h2 id="æ·»åŠ å…¨å±€è¡¨ç¤º"><a href="#æ·»åŠ å…¨å±€è¡¨ç¤º" class="headerlink" title="æ·»åŠ å…¨å±€è¡¨ç¤º"></a>æ·»åŠ å…¨å±€è¡¨ç¤º</h2><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œä¸Šé¢æè¿°çš„ç½‘ç»œå­˜åœ¨ä¸€ä¸ªç¼ºé™·ï¼šå›¾ä¸­å½¼æ­¤ç›¸è·å¾ˆè¿œçš„èŠ‚ç‚¹å¯èƒ½æ°¸è¿œæ— æ³•æœ‰æ•ˆåœ°ç›¸äº’ä¼ è¾“ä¿¡æ¯ï¼Œå³ä½¿æˆ‘ä»¬å¤šæ¬¡åº”ç”¨æ¶ˆæ¯ä¼ é€’ã€‚å¯¹äºä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¦‚æœæˆ‘ä»¬æœ‰ k å±‚ï¼Œä¿¡æ¯æœ€å¤šå°†ä¼ æ’­ k æ­¥ã€‚å¯¹äºé¢„æµ‹ä»»åŠ¡ä¾èµ–äºç›¸è·å¾ˆè¿œçš„èŠ‚ç‚¹æˆ–èŠ‚ç‚¹ç»„çš„æƒ…å†µï¼Œè¿™å¯èƒ½æ˜¯ä¸€ä¸ªé—®é¢˜ã€‚<br>ä¸€ç§è§£å†³æ–¹æ¡ˆæ˜¯è®©æ‰€æœ‰èŠ‚ç‚¹éƒ½èƒ½å¤Ÿç›¸äº’ä¼ é€’ä¿¡æ¯ã€‚ä¸å¹¸çš„æ˜¯ï¼Œå¯¹äºå¤§å›¾æ¥è¯´ï¼Œè¿™å¾ˆå¿«å°±ä¼šå˜å¾—è®¡ç®—æˆæœ¬å¾ˆé«˜ï¼ˆå°½ç®¡ç§°ä¸ºâ€œè™šæ‹Ÿè¾¹â€çš„æ–¹æ³•å·²è¢«ç”¨äºåˆ†å­ç­‰å°å›¾ï¼‰ã€‚<br>è¯¥é—®é¢˜çš„ä¸€ç§è§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨å›¾ (U) çš„å…¨å±€è¡¨ç¤ºï¼Œè¯¥å›¾æœ‰æ—¶ç§°ä¸ºä¸»èŠ‚ç‚¹master nodeæˆ–ä¸Šä¸‹æ–‡å‘é‡ã€‚è¿™ä¸ªå…¨å±€ä¸Šä¸‹æ–‡å‘é‡è¿æ¥åˆ°ç½‘ç»œä¸­çš„æ‰€æœ‰å…¶ä»–èŠ‚ç‚¹å’Œè¾¹ï¼Œå¹¶å¯ä»¥ä½œä¸ºå®ƒä»¬ä¹‹é—´çš„æ¡¥æ¢æ¥ä¼ é€’ä¿¡æ¯ï¼Œä»è€Œä¸ºæ•´ä¸ªå›¾æ„å»ºä¸€ä¸ªè¡¨ç¤ºã€‚è¿™åˆ›å»ºäº†ä¸€ä¸ªæ›´ä¸°å¯Œã€æ›´å¤æ‚çš„è€Œä¸æ˜¯é€šè¿‡å…¶ä»–æ–¹å¼å­¦ä¹ çš„å›¾è¡¨ç¤ºã€‚<br><img src="https://user-images.githubusercontent.com/6218739/142987592-8bb25c8f-7b42-493f-aebd-a1879043f834.png" alt="U"><br>ä¸Šè¿°æ¶æ„ç§°ä¸ºGraph Netsã€‚</p><p>æ­¤æ—¶ï¼Œå¯ä»¥å‘ç°ï¼Œæ‰€æœ‰çš„å›¾å±æ€§éƒ½å­¦ä¹ äº†è¡¨ç¤ºï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åœ¨æ± åŒ–è¿‡ç¨‹ä¸­é€šè¿‡è°ƒèŠ‚æˆ‘ä»¬æ„Ÿå…´è¶£çš„å±æ€§çš„ä¿¡æ¯æ¥ä½¿ç”¨å®ƒä»¬ã€‚ä¾‹å¦‚ï¼Œå¯¹äºä¸€ä¸ªèŠ‚ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘æ¥è‡ªç›¸é‚»èŠ‚ç‚¹ã€æ‰€è¿æ¥çš„è¾¹å’Œå…¨å±€ä¿¡æ¯çš„ä¿¡æ¯ã€‚ä¸ºäº†åœ¨æ‰€æœ‰è¿™äº›å¯èƒ½çš„ä¿¡æ¯æºä¸Šè°ƒæ•´æ–°èŠ‚ç‚¹åµŒå…¥ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•åœ°å°†å®ƒä»¬è¿æ¥èµ·æ¥ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡çº¿æ€§æ˜ å°„å°†å®ƒä»¬æ˜ å°„åˆ°ç›¸åŒçš„ç©ºé—´å¹¶æ·»åŠ å®ƒä»¬æˆ–åº”ç”¨ç‰¹å¾è°ƒåˆ¶å±‚ï¼Œè¿™å¯ä»¥è¢«è®¤ä¸ºæ˜¯ä¸€ç§ç‰¹å¾åŒ–çš„æ³¨æ„åŠ›æœºåˆ¶ã€‚<br><img src="https://user-images.githubusercontent.com/6218739/142988081-315d33c4-d905-4d63-8ba9-8f42c911c084.png" alt="complex"></p><h1 id="GNNæ¸¸ä¹åœº"><a href="#GNNæ¸¸ä¹åœº" class="headerlink" title="GNNæ¸¸ä¹åœº"></a>GNNæ¸¸ä¹åœº</h1><p>ä¸Šé¢ç»™å‡ºäº†GNNçš„å„ç§æ¶æ„å’Œç»„ä»¶ï¼Œåˆ°åº•åœ¨å®è·µä¸­æ€ä¹ˆç”¨å‘¢ï¼Ÿ<br>ä½œè€…ç›´æ¥ç»™å‡ºäº†ä¸€ä¸ªåœ¨çº¿DEMOï¼Œå³GNNæ¸¸ä¹åœºï¼Œè¯¥æ¸¸ä¹åœºåŸºäºtensorflow.jsæ„å»ºï¼Œç”¨æˆ·åœ¨ä¸Šé¢å¯ä»¥è‡ªç”±åœ°ç©è€å’Œé…ç½®ï¼Œä»è€Œæ¢ç´¢ä¸Šé¢ä¸åŒçš„ç»„ä»¶å’Œæ¶æ„å¦‚ä½•ç”¨äºGNNä¸­ã€‚<br>æ•´ä¸ªDEMOå±•ç¤ºäº†ä¸€ä¸ªå¸¦æœ‰å°åˆ†å­å›¾çš„å›¾çº§é¢„æµ‹ä»»åŠ¡ã€‚ä½¿ç”¨ Leffingwell æ°”å‘³æ•°æ®é›†ï¼Œå®ƒç”±å…·æœ‰ç›¸å…³æ°”å‘³æ„ŸçŸ¥ï¼ˆæ ‡ç­¾ï¼‰çš„åˆ†å­ç»„æˆã€‚<br>é¢„æµ‹åˆ†å­ç»“æ„ï¼ˆå›¾ï¼‰ä¸å…¶æ°”å‘³çš„å…³ç³»æ˜¯ä¸€ä¸ªè·¨è¶ŠåŒ–å­¦ã€ç‰©ç†ã€ç¥ç»ç§‘å­¦å’Œæœºå™¨å­¦ä¹ çš„ç™¾å¹´å†å²é—®é¢˜ã€‚ä¸ºäº†ç®€åŒ–é—®é¢˜ï¼Œåªè€ƒè™‘æ¯ä¸ªåˆ†å­çš„ä¸€ä¸ªäºŒå…ƒæ ‡ç­¾ï¼Œæ ¹æ®ä¸“ä¸šè°ƒé¦™å¸ˆçš„æ ‡ç­¾ï¼Œå¯¹åˆ†å­å›¾æ˜¯å¦é—»èµ·æ¥â€œåˆºé¼»â€è¿›è¡Œåˆ†ç±»ã€‚å¦‚æœä¸€ä¸ªåˆ†å­å…·æœ‰å¼ºçƒˆã€é†’ç›®çš„æ°”å‘³ï¼Œæˆ‘ä»¬å°±è¯´å®ƒå…·æœ‰â€œåˆºé¼»â€æ°”å‘³ã€‚ä¾‹å¦‚ï¼Œå¯èƒ½å«æœ‰çƒ¯ä¸™é†‡åˆ†å­çš„å¤§è’œå’ŒèŠ¥æœ«å°±å…·æœ‰è¿™ç§æ€§è´¨ã€‚èƒ¡æ¤’é…®åˆ†å­ï¼Œé€šå¸¸ç”¨äºè–„è·å‘³ç³–æœï¼Œä¹Ÿè¢«æè¿°ä¸ºå…·æœ‰åˆºé¼»çš„æ°”å‘³ã€‚<br>è¿™é‡Œå°†æ¯ä¸ªåˆ†å­è¡¨ç¤ºä¸ºä¸€ä¸ªå›¾ï¼Œå…¶ä¸­åŸå­æ˜¯åŒ…å«å¯¹å…¶åŸå­èº«ä»½ï¼ˆç¢³ã€æ°®ã€æ°§ã€æ°Ÿï¼‰è¿›è¡Œç‹¬çƒ­ç¼–ç çš„èŠ‚ç‚¹ï¼Œè€Œé”®æ˜¯åŒ…å«å¯¹å…¶é”®ç±»å‹ï¼ˆå•ã€åŒã€ä¸‰é‡æˆ–èŠ³é¦™ï¼‰è¿›è¡Œç‹¬çƒ­ç¼–ç çš„è¾¹ã€‚<br>é’ˆå¯¹è¿™ä¸ªé—®é¢˜çš„é€šç”¨å»ºæ¨¡æ¨¡æ¿æ˜¯ä½¿ç”¨GNNå±‚åºåˆ—æ„å»ºï¼Œç„¶åæ¥ä¸€ä¸ªç”¨äºåˆ†ç±»çš„ sigmoid æ¿€æ´»å‡½æ•°ã€‚<br>æ•´ä¸ªGNNæ¨¡å‹æœ‰å¤šä¸ªè¶…å‚æ•°å¯ä¾›è°ƒèŠ‚ï¼š<br>ï¼ˆ1ï¼‰GNN å±‚æ•°ï¼Œä¹Ÿç§°ä¸ºæ·±åº¦ï¼›<br>ï¼ˆ2ï¼‰æ›´æ–°æ—¶æ¯ä¸ªå±æ€§çš„ç»´åº¦ã€‚æ›´æ–°å‡½æ•°æ˜¯ä¸€ä¸ª 1 å±‚ MLPï¼Œå…¶å…·æœ‰ relu æ¿€æ´»å‡½æ•°å’Œç”¨äºæ¿€æ´»å½’ä¸€åŒ–çš„æ ‡å‡†åŒ–å±‚ï¼›<br>ï¼ˆ3ï¼‰æ± åŒ–ä¸­ä½¿ç”¨çš„èšåˆå‡½æ•°ï¼šmaxã€mean æˆ– sumï¼›<br>ï¼ˆ4ï¼‰æ›´æ–°çš„å›¾å½¢å±æ€§æˆ–æ¶ˆæ¯ä¼ é€’çš„æ ·å¼ï¼šèŠ‚ç‚¹ã€è¾¹å’Œå…¨å±€è¡¨ç¤ºã€‚æˆ‘ä»¬é€šè¿‡å¸ƒå°”åˆ‡æ¢ï¼ˆå¼€æˆ–å…³ï¼‰æ¥æ§åˆ¶è¿™äº›ã€‚åŸºçº¿æ¨¡å‹æ˜¯ä¸€ä¸ªä¸å›¾æ— å…³çš„ GNNï¼ˆå…³é—­æ‰€æœ‰æ¶ˆæ¯ä¼ é€’ï¼‰ï¼Œå®ƒå°†æœ€åçš„æ‰€æœ‰æ•°æ®èšåˆåˆ°ä¸€ä¸ªå…¨å±€å±æ€§ä¸­ã€‚æ‰“å¼€æ‰€æœ‰çš„æ¶ˆæ¯ä¼ é€’å‡½æ•°å°±ä¼šå½¢æˆä¸€ä¸ª Graph Nets æ¶æ„ï¼ˆå³ä¸Šé¢æ·»åŠ äº†å…¨å±€è¡¨ç¤ºçš„GNNæ¶æ„ï¼‰ã€‚</p><p>ä¸ºäº†æ›´å¥½åœ°ç†è§£ GNN å¦‚ä½•å­¦ä¹ å›¾çš„ä»»åŠ¡ä¼˜åŒ–è¡¨ç¤ºï¼Œä½œè€…è¿˜æŸ¥çœ‹äº† GNN çš„å€’æ•°ç¬¬äºŒå±‚æ¿€æ´»ã€‚è¿™äº›â€œå›¾åµŒå…¥â€æ˜¯ GNN æ¨¡å‹åœ¨é¢„æµ‹ä¹‹å‰çš„è¾“å‡ºã€‚ç”±äºä½¿ç”¨å¹¿ä¹‰çº¿æ€§æ¨¡å‹è¿›è¡Œé¢„æµ‹ï¼Œå› æ­¤çº¿æ€§æ˜ å°„è¶³ä»¥è®©ç”¨æˆ·äº†è§£å¦‚ä½•å›´ç»•å†³ç­–è¾¹ç•Œå­¦ä¹ è¡¨ç¤ºã€‚ä½†ç”±äºè¿™äº›æ˜¯é«˜ç»´å‘é‡ï¼Œæ‰€ä»¥é€šè¿‡ä¸»æˆåˆ†åˆ†æ (PCA) å°†å®ƒä»¬ç®€åŒ–ä¸º 2Dã€‚ä¸€ä¸ªå®Œç¾çš„æ¨¡å‹å¯ä»¥å¾ˆå®¹æ˜“åœ°å°†è¿™ä¸ªå†³ç­–è¾¹ç•Œæ˜¾ç¤ºå‡ºæ¥ï¼Œä½†ç”±äºè¿™é‡Œå‹ç¼©äº†ç»´åº¦å¹¶ä¸”æ¨¡å‹ä¹Ÿä¸å®Œç¾ï¼Œå› æ­¤è¿™ä¸ªè¾¹ç•Œå¯èƒ½å¾ˆéš¾çœ‹åˆ°ã€‚ï¼ˆå¦‚ä¸‹æˆªå›¾æœ‰ç‚¹é‚£ä¸ªè¾¹ç•Œçš„æ„æ€äº†ï¼‰</p><p>æ¸¸ä¹åœºçš„æˆªå›¾å¦‚ä¸‹ï¼š<br><img src="https://user-images.githubusercontent.com/6218739/142991597-b51165df-ac35-49b6-a5c0-dad0633d2dd0.png" alt="playground"></p><h1 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h1><p><a href="https://distill.pub/2021/gnn-intro/">A Gentle Introduction to Graph Neural Networks</a><br><a href="https://zhuanlan.zhihu.com/p/75307407">å›¾ç¥ç»ç½‘ç»œï¼ˆGraph Neural Networksï¼ŒGNNï¼‰ç»¼è¿°</a><br><a href="https://cloud.tencent.com/developer/article/1479463">GNN ç³»åˆ—ï¼šGraph åŸºç¡€çŸ¥è¯†ä»‹ç»</a></p>]]></content>
    
    
    <summary type="html">æœ¬æ–‡åŸºæœ¬æ˜¯å¯¹A Gentle Introduction to Graph Neural Networksè¿™ç¯‡æ–‡ç« çš„ç¿»è¯‘ç†è§£ã€‚
ï¼ˆæ³¨æ„ï¼šåŸæ–‡ä¸­æœ‰å¾ˆå¤šå¯äº¤äº’çš„åŠ¨ç”»ï¼Œæ›´æœ‰å¯å‘æ€§ã€‚æœ¬æ–‡å¯¹åŸæ–‡ä¸­çš„æœ‰äº›å›¾åƒè¿›è¡Œäº†è°ƒæ•´ï¼Œæ–¹ä¾¿åˆå­¦è€…ç†è§£ï¼‰

ç®€ä»‹
ï¼ˆè¿™éƒ¨åˆ†å¤§éƒ½æ¥è‡ªäºè¿™ç¯‡å‚è€ƒæ–‡çŒ®ï¼‰
æ›¾æœ‰å­¦è€…å°†æœ¬æ¬¡äººå·¥æ™ºèƒ½æµªæ½®çš„å…´èµ·å½’å› äºä¸‰ä¸ªæ¡ä»¶ï¼Œåˆ†åˆ«æ˜¯ï¼š
ï¼ˆ1ï¼‰è®¡ç®—èµ„æºçš„å¿«é€Ÿå‘å±•ï¼ˆå¦‚GPUï¼‰
ï¼ˆ2ï¼‰å¤§é‡è®­ç»ƒæ•°æ®çš„å¯ç”¨æ€§
ï¼ˆ3ï¼‰æ·±åº¦å­¦ä¹ ä»æ¬§æ°ç©ºé—´æ•°æ®ä¸­æå–æ½œåœ¨ç‰¹å¾çš„æœ‰æ•ˆæ€§
å°½ç®¡ä¼ ç»Ÿçš„æ·±åº¦å­¦ä¹ æ–¹æ³•è¢«åº”ç”¨åœ¨æå–æ¬§æ°ç©ºé—´æ•°æ®çš„ç‰¹å¾æ–¹é¢å–å¾—äº†å·¨å¤§çš„æˆåŠŸï¼Œä½†è®¸å¤šå®é™…åº”ç”¨åœºæ™¯ä¸­çš„æ•°æ®æ˜¯ä»éæ¬§å¼ç©ºé—´ç”Ÿæˆçš„ï¼Œä¼ ç»Ÿçš„æ·±åº¦å­¦ä¹ æ–¹æ³•åœ¨å¤„ç†éæ¬§å¼ç©ºé—´æ•°</summary>
    
    
    
    <category term="machine learning" scheme="http://qixinbo.github.io/categories/machine-learning/"/>
    
    
    <category term="GNN" scheme="http://qixinbo.github.io/tags/GNN/"/>
    
  </entry>
  
  <entry>
    <title>ImagePyè§£æï¼š 28 -- ä¸‰ç»´å¯è§†åŒ–</title>
    <link href="http://qixinbo.github.io/2021/11/18/ImagePy_28/"/>
    <id>http://qixinbo.github.io/2021/11/18/ImagePy_28/</id>
    <published>2021-11-17T16:00:00.000Z</published>
    <updated>2021-11-18T08:22:51.670Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡è§£æä¸€ä¸‹ImagePyçš„ä¸‰ç»´ç”»å¸ƒã€‚<br>ä»¥å¦‚ä¸‹ä¾‹å­å…¥æ‰‹ï¼š<br><img src="https://user-images.githubusercontent.com/6218739/141955577-f4a7c5c5-0a9a-409b-9fde-399a92f0c1d8.png" alt="demo"><br>é¦–å…ˆï¼ŒåŸå§‹å›¾åƒæ˜¯ä¸€ä¸ª5ä¹˜5çš„æ–¹å½¢å›¾åƒï¼Œå…¶ä¸­é—´æ˜¯4ä¹˜4çš„ç™½è‰²ï¼Œå‘¨å›´æ˜¯ä¸€åœˆé»‘è‰²ã€‚<br>ç”±è¿™å¼ åŸå§‹å›¾æ ¹æ®è·ç¦»å˜æ¢å¾—åˆ°å³ä¸Šè§’çš„é«˜ç¨‹å›¾ï¼Œç»§è€Œå¯¹è¯¥é«˜ç¨‹å›¾åšä¸‰ç»´å¯è§†åŒ–ã€‚</p><h1 id="æ¸²æŸ“æ’ä»¶"><a href="#æ¸²æŸ“æ’ä»¶" class="headerlink" title="æ¸²æŸ“æ’ä»¶"></a>æ¸²æŸ“æ’ä»¶</h1><p>äºŒç»´å¹³é¢çš„ä¸‰ç»´å¯è§†åŒ–æ’ä»¶æ˜¯è¿™æ ·å†™çš„ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Surface2D</span>(<span class="params">Simple</span>):</span></span><br><span class="line">    title = <span class="string">&#x27;2D Surface&#x27;</span></span><br><span class="line">    note = [<span class="string">&#x27;8-bit&#x27;</span>, <span class="string">&#x27;16-bit&#x27;</span>, <span class="string">&#x27;float&#x27;</span>]</span><br><span class="line">    para = &#123;<span class="string">&#x27;name&#x27;</span>:<span class="string">&#x27;undifine&#x27;</span>, <span class="string">&#x27;sample&#x27;</span>:<span class="number">2</span>, <span class="string">&#x27;sigma&#x27;</span>:<span class="number">2</span>,<span class="string">&#x27;h&#x27;</span>:<span class="number">0.3</span>, <span class="string">&#x27;cm&#x27;</span>:<span class="string">&#x27;gray&#x27;</span>&#125;</span><br><span class="line">    view = [(<span class="built_in">str</span>, <span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;Name&#x27;</span>, <span class="string">&#x27;&#x27;</span>),</span><br><span class="line">            (<span class="built_in">int</span>, <span class="string">&#x27;sample&#x27;</span>, (<span class="number">1</span>,<span class="number">10</span>), <span class="number">0</span>, <span class="string">&#x27;down sample&#x27;</span>, <span class="string">&#x27;pix&#x27;</span>),</span><br><span class="line">            (<span class="built_in">int</span>, <span class="string">&#x27;sigma&#x27;</span>, (<span class="number">0</span>,<span class="number">30</span>), <span class="number">0</span>, <span class="string">&#x27;sigma&#x27;</span>, <span class="string">&#x27;&#x27;</span>),</span><br><span class="line">            (<span class="built_in">float</span>, <span class="string">&#x27;h&#x27;</span>, (<span class="number">0.1</span>,<span class="number">10</span>), <span class="number">1</span>, <span class="string">&#x27;scale z&#x27;</span>, <span class="string">&#x27;&#x27;</span>),</span><br><span class="line">            (<span class="string">&#x27;cmap&#x27;</span>, <span class="string">&#x27;cm&#x27;</span>, <span class="string">&#x27;color map&#x27;</span>)]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span>(<span class="params">self, ips, imgs, para = <span class="literal">None</span></span>):</span></span><br><span class="line">        ds, sigma, cm = para[<span class="string">&#x27;sample&#x27;</span>], para[<span class="string">&#x27;sigma&#x27;</span>], ColorManager.get(para[<span class="string">&#x27;cm&#x27;</span>])</span><br><span class="line">        mesh = Surface2d(ips.img, sample=ds, sigma=sigma, k=para[<span class="string">&#x27;h&#x27;</span>], cmap=cm)</span><br><span class="line">        self.app.show_mesh(mesh, para[<span class="string">&#x27;name&#x27;</span>])</span><br></pre></td></tr></table></figure><br>å…¶ç•Œé¢ä¸ºï¼š<br><img src="https://user-images.githubusercontent.com/6218739/141955719-7c81041c-9c56-4f10-ba0c-1d5d68643f20.png" alt="interface"><br>å³è®¾å®šåå­—ã€ä¸‹é‡‡æ ·ç‡ã€å¹³æ»‘ç‡å’Œzè½´ä¼¸ç¼©ç‡ï¼Œä»¥åŠæ¸²æŸ“æ‰€ç”¨çš„colormapã€‚(åœ¨è¯¥demoä¸­ï¼Œå°±æŒ‰å¦‚å›¾ä¸­çš„å‚æ•°è¿›è¡Œè®¾ç½®)<br>ç„¶åå°†è¿™äº›å‚æ•°ä¼ ç»™Surface2dè¿™ä¸ªImagePyå®šä¹‰çš„Meshå¯¹è±¡ã€‚<br>æœ€åè°ƒç”¨show_meshæ–¹æ³•å°†å…¶å‘ˆç°å‡ºæ¥ã€‚<br>ä¸‹é¢æ˜¯ä¸€æ­¥æ­¥åˆ†æè¿™ä¸ªMeshå¯¹è±¡åŠå…¶ç»˜åˆ¶æ–¹æ³•ã€‚</p><h1 id="Meshå¯¹è±¡"><a href="#Meshå¯¹è±¡" class="headerlink" title="Meshå¯¹è±¡"></a>Meshå¯¹è±¡</h1><p>å¦‚å‰æ‰€è¿°ï¼ŒäºŒç»´é«˜ç¨‹å›¾ä¼ ç»™äº†Surface2dè¿™ä¸€ç±»ï¼Œå…·ä½“çœ‹ä¸€ä¸‹å…¶ä»£ç å®ç°ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Surface2d</span>(<span class="params">Mesh</span>):</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, img=<span class="literal">None</span>, sample=<span class="number">1</span>, sigma=<span class="number">0</span>, k=<span class="number">0.3</span>, **key</span>):</span></span><br><span class="line">self.img, self.sample, self.sigma, self.k = img, sample, sigma, k</span><br><span class="line">Mesh.__init__(self, **key)</span><br><span class="line">self.set_data(img, sample, sigma, k)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">set_data</span>(<span class="params">self, img=<span class="literal">None</span>, sample=<span class="literal">None</span>, sigma=<span class="literal">None</span>, k=<span class="literal">None</span>, **key</span>):</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> img <span class="keyword">is</span> <span class="literal">None</span>: self.img = img</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> sample <span class="keyword">is</span> <span class="literal">None</span>: self.sample = sample</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> sigma <span class="keyword">is</span> <span class="literal">None</span>: self.sigma = sigma</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> k <span class="keyword">is</span> <span class="literal">None</span>: self.k = k</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">sum</span>([<span class="keyword">not</span> i <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">for</span> i <span class="keyword">in</span> (img, sample, sigma, k)])&gt;<span class="number">0</span>:</span><br><span class="line"><span class="keyword">from</span> ..util <span class="keyword">import</span> meshutil</span><br><span class="line">vert, fs = meshutil.create_surface2d(self.img, self.sample, self.sigma, self.k)</span><br><span class="line">Mesh.set_data(self, verts=vert, faces=fs.astype(np.uint32), colors=vert[:,<span class="number">2</span>], **key)</span><br><span class="line"><span class="keyword">else</span>: Mesh.set_data(self, **key)</span><br></pre></td></tr></table></figure><br>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨å®ƒçš„åˆå§‹åŒ–å‡½æ•°ä¸­è°ƒç”¨äº†set_dataæ–¹æ³•ã€‚è¿›ä¸€æ­¥åœ°ï¼Œåœ¨è¯¥æ–¹æ³•ä¸­æœ‰ä¸¤ä¸ªæ ¸å¿ƒæ–¹æ³•ï¼šå°†å›¾åƒè½¬åŒ–ä¸ºé¡¶ç‚¹å’Œé¢ï¼Œç„¶åå†è½¬ä¸ºMeshå¯¹è±¡ã€‚</p><h2 id="ä½å›¾æå–æ ¼ç‚¹åæ ‡å’Œåƒç´ å€¼"><a href="#ä½å›¾æå–æ ¼ç‚¹åæ ‡å’Œåƒç´ å€¼" class="headerlink" title="ä½å›¾æå–æ ¼ç‚¹åæ ‡å’Œåƒç´ å€¼"></a>ä½å›¾æå–æ ¼ç‚¹åæ ‡å’Œåƒç´ å€¼</h2><p>å³å¦‚ä¸‹æ–¹æ³•ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vert, fs = meshutil.create_surface2d(self.img, self.sample, self.sigma, self.k)</span><br></pre></td></tr></table></figure><br>æºç åŠæ³¨é‡Šä¸ºï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create_surface2d</span>(<span class="params">img, sample=<span class="number">1</span>, sigma=<span class="number">0</span>, k=<span class="number">0.3</span></span>):</span></span><br><span class="line">    <span class="keyword">from</span> scipy.ndimage <span class="keyword">import</span> gaussian_filter</span><br><span class="line">    <span class="comment">#start = time()</span></span><br><span class="line">    <span class="comment"># ä»¥é‡‡æ ·ç‡ä¸ºæ­¥é•¿è¿›è¡Œå›¾åƒçš„é‡æ–°æå–</span></span><br><span class="line">    img = img[::sample, ::sample].astype(np.float32)</span><br><span class="line">    <span class="comment"># å¦‚æœæŒ‡å®šäº†å¹³æ»‘ç‡ï¼Œåˆ™ä½¿ç”¨é«˜æ–¯æ»¤æ³¢è¿›è¡Œå¹³æ»‘</span></span><br><span class="line">    <span class="keyword">if</span> sigma&gt;<span class="number">0</span>: img = gaussian_filter(img, sigma)</span><br><span class="line">    <span class="comment"># æ ¹æ®é‡‡æ ·åçš„å›¾åƒå½¢çŠ¶ç”Ÿæˆç½‘æ ¼æ ¼ç‚¹</span></span><br><span class="line">    xs, ys = np.mgrid[:img.shape[<span class="number">0</span>],:img.shape[<span class="number">1</span>]]</span><br><span class="line">    <span class="comment"># æ ¹æ®é‡‡æ ·ç‡ï¼Œå°†æ ¼ç‚¹èŒƒå›´ä¼¸ç¼©åˆ°ä¹‹å‰çš„å¤§å°</span></span><br><span class="line">    xs *= sample; ys *= sample</span><br><span class="line">    <span class="comment"># å°†å›¾åƒåƒç´ å€¼ä¹˜ä»¥ä¼¸ç¼©å¤§å°ï¼Œä½œä¸ºzè½´çš„å€¼ï¼Œä¸æ ¼ç‚¹åæ ‡xyä¼ å…¥ä¸‹é¢çš„æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">return</span> create_grid_mesh(xs, ys, img*k)</span><br></pre></td></tr></table></figure><br>åœ¨æ­¤ä¾‹ä¸­ï¼Œä¾ç…§ä¸Šé¢çš„å‚æ•°ï¼Œæ¥çœ‹ä¸€ä¸‹å„ä¸ªä¸­é—´ç»“æœï¼š<br>é¦–å…ˆé«˜ç¨‹å›¾åœ¨é™é‡‡æ ·åï¼Œå›¾åƒçŸ©é˜µä¸ºï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[[<span class="number">0.</span> <span class="number">0.</span> <span class="number">0.</span>]</span><br><span class="line"> [<span class="number">0.</span> <span class="number">2.</span> <span class="number">0.</span>]</span><br><span class="line"> [<span class="number">0.</span> <span class="number">0.</span> <span class="number">0.</span>]]</span><br></pre></td></tr></table></figure><br>ç„¶ååœ¨$\sigma=1$çš„é«˜æ–¯æ»¤æ³¢åï¼Œå›¾åƒçŸ©é˜µä¸ºï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[[<span class="number">0.17534617</span> <span class="number">0.2415005</span>  <span class="number">0.17534617</span>]</span><br><span class="line"> [<span class="number">0.2415005</span>  <span class="number">0.3326134</span>  <span class="number">0.2415005</span> ]</span><br><span class="line"> [<span class="number">0.17534617</span> <span class="number">0.2415005</span>  <span class="number">0.17534617</span>]]</span><br></pre></td></tr></table></figure><br>å…¶å†ç»è¿‡kå€çš„ä¼¸ç¼©ï¼Œå˜ä¸ºï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[[<span class="number">0.8767308</span> <span class="number">1.2075025</span> <span class="number">0.8767308</span>]</span><br><span class="line"> [<span class="number">1.2075025</span> <span class="number">1.6630671</span> <span class="number">1.2075025</span>]</span><br><span class="line"> [<span class="number">0.8767308</span> <span class="number">1.2075025</span> <span class="number">0.8767308</span>]]</span><br></pre></td></tr></table></figure><br>åŒæ—¶xså’Œyså³ç½‘æ ¼æ ¼ç‚¹åæ ‡ï¼Œä¹Ÿç»è¿‡äº†é™é‡‡æ ·ï¼Œä»¥åŠèŒƒå›´ä¼¸ç¼©ï¼Œå˜ä¸ºï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[[<span class="number">0</span> <span class="number">0</span> <span class="number">0</span>]</span><br><span class="line"> [<span class="number">2</span> <span class="number">2</span> <span class="number">2</span>]</span><br><span class="line"> [<span class="number">4</span> <span class="number">4</span> <span class="number">4</span>]]</span><br></pre></td></tr></table></figure></p><h2 id="è·å–æ ¼ç‚¹å’Œé¢çš„ä¿¡æ¯"><a href="#è·å–æ ¼ç‚¹å’Œé¢çš„ä¿¡æ¯" class="headerlink" title="è·å–æ ¼ç‚¹å’Œé¢çš„ä¿¡æ¯"></a>è·å–æ ¼ç‚¹å’Œé¢çš„ä¿¡æ¯</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create_grid_mesh</span>(<span class="params">xs, ys, zs</span>):</span></span><br><span class="line">    h, w = xs.shape</span><br><span class="line">    <span class="comment"># å°†xyåæ ‡ä½ç½®å’Œzå€¼åˆå¹¶èµ·æ¥</span></span><br><span class="line">    vts = np.array([xs, ys, zs], dtype=np.float32)</span><br><span class="line">    <span class="comment"># è¿™ä¸€æ­¥æ˜¯å®šä¹‰ä»¥æŸæ ¼ç‚¹ä¸ºå‚è€ƒç‚¹çš„åæ ‡ç³»ä¸‹å®ƒä¸å“ªäº›ç‚¹å½¢æˆé¢</span></span><br><span class="line">    <span class="comment"># åœ¨å±€éƒ¨åæ ‡ç³»ä¸‹ï¼Œå‚è€ƒç‚¹ç´¢å¼•ä¸º0ï¼Œé‚£ä¹ˆå®ƒæ‰€æ„æˆçš„é¢æœ‰ä¸¤ä¸ª</span></span><br><span class="line">    <span class="comment"># åˆ†åˆ«ä¸(1, 1+w)è¿™ä¸¤ä¸ªç‚¹æ„æˆä¸€ä¸ªé¢ï¼Œä¸(1+w, w)è¿™ä¸¤ä¸ªç‚¹æ„æˆä¸€ä¸ªé¢</span></span><br><span class="line">    <span class="comment"># æ¯”å¦‚åœ¨æ­¤ä¾‹ä¸‹ï¼Œdidçš„å€¼å°±æ˜¯[[0 1 4 0 4 3]]</span></span><br><span class="line">    did = np.array([[<span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>+w, <span class="number">0</span>, <span class="number">1</span>+w, w]], dtype=np.uint32)</span><br><span class="line">    <span class="comment"># rcsç”±ä¸¤éƒ¨åˆ†æ„æˆ</span></span><br><span class="line">    <span class="comment"># ç¬¬ä¸€éƒ¨åˆ†æ˜¯è·å–å…¨å±€åæ ‡ç³»ä¸‹æ¯ä¸€æ’çš„ç¬¬ä¸€ä¸ªå…ƒç´ çš„ç´¢å¼•ï¼Œæ‰€ä»¥æ˜¯ä»¥wä¸ºæ­¥é•¿</span></span><br><span class="line">    <span class="comment"># æ³¨æ„æ’é™¤æœ€åä¸€æ’ï¼Œå³æ˜¯w*hè¿˜è¦å‡å»wï¼Œå› ä¸ºæœ€åä¸€æ’å…ƒç´ æ‰€å‚ä¸çš„é¢å¯ä»¥é€šè¿‡å€’æ•°ç¬¬äºŒæ’æ¥è·å¾—</span></span><br><span class="line">    <span class="comment"># å¯¹äºæ­¤ä¾‹ï¼Œå°±æ˜¯[[0], [3]]ï¼Œæ³¨æ„è¿™é‡Œä½¿ç”¨Noneæ¥å¢åŠ ä¸€ä¸ªç»´åº¦</span></span><br><span class="line">    <span class="comment"># ç¬¬äºŒéƒ¨åˆ†æ˜¯è·å–å…¨å±€åæ ‡ç³»ä¸‹æ¯ä¸€åˆ—çš„ç´¢å¼•ï¼Œæ‰€ä»¥æ˜¯ä»¥1ä¸ºæ­¥é•¿</span></span><br><span class="line">    <span class="comment"># æ³¨æ„æ˜¯æ’é™¤æœ€åä¸€åˆ—ï¼Œå³wè¦å‡å»1ï¼Œè¿™ä¹Ÿæ˜¯å› ä¸ºæœ€åä¸€åˆ—å‚ä¸çš„é¢å¯ä»¥é€šè¿‡å‰ä¸€åˆ—å¾—åˆ°</span></span><br><span class="line">    <span class="comment"># å¯¹äºæ­¤ä¾‹ï¼Œå°±æ˜¯[0, 1]</span></span><br><span class="line">    <span class="comment"># æœ€ç»ˆrcså°±æ˜¯numpyæ•°ç»„çš„[[0],[3]]+[0, 1]</span></span><br><span class="line">    <span class="comment"># è¿™é‡Œç”¨åˆ°äº†numpyçš„å¹¿æ’­ï¼š https://qixinbo.info/2019/10/20/python-indexing/</span></span><br><span class="line">    <span class="comment"># [[0, 0],[3, 3]] + [[0, 1], [0, 1]] = [[0, 1], [3, 4]]</span></span><br><span class="line">    <span class="comment"># ä»£è¡¨çš„æ„æ€å°±æ˜¯åœ¨å…¨å±€åæ ‡ç³»ä¸­ï¼Œç¬¬ä¸€æ’å–ç´¢å¼•ä¸º0å’Œ1çš„æ ¼ç‚¹ï¼Œåœ¨ç¬¬äºŒæ’å–ç´¢å¼•ä¸º3å’Œ4çš„æ ¼ç‚¹</span></span><br><span class="line">    rcs = np.arange(<span class="number">0</span>,w*h-w,w)[:,<span class="literal">None</span>] + np.arange(<span class="number">0</span>,w-<span class="number">1</span>,<span class="number">1</span>)</span><br><span class="line">    <span class="comment"># æ¥ä¸‹æ¥å°±æ˜¯æ ¹æ®ä¸Šé¢å–å¾—çš„æ ¼ç‚¹ï¼Œå¾—åˆ°æ¯ä¸ªæ ¼ç‚¹ä¸Šæ‰€å½¢æˆçš„é¢</span></span><br><span class="line">    <span class="comment"># é¦–å…ˆç¬¬ä¸€éƒ¨åˆ†æ˜¯å°†rcsæ‹‰ç›´ä¸º[[0], [1], [3], [4]]ï¼Œå³è¿™å››ä¸ªæ ¼ç‚¹ç´¢å¼•æ‹‰å¹³åˆ°ä¸€ä¸ªç»´åº¦ä¸Š</span></span><br><span class="line">    <span class="comment"># ç„¶ååŠ ä¸Šä¸Šé¢çš„å±€éƒ¨åæ ‡ç³»ä¸‹å½¢æˆé¢çš„æ ¼ç‚¹ç´¢å¼•[[0 1 4 0 4 3]]</span></span><br><span class="line">    <span class="comment"># åŒæ ·æ ¹æ®å¹¿æ’­åŸåˆ™ï¼Œå°±å¾—åˆ°äº†æ¯ä¸ªæ ¼ç‚¹ä¸ç›¸é‚»ç‚¹æ‰€å½¢æˆçš„é¢</span></span><br><span class="line">    <span class="comment"># ç»“æœä¸ºï¼š[[0 1 4 0 4 3], [1 2 5 1 5 4], [3 4 7 3 7 6], [4 5 8 4 8 7]] </span></span><br><span class="line">    <span class="comment"># å³æ¯ä¸ªæ ¼ç‚¹ä¸Šéƒ½å‚ä¸å½¢æˆä¸¤ä¸ªé¢ï¼Œå…·ä½“æ¯ä¸€ä¸ªé¢çš„æ ¼ç‚¹ç»„æˆçœ‹ä¸Šé¢çš„åºåˆ—</span></span><br><span class="line">    faces = rcs.reshape(-<span class="number">1</span>,<span class="number">1</span>) + did</span><br><span class="line">    <span class="comment"># è¿”å›å€¼æ˜¯ä¸¤ä¸ª</span></span><br><span class="line">    <span class="comment"># ç¬¬ä¸€ä¸ªå°±æ˜¯æ ¼ç‚¹åæ ‡åŠå…¶ä¸Šé¢çš„å€¼ï¼Œå¹¶æŒ‰è¿™ä¸‰ä¸ªå€¼åˆå¹¶èµ·æ¥ç®—ä¸€ä¸ªé‡æ–°æ”¹å˜å½¢çŠ¶</span></span><br><span class="line">    <span class="comment"># ç¬¬äºŒä¸ªå°±æ˜¯ç”±æ ¼ç‚¹æ‰€å½¢æˆçš„é¢çš„ä¿¡æ¯</span></span><br><span class="line">    <span class="keyword">return</span> vts.reshape(<span class="number">3</span>,-<span class="number">1</span>).T.copy(), faces.reshape(-<span class="number">1</span>,<span class="number">3</span>)</span><br></pre></td></tr></table></figure><p>å…·ä½“çš„è§£æè¿‡ç¨‹è§ä¸Šé¢æºç ã€‚<br>æœ€åè¯´ä¸€ä¸‹æœ€ç»ˆè¿”å›çš„æ ¼ç‚¹ä¿¡æ¯å’Œé¢ä¿¡æ¯ï¼Œåˆ†åˆ«æ˜¯ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[[<span class="number">0.</span>        <span class="number">0.</span>        <span class="number">0.8767308</span>]</span><br><span class="line"> [<span class="number">0.</span>        <span class="number">2.</span>        <span class="number">1.2075025</span>]</span><br><span class="line"> [<span class="number">0.</span>        <span class="number">4.</span>        <span class="number">0.8767308</span>]</span><br><span class="line"> [<span class="number">2.</span>        <span class="number">0.</span>        <span class="number">1.2075025</span>]</span><br><span class="line"> [<span class="number">2.</span>        <span class="number">2.</span>        <span class="number">1.6630671</span>]</span><br><span class="line"> [<span class="number">2.</span>        <span class="number">4.</span>        <span class="number">1.2075025</span>]</span><br><span class="line"> [<span class="number">4.</span>        <span class="number">0.</span>        <span class="number">0.8767308</span>]</span><br><span class="line"> [<span class="number">4.</span>        <span class="number">2.</span>        <span class="number">1.2075025</span>]</span><br><span class="line"> [<span class="number">4.</span>        <span class="number">4.</span>        <span class="number">0.8767308</span>]]</span><br></pre></td></tr></table></figure><br>ä»¥ç¬¬ä¸€ä¸ªæ ¼ç‚¹ä¸ºä¾‹ï¼Œå®ƒæ˜¯åœ¨(0, 0)åæ ‡ï¼ŒåŒæ—¶ä¸Šé¢çš„å€¼æ˜¯0.8767308ã€‚<br>ä»¥åŠé¢ä¿¡æ¯ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[[<span class="number">0</span> <span class="number">1</span> <span class="number">4</span>]</span><br><span class="line"> [<span class="number">0</span> <span class="number">4</span> <span class="number">3</span>]</span><br><span class="line"> [<span class="number">1</span> <span class="number">2</span> <span class="number">5</span>]</span><br><span class="line"> [<span class="number">1</span> <span class="number">5</span> <span class="number">4</span>]</span><br><span class="line"> [<span class="number">3</span> <span class="number">4</span> <span class="number">7</span>]</span><br><span class="line"> [<span class="number">3</span> <span class="number">7</span> <span class="number">6</span>]</span><br><span class="line"> [<span class="number">4</span> <span class="number">5</span> <span class="number">8</span>]</span><br><span class="line"> [<span class="number">4</span> <span class="number">8</span> <span class="number">7</span>]]</span><br></pre></td></tr></table></figure><br>ä»¥ç¬¬ä¸€ä¸ªé¢ä¸ºä¾‹ï¼Œå®ƒç”±(0, 1, 4)å·æ ¼ç‚¹ç»„æˆã€‚</p><h2 id="æ„å»ºMeshå¯¹è±¡"><a href="#æ„å»ºMeshå¯¹è±¡" class="headerlink" title="æ„å»ºMeshå¯¹è±¡"></a>æ„å»ºMeshå¯¹è±¡</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¼ å…¥ä¸Šé¢çš„æ ¼ç‚¹ã€é¢ã€é¢œè‰²ï¼ˆè¿™é‡Œå–çš„æ˜¯æ ¼ç‚¹ä¸Šçš„zå€¼ï¼‰ä»¥åŠcmap</span></span><br><span class="line">Mesh.set_data(self, verts=vert, faces=fs.astype(np.uint32), colors=vert[:,<span class="number">2</span>], **key)</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç æ˜¯è°ƒç”¨äº†Meshå¯¹è±¡çš„set_dataæ–¹æ³•ã€‚<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Mesh</span>:</span></span><br><span class="line"><span class="comment"># åœ¨åˆå§‹åŒ–å‡½æ•°ä¸­ä¼ å…¥ä¸€ä¸ªMeshå¯¹è±¡æ‰€éœ€è¦çš„ä¿¡æ¯</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, verts=<span class="literal">None</span>, faces=<span class="literal">None</span>, colors=<span class="literal">None</span>, cmap=<span class="literal">None</span>, **key</span>):</span></span><br><span class="line"><span class="comment"># å¦‚æœæœ‰æ ¼ç‚¹ä¿¡æ¯ï¼Œä½†æ²¡æœ‰é¢ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">if</span> faces <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">and</span> <span class="keyword">not</span> verts <span class="keyword">is</span> <span class="literal">None</span>: </span><br><span class="line"><span class="comment"># åˆ™ç›´æ¥æŒ‰æ ¼ç‚¹ä¸ªæ•°-1ç”Ÿæˆé¢ï¼Œå³ä¸¤ä¸ªç›¸é‚»æ ¼ç‚¹ç›¸è¿ï¼Œå°±æˆä¸ºé¢</span></span><br><span class="line">faces = np.arange(<span class="built_in">len</span>(verts), dtype=np.uint32)</span><br><span class="line"><span class="comment"># ä¼ å…¥æ ¼ç‚¹ä¿¡æ¯</span></span><br><span class="line">self.verts = verts.astype(np.float32, copy=<span class="literal">False</span>) <span class="keyword">if</span> <span class="keyword">not</span> verts <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">else</span> <span class="literal">None</span></span><br><span class="line"><span class="comment"># ä¼ å…¥é¢ä¿¡æ¯</span></span><br><span class="line">self.faces = faces.astype(np.uint32, copy=<span class="literal">False</span>) <span class="keyword">if</span> <span class="keyword">not</span> faces <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">else</span> <span class="literal">None</span></span><br><span class="line"><span class="comment"># ä¼ å…¥é¢œè‰²ä¿¡æ¯</span></span><br><span class="line">self.colors = colors</span><br><span class="line"><span class="comment"># è®¾ç½®æ¨¡å¼ã€å¯è§æ€§å’Œdirtyå±æ€§ç­‰</span></span><br><span class="line">self.mode, self.visible, self.dirty = <span class="string">&#x27;mesh&#x27;</span>, <span class="literal">True</span>, <span class="string">&#x27;geom&#x27;</span></span><br><span class="line"><span class="comment"># è®¾ç½®alphaé€æ˜åº¦å’Œè¾¹ä¿¡æ¯</span></span><br><span class="line">self.alpha = <span class="number">1</span>; self.edges = <span class="literal">None</span></span><br><span class="line"><span class="comment"># è®¾ç½®é«˜å…‰ã€colormap</span></span><br><span class="line">self.high_light = <span class="literal">False</span>; self.cmap = <span class="string">&#x27;gray&#x27;</span> <span class="keyword">if</span> cmap <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">else</span> cmap</span><br><span class="line"><span class="comment"># è°ƒç”¨set_dataæ–¹æ³•</span></span><br><span class="line">self.set_data(**key)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">set_data</span>(<span class="params">self, verts=<span class="literal">None</span>, faces=<span class="literal">None</span>, colors=<span class="literal">None</span>, **key</span>):</span></span><br><span class="line"><span class="comment"># åŒä¸Šé¢çš„åˆå§‹åŒ–åŠŸèƒ½è¿‘ä¼¼ï¼ŒåŒºåˆ«æ˜¯å¯ä»¥ç›´æ¥è°ƒç”¨å®ƒæ¥é…ç½®ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">if</span> faces <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">and</span> <span class="keyword">not</span> verts <span class="keyword">is</span> <span class="literal">None</span>: </span><br><span class="line">faces = np.arange(<span class="built_in">len</span>(verts), dtype=np.uint32)</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> verts <span class="keyword">is</span> <span class="literal">None</span>: self.verts = verts.astype(np.float32, copy=<span class="literal">False</span>)</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> faces <span class="keyword">is</span> <span class="literal">None</span>: self.faces = faces.astype(np.uint32, copy=<span class="literal">False</span>)</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> colors <span class="keyword">is</span> <span class="literal">None</span>: self.colors = colors</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> faces <span class="keyword">is</span> <span class="literal">None</span>: self.edge = <span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">sum</span>([i <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">for</span> i <span class="keyword">in</span> [verts, faces, colors]])&lt;<span class="number">3</span>: self.dirty = <span class="string">&#x27;geom&#x27;</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> self.faces <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">and</span> self.faces.ndim==<span class="number">1</span>: key[<span class="string">&#x27;mode&#x27;</span>] = <span class="string">&#x27;points&#x27;</span></span><br><span class="line"><span class="keyword">elif</span> <span class="keyword">not</span> self.faces <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">and</span> self.faces.shape[<span class="number">1</span>]==<span class="number">2</span>: </span><br><span class="line"><span class="keyword">if</span> key.get(<span class="string">&#x27;mode&#x27;</span>, self.mode)==<span class="string">&#x27;mesh&#x27;</span>: key[<span class="string">&#x27;mode&#x27;</span>] = <span class="string">&#x27;grid&#x27;</span></span><br><span class="line"><span class="keyword">if</span> key.get(<span class="string">&#x27;mode&#x27;</span>, self.mode) != self.mode: self.dirty = <span class="string">&#x27;geom&#x27;</span></span><br><span class="line">self.mode = key.get(<span class="string">&#x27;mode&#x27;</span>, self.mode)</span><br><span class="line">self.visible = key.get(<span class="string">&#x27;visible&#x27;</span>, self.visible)</span><br><span class="line">self.alpha = key.get(<span class="string">&#x27;alpha&#x27;</span>, self.alpha)</span><br><span class="line">self.high_light = key.get(<span class="string">&#x27;high_light&#x27;</span>, <span class="literal">False</span>)</span><br><span class="line">self.cmap = key.get(<span class="string">&#x27;cmap&#x27;</span>, self.cmap)</span><br><span class="line">self.dirty = self.dirty <span class="keyword">or</span> <span class="literal">True</span></span><br></pre></td></tr></table></figure></p><h1 id="å¯è§†åŒ–Mesh"><a href="#å¯è§†åŒ–Mesh" class="headerlink" title="å¯è§†åŒ–Mesh"></a>å¯è§†åŒ–Mesh</h1><p>å³å°†Meshå¯¹è±¡é€šè¿‡ä¸‰ç»´ç”»å¸ƒå±•ç¤ºå‡ºæ¥ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">self.app.show_mesh(mesh, para[<span class="string">&#x27;name&#x27;</span>])</span><br></pre></td></tr></table></figure><br>è¿™é‡Œå°±æ˜¯è°ƒç”¨äº†appçš„show_meshæ–¹æ³•ã€‚<br>ImagePyçš„ä¸‰ç»´ç”»å¸ƒæ˜¯åŸºäºVisPyçš„ï¼ŒåŒæ—¶åˆè¿›è¡Œäº†å°è£…ï¼Œæœ€åº•å±‚çš„æ˜¯å¦‚ä¸‹è¿™ä¸ªç±»ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Canvas3D</span>(<span class="params">scene.SceneCanvas</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__new__</span>(<span class="params">cls, parent, scene3d=<span class="literal">None</span></span>):</span></span><br><span class="line">        self = <span class="built_in">super</span>().__new__(cls)</span><br><span class="line">        scene.SceneCanvas.__init__(self, app=<span class="string">&quot;wx&quot;</span>, parent=parent, keys=<span class="string">&#x27;interactive&#x27;</span>, show=<span class="literal">True</span>, dpi=<span class="number">150</span>)</span><br><span class="line">        canvas = parent.GetChildren()[-<span class="number">1</span>]</span><br><span class="line">        self.unfreeze()</span><br><span class="line">        self.canvas = weakref.ref(canvas)</span><br><span class="line">        self.view = self.central_widget.add_view()</span><br><span class="line">        self.set_scene(scene3d <span class="keyword">or</span> Scene())</span><br><span class="line">        self.visuals = &#123;&#125;</span><br><span class="line">        self.curobj = <span class="literal">None</span></span><br><span class="line">        self.freeze()</span><br><span class="line">        canvas.Bind(wx.EVT_IDLE, self.on_idle)</span><br><span class="line">        canvas.tool = <span class="literal">None</span></span><br><span class="line">        canvas.camera = scene.cameras.TurntableCamera(parent=self.view.scene, fov=<span class="number">45</span>, name=<span class="string">&#x27;Turntable&#x27;</span>)</span><br><span class="line">        canvas.set_camera = self.set_camera</span><br><span class="line">        canvas.fit = <span class="keyword">lambda</span> : self.set_camera(auto=<span class="literal">True</span>)</span><br><span class="line">        canvas.at = self.at</span><br><span class="line">        self.view.camera = canvas.camera</span><br><span class="line">        <span class="keyword">return</span> canvas</span><br></pre></td></tr></table></figure><br>VisPyçš„æ•™ç¨‹ç•¥å¾®æœ‰ç‚¹å°‘ï¼Œç•™å‘å¾…å¡«ã€‚</p>]]></content>
    
    
    <summary type="html">æœ¬æ–‡è§£æä¸€ä¸‹ImagePyçš„ä¸‰ç»´ç”»å¸ƒã€‚
ä»¥å¦‚ä¸‹ä¾‹å­å…¥æ‰‹ï¼š

é¦–å…ˆï¼ŒåŸå§‹å›¾åƒæ˜¯ä¸€ä¸ª5ä¹˜5çš„æ–¹å½¢å›¾åƒï¼Œå…¶ä¸­é—´æ˜¯4ä¹˜4çš„ç™½è‰²ï¼Œå‘¨å›´æ˜¯ä¸€åœˆé»‘è‰²ã€‚
ç”±è¿™å¼ åŸå§‹å›¾æ ¹æ®è·ç¦»å˜æ¢å¾—åˆ°å³ä¸Šè§’çš„é«˜ç¨‹å›¾ï¼Œç»§è€Œå¯¹è¯¥é«˜ç¨‹å›¾åšä¸‰ç»´å¯è§†åŒ–ã€‚

æ¸²æŸ“æ’ä»¶
äºŒç»´å¹³é¢çš„ä¸‰ç»´å¯è§†åŒ–æ’ä»¶æ˜¯è¿™æ ·å†™çš„ï¼š
1
2
3
4
5
6
7
8
9
10
11
12
13
14


class Surface2D(Simple):
    title = &#39;2D Surface&#39;
    note = [&#39;8-bit&#39;, &#39;16-bit&#39;, &#39;float&#39;]
    para = {&#39;name&#39;:&#39;undifine&#39;, &#39;sample&#39;:2, &#39;</summary>
    
    
    
    <category term="computer vision" scheme="http://qixinbo.github.io/categories/computer-vision/"/>
    
    
    <category term="ImagePy" scheme="http://qixinbo.github.io/tags/ImagePy/"/>
    
  </entry>
  
  <entry>
    <title>Electronåˆæ¢ï¼šåŸºäºWebçš„è·¨å¹³å°æ¡Œé¢åº”ç”¨å¼€å‘</title>
    <link href="http://qixinbo.github.io/2021/11/15/electron/"/>
    <id>http://qixinbo.github.io/2021/11/15/electron/</id>
    <published>2021-11-14T16:00:00.000Z</published>
    <updated>2021-11-15T06:37:55.565Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h1><p><a href="https://juejin.cn/post/6844904055236460558">ä½ èƒ½åˆ†å¾—æ¸…æ¥š Chromium, V8, Blink, Gecko, WebKit ä¹‹é—´çš„åŒºåˆ«å—ï¼Ÿ</a><br><a href="https://msyfls123.github.io/blog/2020/11/02/%E4%B8%9D%E8%88%AC%E9%A1%BA%E6%BB%91%E7%9A%84Electron%E8%B7%A8%E7%AB%AF%E5%BC%80%E5%8F%91%E4%BD%93%E9%AA%8C/">ä¸èˆ¬é¡ºæ»‘çš„ Electron è·¨ç«¯å¼€å‘ä½“éªŒ</a><br><a href="https://jspang.com/detailed?id=62#toc34">Electron å…è´¹è§†é¢‘æ•™ç¨‹-ç”¨å‰ç«¯æŠ€æœ¯å¼€å‘æ¡Œé¢åº”ç”¨</a><br><a href="https://weishuai.gitbooks.io/electron-/content/tutorial/quick-start.html">Electron å¿«é€Ÿå…¥é—¨</a></p><h1 id="åŸºç¡€æ¦‚å¿µ"><a href="#åŸºç¡€æ¦‚å¿µ" class="headerlink" title="åŸºç¡€æ¦‚å¿µ"></a>åŸºç¡€æ¦‚å¿µ</h1><h2 id="å¼•æ“"><a href="#å¼•æ“" class="headerlink" title="å¼•æ“"></a>å¼•æ“</h2><p>JavaScriptå¼•æ“çš„ä½œç”¨æ˜¯è§£é‡Šå’Œç¼–è¯‘JavaScriptä»£ç ã€‚<br>è€Œæµè§ˆå™¨å¼•æ“ä¸ä»…è´Ÿè´£ç®¡ç†ç½‘é¡µçš„å¸ƒå±€ï¼ŒåŒæ—¶å…¶åŒ…æ‹¬JavaScriptå¼•æ“ã€‚<br>å½“å‰å¸‚åœºä¸Šåªæœ‰ 3 ä¸ªä¸»è¦çš„æµè§ˆå™¨å¼•æ“ï¼šMozilla çš„ Geckoã€Google çš„ Blinkã€è¿˜æœ‰è‹¹æœçš„çš„ WebKitï¼ˆBlink çš„è¿‘äº²ï¼‰ã€‚<br>Blink æ˜¯ Google Chromeæµè§ˆå™¨åŠChromiumå¼€æºæµè§ˆå™¨ï¼ˆå¯ä»¥ç†è§£ä¸ºï¼šChromium + é›†æˆ Google äº§å“ = Google Chromeï¼‰çš„æ¸²æŸ“å¼•æ“ï¼ŒV8 æ˜¯ Blink å†…ç½®çš„ JavaScript å¼•æ“ã€‚å…·ä½“æ¥è¯´ï¼ŒV8 å¯¹ DOMï¼ˆæ–‡æ¡£å¯¹è±¡æ¨¡å‹ï¼‰ä¸€æ— æ‰€çŸ¥ï¼Œå› ä¸ºå®ƒä»…ç”¨äºå¤„ç† JavaScriptï¼›è€ŒBlink å†…ç½®çš„å¸ƒå±€å¼•æ“è´Ÿè´£å¤„ç†ç½‘é¡µå¸ƒå±€å’Œå±•ç¤ºã€‚</p><h2 id="åç«¯"><a href="#åç«¯" class="headerlink" title="åç«¯"></a>åç«¯</h2><p>Node.js å°±æ˜¯è¿è¡Œåœ¨æœåŠ¡ç«¯çš„ JavaScriptï¼Œç±»æ¯”Javaåç«¯ã€Pythonåç«¯ç­‰ã€‚<br>å› ä¸º Node.js ä¸éœ€è¦ä½¿ç”¨ DOMï¼Œæ‰€ä»¥ Node.js åªä½¿ç”¨äº† V8 å¼•æ“ï¼Œè€Œæ²¡æœ‰æŠŠæ•´ä¸ª Blink å¼•æ“éƒ½æ¬è¿‡æ¥ç”¨ã€‚</p><h2 id="Electron"><a href="#Electron" class="headerlink" title="Electron"></a>Electron</h2><p>Electron = Chromium + Node.js + Native API<br>ï¼ˆ1ï¼‰Chromium : ä¸ºElectronæä¾›äº†å¼ºå¤§çš„UIèƒ½åŠ›ï¼Œå¯ä»¥ä¸è€ƒè™‘å…¼å®¹æ€§çš„æƒ…å†µä¸‹ï¼Œåˆ©ç”¨å¼ºå¤§çš„Webç”Ÿæ€æ¥å¼€å‘ç•Œé¢ã€‚<br>ï¼ˆ2ï¼‰Node.js ï¼šè®©Electronæœ‰äº†åº•å±‚çš„æ“ä½œèƒ½åŠ›ï¼Œæ¯”å¦‚æ–‡ä»¶çš„è¯»å†™ï¼Œç”šè‡³æ˜¯é›†æˆC++ç­‰ç­‰æ“ä½œï¼Œå¹¶å¯ä»¥ä½¿ç”¨å¤§é‡å¼€æºçš„npmåŒ…æ¥å®Œæˆå¼€å‘éœ€æ±‚ã€‚<br>ï¼ˆ3ï¼‰Native API ï¼š Native APIè®©Electronæœ‰äº†è·¨å¹³å°å’Œæ¡Œé¢ç«¯çš„åŸç”Ÿèƒ½åŠ›ï¼Œæ¯”å¦‚è¯´å®ƒæœ‰ç»Ÿä¸€çš„åŸç”Ÿç•Œé¢ï¼Œçª—å£ã€æ‰˜ç›˜è¿™äº›ã€‚</p><p>Electronä½œç”¨æ˜¯ç”¨Webå‰ç«¯æŠ€æœ¯æ¥å¼€å‘æ¡Œé¢åº”ç”¨ã€‚</p><p>å…·ä½“åŸç†ï¼š<br>Electron å°±æ˜¯ Chromiumï¼ˆChrome å†…æ ¸ï¼‰ã€Node.js å’Œç³»ç»ŸåŸç”Ÿ API çš„ç»“åˆã€‚å®ƒåšçš„äº‹æƒ…å¾ˆç®€å•ï¼Œæ•´ä¸ªåº”ç”¨è·‘åœ¨ä¸€ä¸ª main processï¼ˆä¸»è¿›ç¨‹ï¼‰ ä¸Šï¼Œéœ€è¦æä¾› GUI ç•Œé¢æ—¶åˆ™åˆ›å»ºä¸€ä¸ª renderer processï¼ˆæ¸²æŸ“è¿›ç¨‹ï¼‰å»å¼€å¯ä¸€ä¸ª Chromium é‡Œçš„ BrowserWindow/BrowserViewï¼Œå®é™…å°±åƒæ˜¯ Chrome çš„ä¸€ä¸ªçª—å£æˆ–è€… Tab é¡µä¸€æ ·ï¼Œè€Œå…¶ä¸­å±•ç¤ºçš„æ—¢å¯ä»¥æ˜¯æœ¬åœ°ç½‘é¡µä¹Ÿå¯ä»¥æ˜¯çº¿ä¸Šç½‘é¡µï¼Œä¸»è¿›ç¨‹å’Œæ¸²æŸ“è¿›ç¨‹é—´é€šè¿‡ IPC è¿›è¡Œé€šè®¯ï¼Œä¸»è¿›ç¨‹å¯ä»¥è‡ªç”±åœ°è°ƒç”¨ Electron æä¾›çš„ç³»ç»Ÿ API ä»¥åŠ Node.js æ¨¡å—ï¼Œå¯ä»¥æ§åˆ¶å…¶æ‰€è¾–æ¸²æŸ“è¿›ç¨‹çš„ç”Ÿå‘½å‘¨æœŸã€‚</p><h3 id="ä¸»è¿›ç¨‹"><a href="#ä¸»è¿›ç¨‹" class="headerlink" title="ä¸»è¿›ç¨‹"></a>ä¸»è¿›ç¨‹</h3><p>åœ¨ Electron é‡Œï¼Œè¿è¡Œ package.json é‡Œ main è„šæœ¬çš„è¿›ç¨‹è¢«ç§°ä¸ºä¸»è¿›ç¨‹ã€‚åœ¨ä¸»è¿›ç¨‹è¿è¡Œçš„è„šæœ¬å¯ä»¥ä»¥åˆ›å»º web é¡µé¢çš„å½¢å¼å±•ç¤º GUIã€‚</p><h3 id="æ¸²æŸ“è¿›ç¨‹"><a href="#æ¸²æŸ“è¿›ç¨‹" class="headerlink" title="æ¸²æŸ“è¿›ç¨‹"></a>æ¸²æŸ“è¿›ç¨‹</h3><p>ç”±äº Electron ä½¿ç”¨ Chromium æ¥å±•ç¤ºé¡µé¢ï¼Œæ‰€ä»¥ Chromium çš„å¤šè¿›ç¨‹ç»“æ„ä¹Ÿè¢«å……åˆ†åˆ©ç”¨ã€‚æ¯ä¸ª Electron çš„é¡µé¢éƒ½åœ¨è¿è¡Œç€è‡ªå·±çš„è¿›ç¨‹ï¼Œè¿™æ ·çš„è¿›ç¨‹æˆ‘ä»¬ç§°ä¹‹ä¸ºæ¸²æŸ“è¿›ç¨‹ã€‚<br>åœ¨ä¸€èˆ¬æµè§ˆå™¨ä¸­ï¼Œç½‘é¡µé€šå¸¸ä¼šåœ¨æ²™ç›’ç¯å¢ƒä¸‹è¿è¡Œï¼Œå¹¶ä¸”ä¸å…è®¸è®¿é—®åŸç”Ÿèµ„æºã€‚ç„¶è€Œï¼ŒElectron ç”¨æˆ·æ‹¥æœ‰åœ¨ç½‘é¡µä¸­è°ƒç”¨ Node.js çš„ APIs çš„èƒ½åŠ›ï¼Œå¯ä»¥ä¸åº•å±‚æ“ä½œç³»ç»Ÿç›´æ¥äº¤äº’ã€‚</p><h3 id="ä¸»è¿›ç¨‹ä¸æ¸²æŸ“è¿›ç¨‹çš„åŒºåˆ«"><a href="#ä¸»è¿›ç¨‹ä¸æ¸²æŸ“è¿›ç¨‹çš„åŒºåˆ«" class="headerlink" title="ä¸»è¿›ç¨‹ä¸æ¸²æŸ“è¿›ç¨‹çš„åŒºåˆ«"></a>ä¸»è¿›ç¨‹ä¸æ¸²æŸ“è¿›ç¨‹çš„åŒºåˆ«</h3><p>ä¸»è¿›ç¨‹ä½¿ç”¨ BrowserWindow å®ä¾‹åˆ›å»ºé¡µé¢ã€‚æ¯ä¸ª BrowserWindow å®ä¾‹éƒ½åœ¨è‡ªå·±çš„æ¸²æŸ“è¿›ç¨‹é‡Œè¿è¡Œé¡µé¢ã€‚å½“ä¸€ä¸ª BrowserWindow å®ä¾‹è¢«é”€æ¯åï¼Œç›¸åº”çš„æ¸²æŸ“è¿›ç¨‹ä¹Ÿä¼šè¢«ç»ˆæ­¢ã€‚<br>ä¸»è¿›ç¨‹ç®¡ç†æ‰€æœ‰é¡µé¢å’Œä¸ä¹‹å¯¹åº”çš„æ¸²æŸ“è¿›ç¨‹ã€‚æ¯ä¸ªæ¸²æŸ“è¿›ç¨‹éƒ½æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œå¹¶ä¸”åªå…³å¿ƒä»–ä»¬è‡ªå·±çš„é¡µé¢ã€‚<br>ç”±äºåœ¨é¡µé¢é‡Œç®¡ç†åŸç”Ÿ GUI èµ„æºæ˜¯éå¸¸å±é™©è€Œä¸”å®¹æ˜“é€ æˆèµ„æºæ³„éœ²ï¼Œæ‰€ä»¥åœ¨é¡µé¢è°ƒç”¨ GUI ç›¸å…³çš„ APIs æ˜¯ä¸è¢«å…è®¸çš„ã€‚å¦‚æœä½ æƒ³åœ¨ç½‘é¡µé‡Œä½¿ç”¨ GUI æ“ä½œï¼Œå…¶å¯¹åº”çš„æ¸²æŸ“è¿›ç¨‹å¿…é¡»ä¸ä¸»è¿›ç¨‹è¿›è¡Œé€šè®¯ï¼Œè¯·æ±‚ä¸»è¿›ç¨‹è¿›è¡Œç›¸å…³çš„ GUI æ“ä½œã€‚<br>åœ¨ Electronï¼Œæˆ‘ä»¬æä¾›å‡ ç§æ–¹æ³•ç”¨äºä¸»è¿›ç¨‹å’Œæ¸²æŸ“è¿›ç¨‹ä¹‹é—´çš„é€šè®¯ã€‚åƒ ipcRenderer å’Œ ipcMain æ¨¡å—ç”¨äºå‘é€æ¶ˆæ¯ï¼Œ remote æ¨¡å—ç”¨äº RPC æ–¹å¼é€šè®¯ã€‚</p><h1 id="é…ç½®ç¯å¢ƒ"><a href="#é…ç½®ç¯å¢ƒ" class="headerlink" title="é…ç½®ç¯å¢ƒ"></a>é…ç½®ç¯å¢ƒ</h1><h2 id="å®‰è£…Electron"><a href="#å®‰è£…Electron" class="headerlink" title="å®‰è£…Electron"></a>å®‰è£…Electron</h2><p>å¯ä»¥å…¨å±€å®‰è£…ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g electron</span><br></pre></td></tr></table></figure><br>æˆ–è€…ä»…é¡¹ç›®å®‰è£…ï¼šæ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œç„¶åï¼Œ<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install electron --save-dev</span><br></pre></td></tr></table></figure><br>ç„¶åä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npx electron -v</span><br><span class="line">æˆ–</span><br><span class="line">./node_modules/.<span class="built_in">bin</span>/electron -v</span><br></pre></td></tr></table></figure></p><h1 id="Electronçš„Hello-World"><a href="#Electronçš„Hello-World" class="headerlink" title="Electronçš„Hello World"></a>Electronçš„Hello World</h1><h2 id="æ–°å»ºindex-htmlæ–‡ä»¶"><a href="#æ–°å»ºindex-htmlæ–‡ä»¶" class="headerlink" title="æ–°å»ºindex.htmlæ–‡ä»¶"></a>æ–°å»ºindex.htmlæ–‡ä»¶</h2><p>åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸­æ–°å»ºä¸€ä¸ªindex.htmlæ–‡ä»¶ï¼Œç›¸å½“äºUIéƒ½å†™åœ¨htmlä¸­ï¼ˆå¯ä»¥åœ¨sublimetextè¾“å…¥htmlè‡ªåŠ¨ç”Ÿæˆï¼‰ï¼š<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;utf-8&quot;</span>&gt;</span><br><span class="line">    &lt;meta name=<span class="string">&quot;viewport&quot;</span> content=<span class="string">&quot;width=device-width, initial-scale=1&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;Hello World&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    hello World</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></p><h2 id="æ–°å»ºmain-jsæ–‡ä»¶"><a href="#æ–°å»ºmain-jsæ–‡ä»¶" class="headerlink" title="æ–°å»ºmain.jsæ–‡ä»¶"></a>æ–°å»ºmain.jsæ–‡ä»¶</h2><p>åœ¨æ ¹ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªmain.jsæ–‡ä»¶ï¼Œè¿™ä¸ªå°±æ˜¯Electronçš„ä¸»è¿›ç¨‹æ–‡ä»¶ã€‚<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">var electron = require(<span class="string">&#x27;electron&#x27;</span>)  //å¼•å…¥electronæ¨¡å—</span><br><span class="line"></span><br><span class="line">var app = electron.app   // åˆ›å»ºelectronå¼•ç”¨</span><br><span class="line"></span><br><span class="line">var BrowserWindow = electron.BrowserWindow;  //åˆ›å»ºçª—å£å¼•ç”¨</span><br><span class="line"></span><br><span class="line">var mainWindow = null ;  //å£°æ˜è¦æ‰“å¼€çš„ä¸»çª—å£</span><br><span class="line">app.on(&#x27;ready&#x27;,()=&gt;&#123;</span><br><span class="line">    mainWindow = new BrowserWindow(&#123;width:<span class="number">400</span>,height:<span class="number">400</span>&#125;)   //è®¾ç½®æ‰“å¼€çš„çª—å£å¤§å°</span><br><span class="line"></span><br><span class="line">    mainWindow.loadFile(<span class="string">&#x27;index.html&#x27;</span>)  //åŠ è½½é‚£ä¸ªé¡µé¢</span><br><span class="line"></span><br><span class="line">    //ç›‘å¬å…³é—­äº‹ä»¶ï¼ŒæŠŠä¸»çª—å£è®¾ç½®ä¸ºnull</span><br><span class="line">    mainWindow.on(&#x27;closed&#x27;,()=&gt;&#123;</span><br><span class="line">        mainWindow = null</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p><h2 id="åˆ›å»ºpackage-jsonæ–‡ä»¶"><a href="#åˆ›å»ºpackage-jsonæ–‡ä»¶" class="headerlink" title="åˆ›å»ºpackage.jsonæ–‡ä»¶"></a>åˆ›å»ºpackage.jsonæ–‡ä»¶</h2><p>åœ¨ç»ˆç«¯ä½¿ç”¨å‘½ä»¤ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm init --yes</span><br></pre></td></tr></table></figure><br>è¿™æ—¶å€™mainçš„å€¼ä¸ºmain.jså°±æ­£ç¡®äº†ã€‚</p><h2 id="è¿è¡Œ"><a href="#è¿è¡Œ" class="headerlink" title="è¿è¡Œ"></a>è¿è¡Œ</h2><p>ç»ˆç«¯ä¸‹è¿è¡Œï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.\node_modules\.<span class="built_in">bin</span>\electron .</span><br></pre></td></tr></table></figure></p><p>ç„¶åç»“æœä¸ºï¼š<br><img src="https://user-images.githubusercontent.com/6218739/141733207-8ae86b3e-95ab-4c5d-8e49-6f11c5721fd7.png" alt="hello"></p><p>è¯•äº†è¿™ä¸ªæœ€å°ä¾‹å­ï¼Œæ„Ÿè§‰ä½¿ç”¨electronæ¥å¼€å‘æ¡Œé¢åº”ç”¨çš„è¯ï¼Œæ—¢èƒ½è·¨å¹³å°ï¼Œæ¯”å¦‚Windowsã€Linuxã€MacOSï¼Œä¸€å¤„æ°´æºä¾›å…¨çƒï¼Œè¿˜èƒ½ç›´æ¥è½¬åŒ–æˆWebåº”ç”¨ï¼Œå³ä¸è®©ç”¨æˆ·å®‰è£…è½¯ä»¶ï¼Œç»™ä»–ä¸€ä¸ªé“¾æ¥ç›´æ¥è®¿é—®ã€‚<br>è¿™æ ·å°±å¯è¿›å¯é€€ï¼Œä¸€æ¬¡å¼€å‘ï¼Œåˆ°å¤„ä½¿ç”¨ï¼Œä½†å‰ææ˜¯å¾—ç†Ÿæ‚‰JSå¼€å‘ï¼Œè¿™ä¸ªå‘å¾…å¡«ã€‚ã€‚</p>]]></content>
    
    
    <summary type="html">å‚è€ƒæ–‡çŒ®
ä½ èƒ½åˆ†å¾—æ¸…æ¥š Chromium, V8, Blink, Gecko, WebKit ä¹‹é—´çš„åŒºåˆ«å—ï¼Ÿ
ä¸èˆ¬é¡ºæ»‘çš„ Electron è·¨ç«¯å¼€å‘ä½“éªŒ
Electron å…è´¹è§†é¢‘æ•™ç¨‹-ç”¨å‰ç«¯æŠ€æœ¯å¼€å‘æ¡Œé¢åº”ç”¨
Electron å¿«é€Ÿå…¥é—¨

åŸºç¡€æ¦‚å¿µ
å¼•æ“
JavaScriptå¼•æ“çš„ä½œç”¨æ˜¯è§£é‡Šå’Œç¼–è¯‘JavaScriptä»£ç ã€‚
è€Œæµè§ˆå™¨å¼•æ“ä¸ä»…è´Ÿè´£ç®¡ç†ç½‘é¡µçš„å¸ƒå±€ï¼ŒåŒæ—¶å…¶åŒ…æ‹¬JavaScriptå¼•æ“ã€‚
å½“å‰å¸‚åœºä¸Šåªæœ‰ 3 ä¸ªä¸»è¦çš„æµè§ˆå™¨å¼•æ“ï¼šMozilla çš„ Geckoã€Google çš„ Blinkã€è¿˜æœ‰è‹¹æœçš„çš„ WebKitï¼ˆBlink çš„è¿‘äº²ï¼‰ã€‚
Blink æ˜¯ Google Chromeæµè§ˆ</summary>
    
    
    
    <category term="digitalization" scheme="http://qixinbo.github.io/categories/digitalization/"/>
    
    
    <category term="GUI" scheme="http://qixinbo.github.io/tags/GUI/"/>
    
  </entry>
  
  <entry>
    <title>NLPéœ¸ä¸»TransformeråŠCVæ–°ç§€Vision Transformerè§£æ</title>
    <link href="http://qixinbo.github.io/2021/11/09/transformer/"/>
    <id>http://qixinbo.github.io/2021/11/09/transformer/</id>
    <published>2021-11-08T16:00:00.000Z</published>
    <updated>2021-11-09T07:58:46.805Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h1><p><a href="https://cuijiahua.com/blog/2021/01/dl-basics-3.html">ä¿å§†çº§æ•™ç¨‹ï¼šå›¾è§£Transformer</a><br><a href="https://terrifyzhao.github.io/2019/01/11/Transformer%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3.html">Transformeræ¨¡å‹è¯¦è§£</a><br><a href="https://wmathor.com/index.php/archives/1438/">Transformer è¯¦è§£</a><br><a href="https://picture.iczhiku.com/weixin/message1610942723056.html">ç›˜ç‚¹ | 2021å¹´paperå¤§çƒ­çš„Transformer (ViT)</a><br><a href="https://zhuanlan.zhihu.com/p/356155277">â€œæœªæ¥â€çš„ç»å…¸ä¹‹ä½œViTï¼štransformer is all you need!</a><br><a href="https://paddlepedia.readthedocs.io/en/latest/tutorials/computer_vision/classification/ViT.html">ViT( Vision Transformer)</a></p><h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><p><a href="https://arxiv.org/pdf/1706.03762.pdf">Attention Is All You Need</a>æ˜¯ä¸€ç¯‡Googleäº2017å¹´æå‡ºçš„å°†Attentionæ€æƒ³å‘æŒ¥åˆ°æè‡´çš„è®ºæ–‡ã€‚è¿™ç¯‡è®ºæ–‡ä¸­æå‡ºä¸€ä¸ªå…¨æ–°çš„æ¨¡å‹ï¼Œå« Transformerï¼ŒæŠ›å¼ƒäº†ä»¥å¾€æ·±åº¦å­¦ä¹ ä»»åŠ¡é‡Œé¢ä½¿ç”¨åˆ°çš„ CNN å’Œ RNN ï¼Œç›®å‰å¤§çƒ­çš„Bertã€GPTå’ŒDALL-Eå°±æ˜¯åŸºäºTransformeræ„å»ºçš„ï¼Œè¿™ä¸ªæ¨¡å‹å¹¿æ³›åº”ç”¨äºNLPé¢†åŸŸï¼Œä¾‹å¦‚æœºå™¨ç¿»è¯‘ï¼Œé—®ç­”ç³»ç»Ÿï¼Œæ–‡æœ¬æ‘˜è¦å’Œè¯­éŸ³è¯†åˆ«ç­‰ç­‰æ–¹å‘ã€‚<br><img src="https://user-images.githubusercontent.com/6218739/140851930-34149770-8d8b-4fed-bdf2-43cce255f0b1.png" alt="1"></p><p>ç›¸æ¯”äºNLPé¢†åŸŸï¼Œåœ¨CVé¢†åŸŸä¸­ï¼Œå·ç§¯ç¥ç»ç½‘ç»œCNNå´æ˜¯ç»å¯¹çš„éœ¸ä¸»ã€‚å¯¹äºå›¾åƒé—®é¢˜ï¼ŒCNNå…·æœ‰å¤©ç„¶çš„å…ˆå¤©ä¼˜åŠ¿ï¼ˆinductive biasï¼‰ï¼šå¹³ç§»ä¸å˜æ€§ï¼ˆtranslation equivarianceï¼‰å’Œå±€éƒ¨æ€§ï¼ˆlocalityï¼‰ã€‚è€Œtransformerè™½ç„¶ä¸å¹¶å…·å¤‡è¿™äº›ä¼˜åŠ¿ï¼Œä½†æ˜¯transformerçš„æ ¸å¿ƒself-attentionçš„ä¼˜åŠ¿ä¸åƒå·ç§¯é‚£æ ·æœ‰å›ºå®šä¸”æœ‰é™çš„æ„Ÿå—é‡ï¼Œself-attentionæ“ä½œå¯ä»¥è·å¾—long-rangeä¿¡æ¯ï¼ˆç›¸æ¯”ä¹‹ä¸‹CNNè¦é€šè¿‡ä¸æ–­å †ç§¯Conv layersæ¥è·å–æ›´å¤§çš„æ„Ÿå—é‡ï¼‰ï¼Œä½†è®­ç»ƒçš„éš¾åº¦å°±æ¯”CNNè¦ç¨å¤§ä¸€äº›ã€‚<br>ä»ç„¶æ˜¯Googleï¼Œ<a href="https://arxiv.org/pdf/2010.11929.pdf">An Image is Worth 16x16 Words: Transformers for Image Recognition at Scale</a>è¿™ç¯‡2020å¹´çš„è®ºæ–‡å°†Transformerå¼•å…¥äº†CVä¸­ï¼Œå½¢æˆäº†Vision Transformerï¼Œç®€ç§°ä¸ºViTã€‚<br>æœ¬æ–‡å°è¯•ç†è§£ä¸€ä¸‹åŸå§‹TransformeråŠå…¶è¡ç”Ÿå“ViTã€‚</p><h1 id="Transformeræ¶æ„"><a href="#Transformeræ¶æ„" class="headerlink" title="Transformeræ¶æ„"></a>Transformeræ¶æ„</h1><p>Transformer çš„å†…éƒ¨ï¼Œåœ¨æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª Encoder-Decoder çš„ç»“æ„ï¼Œå³ ç¼–ç å™¨-è§£ç å™¨ã€‚<br><img src="https://user-images.githubusercontent.com/6218739/140852001-0fbc70ae-83f7-40c7-b784-4ed205ac30a9.png" alt="2"><br>Transformer ä¸­æŠ›å¼ƒäº†ä¼ ç»Ÿçš„ CNN å’Œ RNNï¼Œæ•´ä¸ªç½‘ç»œç»“æ„å®Œå…¨ç”± Attention æœºåˆ¶ç»„æˆï¼Œå¹¶ä¸”é‡‡ç”¨äº† 6 å±‚ Encoder-Decoder ç»“æ„ã€‚<br><img src="https://user-images.githubusercontent.com/6218739/140852095-d48c5aaa-d167-4169-8b56-5451a8db4416.png" alt="3"><br>æ˜¾ç„¶ï¼ŒTransformer ä¸»è¦åˆ†ä¸ºä¸¤å¤§éƒ¨åˆ†ï¼Œåˆ†åˆ«æ˜¯ç¼–ç å™¨å’Œè§£ç å™¨ã€‚<br>æ•´ä¸ª Transformer æ˜¯ç”± 6 ä¸ªè¿™æ ·çš„ç»“æ„ç»„æˆï¼Œä¸ºäº†æ–¹ä¾¿ç†è§£ï¼Œæˆ‘ä»¬åªçœ‹å…¶ä¸­ä¸€ä¸ªEncoder-Decoder ç»“æ„ã€‚<br>ä»¥ä¸€ä¸ªç®€å•çš„ä¾‹å­è¿›è¡Œè¯´æ˜ï¼š<br><img src="https://user-images.githubusercontent.com/6218739/140852188-a8f1dee3-5b59-489b-ba4e-df8d6664f6da.png" alt="4"></p><p>Why do we work?ï¼Œæˆ‘ä»¬ä¸ºä»€ä¹ˆå·¥ä½œï¼Ÿ<br>å·¦ä¾§çº¢æ¡†æ˜¯ç¼–ç å™¨ï¼Œå³ä¾§çº¢æ¡†æ˜¯è§£ç å™¨ï¼Œ<br>ç¼–ç å™¨è´Ÿè´£æŠŠè‡ªç„¶è¯­è¨€åºåˆ—æ˜ å°„æˆä¸ºéšè—å±‚ï¼ˆä¸Šå›¾ç¬¬2æ­¥ï¼‰ï¼Œå³å«æœ‰è‡ªç„¶è¯­è¨€åºåˆ—çš„æ•°å­¦è¡¨è¾¾ã€‚<br>è§£ç å™¨æŠŠéšè—å±‚å†æ˜ å°„ä¸ºè‡ªç„¶è¯­è¨€åºåˆ—ï¼Œä»è€Œä½¿æˆ‘ä»¬å¯ä»¥è§£å†³å„ç§é—®é¢˜ï¼Œå¦‚æƒ…æ„Ÿåˆ†æã€æœºå™¨ç¿»è¯‘ã€æ‘˜è¦ç”Ÿæˆã€è¯­ä¹‰å…³ç³»æŠ½å–ç­‰ã€‚<br>ç®€å•è¯´ä¸‹ï¼Œä¸Šå›¾æ¯ä¸€æ­¥éƒ½åšäº†ä»€ä¹ˆï¼š<br>ï¼ˆ1ï¼‰è¾“å…¥è‡ªç„¶è¯­è¨€åºåˆ—åˆ°ç¼–ç å™¨: Why do we work?ï¼›<br>ï¼ˆ2ï¼‰ç¼–ç å™¨è¾“å‡ºçš„éšè—å±‚ï¼Œå†è¾“å…¥åˆ°è§£ç å™¨ï¼›<br>ï¼ˆ3ï¼‰è¾“å…¥ $&lt;ğ‘ ğ‘¡ğ‘ğ‘Ÿğ‘¡&gt;$ç¬¦å·åˆ°è§£ç å™¨ï¼›<br>ï¼ˆ4ï¼‰è§£ç å™¨å¾—åˆ°ç¬¬ä¸€ä¸ªå­—â€ä¸ºâ€ï¼›<br>ï¼ˆ5ï¼‰å°†å¾—åˆ°çš„ç¬¬ä¸€ä¸ªå­—â€ä¸ºâ€è½ä¸‹æ¥å†è¾“å…¥åˆ°è§£ç å™¨ï¼›<br>ï¼ˆ6ï¼‰è§£ç å™¨å¾—åˆ°ç¬¬äºŒä¸ªå­—â€ä»€â€ï¼›<br>ï¼ˆ7ï¼‰å°†å¾—åˆ°çš„ç¬¬äºŒå­—å†è½ä¸‹æ¥ï¼Œç›´åˆ°è§£ç å™¨è¾“å‡º $&lt;ğ‘’ğ‘›ğ‘‘&gt;$ï¼Œå³åºåˆ—ç”Ÿæˆå®Œæˆã€‚</p><h2 id="ç¼–ç å™¨"><a href="#ç¼–ç å™¨" class="headerlink" title="ç¼–ç å™¨"></a>ç¼–ç å™¨</h2><p>ç¼–ç å™¨å³æ˜¯æŠŠè‡ªç„¶è¯­è¨€åºåˆ—æ˜ å°„ä¸ºéšè—å±‚çš„æ•°å­¦è¡¨è¾¾çš„è¿‡ç¨‹ã€‚<br>ä¸ºäº†æ–¹ä¾¿å­¦ä¹ ï¼Œç¼–ç å™¨å¯ä»¥åˆ†ä¸º 4 ä¸ªéƒ¨åˆ†ï¼š<br><img src="https://user-images.githubusercontent.com/6218739/140853558-6b30feb1-7ca3-495b-8c6f-a1456d67be8d.png" alt="5"></p><h3 id="ä½ç½®åµŒå…¥ï¼ˆğ‘ğ‘œğ‘ ğ‘–ğ‘¡ğ‘–ğ‘œğ‘›ğ‘ğ‘™-ğ‘’ğ‘›ğ‘ğ‘œğ‘‘ğ‘–ğ‘›ğ‘”ï¼‰"><a href="#ä½ç½®åµŒå…¥ï¼ˆğ‘ğ‘œğ‘ ğ‘–ğ‘¡ğ‘–ğ‘œğ‘›ğ‘ğ‘™-ğ‘’ğ‘›ğ‘ğ‘œğ‘‘ğ‘–ğ‘›ğ‘”ï¼‰" class="headerlink" title="ä½ç½®åµŒå…¥ï¼ˆğ‘ğ‘œğ‘ ğ‘–ğ‘¡ğ‘–ğ‘œğ‘›ğ‘ğ‘™ ğ‘’ğ‘›ğ‘ğ‘œğ‘‘ğ‘–ğ‘›ğ‘”ï¼‰"></a>ä½ç½®åµŒå…¥ï¼ˆğ‘ğ‘œğ‘ ğ‘–ğ‘¡ğ‘–ğ‘œğ‘›ğ‘ğ‘™ ğ‘’ğ‘›ğ‘ğ‘œğ‘‘ğ‘–ğ‘›ğ‘”ï¼‰</h3><p>æˆ‘ä»¬è¾“å…¥æ•°æ® X ç»´åº¦ä¸º[batch size, sequence length]çš„æ•°æ®ï¼Œæ¯”å¦‚æˆ‘ä»¬ä¸ºä»€ä¹ˆå·¥ä½œã€‚<br>batch size å°±æ˜¯ batch çš„å¤§å°ï¼Œè¿™é‡Œåªæœ‰ä¸€å¥è¯ï¼Œæ‰€ä»¥ batch size ä¸º 1ï¼Œsequence length æ˜¯å¥å­çš„é•¿åº¦ï¼Œä¸€å…± 7 ä¸ªå­—ï¼Œæ‰€ä»¥è¾“å…¥çš„æ•°æ®ç»´åº¦æ˜¯ [1, 7]ã€‚<br>æˆ‘ä»¬ä¸èƒ½ç›´æ¥å°†è¿™å¥è¯è¾“å…¥åˆ°ç¼–ç å™¨ä¸­ï¼Œå› ä¸º Tranformer ä¸è®¤è¯†ï¼Œæˆ‘ä»¬éœ€è¦å…ˆè¿›è¡Œå­—åµŒå…¥ï¼Œå³å¾—åˆ°å›¾ä¸­çš„$X_{embedding}$ã€‚</p><p>ç®€å•ç‚¹è¯´ï¼Œå°±æ˜¯æ–‡å­—åˆ°å­—å‘é‡çš„è½¬æ¢ï¼Œè¿™ç§è½¬æ¢æ˜¯å°†æ–‡å­—è½¬æ¢ä¸ºè®¡ç®—æœºè®¤è¯†çš„æ•°å­¦è¡¨ç¤ºï¼Œç”¨åˆ°çš„æ–¹æ³•å°±æ˜¯Word2Vecï¼ŒWord2Vecçš„å…·ä½“ç»†èŠ‚ï¼Œå¯¹äºåˆå­¦è€…æš‚ä¸”ä¸ç”¨äº†è§£ï¼Œè¿™ä¸ªæ˜¯å¯ä»¥ç›´æ¥ä½¿ç”¨çš„ã€‚</p><p>å¾—åˆ°çš„$X{embedding}$çš„ç»´åº¦æ˜¯[batch size, sequence length, embedding dimension]ï¼Œembedding dimension çš„å¤§å°ç”± Word2Vec ç®—æ³•å†³å®šï¼ŒTranformer é‡‡ç”¨ 512 é•¿åº¦çš„å­—å‘é‡ã€‚æ‰€ä»¥$X_{embedding}$çš„ç»´åº¦æ˜¯[1, 7, 512]ã€‚</p><p>è‡³æ­¤ï¼Œè¾“å…¥çš„æˆ‘ä»¬ä¸ºä»€ä¹ˆå·¥ä½œï¼Œå¯ä»¥ç”¨ä¸€ä¸ªçŸ©é˜µæ¥ç®€åŒ–è¡¨ç¤ºã€‚<br><img src="https://user-images.githubusercontent.com/6218739/140853602-a6f68d15-8308-4b0d-b067-abb5d9a7e098.png" alt="6"><br>æˆ‘ä»¬çŸ¥é“ï¼Œæ–‡å­—çš„å…ˆåé¡ºåºï¼Œå¾ˆé‡è¦ã€‚<br>æ¯”å¦‚åƒé¥­æ²¡ã€æ²¡åƒé¥­ã€æ²¡é¥­åƒã€é¥­åƒæ²¡ã€é¥­æ²¡åƒï¼ŒåŒæ ·ä¸‰ä¸ªå­—ï¼Œé¡ºåºé¢ å€’ï¼Œæ‰€è¡¨è¾¾çš„å«ä¹‰å°±ä¸åŒäº†ã€‚<br>æ–‡å­—çš„ä½ç½®ä¿¡æ¯å¾ˆé‡è¦ï¼ŒTranformer æ²¡æœ‰ç±»ä¼¼ RNN çš„å¾ªç¯ç»“æ„ï¼Œæ²¡æœ‰æ•æ‰é¡ºåºåºåˆ—çš„èƒ½åŠ›ã€‚<br>ä¸ºäº†ä¿ç•™è¿™ç§ä½ç½®ä¿¡æ¯äº¤ç»™ Tranformer å­¦ä¹ ï¼Œæˆ‘ä»¬éœ€è¦ç”¨åˆ°ä½ç½®åµŒå…¥ã€‚<br>åŠ å…¥ä½ç½®ä¿¡æ¯çš„æ–¹å¼éå¸¸å¤šï¼Œæœ€ç®€å•çš„å¯ä»¥æ˜¯ç›´æ¥å°†ç»å¯¹åæ ‡ 0,1,2 ç¼–ç ã€‚<br>Tranformer é‡‡ç”¨çš„æ˜¯ sin-cos è§„åˆ™ï¼Œä½¿ç”¨äº† sin å’Œ cos å‡½æ•°çš„çº¿æ€§å˜æ¢æ¥æä¾›ç»™æ¨¡å‹ä½ç½®ä¿¡æ¯ï¼š</p><script type="math/tex; mode=display">\begin{aligned} P E_{(p o s, 2 i)} &=\sin \left(p o s / 10000^{2 i / d_{\text {model }}}\right) \\ P E_{(\text {pos }, 2 i+1)} &=\cos \left(\text { pos } / 10000^{2 i / d_{\text {model }}}\right) \end{aligned}</script><p>ä¸Šå¼ä¸­ pos æŒ‡çš„æ˜¯å¥ä¸­å­—çš„ä½ç½®ï¼Œå–å€¼èŒƒå›´æ˜¯ [0, ğ‘šğ‘ğ‘¥ ğ‘ ğ‘’ğ‘ğ‘¢ğ‘’ğ‘›ğ‘ğ‘’ ğ‘™ğ‘’ğ‘›ğ‘”ğ‘¡â„)ï¼Œi æŒ‡çš„æ˜¯å­—åµŒå…¥çš„ç»´åº¦, å–å€¼èŒƒå›´æ˜¯ [0, ğ‘’ğ‘šğ‘ğ‘’ğ‘‘ğ‘‘ğ‘–ğ‘›ğ‘” ğ‘‘ğ‘–ğ‘šğ‘’ğ‘›ğ‘ ğ‘–ğ‘œğ‘›)ã€‚<br>ä¸Šé¢æœ‰ sin å’Œ cos ä¸€ç»„å…¬å¼ï¼Œä¹Ÿå°±æ˜¯å¯¹åº”ç€ ğ‘’ğ‘šğ‘ğ‘’ğ‘‘ğ‘‘ğ‘–ğ‘›ğ‘” ğ‘‘ğ‘–ğ‘šğ‘’ğ‘›ğ‘ ğ‘–ğ‘œğ‘› ç»´åº¦çš„ä¸€ç»„å¥‡æ•°å’Œå¶æ•°çš„åºå·çš„ç»´åº¦ï¼Œä»è€Œäº§ç”Ÿä¸åŒçš„å‘¨æœŸæ€§å˜åŒ–ã€‚<br>å¯ä»¥ç”¨ä»£ç ï¼Œç®€å•çœ‹ä¸‹æ•ˆæœã€‚<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¯¼å…¥ä¾èµ–åº“</span></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> seaborn <span class="keyword">as</span> sns</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_positional_encoding</span>(<span class="params">max_seq_len, embed_dim</span>):</span></span><br><span class="line">    <span class="comment"># åˆå§‹åŒ–ä¸€ä¸ªpositional encoding</span></span><br><span class="line">    <span class="comment"># embed_dim: å­—åµŒå…¥çš„ç»´åº¦</span></span><br><span class="line">    <span class="comment"># max_seq_len: æœ€å¤§çš„åºåˆ—é•¿åº¦</span></span><br><span class="line">    positional_encoding = np.array([</span><br><span class="line">        [pos / np.power(<span class="number">10000</span>, <span class="number">2</span> * i / embed_dim) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(embed_dim)]</span><br><span class="line">        <span class="keyword">if</span> pos != <span class="number">0</span> <span class="keyword">else</span> np.zeros(embed_dim) <span class="keyword">for</span> pos <span class="keyword">in</span> <span class="built_in">range</span>(max_seq_len)])</span><br><span class="line">    positional_encoding[<span class="number">1</span>:, <span class="number">0</span>::<span class="number">2</span>] = np.sin(positional_encoding[<span class="number">1</span>:, <span class="number">0</span>::<span class="number">2</span>])  <span class="comment"># dim 2i å¶æ•°</span></span><br><span class="line">    positional_encoding[<span class="number">1</span>:, <span class="number">1</span>::<span class="number">2</span>] = np.cos(positional_encoding[<span class="number">1</span>:, <span class="number">1</span>::<span class="number">2</span>])  <span class="comment"># dim 2i+1 å¥‡æ•°</span></span><br><span class="line">    <span class="comment"># å½’ä¸€åŒ–, ç”¨ä½ç½®åµŒå…¥çš„æ¯ä¸€è¡Œé™¤ä»¥å®ƒçš„æ¨¡é•¿</span></span><br><span class="line">    <span class="comment"># denominator = np.sqrt(np.sum(position_enc**2, axis=1, keepdims=True))</span></span><br><span class="line">    <span class="comment"># position_enc = position_enc / (denominator + 1e-8)</span></span><br><span class="line">    <span class="keyword">return</span> positional_encoding</span><br><span class="line">    </span><br><span class="line">positional_encoding = get_positional_encoding(max_seq_len=<span class="number">100</span>, embed_dim=<span class="number">16</span>)</span><br><span class="line">plt.figure(figsize=(<span class="number">10</span>,<span class="number">10</span>))</span><br><span class="line">sns.heatmap(positional_encoding)</span><br><span class="line">plt.title(<span class="string">&quot;Sinusoidal Function&quot;</span>)</span><br><span class="line">plt.xlabel(<span class="string">&quot;hidden dimension&quot;</span>)</span><br><span class="line">plt.ylabel(<span class="string">&quot;sequence length&quot;</span>)</span><br></pre></td></tr></table></figure><br>å¯ä»¥çœ‹åˆ°ï¼Œä½ç½®åµŒå…¥åœ¨ ğ‘’ğ‘šğ‘ğ‘’ğ‘‘ğ‘‘ğ‘–ğ‘›ğ‘” ğ‘‘ğ‘–ğ‘šğ‘’ğ‘›ğ‘ ğ‘–ğ‘œğ‘› ï¼ˆä¹Ÿæ˜¯hidden dimension ï¼‰ç»´åº¦ä¸Šéšç€ç»´åº¦åºå·å¢å¤§ï¼Œå‘¨æœŸå˜åŒ–ä¼šè¶Šæ¥è¶Šæ…¢ï¼Œè€Œäº§ç”Ÿä¸€ç§åŒ…å«ä½ç½®ä¿¡æ¯çš„çº¹ç†ã€‚<br><img src="https://user-images.githubusercontent.com/6218739/140854019-3e363d94-cefe-4772-a7f2-fa87de1eb41b.png" alt="embed"><br>å°±è¿™æ ·ï¼Œäº§ç”Ÿç‹¬ä¸€çš„çº¹ç†ä½ç½®ä¿¡æ¯ï¼Œæ¨¡å‹ä»è€Œå­¦åˆ°ä½ç½®ä¹‹é—´çš„ä¾èµ–å…³ç³»å’Œè‡ªç„¶è¯­è¨€çš„æ—¶åºç‰¹æ€§ã€‚<br>æœ€åï¼Œå°†$X_{\text {embedding }}$å’Œ ä½ç½®åµŒå…¥ ç›¸åŠ ï¼ˆç»´åº¦ç›¸åŒï¼Œå¯ä»¥ç›´æ¥ç›¸åŠ ï¼‰ï¼Œå¾—åˆ°è¯¥å­—çœŸæ­£çš„å‘é‡è¡¨ç¤ºï¼Œç„¶åé€ç»™ä¸‹ä¸€å±‚ã€‚</p><h3 id="è‡ªæ³¨æ„åŠ›å±‚ï¼ˆğ‘ ğ‘’ğ‘™ğ‘“-ğ‘ğ‘¡ğ‘¡ğ‘’ğ‘›ğ‘¡ğ‘–ğ‘œğ‘›-ğ‘šğ‘’ğ‘â„ğ‘ğ‘›ğ‘–ğ‘ ğ‘šï¼‰"><a href="#è‡ªæ³¨æ„åŠ›å±‚ï¼ˆğ‘ ğ‘’ğ‘™ğ‘“-ğ‘ğ‘¡ğ‘¡ğ‘’ğ‘›ğ‘¡ğ‘–ğ‘œğ‘›-ğ‘šğ‘’ğ‘â„ğ‘ğ‘›ğ‘–ğ‘ ğ‘šï¼‰" class="headerlink" title="è‡ªæ³¨æ„åŠ›å±‚ï¼ˆğ‘ ğ‘’ğ‘™ğ‘“ ğ‘ğ‘¡ğ‘¡ğ‘’ğ‘›ğ‘¡ğ‘–ğ‘œğ‘› ğ‘šğ‘’ğ‘â„ğ‘ğ‘›ğ‘–ğ‘ ğ‘šï¼‰"></a>è‡ªæ³¨æ„åŠ›å±‚ï¼ˆğ‘ ğ‘’ğ‘™ğ‘“ ğ‘ğ‘¡ğ‘¡ğ‘’ğ‘›ğ‘¡ğ‘–ğ‘œğ‘› ğ‘šğ‘’ğ‘â„ğ‘ğ‘›ğ‘–ğ‘ ğ‘šï¼‰</h3><p>è¿™éƒ¨åˆ†ä»‹ç»æ¥è‡ªäº<a href="https://terrifyzhao.github.io/2019/01/11/Transformer%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3.html">è¿™ç¯‡åšå®¢</a><br>self-attentionï¼Œå…¶æ€æƒ³å’Œattentionç±»ä¼¼ï¼Œä½†æ˜¯self-attentionæ˜¯Transformerç”¨æ¥å°†å…¶ä»–ç›¸å…³å•è¯çš„â€œç†è§£â€è½¬æ¢æˆæˆ‘ä»¬æ­£åœ¨å¤„ç†çš„å•è¯çš„ä¸€ç§æ€è·¯ï¼Œæˆ‘ä»¬çœ‹ä¸ªä¾‹å­ï¼š The animal didnâ€™t cross the street because it was too tired è¿™é‡Œçš„itåˆ°åº•ä»£è¡¨çš„æ˜¯animalè¿˜æ˜¯streetå‘¢ï¼Œå¯¹äºæˆ‘ä»¬æ¥è¯´èƒ½å¾ˆç®€å•çš„åˆ¤æ–­å‡ºæ¥ï¼Œä½†æ˜¯å¯¹äºæœºå™¨æ¥è¯´ï¼Œæ˜¯å¾ˆéš¾åˆ¤æ–­çš„ï¼Œself-attentionå°±èƒ½å¤Ÿè®©æœºå™¨æŠŠitå’Œanimalè”ç³»èµ·æ¥ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ä¸‹è¯¦ç»†çš„å¤„ç†è¿‡ç¨‹ã€‚<br>ï¼ˆ1ï¼‰é¦–å…ˆï¼Œself-attentionä¼šè®¡ç®—å‡ºä¸‰ä¸ªæ–°çš„å‘é‡ï¼Œåœ¨è®ºæ–‡ä¸­ï¼Œå‘é‡çš„ç»´åº¦æ˜¯512ç»´ï¼Œæˆ‘ä»¬æŠŠè¿™ä¸‰ä¸ªå‘é‡åˆ†åˆ«ç§°ä¸ºQueryã€Keyã€Valueï¼Œè¿™ä¸‰ä¸ªå‘é‡æ˜¯ç”¨embeddingå‘é‡ä¸ä¸€ä¸ªçŸ©é˜µç›¸ä¹˜å¾—åˆ°çš„ç»“æœï¼Œè¿™ä¸ªçŸ©é˜µæ˜¯éšæœºåˆå§‹åŒ–çš„ï¼Œç»´åº¦ä¸ºï¼ˆ64ï¼Œ512ï¼‰ï¼Œæ³¨æ„ç¬¬äºŒä¸ªç»´åº¦éœ€è¦å’Œembeddingçš„ç»´åº¦ä¸€æ ·ï¼Œå…¶å€¼åœ¨BPçš„è¿‡ç¨‹ä¸­ä¼šä¸€ç›´è¿›è¡Œæ›´æ–°ï¼Œå¾—åˆ°çš„è¿™ä¸‰ä¸ªå‘é‡çš„ç»´åº¦æ˜¯64ä½äºembeddingç»´åº¦çš„ã€‚<br><img src="https://user-images.githubusercontent.com/6218739/140857139-71ca395e-ec3a-40c4-8c0d-4c815ceb9e09.png" alt="qkv"><br>é‚£ä¹ˆQueryã€Keyã€Valueè¿™ä¸‰ä¸ªå‘é‡åˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿè¿™ä¸‰ä¸ªå‘é‡å¯¹äºattentionæ¥è¯´å¾ˆé‡è¦ï¼Œå½“ä½ ç†è§£äº†ä¸‹æ–‡åï¼Œä½ å°†ä¼šæ˜ç™½è¿™ä¸‰ä¸ªå‘é‡æ‰®æ¼”è€…ä»€ä¹ˆçš„è§’è‰²ã€‚<br>ï¼ˆ2ï¼‰è®¡ç®—self-attentionçš„åˆ†æ•°å€¼ï¼Œè¯¥åˆ†æ•°å€¼å†³å®šäº†å½“æˆ‘ä»¬åœ¨æŸä¸ªä½ç½®encodeä¸€ä¸ªè¯æ—¶ï¼Œå¯¹è¾“å…¥å¥å­çš„å…¶ä»–éƒ¨åˆ†çš„å…³æ³¨ç¨‹åº¦ã€‚è¿™ä¸ªåˆ†æ•°å€¼çš„è®¡ç®—æ–¹æ³•æ˜¯Queryä¸Keyåšç‚¹ä¹˜ï¼Œä»¥ä¸‹å›¾ä¸ºä¾‹ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦é’ˆå¯¹Thinkingè¿™ä¸ªè¯ï¼Œè®¡ç®—å‡ºå…¶ä»–è¯å¯¹äºè¯¥è¯çš„ä¸€ä¸ªåˆ†æ•°å€¼ï¼Œé¦–å…ˆæ˜¯é’ˆå¯¹äºè‡ªå·±æœ¬èº«å³$q1Â·k1$ï¼Œç„¶åæ˜¯é’ˆå¯¹äºç¬¬äºŒä¸ªè¯å³$q1Â·k2$ã€‚<br><img src="https://user-images.githubusercontent.com/6218739/140857357-91caf198-e459-471b-a800-8ae705ef1434.png" alt="score"><br>ï¼ˆ3ï¼‰æ¥ä¸‹æ¥ï¼ŒæŠŠç‚¹ä¹˜çš„ç»“æœé™¤ä»¥ä¸€ä¸ªå¸¸æ•°ï¼Œè¿™é‡Œæˆ‘ä»¬é™¤ä»¥8ï¼Œè¿™ä¸ªå€¼ä¸€èˆ¬æ˜¯é‡‡ç”¨ä¸Šæ–‡æåˆ°çš„çŸ©é˜µçš„ç¬¬ä¸€ä¸ªç»´åº¦çš„å¼€æ–¹å³64çš„å¼€æ–¹8ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥é€‰æ‹©å…¶ä»–çš„å€¼ï¼Œç„¶åæŠŠå¾—åˆ°çš„ç»“æœåšä¸€ä¸ªsoftmaxçš„è®¡ç®—ã€‚å¾—åˆ°çš„ç»“æœå³æ˜¯æ¯ä¸ªè¯å¯¹äºå½“å‰ä½ç½®çš„è¯çš„ç›¸å…³æ€§å¤§å°ï¼Œå½“ç„¶ï¼Œå½“å‰ä½ç½®çš„è¯ç›¸å…³æ€§è‚¯å®šä¼šå¾ˆå¤§ã€‚<br><img src="https://user-images.githubusercontent.com/6218739/140857512-c22f2546-25e5-449d-8632-6cdffd1dc4fe.png" alt="score2"><br>ï¼ˆ4ï¼‰ä¸‹ä¸€æ­¥å°±æ˜¯æŠŠValueå’Œsoftmaxå¾—åˆ°çš„å€¼è¿›è¡Œç›¸ä¹˜ï¼Œå¹¶ç›¸åŠ ï¼Œå¾—åˆ°çš„ç»“æœå³æ˜¯self-attentionåœ¨å½“å‰èŠ‚ç‚¹çš„å€¼ã€‚<br><img src="https://user-images.githubusercontent.com/6218739/140857653-468ca02a-3dfb-4d33-a8b9-36f8596f9f15.png" alt="score3"><br>åœ¨å®é™…çš„åº”ç”¨åœºæ™¯ï¼Œä¸ºäº†æé«˜è®¡ç®—é€Ÿåº¦ï¼Œæˆ‘ä»¬é‡‡ç”¨çš„æ˜¯çŸ©é˜µçš„æ–¹å¼ï¼Œç›´æ¥è®¡ç®—å‡ºQuery, Key, Valueçš„çŸ©é˜µï¼Œç„¶åæŠŠembeddingçš„å€¼ä¸ä¸‰ä¸ªçŸ©é˜µç›´æ¥ç›¸ä¹˜ï¼ŒæŠŠå¾—åˆ°çš„æ–°çŸ©é˜µQä¸Kç›¸ä¹˜ï¼Œä¹˜ä»¥ä¸€ä¸ªå¸¸æ•°ï¼Œåšsoftmaxæ“ä½œï¼Œæœ€åä¹˜ä¸ŠVçŸ©é˜µï¼š<br><img src="https://user-images.githubusercontent.com/6218739/140857883-d06b029d-99ec-4a28-8711-35b0d4425f53.png" alt="attention"><br><img src="https://user-images.githubusercontent.com/6218739/140857941-c6f16054-2104-4205-850b-d15bc96a6659.png" alt="attention2"><br>è¿™ç§é€šè¿‡ query å’Œ key çš„ç›¸ä¼¼æ€§ç¨‹åº¦æ¥ç¡®å®š value çš„æƒé‡åˆ†å¸ƒçš„æ–¹æ³•è¢«ç§°ä¸ºscaled dot-product attentionã€‚</p><h4 id="Multi-Headed-Attention"><a href="#Multi-Headed-Attention" class="headerlink" title="Multi-Headed Attention"></a>Multi-Headed Attention</h4><p>è¿™ç¯‡è®ºæ–‡æ›´ç‰›çš„åœ°æ–¹æ˜¯ç»™self-attentionåŠ å…¥äº†å¦å¤–ä¸€ä¸ªæœºåˆ¶ï¼Œè¢«ç§°ä¸ºâ€œmulti-headedâ€ attentionï¼Œè¯¥æœºåˆ¶ç†è§£èµ·æ¥å¾ˆç®€å•ï¼Œå°±æ˜¯è¯´ä¸ä»…ä»…åªåˆå§‹åŒ–ä¸€ç»„Qã€Kã€Vçš„çŸ©é˜µï¼Œè€Œæ˜¯åˆå§‹åŒ–å¤šç»„ï¼Œtranformeræ˜¯ä½¿ç”¨äº†8ç»„ï¼Œæ‰€ä»¥æœ€åå¾—åˆ°çš„ç»“æœæ˜¯8ä¸ªçŸ©é˜µã€‚<br><img src="https://user-images.githubusercontent.com/6218739/140868505-278beff7-e9dc-440d-87ad-b2a021310a59.png" alt="multihead1"><br><img src="https://user-images.githubusercontent.com/6218739/140868544-311c039e-252c-425f-b957-3d1f2eece542.png" alt="multihead2"><br>è¿™ç»™æˆ‘ä»¬ç•™ä¸‹äº†ä¸€ä¸ªå°çš„æŒ‘æˆ˜ï¼Œå‰é¦ˆç¥ç»ç½‘ç»œæ²¡æ³•è¾“å…¥8ä¸ªçŸ©é˜µå‘€ï¼Œè¿™è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ç§æ–¹å¼ï¼ŒæŠŠ8ä¸ªçŸ©é˜µé™ä¸º1ä¸ªï¼Œé¦–å…ˆï¼Œæˆ‘ä»¬æŠŠ8ä¸ªçŸ©é˜µè¿åœ¨ä¸€èµ·ï¼Œè¿™æ ·ä¼šå¾—åˆ°ä¸€ä¸ªå¤§çš„çŸ©é˜µï¼Œå†éšæœºåˆå§‹åŒ–ä¸€ä¸ªçŸ©é˜µå’Œè¿™ä¸ªç»„åˆå¥½çš„çŸ©é˜µç›¸ä¹˜ï¼Œæœ€åå¾—åˆ°ä¸€ä¸ªæœ€ç»ˆçš„çŸ©é˜µã€‚<br><img src="https://user-images.githubusercontent.com/6218739/140868642-638e7a9f-6543-4068-b569-12984bc7b5be.png" alt="multihead3"><br>è¿™å°±æ˜¯multi-headed attentionçš„å…¨éƒ¨æµç¨‹äº†ï¼Œè¿™é‡Œå…¶å®å·²ç»æœ‰å¾ˆå¤šçŸ©é˜µäº†ï¼Œæˆ‘ä»¬æŠŠæ‰€æœ‰çš„çŸ©é˜µæ”¾åˆ°ä¸€å¼ å›¾å†…çœ‹ä¸€ä¸‹æ€»ä½“çš„æµç¨‹ã€‚<br><img src="https://user-images.githubusercontent.com/6218739/140868817-3f900670-e211-4395-bb5a-2e9625ed3644.png" alt="multihead4"></p><h3 id="æ®‹å·®é“¾æ¥å’Œå±‚å½’ä¸€åŒ–"><a href="#æ®‹å·®é“¾æ¥å’Œå±‚å½’ä¸€åŒ–" class="headerlink" title="æ®‹å·®é“¾æ¥å’Œå±‚å½’ä¸€åŒ–"></a>æ®‹å·®é“¾æ¥å’Œå±‚å½’ä¸€åŒ–</h3><p>åŠ å…¥äº†æ®‹å·®è®¾è®¡å’Œå±‚å½’ä¸€åŒ–æ“ä½œï¼Œç›®çš„æ˜¯ä¸ºäº†é˜²æ­¢æ¢¯åº¦æ¶ˆå¤±ï¼ŒåŠ å¿«æ”¶æ•›ã€‚</p><h4 id="æ®‹å·®è®¾è®¡"><a href="#æ®‹å·®è®¾è®¡" class="headerlink" title="æ®‹å·®è®¾è®¡"></a>æ®‹å·®è®¾è®¡</h4><p>æˆ‘ä»¬åœ¨ä¸Šä¸€æ­¥å¾—åˆ°äº†ç»è¿‡æ³¨æ„åŠ›çŸ©é˜µåŠ æƒä¹‹åçš„ $ğ‘‰$ï¼Œ ä¹Ÿå°±æ˜¯$ğ´ğ‘¡ğ‘¡ğ‘’ğ‘›ğ‘¡ğ‘–ğ‘œğ‘›(ğ‘„, ğ¾, ğ‘‰)$ï¼Œæˆ‘ä»¬å¯¹å®ƒè¿›è¡Œä¸€ä¸‹è½¬ç½®ï¼Œä½¿å…¶å’Œ$X_{\text {embedding }}$ çš„ç»´åº¦ä¸€è‡´, ä¹Ÿå°±æ˜¯ [ğ‘ğ‘ğ‘¡ğ‘â„ ğ‘ ğ‘–ğ‘§ğ‘’, ğ‘ ğ‘’ğ‘ğ‘¢ğ‘’ğ‘›ğ‘ğ‘’ ğ‘™ğ‘’ğ‘›ğ‘”ğ‘¡â„, ğ‘’ğ‘šğ‘ğ‘’ğ‘‘ğ‘‘ğ‘–ğ‘›ğ‘” ğ‘‘ğ‘–ğ‘šğ‘’ğ‘›ğ‘ ğ‘–ğ‘œğ‘›]ï¼Œç„¶åæŠŠä»–ä»¬åŠ èµ·æ¥åšæ®‹å·®è¿æ¥ï¼Œç›´æ¥è¿›è¡Œå…ƒç´ ç›¸åŠ ï¼Œå› ä¸ºä»–ä»¬çš„ç»´åº¦ä¸€è‡´:</p><script type="math/tex; mode=display">X_{embedding} + Attention(Q, \ K, \ V)</script><p>åœ¨ä¹‹åçš„è¿ç®—é‡Œï¼Œæ¯ç»è¿‡ä¸€ä¸ªæ¨¡å—çš„è¿ç®—ï¼Œéƒ½è¦æŠŠè¿ç®—ä¹‹å‰çš„å€¼å’Œè¿ç®—ä¹‹åçš„å€¼ç›¸åŠ ï¼Œä»è€Œå¾—åˆ°æ®‹å·®è¿æ¥ï¼Œè®­ç»ƒçš„æ—¶å€™å¯ä»¥ä½¿æ¢¯åº¦ç›´æ¥èµ°æ·å¾„åä¼ åˆ°æœ€åˆå§‹å±‚ï¼š</p><script type="math/tex; mode=display">X + SubLayer(X)</script><h4 id="å±‚å½’ä¸€åŒ–"><a href="#å±‚å½’ä¸€åŒ–" class="headerlink" title="å±‚å½’ä¸€åŒ–"></a>å±‚å½’ä¸€åŒ–</h4><p>Normalizationæœ‰å¾ˆå¤šç§ï¼Œä½†æ˜¯å®ƒä»¬éƒ½æœ‰ä¸€ä¸ªå…±åŒçš„ç›®çš„ï¼Œé‚£å°±æ˜¯æŠŠè¾“å…¥è½¬åŒ–æˆå‡å€¼ä¸º0æ–¹å·®ä¸º1çš„æ•°æ®ã€‚æˆ‘ä»¬åœ¨æŠŠæ•°æ®é€å…¥æ¿€æ´»å‡½æ•°ä¹‹å‰è¿›è¡Œnormalizationï¼ˆå½’ä¸€åŒ–ï¼‰ï¼Œå› ä¸ºæˆ‘ä»¬ä¸å¸Œæœ›è¾“å…¥æ•°æ®è½åœ¨æ¿€æ´»å‡½æ•°çš„é¥±å’ŒåŒºã€‚<br>è¯´åˆ° normalizationï¼Œé‚£å°±è‚¯å®šå¾—æåˆ° Batch Normalizationã€‚BNçš„ä¸»è¦æ€æƒ³å°±æ˜¯ï¼šåœ¨æ¯ä¸€å±‚çš„æ¯ä¸€æ‰¹æ•°æ®ä¸Šè¿›è¡Œå½’ä¸€åŒ–ã€‚æˆ‘ä»¬å¯èƒ½ä¼šå¯¹è¾“å…¥æ•°æ®è¿›è¡Œå½’ä¸€åŒ–ï¼Œä½†æ˜¯ç»è¿‡è¯¥ç½‘ç»œå±‚çš„ä½œç”¨åï¼Œæˆ‘ä»¬çš„æ•°æ®å·²ç»ä¸å†æ˜¯å½’ä¸€åŒ–çš„äº†ã€‚éšç€è¿™ç§æƒ…å†µçš„å‘å±•ï¼Œæ•°æ®çš„åå·®è¶Šæ¥è¶Šå¤§ï¼Œæˆ‘çš„åå‘ä¼ æ’­éœ€è¦è€ƒè™‘åˆ°è¿™äº›å¤§çš„åå·®ï¼Œè¿™å°±è¿«ä½¿æˆ‘ä»¬åªèƒ½ä½¿ç”¨è¾ƒå°çš„å­¦ä¹ ç‡æ¥é˜²æ­¢æ¢¯åº¦æ¶ˆå¤±æˆ–è€…æ¢¯åº¦çˆ†ç‚¸ã€‚<br>BNçš„å…·ä½“åšæ³•å°±æ˜¯å¯¹æ¯ä¸€å°æ‰¹æ•°æ®ï¼Œåœ¨æ‰¹è¿™ä¸ªæ–¹å‘ä¸Šåšå½’ä¸€åŒ–ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="https://user-images.githubusercontent.com/6218739/140869917-059093b6-d8c7-462e-9926-ecdb6101f898.png" alt="BN"><br>å¯ä»¥çœ‹åˆ°ï¼Œå³åŠè¾¹æ±‚å‡å€¼æ˜¯æ²¿ç€æ•°æ® batch_sizeçš„æ–¹å‘è¿›è¡Œçš„ï¼Œå…¶è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">BN(x_i)=\alpha Ã— \frac{x_i-\mu_b}{\sqrt{\sigma^2_B+\epsilon}}+\beta</script><p>é‚£ä¹ˆä»€ä¹ˆæ˜¯ Layer normalization å‘¢ï¼Ÿå®ƒä¹Ÿæ˜¯å½’ä¸€åŒ–æ•°æ®çš„ä¸€ç§æ–¹å¼ï¼Œä¸è¿‡ LN æ˜¯åœ¨æ¯ä¸€ä¸ªæ ·æœ¬ä¸Šè®¡ç®—å‡å€¼å’Œæ–¹å·®ï¼Œè€Œä¸æ˜¯BNé‚£ç§åœ¨æ‰¹æ–¹å‘è®¡ç®—å‡å€¼å’Œæ–¹å·®ï¼<br><img src="https://user-images.githubusercontent.com/6218739/140870020-f7fb5f4e-d6de-4838-9dbb-e809e0f2fdec.png" alt="LN"><br>LNçš„å…¬å¼ä¸ºï¼š</p><script type="math/tex; mode=display">LN(x_i)=\alpha Ã— \frac{x_i-\mu_L}{\sqrt{\sigma^2_L+\epsilon}}+\beta</script><h3 id="å‰é¦ˆç½‘ç»œ"><a href="#å‰é¦ˆç½‘ç»œ" class="headerlink" title="å‰é¦ˆç½‘ç»œ"></a>å‰é¦ˆç½‘ç»œ</h3><p>å‰é¦ˆç½‘ç»œFeedForwardï¼Œå…¶å®å°±æ˜¯ä¸¤å±‚çº¿æ€§æ˜ å°„å¹¶ç”¨æ¿€æ´»å‡½æ•°æ¿€æ´»ã€‚<br>ç„¶åç»è¿‡è¿™ä¸ªç½‘ç»œæ¿€æ´»åï¼Œå†ç»è¿‡ä¸€ä¸ªæ®‹å·®è¿æ¥å’Œå±‚å½’ä¸€åŒ–ï¼Œå³å¯è¾“å‡ºã€‚<br>ç›´æ¥çœ‹ä»£ç å¯èƒ½æ›´ç›´è§‚ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PositionwiseFeedForward</span>(<span class="params">nn.Module</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27; A two-feed-forward-layer module &#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, d_in, d_hid, dropout=<span class="number">0.1</span></span>):</span></span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        <span class="comment"># ä¸¤ä¸ªfcå±‚ï¼Œå¯¹æœ€åçš„512ç»´åº¦è¿›è¡Œå˜æ¢</span></span><br><span class="line">        self.w_1 = nn.Linear(d_in, d_hid) <span class="comment"># position-wise</span></span><br><span class="line">        self.w_2 = nn.Linear(d_hid, d_in) <span class="comment"># position-wise</span></span><br><span class="line">        self.layer_norm = nn.LayerNorm(d_in, eps=<span class="number">1e-6</span>)</span><br><span class="line">        self.dropout = nn.Dropout(dropout)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span>(<span class="params">self, x</span>):</span></span><br><span class="line">        residual = x</span><br><span class="line"></span><br><span class="line">        x = self.w_2(F.relu(self.w_1(x)))</span><br><span class="line">        x = self.dropout(x)</span><br><span class="line">        x += residual</span><br><span class="line"></span><br><span class="line">        x = self.layer_norm(x)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> x</span><br></pre></td></tr></table></figure></p><h3 id="ç¼–ç å™¨æ€»ç»“"><a href="#ç¼–ç å™¨æ€»ç»“" class="headerlink" title="ç¼–ç å™¨æ€»ç»“"></a>ç¼–ç å™¨æ€»ç»“</h3><p>ç»è¿‡ä¸Šé¢ 3 ä¸ªæ­¥éª¤ï¼Œæˆ‘ä»¬å·²ç»åŸºæœ¬äº†è§£äº† Encoder çš„ä¸»è¦æ„æˆéƒ¨åˆ†ã€‚<br>ç”¨ä¸€ä¸ªæ›´ç›´è§‚çš„å›¾è¡¨ç¤ºå¦‚ä¸‹ï¼š<br><img src="https://user-images.githubusercontent.com/6218739/140872426-955ab9c0-842e-444c-947b-b6d9292a4fe1.png" alt="encoder"><br>æ–‡å­—æè¿°ä¸ºï¼š<br>è¾“å…¥$x_1,x_2$ç» self-attention å±‚ä¹‹åå˜æˆ$z_1,z_2$ ï¼Œç„¶åå’Œè¾“å…¥$x_1,x_2$è¿›è¡Œæ®‹å·®è¿æ¥ï¼Œç»è¿‡ LayerNorm åè¾“å‡ºç»™å…¨è¿æ¥å±‚ã€‚å…¨è¿æ¥å±‚ä¹Ÿæœ‰ä¸€ä¸ªæ®‹å·®è¿æ¥å’Œä¸€ä¸ª LayerNormï¼Œæœ€åå†è¾“å‡ºç»™ä¸‹ä¸€ä¸ª Encoderï¼ˆæ¯ä¸ª Encoder Block ä¸­çš„ FeedForward å±‚æƒé‡éƒ½æ˜¯å…±äº«çš„ï¼‰<br>å…¬å¼æè¿°ä¸ºï¼š<br>ï¼ˆ1ï¼‰å­—å‘é‡ä¸ä½ç½®ç¼–ç </p><script type="math/tex; mode=display">X = \text{Embedding-Lookup}(X) + \text{Positional-Encoding}</script><p>ï¼ˆ2ï¼‰è‡ªæ³¨æ„åŠ›æœºåˆ¶</p><script type="math/tex; mode=display">\begin{align}Q &= \text{Linear}_q(X) = XW_{Q}\\K &= \text{Linear}_k(X) = XW_{K}\\V &= \text{Linear}_v(X) = XW_{V}\\X_{attention} &= \text{Self-Attention}(Q,K,V)\end{align}</script><p>ï¼ˆ3ï¼‰self-attention æ®‹å·®è¿æ¥ä¸ Layer Normalization</p><script type="math/tex; mode=display">\begin{align}X_{attention} &= X + X_{attention}\\X_{attention} &= \text{LayerNorm}(X_{attention})\end{align}</script><p>ï¼ˆ4ï¼‰å‰é¦ˆç½‘ç»œFeedForward</p><script type="math/tex; mode=display">X_{hidden} = \text{Linear}(\text{ReLU}(\text{Linear}(X_{attention})))</script><p>ï¼ˆ5ï¼‰FeedForward æ®‹å·®è¿æ¥ä¸ Layer Normalization</p><script type="math/tex; mode=display">\begin{align}X_{hidden} &= X_{attention} + X_{hidden}\\X_{hidden} &= \text{LayerNorm}(X_{hidden})\end{align}</script><p>å…¶ä¸­ï¼š</p><script type="math/tex; mode=display">X_{hidden} \in \mathbb{R}^{batch\_size  \ * \  seq\_len. \  * \  embed\_dim}</script><h2 id="è§£ç å™¨"><a href="#è§£ç å™¨" class="headerlink" title="è§£ç å™¨"></a>è§£ç å™¨</h2><p>è§<a href="https://wmathor.com/index.php/archives/1438/">åŸæ–‡</a>ã€‚<br>Decoderæ¶æ„å¦‚ä¸‹ï¼š<br><img src="https://user-images.githubusercontent.com/6218739/140873135-92be1693-5efe-4998-9c6b-9071a3c96fae.png" alt="decoder"><br>æˆ‘ä»¬å…ˆä» HighLevel çš„è§’åº¦è§‚å¯Ÿä¸€ä¸‹ Decoder ç»“æ„ï¼Œä»ä¸‹åˆ°ä¸Šä¾æ¬¡æ˜¯ï¼š<br>ï¼ˆ1ï¼‰Masked Multi-Head Self-Attention<br>ï¼ˆ2ï¼‰Multi-Head Encoder-Decoder Attention<br>ï¼ˆ3ï¼‰FeedForward Network<br>å’Œ Encoder ä¸€æ ·ï¼Œä¸Šé¢ä¸‰ä¸ªéƒ¨åˆ†çš„æ¯ä¸€ä¸ªéƒ¨åˆ†ï¼Œéƒ½æœ‰ä¸€ä¸ªæ®‹å·®è¿æ¥ï¼Œåæ¥ä¸€ä¸ª Layer Normalizationã€‚Decoder çš„ä¸­é—´éƒ¨ä»¶å¹¶ä¸å¤æ‚ï¼Œå¤§éƒ¨åˆ†åœ¨å‰é¢ Encoder é‡Œæˆ‘ä»¬å·²ç»ä»‹ç»è¿‡äº†ï¼Œä½†æ˜¯ Decoder ç”±äºå…¶ç‰¹æ®Šçš„åŠŸèƒ½ï¼Œå› æ­¤åœ¨è®­ç»ƒæ—¶ä¼šæ¶‰åŠåˆ°ä¸€äº›ç»†èŠ‚ã€‚</p><h3 id="Masked-Self-Attention"><a href="#Masked-Self-Attention" class="headerlink" title="Masked Self-Attention"></a>Masked Self-Attention</h3><p>å…·ä½“æ¥è¯´ï¼Œä¼ ç»Ÿ Seq2Seq ä¸­ Decoder ä½¿ç”¨çš„æ˜¯ RNN æ¨¡å‹ï¼Œå› æ­¤åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­è¾“å…¥$t$æ—¶åˆ»çš„è¯ï¼Œæ¨¡å‹æ— è®ºå¦‚ä½•ä¹Ÿçœ‹ä¸åˆ°æœªæ¥æ—¶åˆ»çš„è¯ï¼Œå› ä¸ºå¾ªç¯ç¥ç»ç½‘ç»œæ˜¯æ—¶é—´é©±åŠ¨çš„ï¼Œåªæœ‰å½“$t$æ—¶åˆ»è¿ç®—ç»“æŸäº†ï¼Œæ‰èƒ½çœ‹åˆ°$t+1$æ—¶åˆ»çš„è¯ã€‚è€Œ Transformer Decoder æŠ›å¼ƒäº† RNNï¼Œæ”¹ä¸º Self-Attentionï¼Œç”±æ­¤å°±äº§ç”Ÿäº†ä¸€ä¸ªé—®é¢˜ï¼Œåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œæ•´ä¸ª ground truth éƒ½æš´éœ²åœ¨ Decoder ä¸­ï¼Œè¿™æ˜¾ç„¶æ˜¯ä¸å¯¹çš„ï¼Œæˆ‘ä»¬éœ€è¦å¯¹ Decoder çš„è¾“å…¥è¿›è¡Œä¸€äº›å¤„ç†ï¼Œè¯¥å¤„ç†è¢«ç§°ä¸º Maskã€‚<br>ä¸¾ä¸ªä¾‹å­ï¼ŒDecoder çš„ ground truth ä¸º â€œstartèµ·å§‹ç¬¦å· I am fineâ€ï¼Œæˆ‘ä»¬å°†è¿™ä¸ªå¥å­è¾“å…¥åˆ° Decoder ä¸­ï¼Œç»è¿‡ WordEmbedding å’Œ Positional Encoding ä¹‹åï¼Œå°†å¾—åˆ°çš„çŸ©é˜µåšä¸‰æ¬¡çº¿æ€§å˜æ¢$W_Q,W_K,W_V$ã€‚ç„¶åè¿›è¡Œ self-attention æ“ä½œï¼Œé¦–å…ˆé€šè¿‡$\frac {Q\times K^T}{\sqrt {d_k}}$å¾—åˆ° Scaled Scoresï¼Œæ¥ä¸‹æ¥éå¸¸å…³é”®ï¼Œæˆ‘ä»¬è¦å¯¹ Scaled Scores è¿›è¡Œ Maskï¼Œä¸¾ä¸ªä¾‹å­ï¼Œå½“æˆ‘ä»¬è¾“å…¥ â€œIâ€ æ—¶ï¼Œæ¨¡å‹ç›®å‰ä»…çŸ¥é“åŒ…æ‹¬ â€œIâ€ åœ¨å†…ä¹‹å‰æ‰€æœ‰å­—çš„ä¿¡æ¯ï¼Œå³ â€œstartèµ·å§‹ç¬¦å·â€ å’Œ â€œIâ€ çš„ä¿¡æ¯ï¼Œä¸åº”è¯¥è®©å…¶çŸ¥é“ â€œIâ€ ä¹‹åè¯çš„ä¿¡æ¯ã€‚é“ç†å¾ˆç®€å•ï¼Œæˆ‘ä»¬åšé¢„æµ‹çš„æ—¶å€™æ˜¯æŒ‰ç…§é¡ºåºä¸€ä¸ªå­—ä¸€ä¸ªå­—çš„é¢„æµ‹ï¼Œæ€ä¹ˆèƒ½è¿™ä¸ªå­—éƒ½æ²¡é¢„æµ‹å®Œï¼Œå°±å·²ç»çŸ¥é“åé¢å­—çš„ä¿¡æ¯äº†å‘¢ï¼ŸMask éå¸¸ç®€å•ï¼Œé¦–å…ˆç”Ÿæˆä¸€ä¸ªä¸‹ä¸‰è§’å…¨ 0ï¼Œä¸Šä¸‰è§’å…¨ä¸ºè´Ÿæ— ç©·çš„çŸ©é˜µï¼Œç„¶åå°†å…¶ä¸ Scaled Scores ç›¸åŠ å³å¯ï¼š<br><img src="https://user-images.githubusercontent.com/6218739/140873707-8ab175f3-df87-40bc-901f-62305d01b2cd.png" alt="mask"><br>ä¹‹åå†åš softmaxï¼Œå°±èƒ½å°† - inf å˜ä¸º 0ï¼Œå¾—åˆ°çš„è¿™ä¸ªçŸ©é˜µå³ä¸ºæ¯ä¸ªå­—ä¹‹é—´çš„æƒé‡ï¼š<br><img src="https://user-images.githubusercontent.com/6218739/140873785-a14ea99e-09c5-4610-a97f-39039bd99ad6.png" alt="unmask"><br>Multi-Head Self-Attention æ— éå°±æ˜¯å¹¶è¡Œçš„å¯¹ä¸Šè¿°æ­¥éª¤å¤šåšå‡ æ¬¡ï¼Œå‰é¢ Encoder ä¹Ÿä»‹ç»äº†ï¼Œè¿™é‡Œå°±ä¸å¤šèµ˜è¿°äº†ã€‚</p><h3 id="Masked-Encoder-Decoder-Attention"><a href="#Masked-Encoder-Decoder-Attention" class="headerlink" title="Masked Encoder-Decoder Attention"></a>Masked Encoder-Decoder Attention</h3><p>å…¶å®è¿™ä¸€éƒ¨åˆ†çš„è®¡ç®—æµç¨‹å’Œå‰é¢ Masked Self-Attention å¾ˆç›¸ä¼¼ï¼Œç»“æ„ä¹Ÿä¸€æ‘¸ä¸€æ ·ï¼Œå”¯ä¸€ä¸åŒçš„æ˜¯è¿™é‡Œçš„$K,V$ä¸º Encoder çš„è¾“å‡ºï¼ˆä¸ç„¶Encoderè¾›è¾›è‹¦è‹¦åšçš„è¾“å‡ºå°±æ²¡ç”¨äº†ï¼‰ï¼Œ$Q$ä¸º Decoder ä¸­ Masked Self-Attention çš„è¾“å‡ºã€‚<br><img src="https://user-images.githubusercontent.com/6218739/140874351-f075901e-7869-4f2d-8c03-c94b12116938.png" alt="e-d"></p><h1 id="Vision-Transformer"><a href="#Vision-Transformer" class="headerlink" title="Vision Transformer"></a>Vision Transformer</h1><p>ä½¿ç”¨Transformerè¿›è¡Œè§†è§‰ä»»åŠ¡çš„ç ”ç©¶å·²ç»æˆäº†ä¸€ä¸ªæ–°çš„çƒ­ç‚¹ï¼Œå¤§å®¶ä¸ºäº†æ›´ä½çš„æ¨¡å‹å¤æ‚åº¦ä»¥åŠè®­ç»ƒçš„æ•ˆç‡ï¼Œéƒ½åœ¨ç ”ç©¶å¦‚ä½•å°†è¿™ä¸€æŠ€æœ¯åº”ç”¨åœ¨è§†è§‰ä»»åŠ¡ä¸Šã€‚<br>é€šå¸¸æ¥è¯´ï¼Œåœ¨æ‰€æœ‰çš„å…³äºTransformerçš„è®ºæ–‡ä»¥åŠå·¥ä½œä¸­ï¼Œæœ‰ä¸¤ä¸ªæ¯”è¾ƒå¤§çš„æ¶æ„ï¼Œå…¶ä¸­ä¸€ä¸ªå°±æ˜¯ä¼ ç»Ÿçš„CNNsåŠ Transformerç»„åˆè€Œæˆçš„ç»“æ„ï¼Œå¦ä¸€ç§æ˜¯çº¯ç²¹çš„Transformersã€‚<br>ViTä½¿ç”¨çš„å°±æ˜¯çº¯ç²¹çš„Transformerå»å®Œæˆè§†è§‰ä»»åŠ¡ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒæ²¡æœ‰ä½¿ç”¨ä»»ä½•çš„CNNsã€‚è¿™ä¹Ÿæ˜¯å®ƒçš„ä»·å€¼æ‰€åœ¨ï¼Œè°·æ­Œå¤§è„‘å›¢é˜Ÿåœ¨å‡ ä¹æ²¡æœ‰ä¿®æ”¹ä»»ä½•åŸºäºNLPçš„Transformerçš„ç»“æ„åŸºç¡€ä¹‹ä¸Šï¼Œåªæ˜¯å°†è¾“å…¥è¿›è¡Œäº†ä¸€ä¸ªé€‚é…ï¼Œå°†å›¾ç‰‡åˆ‡åˆ†æˆè®¸å¤šçš„å°æ ¼ï¼Œç„¶åå°†è¿™äº›ä½œä¸ºåºåˆ—è¾“å…¥åˆ°æ¨¡å‹ï¼Œæœ€ç»ˆå®Œæˆäº†åˆ†ç±»ä»»åŠ¡ï¼Œå¹¶ä¸”æ•ˆæœå¯ä»¥ç›´è¿½åŸºäºCNNsçš„SOTAã€‚<br>ViTçš„æ€è·¯å¾ˆç®€å•ï¼šç›´æ¥æŠŠå›¾åƒåˆ†æˆå›ºå®šå¤§å°çš„patchsï¼Œç„¶åé€šè¿‡çº¿æ€§å˜æ¢å¾—åˆ°patch embeddingï¼Œè¿™å°±ç±»æ¯”NLPçš„wordså’Œword embeddingï¼Œç”±äºtransformerçš„è¾“å…¥å°±æ˜¯a sequence of token embeddingsï¼Œæ‰€ä»¥å°†å›¾åƒçš„patch embeddingsé€å…¥transformeråå°±èƒ½å¤Ÿè¿›è¡Œç‰¹å¾æå–ä»è€Œåˆ†ç±»äº†ã€‚ViTæ¨¡å‹åŸç†å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå…¶å®ViTæ¨¡å‹åªæ˜¯ç”¨äº†transformerçš„Encoderæ¥æå–ç‰¹å¾ï¼ˆåŸå§‹çš„transformerè¿˜æœ‰decoderéƒ¨åˆ†ï¼Œç”¨äºå®ç°sequence to sequenceï¼Œæ¯”å¦‚æœºå™¨ç¿»è¯‘ï¼‰ã€‚<br><img src="https://user-images.githubusercontent.com/6218739/140877989-64b07f86-fe4f-45df-8f4c-a30a11391cb0.png" alt="ViT"></p><p>ViTæ¶æ„ç›¸å¯¹äºåŸå§‹Transformerï¼Œæœ‰ä¸€äº›ç‰¹æ®Šå¤„ç†ï¼š</p><h2 id="å›¾åƒåˆ†å—åµŒå…¥"><a href="#å›¾åƒåˆ†å—åµŒå…¥" class="headerlink" title="å›¾åƒåˆ†å—åµŒå…¥"></a>å›¾åƒåˆ†å—åµŒå…¥</h2><p>è€ƒè™‘åˆ°åœ¨Transformerç»“æ„ä¸­ï¼Œè¾“å…¥æ˜¯ä¸€ä¸ªäºŒç»´çš„çŸ©é˜µï¼ŒçŸ©é˜µçš„å½¢çŠ¶å¯ä»¥è¡¨ç¤ºä¸º$(N,D)$ï¼Œå…¶ä¸­$N$æ˜¯sequenceçš„é•¿åº¦ï¼Œè€Œ$D$æ˜¯sequenceä¸­æ¯ä¸ªå‘é‡çš„ç»´åº¦ã€‚å› æ­¤ï¼Œåœ¨ViTç®—æ³•ä¸­ï¼Œé¦–å…ˆéœ€è¦è®¾æ³•å°†$H \times W \times C$çš„ä¸‰ç»´å›¾åƒè½¬åŒ–ä¸º$(N,D)$çš„äºŒç»´è¾“å…¥ã€‚<br>ViTä¸­çš„å…·ä½“å®ç°æ–¹å¼ä¸ºï¼šå°†$H \times W \times C$çš„å›¾åƒï¼Œå˜ä¸ºä¸€ä¸ª$N \times (P^2 \times C)$çš„åºåˆ—ã€‚è¿™ä¸ªåºåˆ—å¯ä»¥çœ‹ä½œæ˜¯ä¸€ç³»åˆ—å±•å¹³çš„å›¾åƒå—ï¼Œä¹Ÿå°±æ˜¯å°†å›¾åƒåˆ‡åˆ†æˆå°å—åï¼Œå†å°†å…¶å±•å¹³ã€‚è¯¥åºåˆ—ä¸­ä¸€å…±åŒ…å«äº†$N=HW/P^2$ä¸ªå›¾åƒå—ï¼Œæ¯ä¸ªå›¾åƒå—çš„ç»´åº¦åˆ™æ˜¯$(P^2\times C)$ã€‚å…¶ä¸­$P$æ˜¯å›¾åƒå—çš„å¤§å°ï¼Œ$C$æ˜¯é€šé“æ•°é‡ã€‚ç»è¿‡å¦‚ä¸Šå˜æ¢ï¼Œå°±å¯ä»¥å°†$N$è§†ä¸ºsequenceçš„é•¿åº¦äº†ã€‚ä½†æ˜¯ï¼Œæ­¤æ—¶æ¯ä¸ªå›¾åƒå—çš„ç»´åº¦æ˜¯$(P^2\times C)$ï¼Œè€Œæˆ‘ä»¬å®é™…éœ€è¦çš„å‘é‡ç»´åº¦æ˜¯$D$ï¼Œå› æ­¤æˆ‘ä»¬è¿˜éœ€è¦å¯¹å›¾åƒå—è¿›è¡Œ Embeddingã€‚è¿™é‡Œ Embedding çš„æ–¹å¼éå¸¸ç®€å•ï¼Œåªéœ€è¦å¯¹æ¯ä¸ª$(P^2 \times C)$çš„å›¾åƒå—åšä¸€ä¸ªçº¿æ€§å˜æ¢ï¼Œå°†ç»´åº¦å‹ç¼©ä¸º$D$å³å¯ã€‚</p><h2 id="Class-Token"><a href="#Class-Token" class="headerlink" title="Class Token"></a>Class Token</h2><p>ViTå€Ÿé‰´BERTå¢åŠ äº†ä¸€ä¸ªç‰¹æ®Šçš„class tokenã€‚transformerçš„encoderè¾“å…¥æ˜¯a sequence patch embeddingsï¼Œè¾“å‡ºä¹Ÿæ˜¯åŒæ ·é•¿åº¦çš„a sequence patch featuresï¼Œä½†å›¾åƒåˆ†ç±»æœ€åéœ€è¦è·å–image featureï¼Œç®€å•çš„ç­–ç•¥æ˜¯é‡‡ç”¨poolingï¼Œæ¯”å¦‚æ±‚patch featuresçš„å¹³å‡æ¥è·å–image featureï¼Œä½†æ˜¯ViTå¹¶æ²¡æœ‰é‡‡ç”¨ç±»ä¼¼çš„poolingç­–ç•¥ï¼Œè€Œæ˜¯ç›´æ¥å¢åŠ ä¸€ä¸ªç‰¹æ®Šçš„class tokenï¼Œå…¶æœ€åè¾“å‡ºçš„ç‰¹å¾åŠ ä¸€ä¸ªlinear classifierå°±å¯ä»¥å®ç°å¯¹å›¾åƒçš„åˆ†ç±»ï¼ˆViTçš„pre-trainingæ—¶æ˜¯æ¥ä¸€ä¸ªMLP headï¼‰ï¼Œæ‰€ä»¥è¾“å…¥ViTçš„sequenceé•¿åº¦æ˜¯$N+1$ã€‚<br>class tokenå¯¹åº”çš„embeddingåœ¨è®­ç»ƒæ—¶éšæœºåˆå§‹åŒ–ï¼Œç„¶åé€šè¿‡è®­ç»ƒå¾—åˆ°ã€‚</p><h2 id="Positional-Encoding"><a href="#Positional-Encoding" class="headerlink" title="Positional Encoding"></a>Positional Encoding</h2><p>æŒ‰ç…§ Transformer ç»“æ„ä¸­çš„ä½ç½®ç¼–ç ä¹ æƒ¯ï¼Œè¿™ä¸ªå·¥ä½œä¹Ÿä½¿ç”¨äº†ä½ç½®ç¼–ç ã€‚ä¸åŒçš„æ˜¯ï¼ŒViT ä¸­çš„ä½ç½®ç¼–ç æ²¡æœ‰é‡‡ç”¨åŸç‰ˆ Transformer ä¸­çš„ sin-cosç¼–ç ï¼Œè€Œæ˜¯ç›´æ¥è®¾ç½®ä¸ºå¯å­¦ä¹ çš„ Positional Encodingã€‚å¯¹è®­ç»ƒå¥½çš„ Positional Encoding è¿›è¡Œå¯è§†åŒ–ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œä½ç½®è¶Šæ¥è¿‘ï¼Œå¾€å¾€å…·æœ‰æ›´ç›¸ä¼¼çš„ä½ç½®ç¼–ç ã€‚æ­¤å¤–ï¼Œå‡ºç°äº†è¡Œåˆ—ç»“æ„ï¼ŒåŒä¸€è¡Œ/åˆ—ä¸­çš„ patch å…·æœ‰ç›¸ä¼¼çš„ä½ç½®ç¼–ç ã€‚<br><img src="https://user-images.githubusercontent.com/6218739/140884681-87fb368e-87a6-4e6a-a9df-3ea19a31012b.png" alt="vit-pos"></p>]]></content>
    
    
    <summary type="html">å‚è€ƒæ–‡çŒ®
ä¿å§†çº§æ•™ç¨‹ï¼šå›¾è§£Transformer
Transformeræ¨¡å‹è¯¦è§£
Transformer è¯¦è§£
ç›˜ç‚¹ | 2021å¹´paperå¤§çƒ­çš„Transformer (ViT)
â€œæœªæ¥â€çš„ç»å…¸ä¹‹ä½œViTï¼štransformer is all you need!
ViT( Vision Transformer)

ç®€ä»‹
Attention Is All You Needæ˜¯ä¸€ç¯‡Googleäº2017å¹´æå‡ºçš„å°†Attentionæ€æƒ³å‘æŒ¥åˆ°æè‡´çš„è®ºæ–‡ã€‚è¿™ç¯‡è®ºæ–‡ä¸­æå‡ºä¸€ä¸ªå…¨æ–°çš„æ¨¡å‹ï¼Œå« Transformerï¼ŒæŠ›å¼ƒäº†ä»¥å¾€æ·±åº¦å­¦ä¹ ä»»åŠ¡é‡Œé¢ä½¿ç”¨åˆ°çš„ CNN å’Œ RNN ï¼Œç›®å‰å¤§çƒ­çš„Bertã€GPTå’ŒD</summary>
    
    
    
    <category term="machine learning" scheme="http://qixinbo.github.io/categories/machine-learning/"/>
    
    
    <category term="Transformer" scheme="http://qixinbo.github.io/tags/Transformer/"/>
    
  </entry>
  
  <entry>
    <title>Pythonçˆ±æµè§ˆå™¨ï¼Œä½†æµè§ˆå™¨ä¸çˆ±å®ƒï¼šå¦‚ä½•è®©Pythonè¿è¡Œåœ¨æµè§ˆå™¨ä¸Š</title>
    <link href="http://qixinbo.github.io/2021/11/05/python-on-web/"/>
    <id>http://qixinbo.github.io/2021/11/05/python-on-web/</id>
    <published>2021-11-04T16:00:00.000Z</published>
    <updated>2021-11-05T08:37:11.546Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><p>ä¸€ç›´ä»¥æ¥ï¼Œç½‘é¡µæµè§ˆå™¨ç¼–ç¨‹æ‰€ç”¨çš„ç¼–ç¨‹è¯­è¨€ä¸»åŠ›å°±æ˜¯JavaScriptï¼Œæµè§ˆå™¨å°±æ˜¯ä¸€ä¸ªJavaScriptçš„åŸç”Ÿè§£é‡Šå™¨ã€‚<br>é‚£ä¹ˆPythonèƒ½ä¸èƒ½ç›´æ¥è¿è¡Œåœ¨æµè§ˆå™¨ä¸Šå‘¢ï¼Œæˆ–è€…è¯´Pythonèƒ½ä¸èƒ½ä½œä¸ºæµè§ˆå™¨å¼€å‘çš„ç¼–ç¨‹è¯­è¨€ï¼Ÿ<br>æœ¬æ–‡å¯¹è¿™ä¸€é—®é¢˜åšäº†è¯¦ç»†çš„è°ƒç ”ï¼Œç»“æœå¯ä»¥ç”¨ä¸€å¥è¯æ€»ç»“ï¼šå¯ä»¥ï¼Œä½†å¾ˆé¸¡è‚‹ã€‚</p><h1 id="å¯ç”¨æ–¹æ¡ˆ"><a href="#å¯ç”¨æ–¹æ¡ˆ" class="headerlink" title="å¯ç”¨æ–¹æ¡ˆ"></a>å¯ç”¨æ–¹æ¡ˆ</h1><p>è°ƒç ”è¿‡ç¨‹ä¸­ï¼Œå‘ç°äº†å¾ˆå¤šæœ‰è¶£çš„è§£å†³æ–¹æ¡ˆï¼Œæ€»ç»“èµ·æ¥å¯ä»¥æœ‰ä¸¤ç±»ï¼š<br>ï¼ˆ1ï¼‰å°†Pythonè¯­è¨€ç¼–è¯‘æˆJavaScript<br>å³å°†ç°æˆçš„Pythonè¯­è¨€ç¿»è¯‘æˆJavaScriptï¼Œç„¶ååœ¨æµè§ˆå™¨ç½‘é¡µä¸­è¿è¡Œï¼Œæ¯”å¦‚ï¼š<br><a href="https://brython.info/index.html">Brython</a><br><a href="https://skulpt.org/">Skulpt</a><br><a href="https://www.transcrypt.org/">Transcrypt</a><br>ï¼ˆ2ï¼‰åœ¨æµè§ˆå™¨ä¸­å†…ç½®Pythonè§£é‡Šå™¨<br>å³å°†Pythonè§£é‡Šå™¨æ”¾åœ¨æµè§ˆå™¨ä¸­ï¼Œè¿™æ ·å°±èƒ½ç›´æ¥è¿è¡ŒPythonä»£ç ï¼Œæ¯”å¦‚ï¼š<br><a href="https://pyodide.org/en/stable/">Pyodide</a><br><a href="https://pypyjs.org/">PyPy.js</a></p><p>æˆ‘è§‰å¾—è¿™ä¸¤ç±»å„è‡ªçš„é‡ç‚¹ä¸ä¸€æ ·ï¼š<br>ç¬¬ä¸€ç§æ˜¯ä¸ºäº†ç”¨Pythonæ¥ä»£æ›¿JavaScriptï¼Œå³ç”¨Pythonæ“ä½œç½‘é¡µDOMï¼ˆDocument Object Modelï¼‰å…ƒç´ ï¼Œè®©ä¸ç†Ÿæ‚‰JSçš„ç¼–ç¨‹äººå‘˜ä¹Ÿèƒ½ç”¨Pythonæ¥åšä¸€ä¸ªç®€å•çš„åŠ¨æ€äº¤äº’ç½‘é¡µï¼›<br>ç¬¬äºŒç§ï¼Œæ¯”å¦‚Pyodideï¼Œå®ƒçš„é‡å¿ƒå¾ˆå¤§ï¼Œå³å°†Pythonçš„ç§‘å­¦è®¡ç®—ç”Ÿæ€æ¬åˆ°æµè§ˆå™¨ä¸­ï¼Œæ¯”å¦‚numpyã€scipyã€matplotlibç­‰ç§‘å­¦è®¡ç®—å¸¸ç”¨çš„å‡½æ•°åº“ç›´æ¥æ”¾è¿›æµè§ˆå™¨ä¸­ï¼Œè€Œä¸æ˜¯å¸¸è§çš„æ¯”å¦‚ä½œä¸ºæµè§ˆå™¨æœåŠ¡å™¨åç«¯æ¥è°ƒç”¨ã€‚è¿™æ ·å®ç°çš„æ•ˆæœå°±æ˜¯ä¸éœ€è¦éƒ¨ç½²æœåŠ¡å™¨ï¼Œç›´æ¥åœ¨æµè§ˆå™¨ä¸­åšå¤æ‚çš„å‡½æ•°è®¡ç®—ï¼Œå¹¶åæ˜ åˆ°ç½‘é¡µä¸Šã€‚<br>ä¸‹é¢è¯¦ç»†ä»‹ç»ä¸€ä¸‹ä¸¤ç±»å®ç°ä¸­çš„ä»£è¡¨ï¼šBrythonå’ŒPyodideã€‚</p><h1 id="Brython"><a href="#Brython" class="headerlink" title="Brython"></a>Brython</h1><p>å…ˆçœ‹ä¸€ä¸‹ç”¨Brythonå†™çš„Hello Worldï¼š<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta name=<span class="string">&quot;description&quot;</span> content=<span class="string">&quot;Hello world demo written in Brython www.brython.info&quot;</span>&gt;</span><br><span class="line">&lt;meta name=<span class="string">&quot;keywords&quot;</span> content=<span class="string">&quot;Python,Brython&quot;</span>&gt;</span><br><span class="line">&lt;meta charset=<span class="string">&quot;iso-8859-1&quot;</span>&gt;</span><br><span class="line">&lt;title&gt;Hello world&lt;/title&gt;</span><br><span class="line">&lt;script type=&quot;text/javascript&quot; src=&quot;/src/brython.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script type=&quot;text/python&quot; src=&quot;show_source.py&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">// ------------æ³¨æ„çœ‹è¿™ä¸€å—-------------</span><br><span class="line">&lt;body onload=<span class="string">&quot;brython(1)&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;script <span class="built_in">type</span>=<span class="string">&quot;text/python&quot;</span>&gt;</span><br><span class="line"><span class="keyword">from</span> browser <span class="keyword">import</span> document, alert</span><br><span class="line"><span class="keyword">from</span> browser.widgets.dialog <span class="keyword">import</span> InfoDialog</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">echo</span>(<span class="params">ev</span>):</span></span><br><span class="line">    InfoDialog(<span class="string">&quot;Hello&quot;</span>, <span class="string">f&quot;Hello <span class="subst">&#123;document[<span class="string">&#x27;zone&#x27;</span>].value&#125;</span> !&quot;</span>)</span><br><span class="line"></span><br><span class="line">document[<span class="string">&quot;test&quot;</span>].bind(<span class="string">&quot;click&quot;</span>, echo)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">// ------------æ³¨æ„çœ‹ç»“æŸ-------------</span><br><span class="line"></span><br><span class="line">&lt;p&gt;Your name <span class="keyword">is</span> : &lt;<span class="built_in">input</span> <span class="built_in">id</span>=<span class="string">&quot;zone&quot;</span> autocomplete=<span class="string">&quot;off&quot;</span>&gt;</span><br><span class="line">&lt;button id=&quot;test&quot;&gt;click !&lt;/button&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line"></span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><br>ä»ä¸Šé¢ç‰‡æ®µå¾ˆæ˜¾è€Œæ˜“è§ï¼ŒBrythonå°±æ˜¯ç”¨Pythonæ¥æ›¿ä»£JavaScriptçš„å†™æ³•ï¼Œæ¯”å¦‚è·å–ç½‘é¡µä¸Šçš„å…ƒç´ å¹¶æ”¹å˜å…¶å€¼ã€‚<br>å¦‚æœæƒ³å¿«é€Ÿå¼€å‘ä¸€ä¸ªåŠ¨æ€ç½‘é¡µï¼ŒåŒæ—¶ä¸æ‡‚JavaScriptï¼Œå¯ä»¥ä½¿ç”¨Brythonæ¥å†™ã€‚<br>ä½†æ³¨æ„Brythonæ²¡æ³•ä½¿ç”¨Pythonçš„æ•´ä¸ªç”Ÿæ€ï¼Œåªèƒ½ä½¿ç”¨éƒ¨åˆ†æ ‡å‡†åº“ï¼Œæ¯”å¦‚sysã€‚</p><h1 id="Pyodide"><a href="#Pyodide" class="headerlink" title="Pyodide"></a>Pyodide</h1><p>ç®€è¨€ä¹‹ï¼ŒPyodideå°±æ˜¯åœ¨æµè§ˆå™¨ä¸­è¿è¡ŒPythonï¼Œä¸”èƒ½è°ƒç”¨Pythonçš„æ•°å€¼è®¡ç®—åº“ã€‚<br>Pyodideè§£å†³çš„ç—›ç‚¹æ˜¯æ— æ³•åœ¨æµè§ˆå™¨ä¸­è¿›è¡Œç§‘å­¦è®¡ç®—ï¼š<br>ï¼ˆ1ï¼‰ä¸€æ–¹é¢ï¼Œç°åœ¨è¶Šæ¥è¶Šå¤šçš„è½¯ä»¶éƒ½WebåŒ–ã€æµè§ˆå™¨åŒ–ã€‚è€Œæµè§ˆå™¨çš„é€šç”¨ç¼–ç¨‹è¯­è¨€æ˜¯JavaScriptï¼Œä½†å…¶æ²¡æœ‰æˆç†Ÿçš„æ•°æ®ç§‘å­¦å¤„ç†åº“ï¼Œä¹Ÿç¼ºä¹ä¸€äº›æ•°å€¼è®¡ç®—å¾ˆæœ‰ç”¨çš„åŠŸèƒ½å’Œæ•°æ®ç»“æ„ã€‚<br>ï¼ˆ2ï¼‰å¦ä¸€æ–¹é¢ï¼ŒPythonå…·æœ‰æˆç†Ÿä¸”æ´»è·ƒçš„ç§‘å­¦è®¡ç®—ç”Ÿæ€ï¼Œæ¯”å¦‚åŸºæœ¬ä¸Šæ‰€æœ‰å‡½æ•°åº“éƒ½ä¾èµ–çš„numpyæ•°æ®ç»“æ„ï¼Œä½†å…¶æ— æ³•åœ¨æµè§ˆå™¨è¿è¡Œã€‚<br>Pyodide é¡¹ç›®åˆ™æ˜¯é€šè¿‡å°†ç°æœ‰çš„ CPython è§£é‡Šå™¨ç¼–è¯‘ä¸º WebAssembly å¹¶åœ¨æµè§ˆå™¨çš„ JavaScript ç¯å¢ƒä¸­è¿è¡Œè¿™ä¸ªç¼–è¯‘å‡ºæ¥çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè¿™æä¾›äº†ä¸€ç§åœ¨æµè§ˆå™¨ä¸­è¿è¡Œ Python çš„æ–¹æ³•ã€‚</p><p>Pyodideæœ‰ä¸€äº›éå¸¸ç‚«çš„åŠŸèƒ½ç‚¹ï¼š</p><h2 id="åœ¨Pythonå’ŒJavaScriptä¹‹é—´è¿›è¡Œäº¤äº’"><a href="#åœ¨Pythonå’ŒJavaScriptä¹‹é—´è¿›è¡Œäº¤äº’" class="headerlink" title="åœ¨Pythonå’ŒJavaScriptä¹‹é—´è¿›è¡Œäº¤äº’"></a>åœ¨Pythonå’ŒJavaScriptä¹‹é—´è¿›è¡Œäº¤äº’</h2><p>å¦‚æœæ‰€æœ‰Pyodideèƒ½åšçš„å°±åªæ˜¯è¿è¡ŒPythonä»£ç å¹¶å†™å‡ºåˆ°æ ‡å‡†è¾“å‡ºä¸Šï¼Œå®ƒå°†ä¼šå¢é•¿æˆä¸ºä¸€ä¸ªä¸é”™çš„å¾ˆé…·çš„æŠ€å·§ï¼Œä½†æ˜¯ä¸ä¼šæˆä¸ºä¸€ä¸ªç”¨äºå®é™…å·¥ä½œçš„å®ç”¨å·¥å…·ã€‚çœŸæ­£çš„åŠ›é‡æºäºå®ƒä¸æµè§ˆå™¨APIä»¥åŠå…¶å®ƒè¿è¡Œåœ¨æµè§ˆå™¨ä¸­çš„JavaScriptåº“äº¤äº’çš„èƒ½åŠ›ã€‚ç”±äºæˆ‘ä»¬å·²ç»å°†Pythonè§£é‡Šå™¨ç¼–è¯‘ä¸ºäº†WebAssemblyï¼Œå®ƒä¹Ÿä¸JavaScriptç«¯å…·æœ‰æ·±åº¦çš„äº¤äº’ã€‚<br>Pyodideä¼šåœ¨è®¸å¤šPythonä¸JavaScriptä¹‹é—´çš„å†…å»ºæ•°æ®ç±»å‹ä¹‹é—´è¿›è¡Œéšå¼è½¬æ¢ã€‚å…¶ä¸­ä¸€äº›è½¬æ¢æ—¶å¾ˆç›´æ¥æ˜æ˜¾çš„ï¼Œä½†å¦‚å¾€å¸¸ä¸€æ ·ï¼Œé‚£å°±æ˜¯å¾ˆæœ‰è¶£çš„æç«¯æƒ…å†µã€‚<br><img src="https://user-images.githubusercontent.com/6218739/140268286-c89f066f-72fc-4cc9-8709-c95fc6d98096.png" alt="data"></p><h2 id="è®¿é—®Web-APIå’ŒDOM"><a href="#è®¿é—®Web-APIå’ŒDOM" class="headerlink" title="è®¿é—®Web APIå’ŒDOM"></a>è®¿é—®Web APIå’ŒDOM</h2><p>å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è·å¾—Webé¡µé¢ä¸Šçš„æ–‡æ¡£å¯¹è±¡æ¨¡å‹DOMï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> js <span class="keyword">import</span> document</span><br></pre></td></tr></table></figure><br>è¿™ä¼šå°†documentå¯¹è±¡ä½œä¸ºä¸€ä¸ªä»£ç†ä»JavaScriptç«¯å¯¼å…¥åˆ°Pythonç«¯ã€‚ä½ å¯ä»¥å¼€å§‹ä»Pythonä¸­å¯¹å…¶è°ƒç”¨æ–¹æ³•:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">document.getElementById(<span class="string">&quot;myElement&quot;</span>)</span><br></pre></td></tr></table></figure></p><h2 id="å¤šç»´æ•°ç»„"><a href="#å¤šç»´æ•°ç»„" class="headerlink" title="å¤šç»´æ•°ç»„"></a>å¤šç»´æ•°ç»„</h2><p>åœ¨Pythonä¸­ï¼Œ NumPy æ•°ç»„æ˜¯æœ€å¸¸ç”¨çš„å¤šç»´æ•°ç»„çš„å®ç°ã€‚JavaScriptå…·æœ‰TypedArraysï¼Œå…¶ä»…å«æœ‰ä¸€ä¸ªå•ä¸€çš„æ•°å€¼ç±»å‹ï¼Œä½†æ˜¯æ˜¯ä¸€ç»´çš„ï¼Œå› æ­¤éœ€è¦åœ¨å…¶ä¹‹ä¸Šæ„å»ºå¤šç»´ç´¢å¼•ã€‚<br>ç”±äºå®é™…ä¸Šè¿™äº›æ•°ç»„å¯èƒ½ä¼šéå¸¸å¤§ï¼Œæˆ‘ä»¬ä¸æƒ³åœ¨è¯­è¨€è¿è¡Œæ—¶é—´æ‹·è´å®ƒä»¬ã€‚é‚£ä¸ä»…ä»…ä¼šèŠ±ç›¸å½“é•¿çš„æ—¶é—´ï¼Œè€Œä¸”åœ¨å†…å­˜ä¸­åŒæ—¶ä¿ç•™ä¸¤ä¸ªæ‹·è´å°†ä¼šåŠ é‡æµè§ˆå™¨æ‰€å…·æœ‰çš„è¢«é™åˆ¶çš„å†…å­˜çš„è´Ÿæ‹…ã€‚<br>å¹¸è¿çš„æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ç”¨æ‹·è´æ¥å…±äº«æ•°æ®ã€‚å¤šç»´æ•°ç»„é€šå¸¸æ˜¯ç”¨å°‘é‡ç”¨äºæè¿°å€¼ç±»å‹å’Œæ•°ç»„å½¢çŠ¶åŠå†…å­˜åˆ†å¸ƒçš„å…ƒæ•°æ®æ¥å®ç°çš„ã€‚æ•°æ®æœ¬èº«æ˜¯ä»å…ƒæ•°æ®ä¸­é€šè¿‡æŒ‡é’ˆè®¿é—®çš„å¦ä¸€ä¸ªå†…å­˜åŒºåŸŸã€‚è¯¥å†…å­˜å¤„äºä¸€ä¸ªå«ä½œâ€œWebAssemblyå †â€çš„åŒºåŸŸï¼Œè¿™å¸¦æ¥ä¸€ä¸ªä¼˜åŠ¿ï¼Œå› ä¸ºå…¶å¯ä»¥ä»JavaScriptå’ŒPythonä¸­åŒæ—¶è®¿é—®ã€‚æˆ‘ä»¬å¯ä»¥ç®€å•åœ°åœ¨è¯­è¨€ä¹‹é—´æ‹·è´å…ƒæ•°æ®(å…¶æœ¬èº«éå¸¸å°)ï¼Œå¹¶ä¿æŒæŒ‡é’ˆæŒ‡å‘WebAssemblyå †ä¸­çš„æ•°æ®ã€‚<br><img src="https://user-images.githubusercontent.com/6218739/140268781-ab70c08a-1821-4a06-b7de-d65633d54b31.png" alt="numpy"></p><h2 id="å®æ—¶äº¤äº’å¯è§†åŒ–"><a href="#å®æ—¶äº¤äº’å¯è§†åŒ–" class="headerlink" title="å®æ—¶äº¤äº’å¯è§†åŒ–"></a>å®æ—¶äº¤äº’å¯è§†åŒ–</h2><p>åœ¨æµè§ˆå™¨ä¸­è¿›è¡Œæ•°æ®ç§‘å­¦è®¡ç®—ç›¸æ¯”äºå¦‚Jupyterä¸€æ ·åœ¨è¿œç¨‹å†…æ ¸ä¸­è¿›è¡Œè®¡ç®—çš„ä¸€å¤§ä¼˜åŠ¿å°±æ˜¯ï¼Œäº¤äº’å¼å¯è§†åŒ–ä¸ç”¨é€šè¿‡ç½‘ç»œæ¥ä¼ è¾“æ•°æ®å¹¶é‡æ–°å¤„ç†å’Œå±•ç¤ºè¿™äº›æ•°æ®ã€‚è¿™å¾ˆå¤§ç¨‹åº¦åœ°å‡å°‘äº†å»¶è¿Ÿâ€”ç”¨æˆ·ç§»åŠ¨é¼ æ ‡çš„æ—¶åˆ»ä¸å±å¹•æ›´æ–°å¹¶æ˜¾ç¤ºå›¾æ¡ˆçš„æ—¶åˆ»ä¹‹é—´çš„é—´éš”æ—¶é—´ã€‚</p><p>è¦ä½¿å¾—å…¶èƒ½å·¥ä½œéœ€è¦ä¸Šé¢æè¿°åˆ°çš„æ‰€æœ‰çš„æŠ€æœ¯ç‰‡æ®µèƒ½å¤Ÿå¾ˆå¥½åœ°ååŒå·¥ä½œã€‚æˆ‘ä»¬ä½¿ç”¨matplotlibæ¥çœ‹ä¸€ä¸‹ç”¨äºå±•ç¤ºæ­£æ€åˆ†å¸ƒå¦‚ä½•å·¥ä½œçš„äº¤äº’æ€§ç¤ºä¾‹ã€‚é¦–å…ˆï¼Œé€šè¿‡Pythonçš„Numpyäº§ç”Ÿéšæœºæ•°æ®ã€‚æ¥ä¸‹æ¥ï¼ŒMatplotlibæ¥ç®¡è¯¥æ•°æ®ï¼Œå¹¶ä½¿ç”¨å†…å»ºçš„è½¯ä»¶æ¸²æŸ“å™¨æ¥å°†å…¶ç»˜å‡ºã€‚å®ƒä½¿ç”¨Pyodideå¯¹é›¶æ‹·è´å…±äº«æ•°ç»„çš„æ”¯æŒæ¥å°†åƒç´ å›é¦ˆç»™JavaScriptç«¯ï¼Œåœ¨è¿™é‡Œæ•°æ®æœ€ç»ˆè¢«æ¸²æŸ“ä¸ºHTMLçš„ç”»å¸ƒã€‚ç„¶åæµè§ˆå™¨æ¥ç®¡å·¥ä½œï¼Œå°†åƒç´ æ˜¾ç¤ºåˆ°å±å¹•ä¸Šã€‚ç”¨æ¥æ”¯æŒäº¤äº’æ€§æ“ä½œçš„é¼ æ ‡å’Œé”®ç›˜äº‹ä»¶é€šè¿‡ä»Webæµè§ˆå™¨åˆ°Pythonçš„å›è°ƒå‡½æ•°çš„è°ƒç”¨æ¥å¤„ç†ã€‚<br><img src="https://user-images.githubusercontent.com/6218739/140269007-b21d4a82-4def-4581-8631-331f570917e4.gif" alt="matplotlib-interacting-with-plots"></p><p>ä½†éœ€è¦æ³¨æ„çš„æ˜¯Pyodideæœ‰ä¸¤ä¸ªç¼ºç‚¹ï¼š<br>ï¼ˆ1ï¼‰åŒ…ä½“ç§¯å·¨å¤§ï¼Œåœ¨æµè§ˆå™¨ä¸­ç¬¬ä¸€æ¬¡è®¿é—®å†…å«Pyodideçš„ç½‘é¡µæ—¶ï¼Œä¼šä¸‹è½½ç›¸åº”çš„pythonåŒ…ï¼Œæœ€åŸºç¡€çš„pyodideä¹Ÿæœ‰22MBå¤§å°ï¼Œæ›´ä¸ç”¨è¯´å¦‚æœæœ‰é¢å¤–çš„åŒ…ï¼Œæ¯”å¦‚matplotlibï¼Œä¼šæ›´åŠ å·¨å¤§ï¼Œå¯¼è‡´é•¿æ—¶é—´åŠ è½½ä¸å‡ºæ¥é¡µé¢ï¼›<br>ï¼ˆ2ï¼‰å¯¹äºPythonæ—¥æ¸ç«çƒ­çš„æ·±åº¦å­¦ä¹ ç”Ÿæ€ï¼ŒPyodideä¹Ÿæ²¡æ³•ç›´æ¥åˆ©ç”¨ï¼Œæ¯•ç«Ÿé‚£äº›å‡½æ•°åº“ä¼šæ›´å¤§ã€‚</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>JavaScriptä½œä¸ºæµè§ˆå™¨çš„åŸä½æ°‘ï¼Œå…¶åœ¨åŸºäºç½‘é¡µçš„åº”ç”¨å¼€å‘ä¸­çš„åœ°ä½ä¸å¯æ’¼åŠ¨ï¼Œè™½ç„¶Pythonèƒ½é€šè¿‡å„ç§æ–¹å¼éƒ¨åˆ†å–ä»£å®ƒçš„åŠŸèƒ½ï¼Œä½†ç›®å‰è¿˜å¾ˆä¸æˆç†Ÿï¼Œå¼€å‘ç®€æ˜“åŠŸèƒ½å°šå¯ï¼Œä½†é‡åº¦å’Œé«˜é˜¶åº”ç”¨åˆ™åŸºæœ¬ä¸å¯èƒ½ã€‚æœŸå¾…ä»¥åçš„æŠ€æœ¯å‘å±•èƒ½å°†æµè§ˆå™¨å’ŒPythonç»“åˆå¾—æ›´åŠ ç´§å¯†ã€‚</p><h1 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h1><p><a href="https://python.freelycode.com/contribution/detail/1567">åœ¨æµè§ˆå™¨ä¸­ç”¨Pythonåšæ•°æ®ç§‘å­¦ï¼šPyodide</a><br><a href="https://jishuin.proginn.com/p/763bfbd5bd1e">LWN: Pyodide - æµè§ˆå™¨ä¸­çš„Pythonï¼</a><br><a href="https://hacks.mozilla.org/2019/04/pyodide-bringing-the-scientific-python-stack-to-the-browser/">Pyodide: Bringing the scientific Python stack to the browser</a><br><a href="https://www.bilibili.com/video/BV1X541187XK">æŠŠpythonè£…è¿›æµè§ˆå™¨ï¼Œéœ€è¦å‡ ä¸ªæ­¥éª¤ï¼Ÿ</a><br><a href="https://www.youtube.com/watch?v=iUqVgykaF-k&amp;t=91s">Iodide and Pyodide: Bringing Data Science Computation to the Web Browser - Michael Droettboom</a></p>]]></content>
    
    
    <summary type="html">ç®€ä»‹
ä¸€ç›´ä»¥æ¥ï¼Œç½‘é¡µæµè§ˆå™¨ç¼–ç¨‹æ‰€ç”¨çš„ç¼–ç¨‹è¯­è¨€ä¸»åŠ›å°±æ˜¯JavaScriptï¼Œæµè§ˆå™¨å°±æ˜¯ä¸€ä¸ªJavaScriptçš„åŸç”Ÿè§£é‡Šå™¨ã€‚
é‚£ä¹ˆPythonèƒ½ä¸èƒ½ç›´æ¥è¿è¡Œåœ¨æµè§ˆå™¨ä¸Šå‘¢ï¼Œæˆ–è€…è¯´Pythonèƒ½ä¸èƒ½ä½œä¸ºæµè§ˆå™¨å¼€å‘çš„ç¼–ç¨‹è¯­è¨€ï¼Ÿ
æœ¬æ–‡å¯¹è¿™ä¸€é—®é¢˜åšäº†è¯¦ç»†çš„è°ƒç ”ï¼Œç»“æœå¯ä»¥ç”¨ä¸€å¥è¯æ€»ç»“ï¼šå¯ä»¥ï¼Œä½†å¾ˆé¸¡è‚‹ã€‚

å¯ç”¨æ–¹æ¡ˆ
è°ƒç ”è¿‡ç¨‹ä¸­ï¼Œå‘ç°äº†å¾ˆå¤šæœ‰è¶£çš„è§£å†³æ–¹æ¡ˆï¼Œæ€»ç»“èµ·æ¥å¯ä»¥æœ‰ä¸¤ç±»ï¼š
ï¼ˆ1ï¼‰å°†Pythonè¯­è¨€ç¼–è¯‘æˆJavaScript
å³å°†ç°æˆçš„Pythonè¯­è¨€ç¿»è¯‘æˆJavaScriptï¼Œç„¶ååœ¨æµè§ˆå™¨ç½‘é¡µä¸­è¿è¡Œï¼Œæ¯”å¦‚ï¼š
Brython
Skulpt
Transcrypt
ï¼ˆ2ï¼‰åœ¨æµè§ˆå™¨ä¸­å†…ç½®Pythonè§£é‡Šå™¨
å³å°†Py</summary>
    
    
    
    <category term="digitalization" scheme="http://qixinbo.github.io/categories/digitalization/"/>
    
    
    <category term="GUI" scheme="http://qixinbo.github.io/tags/GUI/"/>
    
  </entry>
  
  <entry>
    <title>ç»å…¸å›¾åƒç‰¹å¾ç‚¹æå–SIFTç®—æ³•è¯¦è§£</title>
    <link href="http://qixinbo.github.io/2021/10/26/sift/"/>
    <id>http://qixinbo.github.io/2021/10/26/sift/</id>
    <published>2021-10-25T16:00:00.000Z</published>
    <updated>2022-01-09T07:06:08.497Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h1><p><a href="https://liuchang.men/2020/02/24/SIFT%E7%AE%97%E6%B3%95%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3/">SIFTç®—æ³•æ·±å…¥ç†è§£</a><br><a href="https://blog.csdn.net/lhanchao/article/details/52345845">ç‰¹å¾ç‚¹åŒ¹é…â€”â€”SIFTç®—æ³•è¯¦è§£</a><br><a href="https://www.cnblogs.com/wj-1314/p/11981974.html">å›¾åƒé‡‘å­—å¡”ï¼ˆé«˜æ–¯é‡‘å­—å¡”ï¼Œæ‹‰æ™®æ‹‰æ–¯é‡‘å­—å¡”ï¼Œå›¾åƒç¼©æ”¾resizeå‡½æ•°ï¼‰</a><br><a href="https://blog.csdn.net/zddblog/article/details/7521424">SIFTç®—æ³•è¯¦è§£</a></p><h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><p>SIFTï¼ˆScale Invariant Feature Transformï¼‰ï¼Œå°ºåº¦ä¸å˜ç‰¹å¾å˜æ¢åŒ¹é…ç®—æ³•ï¼Œæ˜¯ç”±David G. Loweåœ¨1999å¹´ï¼ˆã€ŠObject Recognition from Local Scale-Invariant Featuresã€‹ï¼‰æå‡ºçš„é«˜æ•ˆåŒºåŸŸæ£€æµ‹ç®—æ³•ï¼Œåœ¨2004å¹´ï¼ˆã€ŠDistinctive Image Features from Scale-Invariant Keypointsã€‹ï¼‰å¾—ä»¥å®Œå–„ã€‚<br>SIFTç®—å­æ˜¯æŠŠå›¾åƒä¸­æ£€æµ‹åˆ°çš„ç‰¹å¾ç‚¹ç”¨ä¸€ä¸ª128ç»´çš„ç‰¹å¾å‘é‡è¿›è¡Œæè¿°ï¼Œå› æ­¤ä¸€å¹…å›¾åƒç»è¿‡SIFTç®—æ³•åè¡¨ç¤ºä¸ºä¸€ä¸ª128ç»´çš„ç‰¹å¾å‘é‡é›†ã€‚<br>SIFTç®—æ³•çš„å®è´¨æ˜¯åœ¨ä¸åŒçš„å°ºåº¦ç©ºé—´ä¸ŠæŸ¥æ‰¾å…³é”®ç‚¹(ç‰¹å¾ç‚¹)ï¼Œå¹¶è®¡ç®—å‡ºå…³é”®ç‚¹çš„æ–¹å‘ã€‚SIFTæ‰€æŸ¥æ‰¾åˆ°çš„å…³é”®ç‚¹æ˜¯ä¸€äº›ååˆ†çªå‡ºï¼Œä¸ä¼šå› å…‰ç…§ã€ä»¿å°„å˜æ¢å’Œå™ªéŸ³ç­‰å› ç´ è€Œå˜åŒ–çš„ç‚¹ï¼Œå¦‚è§’ç‚¹ã€è¾¹ç¼˜ç‚¹ã€æš—åŒºçš„äº®ç‚¹åŠäº®åŒºçš„æš—ç‚¹ç­‰ã€‚<br>SIFTç‰¹å¾å¯¹æ—‹è½¬ã€å°ºåº¦ç¼©æ”¾ã€äº®åº¦å˜åŒ–ç­‰ä¿æŒä¸å˜æ€§ï¼Œå¯¹äºå…‰ç…§ã€ä»¿å°„å’ŒæŠ•å½±å˜æ¢ä¹Ÿæœ‰ä¸€å®šçš„ä¸å˜æ€§ï¼Œæ˜¯éå¸¸ç¨³å®šçš„å±€éƒ¨ç‰¹å¾ï¼Œç°åœ¨åº”ç”¨å¾ˆå¹¿æ³›ã€‚</p><p>Loweå°†SIFTç®—æ³•åˆ†è§£ä¸ºå¦‚ä¸‹å››æ­¥ï¼š</p><ol><li>å°ºåº¦ç©ºé—´æå€¼æ£€æµ‹ï¼šæœç´¢æ‰€æœ‰å°ºåº¦ä¸Šçš„å›¾åƒä½ç½®ã€‚é€šè¿‡é«˜æ–¯å¾®åˆ†å‡½æ•°æ¥è¯†åˆ«æ½œåœ¨çš„å¯¹äºå°ºåº¦å’Œæ—‹è½¬ä¸å˜çš„å…´è¶£ç‚¹ã€‚</li><li>ç‰¹å¾ç‚¹ç²¾ç¡®å®šä½ï¼šåœ¨æ¯ä¸ªå€™é€‰çš„ä½ç½®ä¸Šï¼Œé€šè¿‡ä¸€ä¸ªæ‹Ÿåˆç²¾ç»†çš„æ¨¡å‹æ¥ç¡®å®šä½ç½®å’Œå°ºåº¦ã€‚ç‰¹å¾ç‚¹çš„é€‰æ‹©ä¾æ®äºå®ƒä»¬çš„ç¨³å®šç¨‹åº¦ã€‚</li><li>æ–¹å‘ç¡®å®šï¼šåŸºäºå›¾åƒå±€éƒ¨çš„æ¢¯åº¦æ–¹å‘ï¼Œåˆ†é…ç»™æ¯ä¸ªç‰¹å¾ç‚¹ä½ç½®ä¸€ä¸ªæˆ–å¤šä¸ªæ–¹å‘ã€‚æ‰€æœ‰åé¢çš„å¯¹å›¾åƒæ•°æ®çš„æ“ä½œéƒ½ç›¸å¯¹äºå…³é”®ç‚¹çš„æ–¹å‘ã€å°ºåº¦å’Œä½ç½®è¿›è¡Œå˜æ¢ï¼Œä»è€Œæä¾›å¯¹äºè¿™äº›å˜æ¢çš„ä¸å˜æ€§ã€‚</li><li>ç‰¹å¾ç‚¹æè¿°ï¼šåœ¨æ¯ä¸ªå…³é”®ç‚¹å‘¨å›´çš„é‚»åŸŸå†…ï¼Œåœ¨é€‰å®šçš„å°ºåº¦ä¸Šæµ‹é‡å›¾åƒå±€éƒ¨çš„æ¢¯åº¦ã€‚è¿™äº›æ¢¯åº¦è¢«å˜æ¢æˆä¸€ç§è¡¨ç¤ºï¼Œè¿™ç§è¡¨ç¤ºå…è®¸æ¯”è¾ƒå¤§çš„å±€éƒ¨å½¢çŠ¶çš„å˜å½¢å’Œå…‰ç…§å˜åŒ–ã€‚</li></ol><h1 id="ç®—æ³•æµç¨‹"><a href="#ç®—æ³•æµç¨‹" class="headerlink" title="ç®—æ³•æµç¨‹"></a>ç®—æ³•æµç¨‹</h1><h2 id="å°ºåº¦ç©ºé—´æå€¼æ£€æµ‹"><a href="#å°ºåº¦ç©ºé—´æå€¼æ£€æµ‹" class="headerlink" title="å°ºåº¦ç©ºé—´æå€¼æ£€æµ‹"></a>å°ºåº¦ç©ºé—´æå€¼æ£€æµ‹</h2><h3 id="å°ºåº¦ç©ºé—´ç†è®º"><a href="#å°ºåº¦ç©ºé—´ç†è®º" class="headerlink" title="å°ºåº¦ç©ºé—´ç†è®º"></a>å°ºåº¦ç©ºé—´ç†è®º</h3><p>å°ºåº¦è¶Šå¤§å›¾åƒè¶Šæ¨¡ç³Šã€‚<br>ç”¨æœºå™¨è§†è§‰ç³»ç»Ÿåˆ†ææœªçŸ¥åœºæ™¯æ—¶ï¼Œè®¡ç®—æœºå¹¶ä¸é¢„å…ˆçŸ¥é“å›¾åƒä¸­ç‰©ä½“çš„å°ºåº¦ã€‚æˆ‘ä»¬éœ€è¦åŒæ—¶è€ƒè™‘å›¾åƒåœ¨å¤šå°ºåº¦ä¸‹çš„æè¿°ï¼Œè·çŸ¥æ„Ÿå…´è¶£ç‰©ä½“çš„æœ€ä½³å°ºåº¦ã€‚å¦å¤–å¦‚æœä¸åŒçš„å°ºåº¦ä¸‹éƒ½æœ‰åŒæ ·çš„å…³é”®ç‚¹ï¼Œé‚£ä¹ˆåœ¨ä¸åŒçš„å°ºåº¦çš„è¾“å…¥å›¾åƒä¸‹å°±éƒ½å¯ä»¥æ£€æµ‹å‡ºæ¥å…³é”®ç‚¹åŒ¹é…ï¼Œä¹Ÿå°±æ˜¯å°ºåº¦ä¸å˜æ€§ã€‚ å›¾åƒçš„å°ºåº¦ç©ºé—´è¡¨è¾¾å°±æ˜¯å›¾åƒåœ¨æ‰€æœ‰å°ºåº¦ä¸‹çš„æè¿°ã€‚</p><h3 id="é«˜æ–¯æ¨¡ç³Š"><a href="#é«˜æ–¯æ¨¡ç³Š" class="headerlink" title="é«˜æ–¯æ¨¡ç³Š"></a>é«˜æ–¯æ¨¡ç³Š</h3><p>é«˜æ–¯æ ¸æ˜¯å”¯ä¸€å¯ä»¥äº§ç”Ÿå¤šå°ºåº¦ç©ºé—´çš„æ ¸ã€‚<br>ä¸€ä¸ªå›¾åƒçš„å°ºåº¦ç©ºé—´$L(x,y,\sigma)$ï¼Œå®šä¹‰ä¸ºåŸå§‹å›¾åƒ$I(x,y)$ä¸ä¸€ä¸ªå¯å˜å°ºåº¦çš„2ç»´é«˜æ–¯å‡½æ•°$G(x,y,\sigma)$çš„å·ç§¯è¿ç®—ã€‚<br>äºŒç»´ç©ºé—´é«˜æ–¯å‡½æ•°ï¼š</p><script type="math/tex; mode=display">G(x_i,y_i,\sigma)=\frac{1}{2\pi\sigma^2}exp\lgroup-\frac{(x-x_i)^2+(y-y_i)^2}{2\sigma^2}\rgroup</script><p>é‚£ä¹ˆå°ºåº¦ç©ºé—´å°±æ˜¯ï¼š</p><script type="math/tex; mode=display">L(x,y,\sigma)=G(x,y,\sigma)*I(x,y)</script><p>åœ¨äºŒç»´ç©ºé—´ä¸­ï¼Œè¿™ä¸ªå…¬å¼ç”Ÿæˆçš„æ›²é¢çš„ç­‰é«˜çº¿æ˜¯ä»ä¸­å¿ƒå¼€å§‹å‘ˆæ­£æ€åˆ†å¸ƒçš„åŒå¿ƒåœ†ã€‚åˆ†å¸ƒä¸ä¸ºé›¶çš„åƒç´ ç»„æˆçš„å·ç§¯çŸ©é˜µä¸åŸå§‹å›¾åƒåšå˜æ¢ã€‚æ¯ä¸ªåƒç´ çš„å€¼éƒ½æ˜¯å‘¨å›´ç›¸é‚»åƒç´ å€¼çš„é«˜æ–¯åŠ æƒå¹³å‡ã€‚ä¸­å¿ƒåƒç´ çš„å€¼æœ‰æœ€å¤§çš„é«˜æ–¯åˆ†å¸ƒå€¼ï¼Œæ‰€ä»¥æœ‰æœ€å¤§çš„æƒé‡ï¼Œç›¸é‚»åƒç´ éšç€è·ç¦»ä¸­å¿ƒåƒç´ è¶Šæ¥è¶Šè¿œï¼Œå…¶æƒé‡ä¹Ÿè¶Šæ¥è¶Šå°ã€‚è¿™æ ·è¿›è¡Œæ¨¡ç³Šå¤„ç†æ¯”å…¶å®ƒçš„å‡è¡¡æ¨¡ç³Šæ»¤æ³¢å™¨æ›´é«˜åœ°ä¿ç•™äº†è¾¹ç¼˜æ•ˆæœã€‚$\sigma$è¶Šå¤§ï¼Œä¸­å¿ƒåƒç´ çš„æƒé‡ä¸å‘¨å›´åƒç´ å°±ä¼šç›¸å¯¹è¶Šå°ï¼ŒåŠ æƒå¹³å‡åå°±ä¼šè¶Šæ¨¡ç³Šï¼›åä¹‹ï¼Œ$\sigma$è¶Šå°ï¼Œä¸­å¿ƒåƒç´ æƒé‡ç›¸å¯¹è¶Šå¤§ï¼Œå½“$\sigma=0$æ—¶ï¼Œå°±æ˜¯åŸå›¾çš„æ ·å­ï¼Œç›¸å½“äºå‘¨å›´åƒç´ å¯¹æ–°å›¾æ²¡æœ‰è´¡çŒ®ã€‚æ¢å¥è¯è¯´ï¼Œå¤§å°ºåº¦å¯¹åº”äºå›¾åƒçš„æ¦‚è²Œç‰¹å¾ï¼Œå°å°ºåº¦å¯¹åº”äºå›¾åƒçš„ç»†èŠ‚ç‰¹å¾ã€‚<br>ç†è®ºä¸Šæ¥è®²ï¼Œå›¾åƒä¸­æ¯ç‚¹çš„åˆ†å¸ƒéƒ½ä¸ä¸ºé›¶ï¼Œè¿™ä¹Ÿå°±æ˜¯è¯´æ¯ä¸ªåƒç´ çš„è®¡ç®—éƒ½éœ€è¦åŒ…å«æ•´å¹…å›¾åƒã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œåœ¨è®¡ç®—é«˜æ–¯å‡½æ•°çš„ç¦»æ•£è¿‘ä¼¼æ—¶ï¼Œåœ¨å¤§æ¦‚$3\sigma$è·ç¦»ä¹‹å¤–çš„åƒç´ éƒ½å¯ä»¥çœ‹ä½œä¸èµ·ä½œç”¨ï¼Œè¿™äº›åƒç´ çš„è®¡ç®—ä¹Ÿå°±å¯ä»¥å¿½ç•¥ã€‚é€šå¸¸ï¼Œå›¾åƒå¤„ç†ç¨‹åºåªéœ€è¦è®¡ç®—$(6\sigma+1)\cdot(6\sigma+1)$çš„çŸ©é˜µå°±å¯ä»¥ä¿è¯ç›¸å…³åƒç´ å½±å“ã€‚</p><h3 id="é‡‘å­—å¡”å¤šåˆ†è¾¨ç‡"><a href="#é‡‘å­—å¡”å¤šåˆ†è¾¨ç‡" class="headerlink" title="é‡‘å­—å¡”å¤šåˆ†è¾¨ç‡"></a>é‡‘å­—å¡”å¤šåˆ†è¾¨ç‡</h3><p>ä¸å¤šå°ºåº¦ç©ºé—´ç›¸å¯¹çš„ï¼Œé‡‘å­—å¡”æ˜¯æ—©æœŸå›¾åƒå¤šå°ºåº¦çš„è¡¨ç¤ºæ–¹å¼ã€‚å›¾åƒé‡‘å­—å¡”åŒ–ä¸€èˆ¬ä¸¤ä¸ªæ­¥éª¤ï¼š<br>(1) ä½¿ç”¨ä½é€šæ»¤æ³¢å™¨ï¼ˆLPFï¼‰å¹³æ»‘å›¾åƒï¼›<br>(2) å¹³æ»‘å›¾åƒé™é‡‡æ ·ï¼ˆé€šå¸¸$\frac{1}{2}$ï¼‰<br>è¯¥æ–¹å¼èƒ½å¾—åˆ°ç³»åˆ—å°ºå¯¸ç¼©å°çš„å›¾ç‰‡ã€‚</p><p>å°ºåº¦ç©ºé—´è¡¨è¾¾å’Œé‡‘å­—å¡”åˆ†è¾¨ç‡è¡¨è¾¾çš„æ˜æ˜¾åŒºåˆ«æœ‰ï¼š<br>ï¼ˆ1ï¼‰å°ºåº¦ç©ºé—´è¡¨è¾¾æ˜¯ç”±ä¸åŒé«˜æ–¯æ ¸å¹³æ»‘å·ç§¯å¾—åˆ°çš„ï¼Œåœ¨æ‰€æœ‰å°ºåº¦ä¸Šåˆ†è¾¨ç‡ç›¸åŒï¼›<br>ï¼ˆ2ï¼‰é‡‘å­—å¡”å¤šåˆ†è¾¨ç‡è¡¨è¾¾æ¯å±‚åˆ†è¾¨ç‡å‡å°‘å›ºå®šæ¯”ç‡ã€‚<br>å› æ­¤ï¼Œé‡‘å­—å¡”å¤šåˆ†è¾¨ç‡ç”Ÿæˆå¿«ï¼Œç©ºé—´å°‘ï¼Œä½†å±€éƒ¨ç‰¹å¾æè¿°å•ä¸€ï¼›å¤šå°ºåº¦ç©ºé—´çš„å›¾ç‰‡å±€éƒ¨ç‰¹å¾å¯ä»¥åœ¨ä¸åŒå°ºåº¦æè¿°ï¼Œä½†éšå°ºåº¦å‚æ•°å¢åŠ ä¼šå¢åŠ å†—ä½™ä¿¡æ¯ã€‚</p><h3 id="é«˜æ–¯é‡‘å­—å¡”"><a href="#é«˜æ–¯é‡‘å­—å¡”" class="headerlink" title="é«˜æ–¯é‡‘å­—å¡”"></a>é«˜æ–¯é‡‘å­—å¡”</h3><p>é«˜æ–¯é‡‘å­—å¡”æ˜¯æœ€åŸºæœ¬çš„å›¾åƒå¡”ã€‚åŸç†ï¼šé¦–å…ˆå°†åŸå›¾åƒä½œä¸ºæœ€åº•å±‚å›¾åƒ level0ï¼ˆé«˜æ–¯é‡‘å­—å¡”çš„ç¬¬0å±‚ï¼‰ï¼Œåˆ©ç”¨é«˜æ–¯æ ¸ï¼ˆ$5*5$ï¼‰å¯¹å…¶è¿›è¡Œå·ç§¯ï¼Œç„¶åå¯¹å·ç§¯åçš„å›¾åƒè¿›è¡Œä¸‹é‡‡æ ·ï¼ˆå»é™¤å¶æ•°è¡Œå’Œåˆ—ï¼‰å¾—åˆ°ä¸Šä¸€å±‚å›¾åƒG1ï¼Œå°†æ­¤å›¾åƒä½œä¸ºè¾“å…¥ï¼Œé‡å¤å·ç§¯å’Œä¸‹é‡‡æ ·æ“ä½œå¾—åˆ°æ›´ä¸Šä¸€å±‚çš„å›¾åƒï¼Œåå¤è¿­ä»£å¤šæ¬¡ï¼Œå½¢æˆä¸€ä¸ªé‡‘å­—å¡”å½¢çš„å›¾åƒæ•°æ®ç»“æ„ï¼Œå³é«˜æ–¯é‡‘å­—å¡”ã€‚<br>é«˜æ–¯é‡‘å­—å¡”æ˜¯åœ¨siftç®—å­ä¸­æå‡ºæ¥çš„æ¦‚å¿µï¼Œé¦–å…ˆé«˜æ–¯é‡‘å­—å¡”å¹¶ä¸æ˜¯ä¸€ä¸ªé‡‘å­—å¡”ï¼Œè€Œæ˜¯ç”±å¾ˆå¤šç»„ï¼ˆOctaveï¼‰é‡‘å­—å¡”æ„æˆï¼Œå¹¶ä¸”æ¯ç»„é‡‘å­—å¡”éƒ½åŒ…å«è‹¥å¹²å±‚ï¼ˆIntervalï¼‰ï¼Œå³åœ¨åŒä¸€ç»„çš„é‡‘å­—å¡”ä¸­ï¼Œä½¿ç”¨ä¸åŒ$\sigma$è¿›è¡Œé«˜æ–¯æ¨¡ç³Šï¼Œç„¶åå†ä¸åŒç»„çš„é‡‘å­—å¡”ä¸­ï¼Œä½¿ç”¨ä¸‹é‡‡æ ·ï¼Œè·å¾—ä¸åŒåˆ†è¾¨ç‡çš„å›¾åƒã€‚<br>é«˜æ–¯é‡‘å­—å¡”çš„æ„å»ºè¿‡ç¨‹ï¼š<br>ï¼ˆ1ï¼‰å…ˆå°†åŸå›¾åƒæ‰©å¤§ä¸€å€ä¹‹åä½œä¸ºé«˜æ–¯é‡‘å­—å¡”çš„ç¬¬1ç»„ç¬¬1å±‚ï¼Œå°†ç¬¬1ç»„ç¬¬1å±‚å›¾åƒç»é«˜æ–¯å·ç§¯ï¼ˆé«˜æ–¯å¹³æ»‘æˆ–ç§°é«˜æ–¯æ»¤æ³¢ï¼‰ä¹‹åä½œä¸ºç¬¬1ç»„é‡‘å­—å¡”çš„ç¬¬2å±‚ã€‚å¯¹äºå‚æ•°$\sigma$ï¼Œåœ¨SIFTç®—å­ä¸­å–çš„æ˜¯å›ºå®šå€¼ 1.6ï¼›<br>ï¼ˆ2ï¼‰å°†$\sigma$ä¹˜ä»¥ä¸€ä¸ªæ¯”ä¾‹ç³»æ•°kï¼Œç­‰åˆ°ä¸€ä¸ªæ–°çš„å¹³æ»‘å› å­$\sigma = k *\sigma$ï¼Œç”¨å®ƒæ¥å¹³æ»‘ç¬¬1ç»„ç¬¬2å±‚å›¾åƒï¼Œç»“æœå›¾åƒä½œä¸ºç¬¬3å±‚ã€‚<br>ï¼ˆ3ï¼‰å¦‚æ­¤é‡å¤ï¼Œæœ€åå¾—åˆ°Lå±‚å›¾åƒï¼Œåœ¨åŒä¸€ç»„ä¸­ï¼Œæ¯ä¸€å±‚å›¾åƒçš„å°ºå¯¸éƒ½æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯å¹³æ»‘ç³»æ•°ä¸ä¸€æ ·ã€‚å®ƒä»¬å¯¹åº”çš„å¹³æ»‘ç³»æ•°åˆ†åˆ«ä¸ºï¼š$0ï¼Œ\sigmaï¼Œk\sigmaï¼Œk^2\sigmaï¼Œk^3\sigmaâ€¦â€¦k^{(L-2)}\sigma$ã€‚<br>ï¼ˆ4ï¼‰å°†ç¬¬1ç»„å€’æ•°ç¬¬ä¸‰å±‚å›¾åƒä½œä¸ºæ¯”ä¾‹å› å­ä¸º2çš„é™é‡‡æ ·ï¼Œå¾—åˆ°çš„å›¾åƒä½œä¸ºç¬¬2ç»„çš„ç¬¬1å±‚ï¼Œç„¶åå¯¹ç¬¬2ç»„çš„ç¬¬1å±‚å›¾åƒä½œå¹³æ»‘å› å­ä¸º $\sigma$çš„é«˜æ–¯å¹³æ»‘ï¼Œå¾—åˆ°ç¬¬2ç»„çš„ç¬¬2å±‚ï¼Œå°±åƒæ­¥éª¤2ä¸­ä¸€æ ·ï¼Œå¦‚æ­¤å¾—åˆ°ç¬¬2ç»„çš„Lå±‚å›¾åƒï¼ŒåŒç»„å†…å®ƒä»¬çš„å°ºå¯¸æ˜¯ä¸€æ ·çš„ï¼Œå¯¹åº”çš„å¹³æ»‘ç³»æ•°åˆ†åˆ«ä¸ºï¼š$0ï¼Œ\sigmaï¼Œk\sigmaï¼Œk^2\sigmaï¼Œk^3\sigmaâ€¦â€¦k^{(L-2)}\sigma$ã€‚ä½†æ˜¯åœ¨å°ºå¯¸æ–¹é¢ç¬¬2ç»„æ˜¯ç¬¬1ç»„å›¾åƒçš„ä¸€åŠã€‚<br>è¿™æ ·åå¤æ‰§è¡Œï¼Œå°±å¯ä»¥å¾—åˆ°ä¸€å…±Oç»„ï¼Œæ¯ç»„Lå±‚ï¼Œå…±è®¡$O*L$ä¸ªå›¾åƒï¼Œè¿™äº›å›¾åƒä¸€èµ·å°±æ„æˆäº†é«˜æ–¯é‡‘å­—å¡”ã€‚<br>åœ¨åŒä¸€ç»„å†…ï¼Œä¸åŒå±‚å›¾åƒçš„å°ºå¯¸æ˜¯ä¸€æ ·çš„ï¼Œåä¸€å±‚å›¾åƒçš„é«˜æ–¯å¹³æ»‘å› å­$\sigma$æ˜¯å‰ä¸€å±‚å›¾åƒå¹³æ»‘å› å­çš„$k$å€ï¼›<br>åœ¨ä¸åŒç»„å†…ï¼Œåä¸€ç»„ç¬¬ä¸€ä¸ªå›¾åƒæ˜¯å‰ä¸€ç»„å€’æ•°ç¬¬ä¸‰ä¸ªå›¾åƒçš„äºŒåˆ†ä¹‹ä¸€é‡‡æ ·ï¼Œå›¾åƒå¤§å°æ˜¯å‰ä¸€ç»„çš„ä¸€åŠã€‚</p><h3 id="é«˜æ–¯æ‹‰æ™®æ‹‰æ–¯é‡‘å­—å¡”"><a href="#é«˜æ–¯æ‹‰æ™®æ‹‰æ–¯é‡‘å­—å¡”" class="headerlink" title="é«˜æ–¯æ‹‰æ™®æ‹‰æ–¯é‡‘å­—å¡”"></a>é«˜æ–¯æ‹‰æ™®æ‹‰æ–¯é‡‘å­—å¡”</h3><p>LoGï¼ˆLaplace of Gaussianï¼‰æ˜¯å¯¹é«˜æ–¯å‡½æ•°è¿›è¡Œæ‹‰æ™®æ‹‰æ–¯å˜æ¢ï¼š</p><script type="math/tex; mode=display">L(x,y,\sigma)=\frac{\partial^2G}{\partial x^2} + \frac{\partial^2G}{\partial y^2}</script><p>æ‹‰æ™®æ‹‰æ–¯é‡‘å­—å¡”ç”¨äºé‡å»ºå›¾å½¢ï¼Œä¹Ÿå°±æ˜¯é¢„æµ‹æ®‹å·®ï¼Œå¯¹å›¾åƒè¿›è¡Œæœ€å¤§ç¨‹åº¦çš„è¿˜åŸã€‚æ¯”å¦‚ä¸€å¹…å°å›¾åƒé‡å»ºä¸ºä¸€å¹…å¤§å›¾ã€‚åŸç†ï¼šç”¨é«˜æ–¯é‡‘å­—å¡”çš„æ¯ä¸€å±‚å›¾åƒå‡å»å…¶ä¸Šä¸€å±‚å›¾åƒä¸Šé‡‡æ ·å¹¶é«˜æ–¯å·ç§¯ä¹‹åçš„é¢„æµ‹å›¾åƒï¼Œå¾—åˆ°ä¸€ç³»åˆ—çš„å·®å€¼å›¾åƒï¼Œå³ä¸ºLaplacianåˆ†è§£å›¾åƒã€‚<br>LoGç¬¬$i$å±‚çš„æ•°å­¦å®šä¹‰ï¼š</p><script type="math/tex; mode=display">\begin{align}L_i &= G_i-Up(G_{i+1})\otimes g \\&=G_i - PyrUp(G_{i+1}) \\\end{align}</script><p>å¼ä¸­ï¼Œ$G_i$è¡¨ç¤ºé«˜æ–¯é‡‘å­—å¡”ä¸­ç¬¬$i$å±‚å›¾åƒã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ‹‰æ™®æ‹‰æ–¯é‡‘å­—å¡”æ˜¯é€šè¿‡é«˜æ–¯é‡‘å­—å¡”å›¾åƒå‡å»å…ˆç¼©å°ï¼ˆå³ä¸Šä¸€å±‚å›¾åƒï¼‰åå†æ”¾å¤§ï¼ˆå³ä¸Šé‡‡æ ·æ“ä½œï¼‰å¹¶é«˜æ–¯å·ç§¯åçš„å›¾åƒçš„ä¸€ç³»åˆ—å›¾åƒæ„æˆçš„ã€‚</p><h3 id="é«˜æ–¯å·®åˆ†é‡‘å­—å¡”"><a href="#é«˜æ–¯å·®åˆ†é‡‘å­—å¡”" class="headerlink" title="é«˜æ–¯å·®åˆ†é‡‘å­—å¡”"></a>é«˜æ–¯å·®åˆ†é‡‘å­—å¡”</h3><p>LoGçš„ä¸»è¦ç¼ºç‚¹æ˜¯éœ€è¦æ±‚äºŒé˜¶å¯¼ï¼Œè®¡ç®—è¾ƒå¤æ‚ï¼Œå› æ­¤æˆ‘ä»¬å°±æƒ³ç”¨åˆ«çš„ç®—å­å»è¿‘ä¼¼å®ƒã€‚DoGï¼ˆDifference of Gaussianï¼‰ï¼Œç›¸å½“äºå¯¹LoGçš„è¿‘ä¼¼è®¡ç®—ï¼ŒSIFTç®—æ³•ä¸­å»ºè®®æŸä¸€å°ºåº¦çš„ç‰¹å¾æ£€æµ‹ï¼Œå¯ä»¥é€šè¿‡ä¸¤ä¸ªç›¸é‚»é«˜æ–¯å°ºåº¦ç©ºé—´çš„å›¾åƒç›¸å‡ï¼Œå¾—åˆ°DoGçš„å“åº”å€¼å›¾åƒã€‚DoGå’ŒLoGçš„å…³ç³»å¦‚ä¸‹è¿°æ‰€ç¤ºï¼š </p><script type="math/tex; mode=display">\sigma\nabla^2G = \frac{\partial G}{\partial\sigma} \approx \frac{G(x,y,k\sigma) - G(x,y,\sigma)}{k\sigma - \sigma}</script><p>å› æ­¤ï¼Œæœ‰ï¼š</p><script type="math/tex; mode=display">G(x,y,k\sigma) - G(x,y,y\sigma) \approx (k-1)\sigma^2\nabla^2G</script><p>è€Œ$\sigma^2\nabla^2G$æ­£æ˜¯å°ºåº¦å½’ä¸€åŒ–ç®—å­çš„è¡¨è¾¾å½¢å¼ã€‚åœ¨æ‰€æœ‰çš„å°ºåº¦ä¸­$k-1$æ˜¯ä¸€ä¸ªå¸¸æ•°ï¼Œå½“$k$è¶‹è¿‘äº1çš„æ—¶å€™è¯¯å·®è¶‹è¿‘äº0ï¼Œä½†å®é™…ä¸Šè¿™ç§è¯¯å·®å¯¹äºæå€¼çš„ä½ç½®æ£€æµ‹å¹¶æ²¡æœ‰ä»€ä¹ˆå½±å“ï¼ˆä¸è¿‡å‰äººçš„å®éªŒè¯æ˜LoGæå–çš„ç‰¹å¾ç¨³å®šæ€§æœ€å¼ºï¼‰ã€‚<br><img src="https://user-images.githubusercontent.com/6218739/138830197-52b6d1f1-ffb1-474e-abfa-d204cace5c57.png" alt="dog"></p><h3 id="ç©ºé—´æå€¼ç‚¹æ£€æµ‹ï¼ˆå…³é”®ç‚¹çš„åˆæ­¥æ¢æŸ¥ï¼‰"><a href="#ç©ºé—´æå€¼ç‚¹æ£€æµ‹ï¼ˆå…³é”®ç‚¹çš„åˆæ­¥æ¢æŸ¥ï¼‰" class="headerlink" title="ç©ºé—´æå€¼ç‚¹æ£€æµ‹ï¼ˆå…³é”®ç‚¹çš„åˆæ­¥æ¢æŸ¥ï¼‰"></a>ç©ºé—´æå€¼ç‚¹æ£€æµ‹ï¼ˆå…³é”®ç‚¹çš„åˆæ­¥æ¢æŸ¥ï¼‰</h3><p>SIFTå…³é”®ç‚¹æ˜¯ç”±DOGç©ºé—´çš„å±€éƒ¨æå€¼ç‚¹ç»„æˆçš„ï¼Œå…³é”®ç‚¹çš„åˆæ­¥æ¢æŸ¥æ˜¯é€šè¿‡åŒä¸€ç»„å†…å„DoGç›¸é‚»ä¸¤å±‚å›¾åƒä¹‹é—´æ¯”è¾ƒå®Œæˆçš„ã€‚<br>æå€¼ç‚¹å®šä¹‰ï¼šæ¯ä¸€ä¸ªåƒç´ ç‚¹ä¸å®ƒæ‰€æœ‰ç›¸é‚»ç‚¹æ¯”è¾ƒï¼Œå½“å…¶å¤§äºï¼ˆæˆ–å°äºï¼‰å®ƒçš„å›¾åƒåŸŸå’Œå°ºåº¦åŸŸçš„æ‰€æœ‰ç›¸é‚»ç‚¹æ—¶ï¼Œå³ä¸ºæå€¼ç‚¹ã€‚<br>ä¸ºäº†å¯»æ‰¾DoGå‡½æ•°çš„æå€¼ç‚¹ï¼Œæ¯ä¸€ä¸ªåƒç´ ç‚¹è¦å’Œå®ƒæ‰€æœ‰çš„ç›¸é‚»ç‚¹æ¯”è¾ƒï¼Œçœ‹å…¶æ˜¯å¦æ¯”å®ƒçš„å›¾åƒåŸŸå’Œå°ºåº¦åŸŸçš„ç›¸é‚»ç‚¹å¤§æˆ–è€…å°ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œä¸­é—´çš„æ£€æµ‹ç‚¹å’Œå®ƒåŒå°ºåº¦çš„8ä¸ªç›¸é‚»ç‚¹å’Œä¸Šä¸‹ç›¸é‚»å°ºåº¦å¯¹åº”çš„9Ã—2ä¸ªç‚¹å…±26ä¸ªç‚¹æ¯”è¾ƒï¼Œä»¥ç¡®ä¿åœ¨å°ºåº¦ç©ºé—´å’ŒäºŒç»´å›¾åƒç©ºé—´éƒ½æ£€æµ‹åˆ°æå€¼ç‚¹ã€‚<br><img src="https://user-images.githubusercontent.com/6218739/138831439-2566a884-59cf-45df-a11a-7aa319584b64.png" alt="peak-detect"><br>ç”±äºè¦åœ¨ç›¸é‚»å°ºåº¦è¿›è¡Œæ¯”è¾ƒï¼Œé‚£ä¹ˆå¯¹äºé«˜æ–¯å·®åˆ†é‡‘å­å¡”ä¸­çš„æ¯ä¸€ç»„çš„æ‰€æœ‰å±‚ï¼Œåªèƒ½åœ¨ä¸­é—´ä¸¤å±‚ä¸­è¿›è¡Œä¸¤ä¸ªå°ºåº¦çš„æå€¼ç‚¹æ£€æµ‹ï¼Œå…¶å®ƒå°ºåº¦åˆ™åªèƒ½åœ¨ä¸åŒç»„ä¸­è¿›è¡Œã€‚ä¸ºäº†åœ¨æ¯ç»„ä¸­æ£€æµ‹$S$ä¸ªå°ºåº¦çš„æå€¼ç‚¹ï¼Œåˆ™DOGé‡‘å­—å¡”æ¯ç»„éœ€$S+2$å±‚å›¾åƒï¼Œè€ŒDOGé‡‘å­—å¡”ç”±é«˜æ–¯é‡‘å­—å¡”ç›¸é‚»ä¸¤å±‚ç›¸å‡å¾—åˆ°ï¼Œåˆ™é«˜æ–¯é‡‘å­—å¡”æ¯ç»„éœ€$S+3$å±‚å›¾åƒï¼Œå®é™…è®¡ç®—æ—¶Såœ¨3åˆ°5ä¹‹é—´ã€‚<br>å½“ç„¶è¿™æ ·äº§ç”Ÿçš„æå€¼ç‚¹å¹¶ä¸å…¨éƒ½æ˜¯ç¨³å®šçš„ç‰¹å¾ç‚¹ï¼Œå› ä¸ºæŸäº›æå€¼ç‚¹å“åº”è¾ƒå¼±ï¼Œè€Œä¸”DOGç®—å­ä¼šäº§ç”Ÿè¾ƒå¼ºçš„è¾¹ç¼˜å“åº”ã€‚</p><p>åˆ°è¿™é‡Œï¼Œæ€»ç»“ä¸€ä¸‹ï¼Œæ„å»ºDOGå°ºåº¦ç©ºé—´é‡‘å­—å¡”çš„ä¸‰ä¸ªé‡è¦å‚æ•°æ˜¯ï¼šå°ºåº¦$\sigma$ã€ç»„(octave)æ•°$O$å’Œç»„å†…å±‚æ•°$S$ã€‚</p><h2 id="ç‰¹å¾ç‚¹ç²¾ç¡®å®šä½"><a href="#ç‰¹å¾ç‚¹ç²¾ç¡®å®šä½" class="headerlink" title="ç‰¹å¾ç‚¹ç²¾ç¡®å®šä½"></a>ç‰¹å¾ç‚¹ç²¾ç¡®å®šä½</h2><p>è®¡ç®—æœºä¸­å­˜å‚¨çš„å›¾åƒæ•°æ®æ˜¯ç¦»æ•£çš„ï¼Œè€Œæˆ‘ä»¬ä¹‹å‰æ‰¾åˆ°çš„æå€¼ç‚¹ä¹Ÿå°±æ˜¯ç¦»æ•£ç©ºé—´ä¸­çš„æå€¼ç‚¹ï¼Œä½†æ˜¯ç¦»æ•£ç©ºé—´ä¸­çš„æå€¼ç‚¹å¹¶ä¸æ˜¯çœŸå®çš„è¿ç»­ç©ºé—´ä¸­çš„æå€¼ç‚¹ã€‚æ‰€ä»¥éœ€è¦å¯¹DoGç©ºé—´è¿›è¡Œæ‹Ÿåˆå¤„ç†ï¼Œä»¥æ‰¾åˆ°æå€¼ç‚¹çš„ç²¾ç¡®ä½ç½®å’Œå°ºåº¦ã€‚å¦å¤–ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å»é™¤é‚£äº›åœ¨è¾¹ç¼˜ä½ç½®çš„æå€¼ç‚¹ï¼Œä»¥æé«˜å…³é”®ç‚¹çš„ç¨³å®šæ€§ã€‚</p><h3 id="ç²¾ç¡®å®šä½"><a href="#ç²¾ç¡®å®šä½" class="headerlink" title="ç²¾ç¡®å®šä½"></a>ç²¾ç¡®å®šä½</h3><p><img src="https://user-images.githubusercontent.com/6218739/138843995-feea3390-c7fd-4f40-8fb1-88660ed06b1d.png" alt="fit"><br>åˆ©ç”¨å·²çŸ¥çš„ç¦»æ•£ç©ºé—´ç‚¹æ’å€¼å¾—åˆ°è¿ç»­ç©ºé—´æå€¼ç‚¹çš„æ–¹æ³•å«åšå­åƒå…ƒæ’å€¼ã€‚<br>åœ¨Loweçš„è®ºæ–‡ä¸­ï¼Œä½¿ç”¨çš„æ˜¯æ³°å‹’å±•å¼€å¼ä½œä¸ºæ‹Ÿåˆå‡½æ•°ã€‚<br>é€šè¿‡ä¸Šæ­¥çš„æå€¼ç‚¹æ£€æµ‹ï¼Œæˆ‘ä»¬å¾—åˆ°çš„æå€¼ç‚¹æ˜¯ä¸€ä¸ªä¸‰ç»´å‘é‡ï¼ŒåŒ…æ‹¬å®ƒæ‰€åœ¨çš„å°ºåº¦$\sigma$ä»¥åŠæ‰€åœ¨å°ºåº¦å›¾åƒä¸­çš„ä½ç½®åæ ‡$(x, y)$ã€‚<br>è®¾$X_0 = (x_0,y_0,\sigma_0)$ï¼Œåˆ™æ³°å‹’å±•å¼€çš„çŸ©é˜µè¡¨ç¤ºä¸ºï¼š</p><script type="math/tex; mode=display">f(\left[\begin{matrix}x\\y\\\sigma\end{matrix}\right]) \approx f(\left[\begin{matrix}x_0\\y_0\\\sigma_0\end{matrix}\right]) + [\frac{\partial f}{\partial x}    \frac{\partial f}{\partial y} \frac{\partial f}{\partial \sigma}]\left(\left[\begin{matrix}x\\y\\\sigma\end{matrix}\right]-\left[\begin{matrix}x_0\\y_0\\\sigma_0\end{matrix}\right]\right) + \\\frac{1}{2}\left(\left[x \quad y \quad \sigma\right] - \left[x_0 \quad y_0 \quad \sigma_0\right]\right)\left[\begin{matrix}\frac{\partial^2 f}{\partial x \partial x} & \frac{\partial^2 f}{\partial x \partial y} & \frac{\partial^2 f}{\partial x \partial \sigma} \\ \frac{\partial^2 f}{\partial x \partial y}&\frac{\partial^2 f}{\partial y \partial y}&\frac{\partial^2 f}{\partial y \partial \sigma}\\\frac{\partial^2 f}{\partial x \partial \sigma}&\frac{\partial^2 f}{\partial y \partial \sigma}&\frac{\partial^2 f}{\partial \sigma \partial \sigma}\end{matrix}\right]\left(\left[\begin{matrix}x\\y\\\sigma\end{matrix}\right]-\left[\begin{matrix}x_0\\y_0\\\sigma_0\end{matrix}\right]\right)</script><p>è‹¥å†™æˆçŸ¢é‡å½¢å¼ï¼Œåˆ™ä¸º ï¼š</p><script type="math/tex; mode=display">f(X) = f(X_0ï¼‰+\frac{\partial f^T}{\partial X}(X- X_0)+\frac{1}{2}(X-X_0)^T\frac{\partial^2 f}{\partial X^2}(X-X_0)</script><p>åœ¨è¿™é‡Œ$X_0$è¡¨ç¤ºç¦»æ•£çš„æ’å€¼ä¸­å¿ƒï¼Œ$X$è¡¨ç¤ºæ‹Ÿåˆåè¿ç»­ç©ºé—´çš„æ’å€¼ç‚¹åæ ‡ï¼Œåˆ™è®¾$\hat{X} = X - X_0$ï¼Œè¡¨ç¤ºåç§»é‡ï¼Œå¸¦å…¥ä¸Šå¼ï¼Œå¦æ±‚å¾—çš„å¯¼æ•°ä¸º0ï¼ˆæ±‚ä¸€é˜¶å¯¼ç­‰äº0å¾—åˆ°çš„ç‚¹å°±æ˜¯æå€¼ç‚¹ï¼‰ï¼Œåˆ™æœ‰ </p><script type="math/tex; mode=display">\hat{X} = -\frac{\partial^2 f^{-1}}{\partial X^2}\frac{\partial f}{\partial X}</script><p>åªè¦ä¸Šå¼ä¸­å¾—åˆ°çš„åç§»é‡å¤§äº0.5ï¼Œåˆ™è®¤ä¸ºåç§»é‡è¿‡å¤§ï¼Œéœ€è¦æŠŠä½ç½®ç§»åŠ¨åˆ°æ‹Ÿåˆåçš„æ–°ä½ç½®ï¼Œç»§ç»­è¿›è¡Œè¿­ä»£æ±‚åç§»é‡ï¼Œè‹¥è¿­ä»£è¿‡ä¸€å®šæ¬¡æ•°ååç§»é‡ä»ç„¶å¤§äº0.5ï¼Œåˆ™æŠ›å¼ƒè¯¥ç‚¹ã€‚å¦‚æœè¿­ä»£è¿‡ç¨‹ä¸­æœ‰åç§»é‡å°äº0.5ï¼Œåˆ™åœæ­¢è¿­ä»£ã€‚ </p><p>æŠŠè¯¥æå€¼ç‚¹å¸¦å…¥åˆ°åŸå…¬å¼ä¸­ï¼Œåˆ™å¾—åˆ°æå€¼ç‚¹æ‰€åœ¨çš„å‡½æ•°å€¼ï¼š</p><script type="math/tex; mode=display">f(\hat{X}) = f(X_0) + \frac{1}{2}\frac{\partial f^T}{\partial X} \hat{X}</script><p>å¦‚æœä¸Šå¼ä¸­å¾—åˆ°çš„$f(\hat{X})$è¿‡å°ï¼Œå³å…¶å“åº”å€¼è¿‡å°ï¼Œè¿™æ ·çš„ç‚¹æ˜“å—å™ªå£°çš„å¹²æ‰°è€Œå˜å¾—ä¸ç¨³å®šï¼Œæ‰€ä»¥ä¹Ÿè¦è¢«åˆ é™¤ï¼ŒLoweè®ºæ–‡ä¸­é˜ˆå€¼ä¸º0.03ï¼ˆè®¾ç°åº¦å€¼ä¸º0~1ï¼‰ã€‚</p><h3 id="æ¶ˆé™¤è¾¹ç¼˜å“åº”"><a href="#æ¶ˆé™¤è¾¹ç¼˜å“åº”" class="headerlink" title="æ¶ˆé™¤è¾¹ç¼˜å“åº”"></a>æ¶ˆé™¤è¾¹ç¼˜å“åº”</h3><p>æœ‰äº›æå€¼ç‚¹çš„ä½ç½®æ˜¯åœ¨å›¾åƒçš„è¾¹ç¼˜ä½ç½®çš„ï¼Œå› ä¸ºå›¾åƒçš„è¾¹ç¼˜ç‚¹å¾ˆéš¾å®šä½ï¼ŒåŒæ—¶ä¹Ÿå®¹æ˜“å—åˆ°å™ªå£°çš„å¹²æ‰°ï¼Œæˆ‘ä»¬æŠŠè¿™äº›ç‚¹çœ‹åšæ˜¯ä¸ç¨³å®šçš„æå€¼ç‚¹ï¼Œéœ€è¦è¿›è¡Œå»é™¤ã€‚<br>ç”±äºå›¾åƒä¸­çš„ç‰©ä½“çš„è¾¹ç¼˜ä½ç½®çš„ç‚¹çš„ä¸»æ›²ç‡ä¸€èˆ¬ä¼šæ¯”è¾ƒé«˜ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸»æ›²ç‡æ¥åˆ¤æ–­è¯¥ç‚¹æ˜¯å¦åœ¨ç‰©ä½“çš„è¾¹ç¼˜ä½ç½®ã€‚<br>æŸåƒç´ ç‚¹ä½ç½®å¤„çš„ä¸»æ›²ç‡å¯ä»¥ç”±äºŒç»´çš„HessiançŸ©é˜µè®¡ç®—å¾—åˆ°ï¼š</p><script type="math/tex; mode=display">H = \left[\begin{matrix}D_{xx}(x,y)&D_{xy}(x,y)\\D_{xy}(x,y)&D_{yy}(x,y)\end{matrix}\right]</script><p>è®¾è¯¥çŸ©é˜µçš„ä¸¤ä¸ªç‰¹å¾å€¼åˆ†åˆ«ä¸º$\alpha$å’Œ$\beta$ï¼Œå…¶ä¸­$\alpha = \gamma\beta$ï¼Œæœ‰å¦‚ä¸‹å…¬å¼ï¼š</p><script type="math/tex; mode=display">Tr(H) = \alpha +\beta</script><p>å’Œ</p><script type="math/tex; mode=display">Det(H) = \alpha\beta</script><p>å…¶ä¸­$Tr(H)$è¡¨ç¤ºçŸ©é˜µçš„è¿¹ï¼Œ$Det(H)$è¡¨ç¤ºçš„çŸ©é˜µçš„è¡Œåˆ—å¼ã€‚<br>é¦–å…ˆéœ€è¦å»é™¤è¡Œåˆ—å¼ä¸ºè´Ÿçš„ç‚¹ã€‚æ¥ä¸‹æ¥éœ€è¦å»æ‰ä¸»æ›²ç‡æ¯”è¾ƒå¤§çš„ç‚¹ï¼ŒLoweä¸­ä½¿ç”¨å¦‚ä¸‹åˆ¤æ–­è§„åˆ™ï¼š</p><script type="math/tex; mode=display">\frac{Tr(H)^2}{Det(H)} = \frac{(\gamma\beta+\beta)^2}{\gamma\beta^2} = \frac{(\gamma+1)^2}{\gamma}</script><p>è¿™é‡Œ$\gamma$è¶Šå¤§ï¼Œåˆ™è¡¨ç¤ºè¯¥ç‚¹è¶Šæœ‰å¯èƒ½åœ¨è¾¹ç¼˜ï¼Œå› æ­¤è¦æ£€æŸ¥ä¸»æ›²ç‡æ˜¯å¦è¶…è¿‡ä¸€å®šçš„é˜ˆå€¼$\gamma_0$ï¼Œåªéœ€è¦åˆ¤æ–­ï¼š</p><script type="math/tex; mode=display">\frac{Tr(H)^2}{Det(H)} < \frac{(\gamma_0+1)^2}{\gamma_0}</script><p>Loweè®ºæ–‡ä¸­é˜ˆå€¼ä¸º10ã€‚ </p><h2 id="ç‰¹å¾ç‚¹æ–¹å‘ç¡®å®š"><a href="#ç‰¹å¾ç‚¹æ–¹å‘ç¡®å®š" class="headerlink" title="ç‰¹å¾ç‚¹æ–¹å‘ç¡®å®š"></a>ç‰¹å¾ç‚¹æ–¹å‘ç¡®å®š</h2><p>ä¸Šé¢æˆ‘ä»¬å·²ç»æ‰¾åˆ°äº†ç‰¹å¾ç‚¹ã€‚ä¸ºäº†å®ç°å›¾åƒæ—‹è½¬ä¸å˜æ€§ï¼Œéœ€è¦æ ¹æ®æ£€æµ‹åˆ°çš„ç‰¹å¾ç‚¹å±€éƒ¨å›¾åƒç»“æ„ä¸ºç‰¹å¾ç‚¹æ–¹å‘èµ‹å€¼ã€‚æˆ‘ä»¬ä½¿ç”¨å›¾åƒçš„æ¢¯åº¦ç›´æ–¹å›¾æ³•æ±‚ç‰¹å¾ç‚¹å±€éƒ¨ç»“æ„çš„ç¨³å®šæ–¹å‘ã€‚</p><h3 id="æ¢¯åº¦æ–¹å‘å’Œå¹…å€¼"><a href="#æ¢¯åº¦æ–¹å‘å’Œå¹…å€¼" class="headerlink" title="æ¢¯åº¦æ–¹å‘å’Œå¹…å€¼"></a>æ¢¯åº¦æ–¹å‘å’Œå¹…å€¼</h3><p>åœ¨å‰æ–‡ä¸­ï¼Œç²¾ç¡®å®šä½å…³é”®ç‚¹åä¹Ÿæ‰¾åˆ°ç‰¹å¾ç‚¹çš„å°ºåº¦å€¼$\sigma$ï¼Œæ ¹æ®è¿™ä¸€å°ºåº¦å€¼ï¼Œå¾—åˆ°æœ€æ¥è¿‘è¿™ä¸€å°ºåº¦å€¼çš„é«˜æ–¯å›¾åƒï¼š </p><script type="math/tex; mode=display">L(x,y) = G(x,y,\sigma)\otimes I(x,y)</script><p>ä½¿ç”¨æœ‰é™å·®åˆ†ï¼Œè®¡ç®—ä»¥ç‰¹å¾ç‚¹ä¸ºä¸­å¿ƒï¼Œä»¥$3\times1.5\sigma$ä¸ºåŠå¾„çš„åŒºåŸŸå†…å›¾åƒæ¢¯åº¦çš„å¹…å€¼$m(x,y)$å’Œå¹…è§’$\theta(x,y)$ï¼Œå…¬å¼å¦‚ä¸‹ï¼š </p><script type="math/tex; mode=display">\begin{align}m(x,y) &= \sqrt{(L(x+1, y) - L(x-1,y))^2+(L(x,y+1)-L(x,y-1))^2} \\\theta(x,y)&=arctan(\frac{L(x,y+1)-L(x,y-1)}{L(x+1,y)-L(x-1,y)})\end{align}</script><h3 id="æ¢¯åº¦ç›´æ–¹å›¾"><a href="#æ¢¯åº¦ç›´æ–¹å›¾" class="headerlink" title="æ¢¯åº¦ç›´æ–¹å›¾"></a>æ¢¯åº¦ç›´æ–¹å›¾</h3><p>åœ¨å®Œæˆç‰¹å¾ç‚¹é‚»åŸŸå†…é«˜æ–¯å›¾åƒæ¢¯åº¦è®¡ç®—åï¼Œä½¿ç”¨ç›´æ–¹å›¾ç»Ÿè®¡é‚»åŸŸå†…åƒç´ å¯¹åº”çš„æ¢¯åº¦æ–¹å‘å’Œå¹…å€¼ã€‚<br>æ¢¯åº¦æ–¹å‘ç›´æ–¹å›¾çš„æ¨ªè½´æ˜¯æ¢¯åº¦æ–¹å‘è§’ï¼Œçºµè½´æ˜¯æ¢¯åº¦æ–¹å‘è§’å¯¹åº”çš„æ¢¯åº¦å¹…å€¼ç´¯åŠ å€¼ï¼ˆ(ä¸ºç®€åŒ–ï¼Œå›¾ä¸­åªç”»äº†å…«ä¸ªæ–¹å‘çš„ç›´æ–¹å›¾)ï¼‰ã€‚æ¢¯åº¦æ–¹å‘ç›´æ–¹å›¾å°†0Â°~360Â°çš„èŒƒå›´åˆ†ä¸º36ä¸ªæŸ±ï¼Œæ¯10Â°ä¸ºä¸€ä¸ªæŸ±ã€‚å¯çœ‹ä½œä¸€å®šåŒºåŸŸå†…çš„å›¾åƒåƒç´ ç‚¹å¯¹ç‰¹å¾ç‚¹æ–¹å‘ç”Ÿæˆæ‰€ä½œçš„è´¡çŒ®ã€‚<br><img src="https://user-images.githubusercontent.com/6218739/138852341-c6e124e1-3cad-43e6-9b1d-af995d9a7bb6.png" alt="hist"><br>åœ¨è®¡ç®—ç›´æ–¹å›¾æ—¶ï¼Œæ¯ä¸ªåŠ å…¥ç›´æ–¹å›¾çš„é‡‡æ ·ç‚¹éƒ½ä½¿ç”¨åœ†å½¢é«˜æ–¯å‡½æ•°å‡½æ•°è¿›è¡Œäº†åŠ æƒå¤„ç†ï¼Œä¹Ÿå°±æ˜¯è¿›è¡Œé«˜æ–¯å¹³æ»‘ã€‚Loweå»ºè®®å­åŒºåŸŸçš„åƒç´ çš„æ¢¯åº¦å¤§å°$\sigma=0.5d$çš„é«˜æ–¯åŠ æƒè®¡ç®—ã€‚è¿™ä¸»è¦æ˜¯å› ä¸ºSIFTç®—æ³•åªè€ƒè™‘äº†å°ºåº¦å’Œæ—‹è½¬ä¸å˜å½¢ï¼Œæ²¡æœ‰è€ƒè™‘ä»¿å°„ä¸å˜æ€§ã€‚é€šè¿‡é«˜æ–¯å¹³æ»‘ï¼Œå¯ä»¥ä½¿å…³é”®ç‚¹é™„è¿‘çš„æ¢¯åº¦å¹…å€¼æœ‰è¾ƒå¤§æƒé‡ï¼Œä»è€Œéƒ¨åˆ†å¼¥è¡¥æ²¡è€ƒè™‘ä»¿å°„ä¸å˜å½¢äº§ç”Ÿçš„ç‰¹å¾ç‚¹ä¸ç¨³å®šã€‚<br>é€šå¸¸ç¦»æ•£çš„æ¢¯åº¦ç›´æ–¹å›¾è¦è¿›è¡Œæ’å€¼æ‹Ÿåˆå¤„ç†ï¼Œä»¥æ±‚å–æ›´ç²¾ç¡®çš„æ–¹å‘è§’åº¦å€¼ã€‚</p><h3 id="ç‰¹å¾ç‚¹æ–¹å‘"><a href="#ç‰¹å¾ç‚¹æ–¹å‘" class="headerlink" title="ç‰¹å¾ç‚¹æ–¹å‘"></a>ç‰¹å¾ç‚¹æ–¹å‘</h3><p>ç›´æ–¹å›¾å³°å€¼ä»£è¡¨è¯¥ç‰¹å¾ç‚¹å¤„é‚»åŸŸå†…å›¾åƒæ¢¯åº¦çš„ä¸»æ–¹å‘ï¼Œä¹Ÿå°±æ˜¯è¯¥ç‰¹å¾ç‚¹çš„ä¸»æ–¹å‘ã€‚åœ¨æ¢¯åº¦æ–¹å‘ç›´æ–¹å›¾ä¸­ï¼Œå½“å­˜åœ¨å¦ä¸€ä¸ªç›¸å½“äºä¸»å³°å€¼$80\%$èƒ½é‡çš„å³°å€¼æ—¶ï¼Œåˆ™å°†è¿™ä¸ªæ–¹å‘è®¤ä¸ºæ˜¯è¯¥ç‰¹å¾ç‚¹çš„è¾…æ–¹å‘ã€‚<br>æ‰€ä»¥ä¸€ä¸ªç‰¹å¾ç‚¹å¯èƒ½æ£€æµ‹å¾—åˆ°å¤šä¸ªæ–¹å‘ï¼Œè¿™å¯ä»¥å¢å¼ºåŒ¹é…çš„é²æ£’æ€§ã€‚Loweçš„è®ºæ–‡æŒ‡å‡ºå¤§æ¦‚æœ‰$15\%$ç‰¹å¾ç‚¹å…·æœ‰å¤šæ–¹å‘ï¼Œä½†è¿™äº›ç‚¹å¯¹åŒ¹é…çš„ç¨³å®šæ€§è‡³ä¸ºå…³é”®ã€‚<br>è·å¾—å›¾åƒç‰¹å¾ç‚¹ä¸»æ–¹å‘åï¼Œæ¯ä¸ªç‰¹å¾ç‚¹æœ‰ä¸‰ä¸ªä¿¡æ¯$(x,y,\sigma,\theta)$ï¼šä½ç½®ã€å°ºåº¦ã€æ–¹å‘ã€‚<br>ç”±æ­¤æˆ‘ä»¬å¯ä»¥ç¡®å®šä¸€ä¸ªSIFTç‰¹å¾åŒºåŸŸã€‚é€šå¸¸ä½¿ç”¨ä¸€ä¸ªå¸¦ç®­å¤´çš„åœ†æˆ–ç›´æ¥ä½¿ç”¨ç®­å¤´è¡¨ç¤ºSIFTåŒºåŸŸçš„ä¸‰ä¸ªå€¼ï¼šä¸­å¿ƒè¡¨ç¤ºç‰¹å¾ç‚¹ä½ç½®ï¼ŒåŠå¾„è¡¨ç¤ºç‰¹å¾ç‚¹å°ºåº¦ï¼ˆ$r=2.5\sigma$ï¼‰ï¼Œç®­å¤´è¡¨ç¤ºä¸»æ–¹å‘ã€‚<br>å…·æœ‰å¤šä¸ªæ–¹å‘çš„ç‰¹å¾ç‚¹å¯ä»¥å¤åˆ¶æˆå¤šä»½ï¼Œç„¶åå°†æ–¹å‘å€¼åˆ†åˆ«èµ‹ç»™å¤åˆ¶åçš„ç‰¹å¾ç‚¹ã€‚å¦‚ä¸‹å›¾ï¼š<br><img src="https://user-images.githubusercontent.com/6218739/138855713-27783685-f694-4aca-a641-9bef8c823c56.png" alt="fea1"></p><h2 id="ç‰¹å¾ç‚¹æè¿°"><a href="#ç‰¹å¾ç‚¹æè¿°" class="headerlink" title="ç‰¹å¾ç‚¹æè¿°"></a>ç‰¹å¾ç‚¹æè¿°</h2><p>ä¸Šæ–‡æ‰¾åˆ°çš„SIFTç‰¹å¾ç‚¹åŒ…å«ä½ç½®ã€å°ºåº¦å’Œæ–¹å‘çš„ä¿¡æ¯ã€‚æ¥ä¸‹æ¥çš„æ­¥éª¤æ˜¯ç‰¹å¾ç‚¹æè¿°ï¼Œå³ç”¨ä¸€ç»„å‘é‡å°†è¿™ä¸ªç‰¹å¾ç‚¹æè¿°å‡ºæ¥ï¼Œè¿™ä¸ªæè¿°å­ä¸ä½†åŒ…æ‹¬ç‰¹å¾ç‚¹ï¼Œä¹ŸåŒ…æ‹¬ç‰¹å¾ç‚¹å‘¨å›´å¯¹å…¶æœ‰è´¡çŒ®çš„åƒç´ ç‚¹ï¼Œç”¨æ¥ä½œä¸ºç›®æ ‡åŒ¹é…çš„ä¾æ®ï¼ˆæ‰€ä»¥æè¿°å­åº”è¯¥æœ‰è¾ƒé«˜çš„ç‹¬ç‰¹æ€§ï¼Œä»¥ä¿è¯åŒ¹é…ç‡ï¼‰ï¼Œä¹Ÿå¯ä½¿ç‰¹å¾ç‚¹å…·æœ‰æ›´å¤šçš„ä¸å˜ç‰¹æ€§ï¼Œå¦‚å…‰ç…§å˜åŒ–ã€3Dè§†ç‚¹å˜åŒ–ç­‰ã€‚<br>SIFTæè¿°å­$h(x,y,\theta)$æ˜¯å¯¹ç‰¹å¾ç‚¹é™„è¿‘é‚»åŸŸå†…é«˜æ–¯å›¾åƒæ¢¯åº¦ç»Ÿè®¡çš„ç»“æœï¼Œæ˜¯ä¸€ä¸ªä¸‰ç»´çŸ©é˜µï¼Œä½†é€šå¸¸ç”¨ä¸€ä¸ªçŸ¢é‡æ¥è¡¨ç¤ºã€‚ç‰¹å¾å‘é‡é€šè¿‡å¯¹ä¸‰ç»´çŸ©é˜µæŒ‰ä¸€å®šè§„å¾‹æ’åˆ—å¾—åˆ°ã€‚</p><h3 id="æè¿°å­é‡‡æ ·åŒºåŸŸ"><a href="#æè¿°å­é‡‡æ ·åŒºåŸŸ" class="headerlink" title="æè¿°å­é‡‡æ ·åŒºåŸŸ"></a>æè¿°å­é‡‡æ ·åŒºåŸŸ</h3><p>ç‰¹å¾æè¿°å­ä¸ç‰¹å¾ç‚¹æ‰€åœ¨å°ºåº¦æœ‰å…³ï¼Œå› æ­¤å¯¹æ¢¯åº¦çš„æ±‚å–åº”åœ¨ç‰¹å¾ç‚¹å¯¹åº”çš„é«˜æ–¯å›¾åƒä¸Šè¿›è¡Œã€‚<br>å°†ç‰¹å¾ç‚¹é™„è¿‘åˆ’åˆ†æˆ$d\times d$ä¸ªå­åŒºåŸŸï¼Œæ¯ä¸ªå­åŒºåŸŸå°ºå¯¸ä¸º$m\sigma$ä¸ªåƒå…ƒï¼ˆ$d=4$ï¼Œ$m=3$ï¼Œ$\sigma$ä¸ºç‰¹å¾ç‚¹çš„å°ºåº¦å€¼ï¼‰ã€‚è€ƒè™‘åˆ°å®é™…è®¡ç®—æ—¶éœ€è¦åŒçº¿æ€§æ’å€¼ï¼Œæ•…è®¡ç®—çš„å›¾åƒåŒºåŸŸä¸º$m\sigma(d+1)$ï¼Œå†è€ƒè™‘æ—‹è½¬ï¼Œåˆ™å®é™…è®¡ç®—çš„å›¾åƒåŒºåŸŸä¸º$\frac{\sqrt{2}}{2}m\sigma(d+1)$ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="https://user-images.githubusercontent.com/6218739/138855575-3dc7b05b-90af-4bc7-82b5-6228406161df.png" alt="area"></p><h3 id="åŒºåŸŸåæ ‡è½´æ—‹è½¬"><a href="#åŒºåŸŸåæ ‡è½´æ—‹è½¬" class="headerlink" title="åŒºåŸŸåæ ‡è½´æ—‹è½¬"></a>åŒºåŸŸåæ ‡è½´æ—‹è½¬</h3><p>ä¸ºäº†ä¿è¯ç‰¹å¾çŸ¢é‡å…·æœ‰æ—‹è½¬ä¸å˜æ€§ï¼Œè¦ä»¥ç‰¹å¾ç‚¹ä¸ºä¸­å¿ƒï¼Œåœ¨é™„è¿‘é‚»åŸŸå†…æ—‹è½¬$\theta$è§’ï¼Œå³æ—‹è½¬ä¸ºç‰¹å¾ç‚¹çš„æ–¹å‘ã€‚<br><img src="https://user-images.githubusercontent.com/6218739/138855946-d33c2c3c-7d7e-4f73-b441-24184c7d2ed1.png" alt="rotate"><br>æ—‹è½¬ååŒºåŸŸå†…é‡‡æ ·ç‚¹æ–°çš„åæ ‡ä¸ºï¼š </p><script type="math/tex; mode=display">\begin{pmatrix} x' \\ y'\end{pmatrix} = \begin{pmatrix} cos\theta & -sin\theta \\ sin\theta & cos\theta\end{pmatrix} \begin{pmatrix} x \\ y\end{pmatrix}</script><h3 id="è®¡ç®—é‡‡æ ·åŒºåŸŸæ¢¯åº¦ç›´æ–¹å›¾"><a href="#è®¡ç®—é‡‡æ ·åŒºåŸŸæ¢¯åº¦ç›´æ–¹å›¾" class="headerlink" title="è®¡ç®—é‡‡æ ·åŒºåŸŸæ¢¯åº¦ç›´æ–¹å›¾"></a>è®¡ç®—é‡‡æ ·åŒºåŸŸæ¢¯åº¦ç›´æ–¹å›¾</h3><p>å°†æ—‹è½¬ååŒºåŸŸåˆ’åˆ†ä¸º$d\times d$ä¸ªå­åŒºåŸŸï¼ˆæ¯ä¸ªåŒºåŸŸé—´éš”ä¸º$m\sigma$åƒå…ƒï¼‰ï¼Œåœ¨å­åŒºåŸŸå†…è®¡ç®—8ä¸ªæ–¹å‘çš„æ¢¯åº¦ç›´æ–¹å›¾ï¼Œç»˜åˆ¶æ¯ä¸ªæ–¹å‘æ¢¯åº¦æ–¹å‘çš„ç´¯åŠ å€¼ï¼Œå½¢æˆä¸€ä¸ªç§å­ç‚¹ã€‚ ä¸æ±‚ä¸»æ–¹å‘ä¸åŒçš„æ˜¯ï¼Œæ­¤æ—¶ï¼Œæ¯ä¸ªå­åŒºåŸŸæ¢¯åº¦æ–¹å‘ç›´æ–¹å›¾å°†0Â°~360Â°åˆ’åˆ†ä¸º8ä¸ªæ–¹å‘åŒºé—´ï¼Œæ¯ä¸ªåŒºé—´ä¸º45Â°ã€‚å³æ¯ä¸ªç§å­ç‚¹æœ‰8ä¸ªæ–¹å‘åŒºé—´çš„æ¢¯åº¦å¼ºåº¦ä¿¡æ¯ã€‚ç”±äºå­˜åœ¨$d\times d$ï¼Œå³$4\times 4$ä¸ªå­åŒºåŸŸï¼Œæ‰€ä»¥æœ€ç»ˆå…±æœ‰$4\times 4 \times 8 = 128$ä¸ªæ•°æ®ï¼ˆLoweå»ºè®®çš„æ•°æ®ï¼‰ï¼Œå½¢æˆ128ç»´SIFTç‰¹å¾çŸ¢é‡ã€‚<br><img src="https://user-images.githubusercontent.com/6218739/138856347-869aa2f0-2669-4e70-9251-52b34f034439.png" alt="final"><br>å¯¹ç‰¹å¾çŸ¢é‡éœ€è¦åŠ æƒå¤„ç†ï¼ŒåŠ æƒé‡‡ç”¨$\frac{m\sigma d}{2}$çš„æ ‡å‡†é«˜æ–¯å‡½æ•°ã€‚ä¸ºäº†é™¤å»å…‰ç…§å˜åŒ–å½±å“ï¼Œè¿˜æœ‰è¿›ä¸€æ­¥å½’ä¸€åŒ–å¤„ç†ã€‚</p><p>è‡³æ­¤SIFTæè¿°å­ç”Ÿæˆï¼ŒSIFTç®—æ³•ä¹ŸåŸºæœ¬å®Œæˆäº†ã€‚</p>]]></content>
    
    
    <summary type="html">å‚è€ƒæ–‡çŒ®
SIFTç®—æ³•æ·±å…¥ç†è§£
ç‰¹å¾ç‚¹åŒ¹é…â€”â€”SIFTç®—æ³•è¯¦è§£
å›¾åƒé‡‘å­—å¡”ï¼ˆé«˜æ–¯é‡‘å­—å¡”ï¼Œæ‹‰æ™®æ‹‰æ–¯é‡‘å­—å¡”ï¼Œå›¾åƒç¼©æ”¾resizeå‡½æ•°ï¼‰
SIFTç®—æ³•è¯¦è§£

ç®€ä»‹
SIFTï¼ˆScale Invariant Feature Transformï¼‰ï¼Œå°ºåº¦ä¸å˜ç‰¹å¾å˜æ¢åŒ¹é…ç®—æ³•ï¼Œæ˜¯ç”±David G. Loweåœ¨1999å¹´ï¼ˆã€ŠObject Recognition from Local Scale-Invariant Featuresã€‹ï¼‰æå‡ºçš„é«˜æ•ˆåŒºåŸŸæ£€æµ‹ç®—æ³•ï¼Œåœ¨2004å¹´ï¼ˆã€ŠDistinctive Image Features from Scale-Invariant Keypointsã€‹ï¼‰å¾—ä»¥å®Œå–„ã€‚
SIFT</summary>
    
    
    
    <category term="computer vision" scheme="http://qixinbo.github.io/categories/computer-vision/"/>
    
    
    <category term="Image" scheme="http://qixinbo.github.io/tags/Image/"/>
    
  </entry>
  
  <entry>
    <title>GANç³»åˆ—ç®—æ³•åŸç†åŠæç®€ä»£ç è§£æ</title>
    <link href="http://qixinbo.github.io/2021/10/21/gan/"/>
    <id>http://qixinbo.github.io/2021/10/21/gan/</id>
    <published>2021-10-20T16:00:00.000Z</published>
    <updated>2021-10-21T08:38:46.620Z</updated>
    
    <content type="html"><![CDATA[<h1 id="åŸºæœ¬æ€æƒ³"><a href="#åŸºæœ¬æ€æƒ³" class="headerlink" title="åŸºæœ¬æ€æƒ³"></a>åŸºæœ¬æ€æƒ³</h1><p><a href="https://alberthg.github.io/2018/05/05/introduction-gan/">ç”Ÿæˆå¯¹æŠ—ç½‘ç»œâ€”â€”åŸç†è§£é‡Šå’Œæ•°å­¦æ¨å¯¼</a><br>é¦–å…ˆæœ‰ä¸€ä¸ªâ€œç”Ÿæˆå™¨(Generator)â€ï¼šå…¶å®å°±æ˜¯ä¸€ä¸ªç¥ç»ç½‘ç»œï¼Œæˆ–è€…æ˜¯æ›´ç®€å•çš„ç†è§£ï¼Œä»–å°±æ˜¯ä¸€ä¸ªå‡½æ•°(Function)ã€‚è¾“å…¥ä¸€ç»„å‘é‡ï¼Œç»ç”±ç”Ÿæˆå™¨ï¼Œäº§ç”Ÿä¸€ç»„ç›®æ ‡çŸ©é˜µï¼ˆå¦‚æœä½ è¦ç”Ÿæˆå›¾ç‰‡ï¼Œé‚£ä¹ˆçŸ©é˜µå°±æ˜¯å›¾ç‰‡çš„åƒç´ é›†åˆï¼Œå…·ä½“çš„è¾“å‡ºè§†ä½ çš„ä»»åŠ¡è€Œå®šï¼‰ã€‚å®ƒçš„ç›®çš„å°±æ˜¯ä½¿å¾—è‡ªå·±é€ æ ·æœ¬çš„èƒ½åŠ›å°½å¯èƒ½å¼ºï¼Œå¼ºåˆ°ä»€ä¹ˆç¨‹åº¦å‘¢ï¼Œå¼ºåˆ°ä½ åˆ¤åˆ«ç½‘ç»œæ²¡æ³•åˆ¤æ–­æˆ‘æ˜¯çœŸæ ·æœ¬è¿˜æ˜¯å‡æ ·æœ¬ã€‚<br>åŒæ—¶è¿˜æœ‰ä¸€ä¸ªâ€œåˆ¤åˆ«å™¨(Discriminator)â€ï¼šåˆ¤åˆ«å™¨çš„ç›®çš„å°±æ˜¯èƒ½åˆ¤åˆ«å‡ºæ¥ä¸€å¼ å›¾å®ƒæ˜¯æ¥è‡ªçœŸå®æ ·æœ¬é›†è¿˜æ˜¯å‡æ ·æœ¬é›†ã€‚å‡å¦‚è¾“å…¥çš„æ˜¯çœŸæ ·æœ¬ï¼Œç½‘ç»œè¾“å‡ºå°±æ¥è¿‘ 1ï¼Œè¾“å…¥çš„æ˜¯å‡æ ·æœ¬ï¼Œç½‘ç»œè¾“å‡ºæ¥è¿‘ 0ï¼Œé‚£ä¹ˆå¾ˆå®Œç¾ï¼Œè¾¾åˆ°äº†å¾ˆå¥½åˆ¤åˆ«çš„ç›®çš„ã€‚<br>é‚£ä¸ºä»€ä¹ˆéœ€è¦è¿™ä¸¤ä¸ªç»„ä»¶å‘¢ï¼ŸGANåœ¨ç»“æ„ä¸Šå—åšå¼ˆè®ºä¸­çš„äºŒäººé›¶å’Œåšå¼ˆ ï¼ˆå³äºŒäººçš„åˆ©ç›Šä¹‹å’Œä¸ºé›¶ï¼Œä¸€æ–¹çš„æ‰€å¾—æ­£æ˜¯å¦ä¸€æ–¹çš„æ‰€å¤±ï¼‰çš„å¯å‘ï¼Œç³»ç»Ÿç”±ä¸€ä¸ªç”Ÿæˆæ¨¡å‹ï¼ˆGï¼‰å’Œä¸€ä¸ªåˆ¤åˆ«æ¨¡å‹ï¼ˆDï¼‰æ„æˆã€‚G æ•æ‰çœŸå®æ•°æ®æ ·æœ¬çš„æ½œåœ¨åˆ†å¸ƒï¼Œå¹¶ç”Ÿæˆæ–°çš„æ•°æ®æ ·æœ¬ï¼›D æ˜¯ä¸€ä¸ªäºŒåˆ†ç±»å™¨ï¼Œåˆ¤åˆ«è¾“å…¥æ˜¯çœŸå®æ•°æ®è¿˜æ˜¯ç”Ÿæˆçš„æ ·æœ¬ã€‚ç”Ÿæˆå™¨å’Œåˆ¤åˆ«å™¨å‡å¯ä»¥é‡‡ç”¨æ·±åº¦ç¥ç»ç½‘ç»œã€‚GANçš„ä¼˜åŒ–è¿‡ç¨‹æ˜¯ä¸€ä¸ªæå°æå¤§åšå¼ˆ(Minimax game)é—®é¢˜ï¼Œä¼˜åŒ–ç›®æ ‡æ˜¯è¾¾åˆ°çº³ä»€å‡è¡¡ã€‚</p><h1 id="åŸå§‹GAN"><a href="#åŸå§‹GAN" class="headerlink" title="åŸå§‹GAN"></a>åŸå§‹GAN</h1><p>è¿™é‡Œç”¨çš„ç½‘ç»œéå¸¸ç®€å•ï¼Œä»…æœ‰äºŒå±‚ï¼Œä¸”è¿˜ä¸æ˜¯å·ç§¯ç¥ç»ç½‘ç»œï¼Œè€Œæ˜¯å…¨è¿æ¥å±‚ã€‚åé¢çš„GANå˜ç§ä¼šä½¿ç”¨æ›´åŠ å¼ºå¤§çš„æ·±åº¦ç½‘ç»œã€‚<br>é¦–å…ˆå…ˆçœ‹ä¸€ä¸‹åˆ¤åˆ«å™¨å’Œç”Ÿæˆå™¨çš„åˆ†åˆ«çš„æŸå¤±å‡½æ•°ï¼š<br><img src="https://user-images.githubusercontent.com/6218739/136900996-05cfa37c-96f4-48cf-9f5b-7f7aa6a074b8.png" alt="loss-d"><br><img src="https://user-images.githubusercontent.com/6218739/136901466-4f4a85d8-92db-4eaf-9e05-6b8b206df7d7.png" alt="loss-g"></p><p>æœ€ç»ˆå®ç°çš„æ•ˆæœå°±æ˜¯ï¼šç”Ÿæˆå™¨èƒ½å¤Ÿå‡­ç©ºï¼ˆä¹Ÿä¸æ˜¯å®Œå…¨å‡­ç©ºï¼Œå®ƒçš„è¾“å…¥æ˜¯ä¸€ä¸ªå…·æœ‰éšå‚é‡ç»´åº¦çš„å™ªå£°å›¾åƒï¼‰ç”Ÿæˆä¸€å¼ ä¸è®­ç»ƒå›¾ç‰‡æä¸ºç±»ä¼¼çš„è™šå‡å›¾ç‰‡ã€‚</p><p>ä»£ç åœ¨ï¼š<br><a href="https://github.com/aladdinpersson/Machine-Learning-Collection/tree/master/ML/Pytorch/GANs">Machine-Learning-Collection/ML/Pytorch/GANs</a><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"><span class="keyword">import</span> torch.optim <span class="keyword">as</span> optim</span><br><span class="line"><span class="keyword">import</span> torchvision</span><br><span class="line"><span class="keyword">import</span> torchvision.datasets <span class="keyword">as</span> datasets</span><br><span class="line"><span class="keyword">from</span> torch.utils.data <span class="keyword">import</span> DataLoader</span><br><span class="line"><span class="keyword">import</span> torchvision.transforms <span class="keyword">as</span> transforms</span><br><span class="line"><span class="keyword">from</span> torch.utils.tensorboard <span class="keyword">import</span> SummaryWriter  <span class="comment"># to print to tensorboard</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ¤åˆ«å™¨</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Discriminator</span>(<span class="params">nn.Module</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, in_features</span>):</span></span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        <span class="comment"># éå¸¸å°çš„ç½‘ç»œ</span></span><br><span class="line">        self.disc = nn.Sequential(</span><br><span class="line">            nn.Linear(in_features, <span class="number">128</span>),</span><br><span class="line">            nn.LeakyReLU(<span class="number">0.01</span>),</span><br><span class="line">            nn.Linear(<span class="number">128</span>, <span class="number">1</span>),</span><br><span class="line">            nn.Sigmoid(),</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span>(<span class="params">self, x</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.disc(x)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”Ÿæˆå™¨</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Generator</span>(<span class="params">nn.Module</span>):</span></span><br><span class="line">    <span class="comment"># zæ˜¯éšç©ºé—´å‚é‡</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, z_dim, img_dim</span>):</span></span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        self.gen = nn.Sequential(</span><br><span class="line">            nn.Linear(z_dim, <span class="number">256</span>),</span><br><span class="line">            nn.LeakyReLU(<span class="number">0.01</span>),</span><br><span class="line">            nn.Linear(<span class="number">256</span>, img_dim),</span><br><span class="line">            <span class="comment"># è¾“å…¥ä¼šæ ‡å‡†åŒ–ä¸º[-1, 1]ï¼Œæ‰€ä»¥è¿™é‡Œçš„è¾“å‡ºä¹Ÿè¦æ ‡å‡†åŒ–åˆ°[-1, 1]</span></span><br><span class="line">            nn.Tanh(), </span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span>(<span class="params">self, x</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.gen(x)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¶…å‚æ•°è®¾ç½®</span></span><br><span class="line">device = <span class="string">&quot;cuda&quot;</span> <span class="keyword">if</span> torch.cuda.is_available() <span class="keyword">else</span> <span class="string">&quot;cpu&quot;</span></span><br><span class="line">lr = <span class="number">3e-4</span> <span class="comment"># å­¦ä¹ ç‡</span></span><br><span class="line">z_dim = <span class="number">64</span> <span class="comment"># éšå‚é‡çš„ç»´åº¦</span></span><br><span class="line">image_dim = <span class="number">28</span> * <span class="number">28</span> * <span class="number">1</span>  <span class="comment"># 784ï¼ŒMNIST</span></span><br><span class="line">batch_size = <span class="number">32</span></span><br><span class="line">num_epochs = <span class="number">50</span></span><br><span class="line"></span><br><span class="line">disc = Discriminator(image_dim).to(device)</span><br><span class="line">gen = Generator(z_dim, image_dim).to(device)</span><br><span class="line"><span class="comment"># è¿™é‡ŒåŠ å…¥å™ªå£°æ˜¯ä¸ºäº†çœ‹å‡ºåœ¨è¿­ä»£è¿‡ç¨‹ä¸­çš„å˜åŒ–</span></span><br><span class="line">fixed_noise = torch.randn((batch_size, z_dim)).to(device)</span><br><span class="line">transforms = transforms.Compose(</span><br><span class="line">    <span class="comment"># æŒ‰é“ç†åº”è¯¥é‡‡ç”¨ä¸MNistç›¸åŒçš„å‡å€¼å’Œæ ‡å‡†å·®(0.1307, 0.3081)</span></span><br><span class="line">    <span class="comment"># ä½†ä¸Šé¢çš„è¶…å‚æ•°çš„è®¾ç½®æ˜¯ä½œè€…ç”¨(0.5, 0.5)æ—¶è°ƒå‡ºæ¥çš„ï¼Œæ‰€ä»¥è¿™é‡Œå¦‚æœæ”¹äº†å°±ä¼šå‘æ•£</span></span><br><span class="line">    <span class="comment"># è¿™ä¹Ÿè¯´æ˜GANå¯¹å‚æ•°éå¸¸æ•æ„Ÿï¼Œéå¸¸éš¾ä»¥è®­ç»ƒ</span></span><br><span class="line">    [transforms.ToTensor(), transforms.Normalize((<span class="number">0.5</span>,), (<span class="number">0.5</span>,)),]</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">dataset = datasets.MNIST(root=<span class="string">&quot;dataset/&quot;</span>, transform=transforms, download=<span class="literal">True</span>)</span><br><span class="line">loader = DataLoader(dataset, batch_size=batch_size, shuffle=<span class="literal">True</span>)</span><br><span class="line"><span class="comment"># åˆ¤åˆ«å™¨çš„ä¼˜åŒ–ç®—æ³•</span></span><br><span class="line">opt_disc = optim.Adam(disc.parameters(), lr=lr)</span><br><span class="line"><span class="comment"># ç”Ÿæˆå™¨çš„ä¼˜åŒ–ç®—æ³•</span></span><br><span class="line">opt_gen = optim.Adam(gen.parameters(), lr=lr)</span><br><span class="line"><span class="comment"># æŸå¤±å‡½æ•°è®¾ä¸ºBinary Cross Entropy</span></span><br><span class="line"><span class="comment"># å…¬å¼ä¸º-[y*logx + (1-y)log(1-x)]</span></span><br><span class="line"><span class="comment"># æ³¨æ„å…¬å¼å‰é¢çš„è´Ÿå·ï¼Œåé¢è®¡ç®—æŸå¤±æ—¶è¯¥è´Ÿå·å°†æœ€å¤§åŒ–æ”¹ä¸ºäº†æœ€å°åŒ–</span></span><br><span class="line">criterion = nn.BCELoss()</span><br><span class="line">writer_fake = SummaryWriter(<span class="string">f&quot;logs/fake&quot;</span>)</span><br><span class="line">writer_real = SummaryWriter(<span class="string">f&quot;logs/real&quot;</span>)</span><br><span class="line">step = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿­ä»£è®­ç»ƒ</span></span><br><span class="line"><span class="keyword">for</span> epoch <span class="keyword">in</span> <span class="built_in">range</span>(num_epochs):</span><br><span class="line">    <span class="comment"># ä»åŠ è½½å™¨é‡Œå–å‡ºçš„æ˜¯realå›¾åƒ</span></span><br><span class="line">    <span class="keyword">for</span> batch_idx, (real, _) <span class="keyword">in</span> <span class="built_in">enumerate</span>(loader):</span><br><span class="line">        real = real.view(-<span class="number">1</span>, <span class="number">784</span>).to(device)</span><br><span class="line">        batch_size = real.shape[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">        <span class="comment">########## è®­ç»ƒåˆ¤åˆ«å™¨ï¼šæœ€å¤§åŒ–log(D(x)) + log(1 - D(G(z))) ###############</span></span><br><span class="line">        <span class="comment">## å³ï¼šlog(D(real)) + log(1 - D(G(latent_noise)))</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># äº‹å…ˆå‡†å¤‡éšç©ºé—´çš„å™ªå£°æ•°æ®</span></span><br><span class="line">        noise = torch.randn(batch_size, z_dim).to(device)</span><br><span class="line">        <span class="comment"># å°†å™ªå£°æ•°æ®ä¼ ç»™ç”Ÿæˆå™¨ï¼Œç”Ÿæˆå‡çš„å›¾åƒ</span></span><br><span class="line">        fake = gen(noise)</span><br><span class="line"></span><br><span class="line">        <span class="comment">#### è®¡ç®—log(D(x))æŸå¤± ####</span></span><br><span class="line">        <span class="comment"># å°†çœŸå®å›¾åƒä¼ ç»™åˆ¤åˆ«å™¨ï¼Œå³è®¡ç®—D(x)</span></span><br><span class="line">        disc_real = disc(real).view(-<span class="number">1</span>)</span><br><span class="line">        <span class="comment"># å°†D(x)ä¸1åˆ†åˆ«ä½œä¸ºé¢„æµ‹å€¼å’Œç›®æ ‡å€¼æ”¾åˆ°BCEä¸­è¿›è¡Œè®¡ç®—</span></span><br><span class="line">        <span class="comment"># æ ¹æ®BCEçš„å…¬å¼-[y*logx + (1-y)log(1-x)]ï¼Œè¿™é‡Œyä¸º1ï¼Œå› æ­¤æ­¤å¤„è®¡ç®—çš„å°±æ˜¯-log(D(x))</span></span><br><span class="line">        <span class="comment"># ä¹Ÿå¯ä»¥è¿™æ ·ç†è§£ï¼Œæ­¤å¤„çš„æŸå¤±å°±æ˜¯çœ‹çœ‹åˆ¤åˆ«å™¨å¯¹äºçœŸå®å›¾åƒçš„é¢„æµ‹æ˜¯ä¸æ˜¯æ¥è¿‘1ï¼Œå³åˆ¤åˆ«å™¨å¯¹äºçœŸå®å›¾åƒçš„æ€§èƒ½æ€ä¹ˆæ ·</span></span><br><span class="line">        lossD_real = criterion(disc_real, torch.ones_like(disc_real))</span><br><span class="line"></span><br><span class="line">        <span class="comment">#### è®¡ç®—log(1-D(G(z)))æŸå¤±</span></span><br><span class="line">        <span class="comment"># å°†ç”Ÿæˆå™¨ç”Ÿæˆçš„è™šå‡å›¾åƒä¼ ç»™åˆ¤åˆ«å™¨ï¼Œå³è®¡ç®—D(G(z))</span></span><br><span class="line">        disc_fake = disc(fake).view(-<span class="number">1</span>)</span><br><span class="line">        <span class="comment"># å°†D(G(z))ä¸0åˆ†åˆ«ä½œä¸ºé¢„æµ‹å€¼å’Œç›®æ ‡å€¼æ”¾åˆ°BCEä¸­è¿›è¡Œè®¡ç®—</span></span><br><span class="line">        <span class="comment"># æ ¹æ®BCEçš„å…¬å¼-[y*logx + (1-y)log(1-x)]ï¼Œè¿™é‡Œyä¸º0ï¼Œå› æ­¤æ­¤å¤„è®¡ç®—çš„å°±æ˜¯-log(1-D(G(z)))</span></span><br><span class="line">        <span class="comment"># ä¹Ÿå¯ä»¥è¿™æ ·ç†è§£ï¼Œæ­¤å¤„çš„æŸå¤±å°±æ˜¯çœ‹çœ‹åˆ¤åˆ«å™¨å¯¹äºè™šå‡å›¾åƒçš„é¢„æµ‹æ˜¯ä¸æ˜¯æ¥è¿‘0ï¼Œå³åˆ¤åˆ«å™¨å¯¹äºè™šå‡å›¾åƒçš„æ€§èƒ½æ€ä¹ˆæ ·</span></span><br><span class="line">        lossD_fake = criterion(disc_fake, torch.zeros_like(disc_fake))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># æ€»æŸå¤±</span></span><br><span class="line">        lossD = (lossD_real + lossD_fake) / <span class="number">2</span></span><br><span class="line">        <span class="comment"># åˆ¤åˆ«å™¨çš„åå‘ä¼ æ’­</span></span><br><span class="line">        disc.zero_grad()</span><br><span class="line">        <span class="comment"># æ³¨æ„ï¼Œè¿™é‡Œå°†retain_graphè®¾ä¸ºTrueï¼Œæ˜¯ä¸ºäº†ä¿ç•™è¯¥è¿‡ç¨‹ä¸­è®¡ç®—çš„æ¢¯åº¦ï¼Œåç»­ç”Ÿæˆå™¨ç½‘ç»œæ›´æ–°æ—¶ä½¿ç”¨</span></span><br><span class="line">        <span class="comment"># å¦åˆ™è¿™é‡Œåˆ¤åˆ«å™¨ç½‘ç»œæ„å»ºäº†æ­£å‘è®¡ç®—å›¾åï¼Œåå‘ä¼ æ’­ç»“æŸåå°±å°†å…¶é”€æ¯</span></span><br><span class="line">        lossD.backward(retain_graph=<span class="literal">True</span>)</span><br><span class="line">        opt_disc.step()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">########## è®­ç»ƒç”Ÿæˆå™¨ï¼šæœ€å°åŒ–log(1 - D(G(z)))ï¼Œç­‰ä»·äºæœ€å¤§åŒ–log(D(G(z)) ###############</span></span><br><span class="line">        <span class="comment">## ç¬¬äºŒç§æŸå¤±ä¸ä¼šé‡åˆ°æ¢¯åº¦é¥±å’Œçš„é—®é¢˜</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># å°†ç”Ÿæˆå™¨ç”Ÿæˆçš„è™šå‡å›¾åƒä¼ ç»™åˆ¤åˆ«å™¨ï¼Œå³è®¡ç®—D(G(z))</span></span><br><span class="line">        <span class="comment"># è¿™é‡Œçš„discæ˜¯ç»è¿‡äº†å‡çº§åçš„åˆ¤åˆ«å™¨ï¼Œæ‰€ä»¥ä¸ç¬¬99è¡Œçš„D(G(z))è®¡ç®—ä¸åŒ</span></span><br><span class="line">        <span class="comment"># ä½†fakeè¿™ä¸ªé‡è¿˜æ˜¯ä¸Šé¢çš„fake = gen(noise)</span></span><br><span class="line">        output = disc(fake).view(-<span class="number">1</span>)</span><br><span class="line">        <span class="comment"># å°†D(G(z))ä¸1åˆ†åˆ«ä½œä¸ºé¢„æµ‹å€¼å’Œç›®æ ‡å€¼æ”¾åˆ°BCEä¸­è¿›è¡Œè®¡ç®—</span></span><br><span class="line">        <span class="comment"># æ ¹æ®BCEçš„å…¬å¼-[y*logx + (1-y)log(1-x)]ï¼Œè¿™é‡Œyä¸º1ï¼Œå› æ­¤æ­¤å¤„è®¡ç®—çš„å°±æ˜¯-log(D(G(z)))</span></span><br><span class="line">        <span class="comment"># ä¹Ÿå¯ä»¥è¿™æ ·ç†è§£ï¼Œæ­¤å¤„çš„æŸå¤±å°±æ˜¯çœ‹çœ‹åˆ¤åˆ«å™¨å¯¹äºç”Ÿæˆå™¨ç”Ÿæˆçš„è™šå‡å›¾åƒçš„é¢„æµ‹æ˜¯ä¸æ˜¯æ¥è¿‘1ï¼Œå³ç”Ÿæˆå™¨æœ‰æ²¡æœ‰éª—è¿‡åˆ¤åˆ«å™¨</span></span><br><span class="line">        <span class="comment"># è¿™é‡Œlog(D(G(z))çš„è®¡ç®—ä¸ä¸Šé¢çš„log(D(G(z))çš„è®¡ç®—ä¸é‡å¤ï¼Œæ˜¯å› ä¸ºç”Ÿæˆå™¨å’Œåˆ¤åˆ«å™¨æ˜¯åˆ†å¼€è®­ç»ƒçš„ï¼Œä¸¤è€…éƒ½è¦æœ‰å„è‡ªçš„æŸå¤±å‡½æ•°</span></span><br><span class="line">        lossG = criterion(output, torch.ones_like(output))</span><br><span class="line">        <span class="comment"># ç”Ÿæˆå™¨çš„åå‘ä¼ æ’­</span></span><br><span class="line">        gen.zero_grad()</span><br><span class="line">        lossG.backward()</span><br><span class="line">        opt_gen.step()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment"># ä¸‹é¢å°±æ˜¯ç”¨äºtenshorboardçš„å¯è§†åŒ–</span></span><br><span class="line">        <span class="keyword">if</span> batch_idx == <span class="number">0</span>:</span><br><span class="line">            <span class="built_in">print</span>(</span><br><span class="line">                <span class="string">f&quot;Epoch [<span class="subst">&#123;epoch&#125;</span>/<span class="subst">&#123;num_epochs&#125;</span>] Batch <span class="subst">&#123;batch_idx&#125;</span>/<span class="subst">&#123;<span class="built_in">len</span>(loader)&#125;</span> \</span></span><br><span class="line"><span class="string">                      Loss D: <span class="subst">&#123;lossD:<span class="number">.4</span>f&#125;</span>, loss G: <span class="subst">&#123;lossG:<span class="number">.4</span>f&#125;</span>&quot;</span></span><br><span class="line">            )</span><br><span class="line"></span><br><span class="line">            <span class="keyword">with</span> torch.no_grad():</span><br><span class="line">                fake = gen(fixed_noise).reshape(-<span class="number">1</span>, <span class="number">1</span>, <span class="number">28</span>, <span class="number">28</span>)</span><br><span class="line">                data = real.reshape(-<span class="number">1</span>, <span class="number">1</span>, <span class="number">28</span>, <span class="number">28</span>)</span><br><span class="line">                img_grid_fake = torchvision.utils.make_grid(fake, normalize=<span class="literal">True</span>)</span><br><span class="line">                img_grid_real = torchvision.utils.make_grid(data, normalize=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">                writer_fake.add_image(</span><br><span class="line">                    <span class="string">&quot;Mnist Fake Images&quot;</span>, img_grid_fake, global_step=step</span><br><span class="line">                )</span><br><span class="line">                writer_real.add_image(</span><br><span class="line">                    <span class="string">&quot;Mnist Real Images&quot;</span>, img_grid_real, global_step=step</span><br><span class="line">                )</span><br><span class="line">                step += <span class="number">1</span></span><br></pre></td></tr></table></figure></p><h1 id="DCGAN"><a href="#DCGAN" class="headerlink" title="DCGAN"></a>DCGAN</h1><p>DCGANï¼Œæ·±åº¦å·ç§¯ç”Ÿæˆå¯¹æŠ—ç½‘ç»œï¼Œå…¨åâ€œDeep Convolutional Generative Adversarial Networksâ€ã€‚<br>DCGANçš„ç”Ÿæˆå™¨å’Œåˆ¤åˆ«å™¨çš„ç½‘ç»œæ¶æ„å¦‚ä¸‹ï¼š<br><img src="https://user-images.githubusercontent.com/6218739/136920307-cfbf4981-6576-4bad-9a31-866b8465ece4.png" alt="dcgan"><br>ä¸ä¸Šé¢çš„åŸç”Ÿçš„GANç±»ä¼¼ï¼ŒDCGANæ˜¯å°†ç½‘ç»œæ¶æ„æ¢æˆäº†æ·±åº¦å·ç§¯ç½‘ç»œï¼Œå…¶å‚æ•°ä¹Ÿè¦å°å¿ƒè°ƒèŠ‚ã€‚</p><h1 id="WGAN"><a href="#WGAN" class="headerlink" title="WGAN"></a>WGAN</h1><p><a href="https://zhuanlan.zhihu.com/p/25071913">ä»¤äººæ‹æ¡ˆå«ç»çš„Wasserstein GAN</a><br>ï¼ˆè¯¥æ–‡ç« ä¸‹é¢çš„è¯„è®ºä¹Ÿå¾ˆæœ‰è§è§£ï¼‰<br>è‡ªä»2014å¹´Ian Goodfellowæå‡ºä»¥æ¥ï¼ŒGANå°±å­˜åœ¨ç€è®­ç»ƒå›°éš¾ã€ç”Ÿæˆå™¨å’Œåˆ¤åˆ«å™¨çš„lossæ— æ³•æŒ‡ç¤ºè®­ç»ƒè¿›ç¨‹ã€ç”Ÿæˆæ ·æœ¬ç¼ºä¹å¤šæ ·æ€§ç­‰é—®é¢˜ã€‚ä»é‚£æ—¶èµ·ï¼Œå¾ˆå¤šè®ºæ–‡éƒ½åœ¨å°è¯•è§£å†³ï¼Œä½†æ˜¯æ•ˆæœä¸å°½äººæ„ï¼Œæ¯”å¦‚æœ€æœ‰åçš„ä¸€ä¸ªæ”¹è¿›DCGANä¾é çš„æ˜¯å¯¹åˆ¤åˆ«å™¨å’Œç”Ÿæˆå™¨çš„æ¶æ„è¿›è¡Œå®éªŒæšä¸¾ï¼Œæœ€ç»ˆæ‰¾åˆ°ä¸€ç»„æ¯”è¾ƒå¥½çš„ç½‘ç»œæ¶æ„è®¾ç½®ï¼Œä½†æ˜¯å®é™…ä¸Šæ˜¯æ²»æ ‡ä¸æ²»æœ¬ï¼Œæ²¡æœ‰å½»åº•è§£å†³é—®é¢˜ã€‚è€ŒWasserstein GANï¼ˆä¸‹é¢ç®€ç§°WGANï¼‰æˆåŠŸåœ°åšåˆ°äº†ä»¥ä¸‹çˆ†ç‚¸æ€§çš„å‡ ç‚¹ï¼š<br>ï¼ˆ1ï¼‰å½»åº•è§£å†³GANè®­ç»ƒä¸ç¨³å®šçš„é—®é¢˜ï¼Œä¸å†éœ€è¦å°å¿ƒå¹³è¡¡ç”Ÿæˆå™¨å’Œåˆ¤åˆ«å™¨çš„è®­ç»ƒç¨‹åº¦<br>ï¼ˆ2ï¼‰åŸºæœ¬è§£å†³äº†collapse modeçš„é—®é¢˜ï¼Œç¡®ä¿äº†ç”Ÿæˆæ ·æœ¬çš„å¤šæ ·æ€§ï¼ˆcollapse modeå°±æ˜¯æ¨¡å¼å€’å¡Œã€‚æ¯”å¦‚æˆ‘ä»¬çŸ¥é“äººæ°‘å¸æœ‰å¥½å‡ ä¸ªé¢é¢çš„çº¸å¸ã€‚å‡é’åˆ¶é€ å›¢ä¼™å‘ç°å¦‚æœä»–ä»¬å°†å…¨éƒ¨ç²¾åŠ›éƒ½æ”¾åœ¨åˆ¶é€ ä¸€ç§é¢å€¼çš„è´§å¸æ—¶æœ€å®¹æ˜“è·å¾—æˆåŠŸã€‚è€Œè¿™æ—¶å€™ï¼Œæ¨¡å¼å€’å¡Œä¹Ÿå°±å‘ç”Ÿäº†ã€‚è™½ç„¶è¿™ä¸ªå‡é’åˆ¶é€ å›¢ä¼™èƒ½å¤Ÿåˆ¶é€ å‡ºååˆ†çœŸå®çš„è´§å¸ï¼Œä½†å´åªæœ‰ä¸€ç§ï¼Œè€Œè¿™æœ‰æ—¶å¹¶ä¸æ˜¯æˆ‘ä»¬å¸Œæœ›çš„ã€‚æˆ‘ä»¬å¸Œæœ›å‡é’åˆ¶é€ å›¢ä¼™èƒ½ç”Ÿæˆæ‰€æœ‰çš„å¸å€¼äººæ°‘å¸ã€‚ï¼‰<br>ï¼ˆ3ï¼‰è®­ç»ƒè¿‡ç¨‹ä¸­ç»ˆäºæœ‰ä¸€ä¸ªåƒäº¤å‰ç†µã€å‡†ç¡®ç‡è¿™æ ·çš„æ•°å€¼æ¥æŒ‡ç¤ºè®­ç»ƒçš„è¿›ç¨‹ï¼Œè¿™ä¸ªæ•°å€¼è¶Šå°ä»£è¡¨GANè®­ç»ƒå¾—è¶Šå¥½ï¼Œä»£è¡¨ç”Ÿæˆå™¨äº§ç”Ÿçš„å›¾åƒè´¨é‡è¶Šé«˜<br>ï¼ˆ4ï¼‰ä»¥ä¸Šä¸€åˆ‡å¥½å¤„ä¸éœ€è¦ç²¾å¿ƒè®¾è®¡çš„ç½‘ç»œæ¶æ„ï¼Œæœ€ç®€å•çš„å¤šå±‚å…¨è¿æ¥ç½‘ç»œå°±å¯ä»¥åšåˆ°ã€‚<br>é‚£ä»¥ä¸Šå¥½å¤„æ¥è‡ªå“ªé‡Œï¼Ÿè¿™å°±æ˜¯ä»¤äººæ‹æ¡ˆå«ç»çš„éƒ¨åˆ†äº†â€”â€”å®é™…ä¸Šä½œè€…æ•´æ•´èŠ±äº†ä¸¤ç¯‡è®ºæ–‡ï¼Œåœ¨ç¬¬ä¸€ç¯‡ã€ŠTowards Principled Methods for Training Generative Adversarial Networksã€‹é‡Œé¢æ¨äº†ä¸€å †å…¬å¼å®šç†ï¼Œä»ç†è®ºä¸Šåˆ†æäº†åŸå§‹GANçš„é—®é¢˜æ‰€åœ¨ï¼Œä»è€Œé’ˆå¯¹æ€§åœ°ç»™å‡ºäº†æ”¹è¿›è¦ç‚¹ï¼›åœ¨è¿™ç¬¬äºŒç¯‡ã€ŠWasserstein GANã€‹é‡Œé¢ï¼Œåˆå†ä»è¿™ä¸ªæ”¹è¿›ç‚¹å‡ºå‘æ¨äº†ä¸€å †å…¬å¼å®šç†ï¼Œæœ€ç»ˆç»™å‡ºäº†æ”¹è¿›çš„ç®—æ³•å®ç°æµç¨‹ï¼Œè€Œæ”¹è¿›åç›¸æ¯”åŸå§‹GANçš„ç®—æ³•å®ç°æµç¨‹å´åªæ”¹äº†å››ç‚¹ï¼š<br>ï¼ˆ1ï¼‰åˆ¤åˆ«å™¨æœ€åä¸€å±‚å»æ‰sigmoid<br>ï¼ˆ2ï¼‰ç”Ÿæˆå™¨å’Œåˆ¤åˆ«å™¨çš„lossä¸å–log<br>ï¼ˆ3ï¼‰æ¯æ¬¡æ›´æ–°åˆ¤åˆ«å™¨çš„å‚æ•°ä¹‹åæŠŠå®ƒä»¬çš„ç»å¯¹å€¼æˆªæ–­åˆ°ä¸è¶…è¿‡ä¸€ä¸ªå›ºå®šå¸¸æ•°c<br>ï¼ˆ4ï¼‰ä¸è¦ç”¨åŸºäºåŠ¨é‡çš„ä¼˜åŒ–ç®—æ³•ï¼ˆåŒ…æ‹¬momentumå’ŒAdamï¼‰ï¼Œæ¨èRMSPropï¼ŒSGDä¹Ÿè¡Œã€‚</p><p>ä¸Šè¿°æ˜¯å·¥ç¨‹ä¸Šçš„æ”¹è¿›ï¼Œä½†ä¸ºä»€ä¹ˆè¿™æ ·æ”¹è¿›ï¼Œéœ€è¦éå¸¸æ·±åšçš„æ•°å­¦çŸ¥è¯†æ¨å¯¼ã€‚ä»å®è§‚ä¸Šç†è§£å°±æ˜¯å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="https://user-images.githubusercontent.com/6218739/137093439-169e8c77-debc-46cb-982f-d91502574eb4.png" alt="distance"><br>GANçš„ç›®çš„æ˜¯ä½¿å¾—ç”Ÿæˆå›¾åƒçš„æ ·æœ¬åˆ†å¸ƒä¸çœŸå®å›¾åƒçš„æ ·æœ¬åˆ†å¸ƒå°½å¯èƒ½ç›¸è¿‘ï¼Œå³æ•°å­¦ä¸Šæ€æ ·è¡¨è¾¾è¿™ä¸¤ç§åˆ†å¸ƒçš„è·ç¦»ã€‚åŸå§‹GANä½¿ç”¨äº†JSæ•£åº¦æ¥è¡¡é‡è¯¥è·ç¦»ï¼ˆæ›´æ–°lossåçš„GANä½¿ç”¨çš„æ˜¯KLæ•£åº¦ï¼‰ï¼ŒWGANåˆ™ä½¿ç”¨çš„æ˜¯Wassersteinè·ç¦»ã€‚<br>å› ä¸ºå¯¹äºJSæ•£åº¦ï¼Œæ— è®ºçœŸå®æ ·æœ¬åˆ†å¸ƒè·Ÿç”Ÿæˆæ ·æœ¬åˆ†å¸ƒæ˜¯è¿œåœ¨å¤©è¾¹ï¼Œè¿˜æ˜¯è¿‘åœ¨çœ¼å‰ï¼Œåªè¦å®ƒä»¬ä¿©æ²¡æœ‰ä¸€ç‚¹é‡å æˆ–è€…é‡å éƒ¨åˆ†å¯å¿½ç•¥ï¼ŒJSæ•£åº¦å°±å›ºå®šæ˜¯å¸¸æ•°$log 2$ï¼Œè€Œè¿™å¯¹äºæ¢¯åº¦ä¸‹é™æ–¹æ³•æ„å‘³ç€â€”â€”æ¢¯åº¦ä¸º0ï¼æ­¤æ—¶å¯¹äºæœ€ä¼˜åˆ¤åˆ«å™¨æ¥è¯´ï¼Œç”Ÿæˆå™¨è‚¯å®šæ˜¯å¾—ä¸åˆ°ä¸€ä¸ç‚¹æ¢¯åº¦ä¿¡æ¯çš„ï¼›å³ä½¿å¯¹äºæ¥è¿‘æœ€ä¼˜çš„åˆ¤åˆ«å™¨æ¥è¯´ï¼Œç”Ÿæˆå™¨ä¹Ÿæœ‰å¾ˆå¤§æœºä¼šé¢ä¸´æ¢¯åº¦æ¶ˆå¤±çš„é—®é¢˜ã€‚ åŸå§‹GANä¸ç¨³å®šçš„åŸå› æ˜¯ï¼šåˆ¤åˆ«å™¨è®­ç»ƒå¾—å¤ªå¥½ï¼Œç”Ÿæˆå™¨æ¢¯åº¦æ¶ˆå¤±ï¼Œç”Ÿæˆå™¨lossé™ä¸ä¸‹å»ï¼›åˆ¤åˆ«å™¨è®­ç»ƒå¾—ä¸å¥½ï¼Œç”Ÿæˆå™¨æ¢¯åº¦ä¸å‡†ï¼Œå››å¤„ä¹±è·‘ã€‚åªæœ‰åˆ¤åˆ«å™¨è®­ç»ƒå¾—ä¸å¥½ä¸åæ‰è¡Œï¼Œä½†æ˜¯è¿™ä¸ªç«å€™åˆå¾ˆéš¾æŠŠæ¡ï¼Œç”šè‡³åœ¨åŒä¸€è½®è®­ç»ƒçš„å‰åä¸åŒé˜¶æ®µè¿™ä¸ªç«å€™éƒ½å¯èƒ½ä¸ä¸€æ ·ï¼Œæ‰€ä»¥GANæ‰é‚£ä¹ˆéš¾è®­ç»ƒã€‚<br>Ian Goodfellowæå‡ºçš„åŸå§‹GANä¸¤ç§å½¢å¼æœ‰å„è‡ªçš„é—®é¢˜ï¼Œç¬¬ä¸€ç§å½¢å¼ç­‰ä»·åœ¨æœ€ä¼˜åˆ¤åˆ«å™¨ä¸‹ç­‰ä»·äºæœ€å°åŒ–ç”Ÿæˆåˆ†å¸ƒä¸çœŸå®åˆ†å¸ƒä¹‹é—´çš„JSæ•£åº¦ï¼Œç”±äºéšæœºç”Ÿæˆåˆ†å¸ƒå¾ˆéš¾ä¸çœŸå®åˆ†å¸ƒæœ‰ä¸å¯å¿½ç•¥çš„é‡å ä»¥åŠJSæ•£åº¦çš„çªå˜ç‰¹æ€§ï¼Œä½¿å¾—ç”Ÿæˆå™¨é¢ä¸´æ¢¯åº¦æ¶ˆå¤±çš„é—®é¢˜ï¼›ç¬¬äºŒç§å½¢å¼åœ¨æœ€ä¼˜åˆ¤åˆ«å™¨ä¸‹ç­‰ä»·äºæ—¢è¦æœ€å°åŒ–ç”Ÿæˆåˆ†å¸ƒä¸çœŸå®åˆ†å¸ƒç›´æ¥çš„KLæ•£åº¦ï¼Œåˆè¦æœ€å¤§åŒ–å…¶JSæ•£åº¦ï¼Œç›¸äº’çŸ›ç›¾ï¼Œå¯¼è‡´æ¢¯åº¦ä¸ç¨³å®šï¼Œè€Œä¸”KLæ•£åº¦çš„ä¸å¯¹ç§°æ€§ä½¿å¾—ç”Ÿæˆå™¨å®å¯ä¸§å¤±å¤šæ ·æ€§ä¹Ÿä¸æ„¿ä¸§å¤±å‡†ç¡®æ€§ï¼Œå¯¼è‡´collapse modeç°è±¡ã€‚<br>Wassersteinè·ç¦»ç›¸æ¯”KLæ•£åº¦ã€JSæ•£åº¦çš„ä¼˜è¶Šæ€§åœ¨äºï¼Œå³ä¾¿ä¸¤ä¸ªåˆ†å¸ƒæ²¡æœ‰é‡å ï¼ŒWassersteinè·ç¦»ä»ç„¶èƒ½å¤Ÿåæ˜ å®ƒä»¬çš„è¿œè¿‘ã€‚<br>å…¶å…·ä½“å®šä¹‰å¦‚ä¸‹ï¼š<br><img src="https://user-images.githubusercontent.com/6218739/137243663-49a15547-9972-4daf-95ea-5a78751e10af.png" alt="em"><br>ï¼ˆæ³¨æ„ï¼ŒWassersteinè·ç¦»æœ¬èº«æ˜¯ä¸€ä¸ªè·ç¦»çš„æ¦‚å¿µï¼Œä¸Šå¼ä¸­çš„ä¸‹ç•Œæ„æ€æ˜¯ä»è¿™ä¸¤ä¸ªåˆ†å¸ƒä¸­é‡‡æ ·æ—¶å–å¾—çš„æœ€å°è·ç¦»ï¼Œå°±æ˜¯Wassersteinè·ç¦»ï¼‰<br>åœ¨å®é™…ä½¿ç”¨Wassersteinè·ç¦»æ—¶ï¼Œæ— æ³•ç›´æ¥åº”ç”¨ï¼Œä½œè€…å°†å…¶é€šè¿‡æŸä¸€å®šç†æ”¹å˜æˆäº†å¦‚ä¸‹æ¡ä»¶ï¼š<br><img src="https://user-images.githubusercontent.com/6218739/137256384-4c8ed599-a4e0-46b3-9b1f-d8546bfc53fb.png" alt="wgan-1"><br><img src="https://user-images.githubusercontent.com/6218739/137256914-76caca0f-c705-4973-aa5e-b492ba1910f6.png" alt="wgan-2"><br>å³è¿™é‡Œä¸çŸ¥é“å‡½æ•°fçš„å…·ä½“å½¢å¼ï¼Œç”¨ä¸€ç»„å‚æ•°wæ¥å®šä¹‰è¿™äº›fï¼Œè¿™é‡Œå°±æ˜¯æ·±åº¦å­¦ä¹ ä¸­çš„å¸¸ç”¨å¥—è·¯ï¼Œâ€œä»€ä¹ˆä¸œè¥¿å¦‚æœä¸çŸ¥é“ï¼Œå°±ç”¨ç¥ç»ç½‘ç»œæ¥å­¦åˆ°â€ï¼Œå› æ­¤få°±æ˜¯å‚æ•°ä¸ºwçš„ä¸€å¥—ç½‘ç»œï¼Œè¿™é‡ŒåŸä½œè€…å‘½åä¸ºCriticã€‚ï¼ˆè‡³äºä¸Šå¼ä¸­Kæ–½åŠ çš„é™åˆ¶ï¼Œæ˜¯é€šè¿‡å¯¹æƒé‡å‚æ•°wçš„è£å‰ªæ¥å®ç°çš„ã€‚ï¼‰<br>æ³¨æ„ä¸Šå¼ä¸­æ˜¯å°½å¯èƒ½æœ€å¤§åŒ–æ‰èƒ½è·å¾—Wassersteinè·ç¦»ï¼Œå› æ­¤ç½‘ç»œfçš„ä½œç”¨æ˜¯ä¸€ä¸ªæµ‹è·ç½‘ç»œï¼Œå®ƒçš„æœ€å¤§åŒ–maxçš„è¿‡ç¨‹å°±æ˜¯ä¸ºäº†æ‰¾åˆ°Wassersteinè·ç¦»ï¼Œå³è¯¥ç½‘ç»œé€æ­¥ä¼˜åŒ–æˆä¸ºä¸€ä¸ªå‡†ç¡®çš„Wassersteinè·ç¦»æµ‹é‡å°ºã€‚<br>å› æ­¤ï¼Œæœ€å¥½ä¸æŠŠå®ƒç§°ä¸ºåˆ¤åˆ«ç½‘ç»œï¼Œè€Œæ˜¯ç§°ä¸ºæµ‹è·ç½‘ç»œã€‚å®ƒçš„è®­ç»ƒè¿‡ç¨‹å°±æ˜¯æœ€å°åŒ–ä¸‹é¢çš„æŸå¤±ï¼ˆå› ä¸ºå®ƒæ˜¯ä¸ºäº†è¿‘ä¼¼æ‹ŸåˆWassersteinè·ç¦»ï¼Œå±äºå›å½’ä»»åŠ¡ï¼Œæ‰€ä»¥è¦æŠŠæœ€åä¸€å±‚çš„sigmoidæ‹¿æ‰ï¼‰ï¼š<br><img src="https://user-images.githubusercontent.com/6218739/137257689-06b20ed0-fd71-411e-b3c2-17798a574b3d.png" alt="wgan-loss-1"><br>é‚£ä¹ˆæ¥ä¸‹æ¥ï¼Œå› ä¸ºæµ‹è·ç½‘ç»œå·²ç»å°†Wassersteinè·ç¦»è®¡ç®—äº†å‡ºæ¥ï¼Œä¸‹ä¸€æ­¥å°±æ˜¯å°†è¯¥è·ç¦»å°½å¯èƒ½åœ°å‡å°ï¼Œä»è€Œä½¿å¾—ç”Ÿæˆå›¾åƒçš„åˆ†å¸ƒå°½å¯èƒ½åœ°ä¸çœŸå®å›¾åƒçš„åˆ†å¸ƒç±»ä¼¼ï¼Œè¿™å°±æ˜¯ç”Ÿæˆå™¨ç½‘ç»œè¦å¹²çš„äº‹æƒ…ã€‚<br>å›åˆ°å…¬å¼14ä¸­Wassersteinè·ç¦»çš„å®šä¹‰ï¼Œè¯¥è·ç¦»ç”±ä¸¤éƒ¨åˆ†æ„æˆï¼Œç¬¬ä¸€é¡¹æ˜¯çœŸå®å›¾åƒåˆ†å¸ƒçš„è´¡çŒ®ï¼Œç¬¬äºŒé¡¹æ˜¯ç”Ÿæˆå›¾åƒåˆ†å¸ƒçš„è´¡çŒ®ï¼Œè€Œç¬¬ä¸€é¡¹ä¸ç”Ÿæˆå™¨ç½‘ç»œæ— å…³ï¼Œå› æ­¤è¦ä½¿å¾—Wassersteinè·ç¦»å˜å¾—å°ä¸€äº›ï¼ˆæ³¨æ„ä¸è¦å—å¼ä¸­çš„maxå½±å“ï¼Œmaxæ˜¯ä¸ºäº†è®¡ç®—Wassersteinè·ç¦»ï¼‰ï¼Œå°±è¦ä½¿ç¬¬äºŒé¡¹ï¼ˆæ³¨æ„å¸¦å‰é¢çš„è´Ÿå·ï¼‰å˜å°ï¼Œå³ï¼š<br><img src="https://user-images.githubusercontent.com/6218739/137263288-aa414595-7a8d-4b78-97ed-83c134835975.png" alt="wgan-loss-2"><br>è‡³äºä»£ç å®ç°ï¼Œå¤§éƒ¨åˆ†éƒ½å¯ä»¥å¤ç”¨ä¹‹å‰çš„ï¼Œåªæ˜¯é’ˆå¯¹ä¸Šé¢è¯´çš„å››ç‚¹æ”¹åŠ¨ä¸€ä¸‹å³å¯ã€‚<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æµ‹è·ç½‘ç»œï¼Œçœ‹ç€è·ŸåŸå§‹GANçš„åˆ¤åˆ«ç½‘ç»œç±»ä¼¼ï¼Œä½†æ ¸å¿ƒæ„ä¹‰ä¸åŒï¼Œè¿™é‡Œä»ç„¶æ²¿ç”¨é‚£ä¸ªç½‘ç»œæ¶æ„ï¼Œä½†æ”¹ä¸ªåå­—ä»¥ç¤ºåŒºåˆ«</span></span><br><span class="line">critic = Discriminator(CHANNELS_IMG, FEATURES_CRITIC).to(device)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> epoch <span class="keyword">in</span> <span class="built_in">range</span>(NUM_EPOCHS):</span><br><span class="line">    <span class="comment"># Target labels not needed! &lt;3 unsupervised</span></span><br><span class="line">    <span class="keyword">for</span> batch_idx, (data, _) <span class="keyword">in</span> <span class="built_in">enumerate</span>(loader):</span><br><span class="line">        data = data.to(device)</span><br><span class="line">        cur_batch_size = data.shape[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">        <span class="comment">### è®­ç»ƒæµ‹è·ç½‘ç»œï¼Œæœ€å¤§åŒ–E[critic(real)] - E[critic(fake)]</span></span><br><span class="line">        <span class="comment">### å³æœ€å°åŒ–-(E[critic(real)] - E[critic(fake)])</span></span><br><span class="line">        <span class="comment"># Criticè®­ç»ƒå¾—è¶Šå¥½ï¼Œå¯¹Generatorçš„æå‡æ›´æœ‰åˆ©ï¼Œå› æ­¤å¤šè®­ç»ƒå‡ è½®Criticã€‚</span></span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(CRITIC_ITERATIONS):</span><br><span class="line">            noise = torch.randn(cur_batch_size, Z_DIM, <span class="number">1</span>, <span class="number">1</span>).to(device)</span><br><span class="line">            fake = gen(noise)</span><br><span class="line">            critic_real = critic(data).reshape(-<span class="number">1</span>)</span><br><span class="line">            critic_fake = critic(fake).reshape(-<span class="number">1</span>)</span><br><span class="line">            <span class="comment"># æµ‹è·ç½‘ç»œçš„æŸå¤±å‡½æ•°</span></span><br><span class="line">            <span class="comment"># ä¸¤ä¸ªæœŸæœ›å€¼ç›¸å‡</span></span><br><span class="line">            loss_critic = -(torch.mean(critic_real) - torch.mean(critic_fake))</span><br><span class="line">            critic.zero_grad()</span><br><span class="line">            loss_critic.backward(retain_graph=<span class="literal">True</span>)</span><br><span class="line">            opt_critic.step()</span><br><span class="line"></span><br><span class="line">            <span class="comment"># è£å‰ªç½‘ç»œæƒé‡</span></span><br><span class="line">            <span class="keyword">for</span> p <span class="keyword">in</span> critic.parameters():</span><br><span class="line">                p.data.clamp_(-WEIGHT_CLIP, WEIGHT_CLIP)</span><br><span class="line"></span><br><span class="line">        <span class="comment">########## è®­ç»ƒç”Ÿæˆå™¨ç½‘ç»œ ################</span></span><br><span class="line">        <span class="comment">## æœ€å¤§åŒ–E[critic(gen_fake)]</span></span><br><span class="line">        <span class="comment">## å³æœ€å°åŒ–-E[critic(gen_fake)]</span></span><br><span class="line">        gen_fake = critic(fake).reshape(-<span class="number">1</span>)</span><br><span class="line">        loss_gen = -torch.mean(gen_fake)</span><br><span class="line">        gen.zero_grad()</span><br><span class="line">        loss_gen.backward()</span><br><span class="line">        opt_gen.step()</span><br></pre></td></tr></table></figure></p><h2 id="WGAN-GP"><a href="#WGAN-GP" class="headerlink" title="WGAN-GP"></a>WGAN-GP</h2><p><a href="https://zhuanlan.zhihu.com/p/58260684">WGANçš„æ¥é¾™å»è„‰</a><br>ä½œè€…ä»¬å‘ç°WGANæœ‰æ—¶å€™ä¹Ÿä¼šä¼´éšæ ·æœ¬è´¨é‡ä½ã€éš¾ä»¥æ”¶æ•›ç­‰é—®é¢˜ã€‚WGANä¸ºäº†ä¿è¯Lipschitzé™åˆ¶ï¼Œé‡‡ç”¨äº†weight clippingçš„æ–¹æ³•ï¼Œç„¶è€Œè¿™æ ·çš„æ–¹å¼å¯èƒ½è¿‡äºç®€å•ç²—æš´äº†ï¼Œå› æ­¤ä»–ä»¬è®¤ä¸ºè¿™æ˜¯ä¸Šè¿°é—®é¢˜çš„ç½ªé­ç¥¸é¦–ã€‚<br>å…·ä½“è€Œè¨€ï¼Œä»–ä»¬é€šè¿‡ç®€å•çš„å®éªŒï¼Œå‘ç°weight clippingä¼šå¯¼è‡´ä¸¤å¤§é—®é¢˜ï¼šæ¨¡å‹å»ºæ¨¡èƒ½åŠ›å¼±åŒ–ï¼Œä»¥åŠæ¢¯åº¦çˆ†ç‚¸æˆ–æ¶ˆå¤±ã€‚<br>ä»–ä»¬æå‡ºçš„æ›¿ä»£æ–¹æ¡ˆæ˜¯ç»™Critic lossåŠ å…¥gradient penalty (GP)ï¼Œè¿™æ ·ï¼Œæ–°çš„ç½‘ç»œæ¨¡å‹å°±å«WGAN-GPã€‚<br>æ–°çš„Lossä¸ºï¼š<br><img src="https://user-images.githubusercontent.com/6218739/137277767-786bce8c-7f5c-4c2a-aca2-41cb80fcde85.png" alt="wgan-gp-loss"><br>å¦ä¸€ä¸ªå€¼å¾—æ³¨æ„çš„åœ°æ–¹æ˜¯ï¼Œç”¨äºè®¡ç®—GPçš„æ ·æœ¬æ˜¯ç”Ÿæˆæ ·æœ¬å’ŒçœŸå®æ ·æœ¬çš„çº¿æ€§æ’å€¼ã€‚<br>GPéƒ¨åˆ†çš„ä»£ç ä¸ºï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gradient_penalty</span>(<span class="params">critic, real, fake, device=<span class="string">&quot;cpu&quot;</span></span>):</span></span><br><span class="line">    BATCH_SIZE, C, H, W = real.shape</span><br><span class="line">    alpha = torch.rand((BATCH_SIZE, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>)).repeat(<span class="number">1</span>, C, H, W).to(device)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># çº¿æ€§æ’å€¼</span></span><br><span class="line">    interpolated_images = real * alpha + fake * (<span class="number">1</span> - alpha)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è®¡ç®—åˆ¤åˆ«ç½‘ç»œï¼ˆæµ‹è·ç½‘ç»œï¼‰å¾—åˆ†</span></span><br><span class="line">    mixed_scores = critic(interpolated_images)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è®¡ç®—æ¢¯åº¦</span></span><br><span class="line">    gradient = torch.autograd.grad(</span><br><span class="line">        inputs=interpolated_images,</span><br><span class="line">        outputs=mixed_scores,</span><br><span class="line">        grad_outputs=torch.ones_like(mixed_scores),</span><br><span class="line">        create_graph=<span class="literal">True</span>,</span><br><span class="line">        retain_graph=<span class="literal">True</span>,</span><br><span class="line">    )[<span class="number">0</span>]</span><br><span class="line">    gradient = gradient.view(gradient.shape[<span class="number">0</span>], -<span class="number">1</span>)</span><br><span class="line">    <span class="comment"># 2èŒƒæ•°</span></span><br><span class="line">    gradient_norm = gradient.norm(<span class="number">2</span>, dim=<span class="number">1</span>)</span><br><span class="line">    gradient_penalty = torch.mean((gradient_norm - <span class="number">1</span>) ** <span class="number">2</span>)</span><br><span class="line">    <span class="keyword">return</span> gradient_penalty</span><br></pre></td></tr></table></figure></p><h1 id="CGAN"><a href="#CGAN" class="headerlink" title="CGAN"></a>CGAN</h1><p><a href="https://zhuanlan.zhihu.com/p/61464846">æå®æ¯…GAN2018ç¬”è®° Conditional GAN</a><br>Conditionalï¼Œæ„æ€æ˜¯æ¡ä»¶ï¼Œæ‰€ä»¥ Conditional GAN çš„æ„æ€å°±æ˜¯æœ‰æ¡ä»¶çš„GANã€‚Conditional GAN å¯ä»¥è®© GAN äº§ç”Ÿçš„ç»“æœç¬¦åˆä¸€å®šçš„æ¡ä»¶ï¼Œå³å¯ä»¥é€šè¿‡äººä¸ºæ”¹å˜è¾“å…¥çš„å‘é‡ï¼ˆè®°ä¸è®°å¾—æˆ‘ä»¬è®©ç”Ÿæˆå™¨ç”Ÿæˆç»“æœéœ€è¦è¾“å…¥ä¸€ä¸ªä½ç»´å‘é‡ï¼‰ï¼Œæ§åˆ¶æœ€ç»ˆè¾“å‡ºçš„ç»“æœã€‚<br>è¿™ç§ç½‘ç»œä¸æ™®é€š GAN çš„åŒºåˆ«åœ¨äºè¾“å…¥åŠ å…¥äº†ä¸€ä¸ªé¢å¤–çš„ conditionï¼ˆæ¯”å¦‚åœ¨ text-to-image ä»»åŠ¡ä¸­çš„æè¿°æ–‡æœ¬ï¼‰ï¼Œå¹¶ä¸”åœ¨è®­ç»ƒçš„æ—¶å€™ä½¿å¾—è¾“å‡ºçš„ç»“æœæ‹Ÿåˆè¿™ä¸ª conditionã€‚<br>æ‰€ä»¥ç°åœ¨åˆ¤åˆ«å™¨ä¸ä»…è¦å¯¹ç”Ÿæˆç»“æœçš„è´¨é‡æ‰“åˆ†ï¼Œè¿˜è¦å¯¹ç»“æœä¸è¾“å…¥ condition çš„ç¬¦åˆç¨‹åº¦æ‰“åˆ†ã€‚<br>Conditional GAN çš„åˆ¤åˆ«å™¨æœ‰ä¸¤ç§å¸¸è§æ¶æ„ï¼Œå‰è€…æ›´ä¸ºå¸¸ç”¨ï¼Œä½†æå®æ¯…è€å¸ˆè®¤ä¸ºåè€…æ›´åŠ åˆç†ï¼Œå®ƒç”¨ä¸¤ä¸ªç¥ç»ç½‘ç»œåˆ†åˆ«å¯¹è¾“å‡ºç»“æœçš„è´¨é‡ä»¥åŠæ¡ä»¶ç¬¦åˆç¨‹åº¦ç‹¬ç«‹è¿›è¡Œåˆ¤åˆ«ã€‚<br><img src="https://user-images.githubusercontent.com/6218739/137661146-99fb337c-9d64-4740-ab9a-5b232a1aafdb.png" alt="cgan"></p><h1 id="Pix2Pix"><a href="#Pix2Pix" class="headerlink" title="Pix2Pix"></a>Pix2Pix</h1><p><a href="https://blog.csdn.net/u014380165/article/details/98453672">pix2pixç®—æ³•ç¬”è®°</a><br><a href="https://zhuanlan.zhihu.com/p/90300175">Pix2Pixå›¾å›¾è½¬æ¢ç½‘ç»œåŸç†åˆ†æä¸pytorchå®ç°</a><br>è‡ªåŠ¨å›¾å›¾è½¬æ¢ä»»åŠ¡è¢«å®šä¹‰ä¸ºï¼šåœ¨ç»™å®šå……è¶³çš„æ•°æ®ä¸‹ï¼Œä»ä¸€ç§åœºæ™¯è½¬æ¢åˆ°å¦ä¸€ç§åœºæ™¯ã€‚ä»åŠŸèƒ½å®ç°ä¸Šæ¥çœ‹ï¼Œç½‘ç»œéœ€è¦å­¦ä¼šâ€œæ ¹æ®åƒç´ é¢„æµ‹åƒç´ â€ï¼ˆpredict pixels from pixelsï¼‰ã€‚<br>CNNsçš„ç ”ç©¶å·²ç»ç»™å›¾å›¾è½¬æ¢é—®é¢˜æä¾›äº†ä¸€ç§ç®€ä¾¿çš„æ€è·¯ï¼Œæ¯”å¦‚è®¾è®¡ä¸€ä¸ªç¼–ç è§£ç ç½‘ç»œAEï¼ŒAEçš„è¾“å…¥ æ˜¯ç™½å¤©çš„å›¾åƒï¼ŒAEçš„æœŸæœ›è¾“å‡ºæ˜¯é»‘å¤œçš„å›¾åƒã€‚é‚£ä¹ˆå¯ä»¥ä½¿ç”¨MSEæŸå¤±ï¼Œæ¥æœ€å°åŒ–ç½‘ç»œè¾“å‡ºçš„é»‘å¤œå›¾åƒå’ŒçœŸå®é»‘å¤œå›¾åƒä¹‹é—´çš„å·®å¼‚ï¼Œå®ç°ç™½å¤©åˆ°é»‘å¤œçš„å›¾å›¾è½¬æ¢ã€‚<br>ç„¶è€Œï¼ŒCNNéœ€è¦æˆ‘ä»¬å»è®¾è®¡ç‰¹å®šçš„æŸå¤±å‡½æ•°ï¼Œæ¯”å¦‚ä½¿ç”¨æ¬§æ°è·ç¦»ä¼šå¯¼è‡´é¢„æµ‹çš„å›¾åƒå‡ºç°æ¨¡ç³Šã€‚æ‰€ä»¥ï¼Œéœ€è¦å»è®¾è®¡ä¸€ç§ç½‘ç»œï¼Œè¿™ç§ç½‘ç»œä¸éœ€è¦ç²¾å¿ƒé€‰æ‹©æŸå¤±å‡½æ•°ã€‚<br>æ›´ç¡®åˆ‡åœ°è¯´ï¼Œæ˜¯ç”¨ä¸€ç§é€šç”¨çš„æŸå¤±å‡½æ•°å½¢å¼æ¥è‡ªåŠ¨å­¦ä¹ ç‰¹å®šä»»åŠ¡çš„æŸå¤±å‡½æ•°ï¼Œå³GANæ¶æ„é‡Œåˆ¤åˆ«å™¨å’Œç”Ÿæˆå™¨çš„æŸå¤±å‡½æ•°æ˜¯é€šç”¨å½¢å¼ï¼Œå®ƒå¯ä»¥ç”¨æ¥ä½œä¸ºæ‰€æœ‰å›¾å›¾è½¬æ¢ä»»åŠ¡çš„ç»Ÿä¸€æŸå¤±ï¼Œè€Œå…·ä½“ä»»åŠ¡çš„æŸå¤±åˆ™æ˜¯åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­è‡ªåŠ¨å­¦ä¹ åˆ°çš„ï¼Œè¿™æ ·å°±ä¸ç”¨æ‰‹åŠ¨å‡†ç¡®è®¾å®šæŸå¤±å‡½æ•°ã€‚</p><p>è®ºæ–‡Image-to-Image Translation with Conditional Adversarial Networkså‘è¡¨åœ¨CVPR2017ï¼Œç®€ç§°pix2pixï¼Œæ˜¯å°†GANåº”ç”¨äºæœ‰ç›‘ç£çš„â€œå›¾åƒåˆ°å›¾åƒâ€ç¿»è¯‘çš„ç»å…¸è®ºæ–‡ï¼Œæœ‰ç›‘ç£è¡¨ç¤ºè®­ç»ƒæ•°æ®æ˜¯æˆå¯¹çš„ã€‚å›¾åƒåˆ°å›¾åƒç¿»è¯‘ï¼ˆimage-to-image translationï¼‰æ˜¯GANå¾ˆé‡è¦çš„ä¸€ä¸ªåº”ç”¨æ–¹å‘ï¼Œä»€ä¹ˆå«å›¾åƒåˆ°å›¾åƒç¿»è¯‘å‘¢ï¼Ÿå…¶å®å°±æ˜¯åŸºäºä¸€å¼ è¾“å…¥å›¾åƒå¾—åˆ°æƒ³è¦çš„è¾“å‡ºå›¾åƒçš„è¿‡ç¨‹ï¼Œå¯ä»¥çœ‹åšæ˜¯å›¾åƒå’Œå›¾åƒä¹‹é—´çš„ä¸€ç§æ˜ å°„ï¼ˆmappingï¼‰ï¼Œæˆ‘ä»¬å¸¸è§çš„å›¾åƒä¿®å¤ã€è¶…åˆ†è¾¨ç‡å…¶å®éƒ½æ˜¯å›¾åƒåˆ°å›¾åƒç¿»è¯‘çš„ä¾‹å­ã€‚ï¼ˆèŠ‚é€‰ä¸ºCSDNåšä¸»ã€ŒAIä¹‹è·¯ã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ï¼‰<br>pix2pixåŸºäºGANå®ç°å›¾åƒç¿»è¯‘ï¼Œæ›´å‡†ç¡®åœ°è®²æ˜¯åŸºäºcGANï¼ˆconditional GANï¼Œä¹Ÿå«æ¡ä»¶GANï¼‰ï¼Œå› ä¸ºcGANå¯ä»¥é€šè¿‡æ·»åŠ æ¡ä»¶ä¿¡æ¯æ¥æŒ‡å¯¼å›¾åƒç”Ÿæˆï¼Œå› æ­¤åœ¨å›¾åƒç¿»è¯‘ä¸­å°±å¯ä»¥å°†è¾“å…¥å›¾åƒä½œä¸ºæ¡ä»¶ï¼Œå­¦ä¹ ä»è¾“å…¥å›¾åƒåˆ°è¾“å‡ºå›¾åƒä¹‹é—´çš„æ˜ å°„ï¼Œä»è€Œå¾—åˆ°æŒ‡å®šçš„è¾“å‡ºå›¾åƒã€‚è€Œå…¶ä»–åŸºäºGANæ¥åšå›¾åƒç¿»è¯‘çš„ï¼Œå› ä¸ºGANç®—æ³•çš„ç”Ÿæˆå™¨æ˜¯åŸºäºä¸€ä¸ªéšæœºå™ªå£°ç”Ÿæˆå›¾åƒï¼Œéš¾ä»¥æ§åˆ¶è¾“å‡ºï¼Œå› æ­¤åŸºæœ¬ä¸Šéƒ½æ˜¯é€šè¿‡å…¶ä»–çº¦æŸæ¡ä»¶æ¥æŒ‡å¯¼å›¾åƒç”Ÿæˆï¼Œè€Œä¸æ˜¯åˆ©ç”¨cGANï¼Œè¿™æ˜¯pix2pixå’Œå…¶ä»–åŸºäºGANåšå›¾åƒç¿»è¯‘çš„å·®å¼‚ã€‚</p><p>ç”Ÿæˆå™¨é‡‡ç”¨U-Netï¼Œè¿™æ˜¯åœ¨å›¾åƒåˆ†å‰²é¢†åŸŸåº”ç”¨éå¸¸å¹¿æ³›çš„ç½‘ç»œç»“æ„ï¼Œèƒ½å¤Ÿå……åˆ†èåˆç‰¹å¾ï¼›è€ŒåŸæœ¬GANä¸­å¸¸ç”¨çš„ç”Ÿæˆå™¨ç»“æ„æ˜¯encoder-decoderç±»å‹ã€‚<br>åˆ¤åˆ«å™¨é‡‡ç”¨PatchGANã€‚é€šå¸¸åˆ¤æ–­éƒ½æ˜¯å¯¹ç”Ÿæˆæ ·æœ¬æ•´ä½“è¿›è¡Œåˆ¤æ–­ï¼Œæ¯”å¦‚å¯¹ä¸€å¼ å›¾ç‰‡æ¥è¯´ï¼Œå°±æ˜¯ç›´æ¥çœ‹æ•´å¼ ç…§ç‰‡æ˜¯å¦çœŸå®ã€‚è€Œä¸”Image-to-Image Translationä¸­å¾ˆå¤šè¯„ä»·æ˜¯åƒç´ å¯¹åƒç´ çš„ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œæå‡ºäº†åˆ†å—åˆ¤æ–­çš„ç®—æ³•ï¼Œåœ¨å›¾åƒçš„æ¯ä¸ªå—ä¸Šå»åˆ¤æ–­æ˜¯å¦ä¸ºçœŸï¼Œæœ€ç»ˆå¹³å‡ç»™å‡ºç»“æœã€‚PatchGANçš„å·®åˆ«ä¸»è¦æ˜¯åœ¨äºDiscriminatorä¸Šï¼Œä¸€èˆ¬çš„GANæ˜¯åªéœ€è¦è¾“å‡ºä¸€ä¸ªtrue or fasle çš„çŸ¢é‡ï¼Œè¿™æ˜¯ä»£è¡¨å¯¹æ•´å¼ å›¾åƒçš„è¯„ä»·ï¼›ä½†æ˜¯PatchGANè¾“å‡ºçš„æ˜¯ä¸€ä¸ªN x Nçš„çŸ©é˜µï¼Œè¿™ä¸ªN x Nçš„çŸ©é˜µçš„æ¯ä¸€ä¸ªå…ƒç´ ï¼Œæ¯”å¦‚a(i,j) åªæœ‰True or False è¿™ä¸¤ä¸ªé€‰æ‹©ï¼ˆlabel æ˜¯ N x Nçš„çŸ©é˜µï¼Œæ¯ä¸€ä¸ªå…ƒç´ æ˜¯True æˆ–è€… Falseï¼‰ï¼Œè¿™æ ·çš„ç»“æœå¾€å¾€æ˜¯é€šè¿‡å·ç§¯å±‚æ¥è¾¾åˆ°çš„ï¼Œå› ä¸ºé€æ¬¡å åŠ çš„å·ç§¯å±‚æœ€ç»ˆè¾“å‡ºçš„è¿™ä¸ªN x N çš„çŸ©é˜µï¼Œå…¶ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ ï¼Œå®é™…ä¸Šä»£è¡¨ç€åŸå›¾ä¸­çš„ä¸€ä¸ªæ¯”è¾ƒå¤§çš„æ„Ÿå—é‡ï¼Œä¹Ÿå°±æ˜¯è¯´å¯¹åº”ç€åŸå›¾ä¸­çš„ä¸€ä¸ªPatchï¼Œå› æ­¤å…·æœ‰è¿™æ ·ç»“æ„ä»¥åŠè¿™æ ·è¾“å‡ºçš„GANè¢«ç§°ä¹‹ä¸ºPatch GANã€‚è¿™ä¹ˆè®¾è®¡çš„åŸå› æ˜¯ä¾é L1é¡¹æ¥ä¿è¯ä½é¢‘çš„å‡†ç¡®æ€§ã€‚ä¸ºäº†å¯¹é«˜é¢‘ä¿¡æ¯å»ºæ¨¡ï¼ˆå³ç»†èŠ‚ï¼‰ï¼Œå…³æ³¨å¯¹å±€éƒ¨å›¾åƒå—ï¼ˆpatchesï¼‰å°±å·²ç»è¶³å¤Ÿäº†ã€‚</p><p>æŸå¤±å‡½æ•°æ²¿ç”¨äº†æœ€åŸå§‹çš„GANçš„æŸå¤±ï¼Œå³æœ‰logä½œç”¨ï¼š<br><img src="https://user-images.githubusercontent.com/6218739/137694646-69faa7ab-913e-4cdc-9f6f-6e97faf30da7.png" alt="pix2pix-loss-1"><br>åŒæ—¶åŠ å…¥äº†ä¸€ä¸ªL1æŸå¤±ï¼Œä½¿ç”Ÿæˆå›¾åƒä¸ä»…è¦åƒçœŸå®å›¾ç‰‡ï¼Œä¹Ÿè¦æ›´æ¥è¿‘äºè¾“å…¥çš„æ¡ä»¶å›¾ç‰‡ï¼š<br><img src="https://user-images.githubusercontent.com/6218739/137695208-19578014-4dcf-448d-8781-35a33a519441.png" alt="pix2pix-loss-2"><br>å°†å¯¹æŠ—æŸå¤±å’ŒL1æŸå¤±ç›¸åŠ ï¼Œå°±å¾—åˆ°äº†æœ€ç»ˆçš„æ•´ä½“æŸå¤±å‡½æ•°ï¼š<br><img src="https://user-images.githubusercontent.com/6218739/137695374-7ee625bb-6593-4391-8d0b-10a407d1642d.png" alt="pix2pix-loss"></p><p>pix2pixçš„ä»£ç å®ç°ä¸ä¹‹å‰çš„GANå¤§åŒå°å¼‚ï¼Œä¸åŒçš„åœ°æ–¹å°±æ˜¯ä¸Šé¢çš„æ¨¡å‹æ¶æ„å’ŒæŸå¤±å‡½æ•°ï¼Œä¸å†èµ˜è¿°ã€‚</p><h1 id="CycleGAN"><a href="#CycleGAN" class="headerlink" title="CycleGAN"></a>CycleGAN</h1><p><a href="https://zhuanlan.zhihu.com/p/26332365">å¼‚çˆ¶å¼‚æ¯çš„ä¸‰èƒèƒï¼šCycleGAN, DiscoGAN, DualGAN</a><br><a href="https://zhuanlan.zhihu.com/p/26995910">CycleGAN</a></p><p>pix2pixçš„æ¨¡å‹æ˜¯åœ¨æˆå¯¹çš„æ•°æ®ä¸Šè®­ç»ƒçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹äºçº¿æ¡åˆ°çŒ«çš„åº”ç”¨ï¼Œæˆ‘ä»¬è®­ç»ƒçš„æ—¶å€™å°±éœ€è¦æä¾›ä¸€å¯¹ä¸€å¯¹çš„æ•°æ®ï¼šä¸€ä¸ªçº¿æ¡ç”»ï¼Œå’Œå¯¹åº”çš„çœŸå®çš„çŒ«å›¾ç‰‡ã€‚<br>ç„¶è€Œåœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰è¿™æ ·å®Œç¾çš„æˆå¯¹çš„è®­ç»ƒæ•°æ®ã€‚æ¯”å¦‚è¯´å¦‚æœä½ æƒ³æŠŠé©¬å˜æˆæ–‘é©¬ï¼Œå¹¶æ²¡æœ‰è¿™æ ·å¯¹åº”çš„ä¸€ä¸ªé©¬å¯¹åº”ä¸€ä¸ªæ–‘é©¬ã€‚ç„¶è€Œï¼Œé©¬çš„å›¾ç‰‡å’Œæ–‘é©¬çš„å›¾ç‰‡å´å¾ˆå¤šã€‚æ‰€ä»¥è¿™ç¯‡è®ºæ–‡å°±æ˜¯å¸Œæœ›ï¼Œèƒ½å¤Ÿé€šè¿‡ä¸æˆå¯¹çš„è®­ç»ƒæ•°æ®ï¼Œæ¥å­¦åˆ°å˜æ¢ã€‚<br>ä¸€ä¸ªæ™®é€šçš„GANåªæœ‰ä¸€ä¸ªç”Ÿæˆå™¨å’Œä¸€ä¸ªåˆ¤åˆ«å™¨ã€‚è€Œåœ¨CycleGANé‡Œï¼Œåˆ†åˆ«æœ‰ä¸¤ä¸ªç”Ÿæˆå™¨å’Œåˆ¤åˆ«å™¨ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="https://user-images.githubusercontent.com/6218739/138195026-c3033357-122f-4448-90b8-bd4814cf2e9c.png" alt="cyclegan"><br>ä¸€ä¸ªç”Ÿæˆå™¨å°†XåŸŸçš„å›¾ç‰‡è½¬æ¢æˆYåŸŸçš„å›¾ç‰‡ï¼ˆç”¨Gè¡¨ç¤ºï¼‰ï¼Œè€Œå¦ä¸€ä¸ªç”Ÿæˆå™¨åšç›¸åçš„äº‹æƒ…ï¼Œç”¨Fè¡¨ç¤ºã€‚è€Œä¸¤ä¸ªåˆ¤åˆ«å™¨$D_x$å’Œ$D_y$è¯•å›¾åˆ†è¾¨ä¸¤ä¸ªåŸŸä¸­çœŸå‡å›¾ç‰‡ã€‚ï¼ˆè¿™é‡Œå‡å›¾ç‰‡æŒ‡çš„æ˜¯ä»çœŸç…§ç‰‡transformæ¥çš„ï¼‰<br>çœ‹ä¸Šå›¾ï¼ŒXé€šè¿‡Gç”ŸæˆYï¼ŒYå†é€šè¿‡Fç”ŸæˆXï¼Œæ„æˆäº†ä¸€ä¸ªå¾ªç¯ï¼Œæ‰€ä»¥å«CycleGANã€‚æ•´ä¸ªcycleå¯ä»¥çœ‹æˆæ˜¯ä¸€ä¸ªautoencoderï¼Œä¸¤ä¸ªgeneratorçœ‹æˆæ˜¯encoderå’Œdecoderã€‚è€Œä¸¤ä¸ªdiscriminatoråˆ™æ˜¯å‡†åˆ™ã€‚<br>æŸå¤±å‡½æ•°åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š<br>ï¼ˆ1ï¼‰å¯¹æŠ—æŸå¤±Adversarial Lossï¼š<br>ä»Xåˆ°Yçš„å¯¹æŠ—æŸå¤±ä¸ºï¼š<br><img src="https://user-images.githubusercontent.com/6218739/138197675-43f6916f-3730-4836-b962-dce030489cfe.png" alt="cyclegan-loss-1"><br>ä»Yåˆ°Xçš„å¯¹æŠ—æŸå¤±åä¹‹äº¦ç„¶ã€‚<br>ï¼ˆ2ï¼‰Cycle Consistency æŸå¤±<br>Cycle consistencyæ˜¯ä¸ºäº†ä½¿å¾—transformèƒ½æˆåŠŸã€‚è®²é“ç†ï¼Œå¦‚æœä½ èƒ½ä»Xè½¬æ¢åˆ°Yï¼Œç„¶åå†ä»Yè½¬æ¢åˆ°Xï¼Œæœ€åçš„ç»“æœåº”è¯¥å’Œè¾“å…¥ç›¸ä¼¼ã€‚è¿™é‡Œä»–ä»¬ç”¨æœ€åè¾“å‡ºå’Œè¾“å…¥çš„L1è·ç¦»æ¥ä½œä¸ºå¦å¤–çš„æƒ©ç½šé¡¹ã€‚<br>è¿™ä¸ªæƒ©ç½šé¡¹é˜²æ­¢äº†mode collapseçš„é—®é¢˜ã€‚å¦‚æœæ²¡æœ‰è¿™ä¸ªcycle consistencyé¡¹ï¼Œç½‘ç»œä¼šè¾“å‡ºæ›´çœŸå®çš„å›¾ç‰‡ï¼Œä½†æ˜¯æ— è®ºä»€ä¹ˆè¾“å…¥ï¼Œéƒ½ä¼šæ˜¯ä¸€æ ·çš„è¾“å‡ºã€‚è€Œå¦‚æœåŠ äº†cycle consistencyï¼Œä¸€æ ·çš„è¾“å‡ºä¼šå¯¼è‡´cycle consistencyçš„ç›´æ¥å¤±è´¥ã€‚æ‰€ä»¥è¿™è§„å®šäº†åœ¨ç»è¿‡äº†å˜æ¢ä¹‹åçš„å›¾ç‰‡ä¸ä»…éœ€è¦çœŸå®ï¼Œä¸”åŒ…å«åŸæœ¬å›¾ç‰‡çš„ä¿¡æ¯ã€‚<br><img src="https://user-images.githubusercontent.com/6218739/138223001-01e048e8-1f0d-4ae0-aa39-5cb518809809.png" alt="cyclegan-loss-2"></p><p>åˆ¶ä½œæ•°æ®é›†æ—¶ï¼Œæ¯”å¦‚æƒ³æŠŠé©¬å’Œæ–‘é©¬è¿›è¡Œè½¬æ¢ï¼Œé‚£ä¹ˆå°±å‡†å¤‡é©¬çš„æ•°æ®é›†Xï¼Œæ–‘é©¬çš„æ•°æ®é›†Yï¼Œä¸¤è€…ä¸éœ€è¦æ•°é‡ç›¸ç­‰ï¼Œä¹Ÿä¸éœ€è¦ä¸€ä¸€å¯¹åº”ã€‚è®­ç»ƒæ—¶ï¼Œä¸Šé¢çš„æŸå¤±ä¼šä¿è¯é©¬è½¬æ¢æˆç›¸åŒä½“å‹å’Œå§¿æ€çš„æ–‘é©¬ã€‚</p><h1 id="ProGAN"><a href="#ProGAN" class="headerlink" title="ProGAN"></a>ProGAN</h1><p><a href="https://zhuanlan.zhihu.com/p/93748098">ProGANï¼šStep by step, better than better</a><br>ProGAN ä¸­çš„ Pro å¹¶é Professionalï¼Œè€Œæ˜¯ Progressiveï¼Œå³é€æ¸çš„æ„æ€ï¼Œè¿™ç¯‡ paper ä¸»è¦æƒ³è§£å†³çš„é—®é¢˜æ˜¯é«˜æ¸…å›¾åƒéš¾ä»¥ç”Ÿæˆçš„é—®é¢˜ï¼Œå›¾åƒç”Ÿæˆä¸»è¦çš„æŠ€æœ¯è·¯çº¿æœ‰ï¼šï¼ˆ1ï¼‰Autoregressive Model: PixelRNNï¼Œï¼ˆ2ï¼‰VAEsï¼Œï¼ˆ3ï¼‰GANsã€‚<br>GANæœ€å¤§çš„å¥½å¤„åœ¨äºç”Ÿæˆçš„å›¾åƒååˆ†Sharpï¼Œè€Œå¼±ç‚¹åˆ™åœ¨äºè®­ç»ƒéº»çƒ¦ï¼Œå®¹æ˜“å´©ï¼Œè€Œä¸”ç”Ÿæˆçš„æ•°æ®åˆ†å¸ƒåªæ˜¯è®­ç»ƒé›†æ•°æ®åˆ†å¸ƒçš„ä¸€ä¸ªå­é›†ï¼Œå³å¤šæ ·æ€§ä¸è¶³ã€‚ProGAN æœ€å¤§çš„è´¡çŒ®åœ¨äºæå‡ºäº†ä¸€ç§æ–°çš„è®­ç»ƒæ–¹å¼ï¼Œå³ï¼Œæˆ‘ä»¬ä¸è¦ä¸€ä¸Šæ¥å°±å­¦é‚£ä¹ˆéš¾çš„é«˜æ¸…å›¾åƒç”Ÿæˆï¼Œè¿™æ ·ä¼šè®© Generator ç›´æ¥å´©æ‰ï¼Œè€Œæ˜¯ä»ä½æ¸…å¼€å§‹å­¦èµ·ï¼Œå­¦å¥½äº†å†æå‡åˆ†è¾¨ç‡å­¦æ›´é«˜åˆ†è¾¨ç‡ä¸‹çš„å›¾ç‰‡ç”Ÿæˆã€‚ä»4x4åˆ°8x8ä¸€ç›´æå‡åˆ°1024x1024ï¼Œå¾ªåºæ¸è¿›ï¼Œå³èƒ½æœ‰æ•ˆä¸”ç¨³å®šåœ°è®­ç»ƒå‡ºä¸€ä¸ªé«˜è´¨é‡çš„é«˜åˆ†è¾¨ç‡ç”Ÿæˆå™¨æ¨¡å‹ã€‚<br>è¿™æ ·åšçš„å¥½å¤„ä¸»è¦æœ‰äºŒï¼š<br>ï¼ˆ1ï¼‰æ¯«æ— ç–‘é—®ï¼Œæ¯”ç›´æ¥å­¦ç”Ÿæˆ 1024x1024 çš„å›¾åƒç¨³å®šå¤šäº†ã€‚<br>ï¼ˆ2ï¼‰å¦å¤–ï¼ŒèŠ‚çœæ—¶é—´ï¼Œè®­ç»ƒä½åˆ†è¾¨ç‡é˜¶æ®µä¸‹çš„ç”Ÿæˆå™¨å¿«å¾—ä¸çŸ¥é“å“ªé‡Œå»äº†ï¼Œå¤§å¤§èŠ‚çœæ•´ä½“è®­ç»ƒæ—¶é—´ã€‚</p><h1 id="SRGAN"><a href="#SRGAN" class="headerlink" title="SRGAN"></a>SRGAN</h1><p><a href="https://perper.site/2019/03/01/SRGAN-%E8%AF%A6%E8%A7%A3/">SRGAN è¯¦è§£</a><br>SRGANç›®æ ‡ä»ä¸€ä¸ªä½åˆ†è¾¨ç‡çš„å›¾ç‰‡ä¸­ç”Ÿæˆå®ƒçš„é«˜åˆ†è¾¨ç‡ç‰ˆæœ¬ã€‚<br>ä¼ ç»ŸCNNæ–¹æ³•ï¼šåŸºäºæ·±åº¦å­¦ä¹ çš„é«˜åˆ†è¾¨ç‡å›¾åƒé‡å»ºå·²ç»å–å¾—äº†å¾ˆå¥½çš„æ•ˆæœï¼Œå…¶æ–¹æ³•æ˜¯é€šè¿‡ä¸€ç³»åˆ—ä½åˆ†è¾¨ç‡å›¾åƒå’Œä¸ä¹‹å¯¹åº”çš„é«˜åˆ†è¾¨ç‡å›¾åƒä½œä¸ºè®­ç»ƒæ•°æ®ï¼Œå­¦ä¹ ä¸€ä¸ªä»ä½åˆ†è¾¨ç‡å›¾åƒåˆ°é«˜åˆ†è¾¨ç‡å›¾åƒçš„æ˜ å°„å‡½æ•°ã€‚ä½†æ˜¯å½“å›¾åƒçš„æ”¾å¤§å€æ•°åœ¨4ä»¥ä¸Šæ—¶ï¼Œå¾ˆå®¹æ˜“ä½¿å¾—åˆ°çš„ç»“æœæ˜¾å¾—è¿‡äºå¹³æ»‘ï¼Œè€Œç¼ºå°‘ä¸€äº›ç»†èŠ‚ä¸Šçš„çœŸå®æ„Ÿã€‚è¿™æ˜¯å› ä¸ºä¼ ç»Ÿçš„æ–¹æ³•ä½¿ç”¨çš„ä»£ä»·å‡½æ•°ä¸€èˆ¬æ˜¯æœ€å°å‡æ–¹å·®ï¼ˆMSEï¼‰ï¼Œä½¿å¾—ç”Ÿæˆçš„å›¾åƒæœ‰è¾ƒé«˜çš„ä¿¡å™ªæ¯”ï¼Œä½†æ˜¯ç¼ºå°‘äº†é«˜é¢‘ä¿¡æ¯ï¼Œå‡ºç°è¿‡åº¦å¹³æ»‘çš„çº¹ç†ã€‚ä½œè€…è¿˜åšäº†å®éªŒï¼Œè¯æ˜å¹¶ä¸æ˜¯ä¿¡å™ªæ¯”è¶Šé«˜è¶…åˆ†è¾¨ç‡æ•ˆæœè¶Šå¥½ã€‚<br>æœ¬æ–‡çš„åšæ³•ï¼šåº”å½“ä½¿é‡å»ºçš„é«˜åˆ†è¾¨ç‡å›¾åƒä¸çœŸå®çš„é«˜åˆ†è¾¨ç‡å›¾åƒæ— è®ºæ˜¯ä½å±‚æ¬¡çš„åƒç´ å€¼ä¸Šï¼Œè¿˜æ˜¯é«˜å±‚æ¬¡çš„æŠ½è±¡ç‰¹å¾ä¸Šï¼Œå’Œæ•´ä½“æ¦‚å¿µå’Œé£æ ¼ä¸Šï¼Œéƒ½åº”å½“æ¥è¿‘ã€‚å› æ­¤åœ¨losséƒ¨åˆ†ï¼ŒSRGANåŠ ä¸Šäº†feature mapéƒ¨åˆ†çš„MSE lossã€‚<br>ç½‘ç»œç»“æ„æœ‰ï¼š<br>ç”Ÿæˆç½‘ç»œéƒ¨åˆ†ï¼šSRResnetï¼Œè¾“å…¥æ˜¯ä½åˆ†è¾¨ç‡å›¾åƒï¼ˆæ³¨æ„ä¸åŸå§‹GANè¾“å…¥æ˜¯å™ªå£°è¿›è¡Œå¯¹æ¯”ï¼‰ï¼Œç”±æ®‹å·®ç»“æ„ï¼ŒBNï¼ŒPReLUç»„æˆï¼Œç”¨äºå®ç°é«˜åˆ†è¾¨ç‡çš„ç”Ÿæˆã€‚<br>åˆ¤åˆ«å™¨éƒ¨åˆ†ï¼šç”±å¤§é‡å·ç§¯å±‚ï¼ŒLeaky ReLU,BNç­‰ç»“æ„ç»„æˆï¼Œç”¨äºåˆ¤åˆ«å›¾åƒçš„çœŸå®æ€§ã€‚<br>æŸå¤±å‡½æ•°ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼šï¼ˆ1ï¼‰content lossï¼šä¼ ç»Ÿç®—æ³•ä½¿ç”¨çš„æ˜¯è¿˜åŸå›¾åƒä¸GTå›¾åƒä¹‹é—´çš„MSEæŸå¤±ï¼Œä½œè€…ä¸ºäº†é¿å…æ”¾å¤§åç‰¹å¾è¿‡äºå¹³æ»‘ï¼Œè®¤ä¸ºé«˜å±‚æ¬¡ï¼ˆfeatures mapï¼‰ä¹Ÿåº”å½“ç›¸ä¼¼ã€‚å› æ­¤å®šä¹‰äº†VGG feature map lossã€‚ï¼ˆ2ï¼‰adversarial lossï¼šå¯¹æŠ—ç½‘ç»œéƒ¨åˆ†çš„lossä¸ºåˆ¤åˆ«å™¨åˆ¤åˆ«lossï¼Œå³å½“ç”Ÿæˆå™¨ç”Ÿæˆçš„å›¾ç‰‡ï¼Œåˆ¤åˆ«å™¨è®¤ä¸ºä¸ºçœŸå®çš„å›¾ç‰‡æ—¶ï¼Œè¯¥losså–å¾—æœ€å°ã€‚<br>å› æ­¤ï¼ŒSRGANæ˜¯ä¸€ä¸ªç›‘ç£å¼ç®—æ³•ï¼Œå®ƒéœ€è¦Ground Truthçš„è¾“å…¥ã€‚</p><h2 id="ESRGAN"><a href="#ESRGAN" class="headerlink" title="ESRGAN"></a>ESRGAN</h2><p><a href="https://zhuanlan.zhihu.com/p/338646051">ESRGANè¶…åˆ†è¾¨ç½‘ç»œ</a><br>ESRGANå°±æ˜¯Enhanced Super-Resolution Generative Adversarial Networksï¼Œä½œè€…ä¸»è¦ä»ä¸‰ä¸ªæ–¹é¢å¯¹SRGANè¿›è¡Œæ”¹è¿›ï¼šç½‘ç»œç»“æ„ã€å¯¹æŠ—æŸå¤±ã€æ„ŸçŸ¥æŸå¤±ã€‚<br>ï¼ˆ1ï¼‰ç½‘ç»œç»“æ„ï¼šå¼•å…¥äº† Residual-in-Residual Dense Block (RRDB)æ¥ä»£æ›¿SRGANä¸­çš„resblockï¼›ç§»é™¤äº†ç½‘ç»œå•å…ƒçš„BNå±‚ï¼›å¢åŠ äº†residual scalingï¼Œæ¥æ¶ˆé™¤éƒ¨åˆ†å› ç§»é™¤BNå±‚å¯¹æ·±åº¦ç½‘ç»œè®­ç»ƒç¨³å®šæ€§çš„å½±å“ã€‚<br>ï¼ˆ2ï¼‰å¯¹æŠ—æŸå¤±ï¼šSRGANçš„å¯¹æŠ—æŸå¤±çš„ç›®çš„æ˜¯ä¸ºäº†è®©çœŸå®å›¾åƒçš„åˆ¤å†³æ¦‚ç‡æ›´æ¥è¿‘1ï¼Œè®©ç”Ÿæˆå›¾åƒçš„åˆ¤å†³æ¦‚ç‡æ›´æ¥è¿‘0ã€‚è€Œæ”¹è¿›çš„ESRGANçš„ç›®æ ‡æ˜¯ï¼Œè®©ç”Ÿæˆå›¾åƒå’ŒçœŸå®å›¾åƒä¹‹é—´çš„è·ç¦»ä¿æŒå°½å¯èƒ½å¤§ï¼Œè¿™æ˜¯å¼•å…¥äº†çœŸå®å›¾åƒå’Œç”Ÿæˆå›¾åƒé—´çš„ç›¸å¯¹è·ç¦»ï¼ˆRelativistic average GANç®€ç§°RaGANï¼‰ï¼Œè€Œä¸æ˜¯SRGANä¸­çš„è¡¡é‡å’Œ0æˆ–1é—´çš„ç»å¯¹è·ç¦»ã€‚ï¼ˆå…·ä½“è¯´æ¥ï¼ŒESRGANç›®çš„æ˜¯ï¼šè®©çœŸå®å›¾åƒçš„åˆ¤å†³åˆ†å¸ƒå‡å»ç”Ÿæˆå›¾åƒçš„å¹³å‡åˆ†å¸ƒï¼Œå†å¯¹ä¸Šè¿°ç»“æœåšsigmoidå¤„ç†ï¼Œä½¿å¾—ç»“æœæ›´æ¥è¿‘äº1ï¼›è®©ç”Ÿæˆå›¾åƒçš„åˆ¤å†³åˆ†å¸ƒå‡å»çœŸå®å›¾åƒçš„å¹³å‡åˆ†å¸ƒï¼Œå†å¯¹ä¸Šè¿°ç»“æœåšsigmoidå¤„ç†ï¼Œä½¿å¾—ç»“æœæ›´æ¥è¿‘äº0ã€‚ï¼‰<br>ï¼ˆ3ï¼‰æ„ŸçŸ¥æŸå¤±ï¼šï¼ˆåŸºäºç‰¹å¾ç©ºé—´çš„è®¡ç®—ï¼Œè€Œéåƒç´ ç©ºé—´ï¼‰ä½¿ç”¨VGGç½‘ç»œæ¿€æ´»å±‚å‰çš„ç‰¹å¾å›¾ï¼Œè€Œä¸åƒSRGANä¸­ä½¿ç”¨æ¿€æ´»å±‚åçš„ç‰¹å¾å›¾ã€‚å› ä¸ºæ¿€æ´»å±‚åçš„ç‰¹å¾å›¾æœ‰æ›´ç¨€ç–çš„ç‰¹å¾ï¼Œè€Œæ¿€æ´»å‰çš„ç‰¹å¾å›¾æœ‰æ›´è¯¦ç»†çš„ç»†èŠ‚ï¼Œå› æ­¤å¯ä»¥å¸¦æ¥æ›´å¼ºçš„ç›‘ç£ã€‚å¹¶ä¸”ï¼Œé€šè¿‡ä½¿ç”¨æ¿€æ´»åçš„ç‰¹å¾å›¾ä½œä¸ºæ„ŸçŸ¥æŸå¤±çš„è®¡ç®—ï¼Œå¯ä»¥å¸¦æ¥æ›´åŠ é”åŒ–çš„è¾¹ç¼˜å’Œæ›´å¥½è§†è§‰ä½“éªŒã€‚</p>]]></content>
    
    
    <summary type="html">åŸºæœ¬æ€æƒ³
ç”Ÿæˆå¯¹æŠ—ç½‘ç»œâ€”â€”åŸç†è§£é‡Šå’Œæ•°å­¦æ¨å¯¼
é¦–å…ˆæœ‰ä¸€ä¸ªâ€œç”Ÿæˆå™¨(Generator)â€ï¼šå…¶å®å°±æ˜¯ä¸€ä¸ªç¥ç»ç½‘ç»œï¼Œæˆ–è€…æ˜¯æ›´ç®€å•çš„ç†è§£ï¼Œä»–å°±æ˜¯ä¸€ä¸ªå‡½æ•°(Function)ã€‚è¾“å…¥ä¸€ç»„å‘é‡ï¼Œç»ç”±ç”Ÿæˆå™¨ï¼Œäº§ç”Ÿä¸€ç»„ç›®æ ‡çŸ©é˜µï¼ˆå¦‚æœä½ è¦ç”Ÿæˆå›¾ç‰‡ï¼Œé‚£ä¹ˆçŸ©é˜µå°±æ˜¯å›¾ç‰‡çš„åƒç´ é›†åˆï¼Œå…·ä½“çš„è¾“å‡ºè§†ä½ çš„ä»»åŠ¡è€Œå®šï¼‰ã€‚å®ƒçš„ç›®çš„å°±æ˜¯ä½¿å¾—è‡ªå·±é€ æ ·æœ¬çš„èƒ½åŠ›å°½å¯èƒ½å¼ºï¼Œå¼ºåˆ°ä»€ä¹ˆç¨‹åº¦å‘¢ï¼Œå¼ºåˆ°ä½ åˆ¤åˆ«ç½‘ç»œæ²¡æ³•åˆ¤æ–­æˆ‘æ˜¯çœŸæ ·æœ¬è¿˜æ˜¯å‡æ ·æœ¬ã€‚
åŒæ—¶è¿˜æœ‰ä¸€ä¸ªâ€œåˆ¤åˆ«å™¨(Discriminator)â€ï¼šåˆ¤åˆ«å™¨çš„ç›®çš„å°±æ˜¯èƒ½åˆ¤åˆ«å‡ºæ¥ä¸€å¼ å›¾å®ƒæ˜¯æ¥è‡ªçœŸå®æ ·æœ¬é›†è¿˜æ˜¯å‡æ ·æœ¬é›†ã€‚å‡å¦‚è¾“å…¥çš„æ˜¯çœŸæ ·æœ¬ï¼Œç½‘ç»œè¾“å‡ºå°±æ¥è¿‘ 1ï¼Œè¾“å…¥çš„æ˜¯å‡æ ·æœ¬ï¼Œç½‘ç»œè¾“å‡ºæ¥è¿‘ 0ï¼Œé‚£ä¹ˆå¾ˆå®Œç¾ï¼Œè¾¾åˆ°äº†</summary>
    
    
    
    <category term="machine learning" scheme="http://qixinbo.github.io/categories/machine-learning/"/>
    
    
    <category term="GAN" scheme="http://qixinbo.github.io/tags/GAN/"/>
    
  </entry>
  
  <entry>
    <title>YOLOç³»åˆ—ç®—æ³•åŸç†åŠæç®€ä»£ç è§£æ</title>
    <link href="http://qixinbo.github.io/2021/09/25/yolo3/"/>
    <id>http://qixinbo.github.io/2021/09/25/yolo3/</id>
    <published>2021-09-24T16:00:00.000Z</published>
    <updated>2021-09-25T15:15:16.864Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h1><p>ç‰©ä½“æ£€æµ‹çš„ä¸¤ä¸ªæ­¥éª¤å¯ä»¥æ¦‚æ‹¬ä¸ºï¼š<br>æ­¥éª¤ä¸€ï¼šæ£€æµ‹ç›®æ ‡ä½ç½®ï¼ˆç”ŸæˆçŸ©å½¢æ¡†ï¼‰<br>æ­¥éª¤äºŒï¼šå¯¹ç›®æ ‡ç‰©ä½“è¿›è¡Œåˆ†ç±»<br>ç‰©ä½“æ£€æµ‹ä¸»æµçš„ç®—æ³•æ¡†æ¶å¤§è‡´åˆ†ä¸ºone-stageä¸two-stageã€‚two-stageç®—æ³•ä»£è¡¨æœ‰R-CNNç³»åˆ—ï¼Œone-stageç®—æ³•ä»£è¡¨æœ‰Yoloç³»åˆ—ã€‚two-stageç®—æ³•å°†æ­¥éª¤ä¸€ä¸æ­¥éª¤äºŒåˆ†å¼€æ‰§è¡Œï¼Œè¾“å…¥å›¾åƒå…ˆç»è¿‡å€™é€‰æ¡†ç”Ÿæˆç½‘ç»œï¼ˆä¾‹å¦‚faster rcnnä¸­çš„RPNç½‘ç»œï¼‰ï¼Œå†ç»è¿‡åˆ†ç±»ç½‘ç»œï¼›one-stageç®—æ³•å°†æ­¥éª¤ä¸€ä¸æ­¥éª¤äºŒåŒæ—¶æ‰§è¡Œï¼Œè¾“å…¥å›¾åƒåªç»è¿‡ä¸€ä¸ªç½‘ç»œï¼Œç”Ÿæˆçš„ç»“æœä¸­åŒæ—¶åŒ…å«ä½ç½®ä¸ç±»åˆ«ä¿¡æ¯ã€‚two-stageä¸one-stageç›¸æ¯”ï¼Œç²¾åº¦é«˜ï¼Œä½†æ˜¯è®¡ç®—é‡æ›´å¤§ï¼Œæ‰€ä»¥è¿ç®—è¾ƒæ…¢ã€‚</p><h1 id="YOLO"><a href="#YOLO" class="headerlink" title="YOLO"></a>YOLO</h1><h2 id="YOLOv1"><a href="#YOLOv1" class="headerlink" title="YOLOv1"></a>YOLOv1</h2><p><a href="https://zhuanlan.zhihu.com/p/70387154">ã€è®ºæ–‡è§£è¯»ã€‘Yoloä¸‰éƒ¨æ›²è§£è¯»â€”â€”Yolov1</a><br>YOLOv1çš„ç½‘ç»œæ¶æ„å¦‚ä¸‹å›¾ï¼š<br><img src="https://user-images.githubusercontent.com/6218739/133874079-e9c89d7b-f8f3-4078-8d9a-30e9f0451df3.png" alt="yolov1"><br>ç›´æ¥ä¸Šç»“æ„å›¾ï¼Œè¾“å…¥å›¾åƒå¤§å°ä¸º448ä¹˜448ï¼Œç»è¿‡è‹¥å¹²ä¸ªå·ç§¯å±‚ä¸æ± åŒ–å±‚ï¼Œå˜ä¸º7ä¹˜7ä¹˜1024å¼ é‡ï¼ˆå›¾ä¸€ä¸­å€’æ•°ç¬¬ä¸‰ä¸ªç«‹æ–¹ä½“ï¼‰ï¼Œæœ€åç»è¿‡ä¸¤å±‚å…¨è¿æ¥å±‚ï¼Œè¾“å‡ºå¼ é‡ç»´åº¦ä¸º7ä¹˜7ä¹˜30ï¼Œè¿™å°±æ˜¯Yolo v1çš„æ•´ä¸ªç¥ç»ç½‘ç»œç»“æ„ï¼Œå’Œä¸€èˆ¬çš„å·ç§¯ç‰©ä½“åˆ†ç±»ç½‘ç»œæ²¡æœ‰å¤ªå¤šåŒºåˆ«ï¼Œæœ€å¤§çš„ä¸åŒå°±æ˜¯ï¼šåˆ†ç±»ç½‘ç»œæœ€åçš„å…¨è¿æ¥å±‚ï¼Œä¸€èˆ¬è¿æ¥äºä¸€ä¸ªä¸€ç»´å‘é‡ï¼Œå‘é‡çš„ä¸åŒä½ä»£è¡¨ä¸åŒç±»åˆ«ï¼Œè€Œè¿™é‡Œçš„è¾“å‡ºå‘é‡æ˜¯ä¸€ä¸ªä¸‰ç»´çš„å¼ é‡ï¼ˆ7ä¹˜7ä¹˜30ï¼‰ã€‚ä¸Šå›¾ä¸­Yoloçš„backboneç½‘ç»œç»“æ„ï¼Œå—å¯å‘äºGoogLeNetï¼Œä¹Ÿæ˜¯v2ã€v3ä¸­Darknetçš„å…ˆé”‹ã€‚æœ¬è´¨ä¸Šæ¥è¯´æ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«ï¼Œæ²¡æœ‰ä½¿ç”¨BNå±‚ï¼Œç”¨äº†ä¸€å±‚Dropoutã€‚é™¤äº†æœ€åä¸€å±‚çš„è¾“å‡ºä½¿ç”¨äº†çº¿æ€§æ¿€æ´»å‡½æ•°ï¼Œå…¶ä»–å±‚å…¨éƒ¨ä½¿ç”¨Leaky Reluæ¿€æ´»å‡½æ•°ã€‚ç½‘ç»œç»“æ„æ²¡æœ‰ç‰¹åˆ«çš„ä¸œè¥¿ï¼Œä¸å†èµ˜è¿°ã€‚</p><p>è¾“å‡ºå¼ é‡ç»´åº¦çš„æ„ä¹‰ï¼š<br>ï¼ˆ1ï¼‰7ä¹˜7çš„å«ä¹‰<br>7ä¹˜7æ˜¯æŒ‡å›¾ç‰‡è¢«åˆ†æˆäº†7ä¹˜7ä¸ªæ ¼å­ï¼Œå¦‚ä¸‹å›¾ï¼š<br><img src="https://user-images.githubusercontent.com/6218739/133877539-5d2fe916-a712-4676-9a5e-06a3657a27cf.png" alt="grid-yolov1"><br>åœ¨Yoloä¸­ï¼Œå¦‚æœä¸€ä¸ªç‰©ä½“çš„ä¸­å¿ƒç‚¹ï¼Œè½åœ¨äº†æŸä¸ªæ ¼å­ä¸­ï¼Œé‚£ä¹ˆè¿™ä¸ªæ ¼å­å°†è´Ÿè´£é¢„æµ‹è¿™ä¸ªç‰©ä½“ã€‚è€Œé‚£äº›æ²¡æœ‰ç‰©ä½“ä¸­å¿ƒç‚¹è½è¿›æ¥çš„æ ¼å­ï¼Œåˆ™ä¸è´Ÿè´£é¢„æµ‹ä»»ä½•ç‰©ä½“ã€‚è¿™ä¸ªè®¾å®šå°±å¥½æ¯”è¯¥ç½‘ç»œåœ¨ä¸€å¼€å§‹ï¼Œå°±å°†æ•´ä¸ªå›¾ç‰‡ä¸Šçš„é¢„æµ‹ä»»åŠ¡è¿›è¡Œäº†åˆ†å·¥ï¼Œä¸€å…±è®¾å®š7ä¹˜7ä¸ªæŒ‰ç…§æ–¹é˜µåˆ—é˜Ÿçš„æ£€æµ‹äººå‘˜ï¼Œæ¯ä¸ªäººå‘˜è´Ÿè´£æ£€æµ‹ä¸€ä¸ªç‰©ä½“ï¼Œå¤§å®¶çš„åˆ†å·¥ç•Œçº¿ï¼Œå°±æ˜¯çœ‹è¢«æ£€æµ‹ç‰©ä½“çš„ä¸­å¿ƒç‚¹è½åœ¨è°çš„æ ¼å­é‡Œã€‚å½“ç„¶ï¼Œæ˜¯7ä¹˜7è¿˜æ˜¯9ä¹˜9ï¼Œæ˜¯ä¸Šå›¾ä¸­çš„å‚æ•°Sï¼Œå¯ä»¥è‡ªå·±ä¿®æ”¹ï¼Œç²¾åº¦å’Œæ€§èƒ½ä¼šéšä¹‹æœ‰äº›å˜åŒ–ã€‚<br>ï¼ˆ2ï¼‰30çš„å«ä¹‰<br>åˆšæ‰è®¾å®šäº†49ä¸ªæ£€æµ‹äººå‘˜ï¼Œé‚£ä¹ˆæ¯ä¸ªäººå‘˜è´Ÿè´£æ£€æµ‹çš„å†…å®¹ï¼Œå°±æ˜¯è¿™é‡Œçš„30ï¼ˆæ³¨æ„ï¼Œ30æ˜¯å¼ é‡æœ€åä¸€ç»´çš„é•¿åº¦ï¼‰ã€‚åœ¨Yolo v1è®ºæ–‡ä¸­ï¼Œ30æ˜¯ç”±$(4+1) \times 2 +20$å¾—åˆ°çš„ã€‚å…¶ä¸­$4+1$æ˜¯çŸ©å½¢æ¡†çš„ä¸­å¿ƒç‚¹åæ ‡(x,y)ã€é•¿å®½(w,h)ä»¥åŠæ˜¯å¦å±äºè¢«æ£€æµ‹ç‰©ä½“çš„ç½®ä¿¡åº¦cï¼›2æ˜¯ä¸€ä¸ªæ ¼å­å…±å›å½’ä¸¤ä¸ªçŸ©å½¢æ¡†ï¼Œæ¯ä¸ªçŸ©å½¢æ¡†åˆ†åˆ«äº§ç”Ÿ5ä¸ªé¢„æµ‹å€¼ï¼ˆæ¯ä¸ªæ ¼å­é¢„æµ‹çŸ©å½¢æ¡†ä¸ªæ•°ï¼Œæ˜¯å¯è°ƒè¶…å‚æ•°ï¼›è®ºæ–‡ä¸­é€‰æ‹©äº†2ä¸ªæ¡†ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥åªé¢„æµ‹1ä¸ªæ¡†ï¼Œå…·ä½“é¢„æµ‹å‡ ä¸ªçŸ©å½¢æ¡†ï¼Œæ— éæ˜¯åœ¨è®¡ç®—é‡å’Œç²¾åº¦ä¹‹é—´å–ä¸€ä¸ªæƒè¡¡ã€‚å¦‚æœåªé¢„æµ‹ä¸€ä¸ªçŸ©å½¢æ¡†ï¼Œè®¡ç®—é‡ä¼šå°å¾ˆå¤šï¼Œä½†æ˜¯å¦‚æœè®­ç»ƒæ•°æ®éƒ½æ˜¯å°ç‰©ä½“ï¼Œé‚£ä¹ˆç½‘ç»œå­¦ä¹ åˆ°çš„æ¡†ï¼Œä¹Ÿä¼šæ™®éæ¯”è¾ƒå°ï¼Œæµ‹è¯•æ—¶å¦‚æœç‰©ä½“è¾ƒå¤§ï¼Œé‚£ä¹ˆé¢„æµ‹æ•ˆæœå°±ä¼šä¸ç†æƒ³ï¼›å¦‚æœæ¯ä¸ªæ ¼å­å¤šé¢„æµ‹å‡ ä¸ªçŸ©å½¢æ¡†ï¼Œå¦‚ä¸Šæ–‡ä¸­è®²åˆ°çš„ï¼Œæ¯ä¸ªçŸ©å½¢æ¡†çš„å­¦ä¹ ç›®æ ‡ä¼šæœ‰æ‰€åˆ†å·¥ï¼Œæœ‰äº›å­¦ä¹ å°ç‰©ä½“ç‰¹å¾ï¼Œæœ‰äº›å­¦ä¹ å¤§ç‰©ä½“ç‰¹å¾ç­‰ï¼›åœ¨Yolov2ã€v3ä¸­ï¼Œè¿™ä¸ªæ•°ç›®éƒ½æœ‰ä¸€å®šçš„è°ƒæ•´ã€‚ï¼‰ï¼›20ä»£è¡¨é¢„æµ‹20ä¸ªç±»åˆ«ã€‚è¿™é‡Œæœ‰å‡ ç‚¹éœ€è¦æ³¨æ„ï¼š1. æ¯ä¸ªæ–¹æ ¼ï¼ˆgridï¼‰ äº§ç”Ÿ2ä¸ªé¢„æµ‹æ¡†ï¼Œ2ä¹Ÿæ˜¯å‚æ•°ï¼Œå¯ä»¥è°ƒï¼Œä½†æ˜¯ä¸€æ—¦è®¾å®šä¸º2ä»¥åï¼Œé‚£ä¹ˆæ¯ä¸ªæ–¹æ ¼åªäº§ç”Ÿä¸¤ä¸ªçŸ©å½¢æ¡†ï¼Œæœ€åé€‰å®šç½®ä¿¡åº¦æ›´å¤§çš„çŸ©å½¢æ¡†ä½œä¸ºè¾“å‡ºï¼Œä¹Ÿå°±æ˜¯æœ€ç»ˆæ¯ä¸ªæ–¹æ ¼åªè¾“å‡ºä¸€ä¸ªé¢„æµ‹çŸ©å½¢æ¡†ã€‚2. æ¯ä¸ªæ–¹æ ¼åªèƒ½é¢„æµ‹ä¸€ä¸ªç‰©ä½“ã€‚è™½ç„¶å¯ä»¥é€šè¿‡è°ƒæ•´å‚æ•°ï¼Œäº§ç”Ÿä¸åŒçš„çŸ©å½¢æ¡†ï¼Œä½†è¿™åªèƒ½æé«˜çŸ©å½¢æ¡†çš„ç²¾åº¦ã€‚æ‰€ä»¥å½“æœ‰å¾ˆå¤šä¸ªç‰©ä½“çš„ä¸­å¿ƒç‚¹è½åœ¨äº†åŒä¸€ä¸ªæ ¼å­é‡Œï¼Œè¯¥æ ¼å­åªèƒ½é¢„æµ‹ä¸€ä¸ªç‰©ä½“ã€‚ä¹Ÿå°±æ˜¯æ ¼å­æ•°ä¸º7ä¹˜7æ—¶ï¼Œè¯¥ç½‘ç»œæœ€å¤šé¢„æµ‹49ä¸ªç‰©ä½“ã€‚<br>å¦‚ä¸Šè¿°åŸæ–‡ä¸­æåŠï¼Œåœ¨å¼ºè¡Œæ–½åŠ äº†æ ¼ç‚¹é™åˆ¶ä»¥åï¼Œæ¯ä¸ªæ ¼ç‚¹åªèƒ½è¾“å‡ºä¸€ä¸ªé¢„æµ‹ç»“æœï¼Œæ‰€ä»¥è¯¥ç®—æ³•æœ€å¤§çš„ä¸è¶³ï¼Œå°±æ˜¯å¯¹ä¸€äº›é‚»è¿‘å°ç‰©ä½“çš„è¯†åˆ«æ•ˆæœä¸æ˜¯å¤ªå¥½ï¼Œä¾‹å¦‚æˆç¾¤ç»“é˜Ÿçš„å°é¸Ÿã€‚</p><p>æŸå¤±å‡½æ•°ï¼š<br><img src="https://user-images.githubusercontent.com/6218739/133877787-e073a763-b371-4908-8456-60f6329974b7.png" alt="loss-yolov1"><br>è®ºæ–‡ä¸­Losså‡½æ•°ï¼Œå¯†å¯†éº»éº»çš„å…¬å¼åˆçœ‹å¯èƒ½æ¯”è¾ƒéš¾æ‡‚ã€‚å…¶å®è®ºæ–‡ä¸­ç»™å‡ºäº†æ¯”è¾ƒè¯¦ç»†çš„è§£é‡Šã€‚æ‰€æœ‰çš„æŸå¤±éƒ½æ˜¯ä½¿ç”¨å¹³æ–¹å’Œè¯¯å·®å…¬å¼ã€‚<br>ï¼ˆ1ï¼‰é¢„æµ‹æ¡†çš„ä¸­å¿ƒç‚¹(x,y)ã€‚é€ æˆçš„æŸå¤±æ˜¯ä¸Šå›¾ä¸­çš„ç¬¬ä¸€è¡Œã€‚å…¶ä¸­$\mathbb{I}_{ij}^{obj}$ä¸ºæ§åˆ¶å‡½æ•°ï¼Œåœ¨æ ‡ç­¾ä¸­åŒ…å«ç‰©ä½“çš„é‚£äº›æ ¼ç‚¹å¤„ï¼Œè¯¥å€¼ä¸º 1 ï¼›è‹¥æ ¼ç‚¹ä¸å«æœ‰ç‰©ä½“ï¼Œè¯¥å€¼ä¸º 0ã€‚ä¹Ÿå°±æ˜¯åªå¯¹é‚£äº›æœ‰çœŸå®ç‰©ä½“æ‰€å±çš„æ ¼ç‚¹è¿›è¡ŒæŸå¤±è®¡ç®—ï¼Œè‹¥è¯¥æ ¼ç‚¹ä¸åŒ…å«ç‰©ä½“ï¼Œé‚£ä¹ˆé¢„æµ‹æ•°å€¼ä¸å¯¹æŸå¤±å‡½æ•°é€ æˆå½±å“ã€‚ï¼ˆx,yï¼‰æ•°å€¼ä¸æ ‡ç­¾ç”¨ç®€å•çš„å¹³æ–¹å’Œè¯¯å·®ã€‚<br>ï¼ˆ2ï¼‰é¢„æµ‹æ¡†çš„å®½é«˜ã€‚é€ æˆçš„æŸå¤±æ˜¯ä¸Šå›¾çš„ç¬¬äºŒè¡Œã€‚$\mathbb{I}_{ij}^{obj}$çš„å«ä¹‰ä¸€æ ·ï¼Œä¹Ÿæ˜¯ä½¿å¾—åªæœ‰çœŸå®ç‰©ä½“æ‰€å±çš„æ ¼ç‚¹æ‰ä¼šé€ æˆæŸå¤±ã€‚è¿™é‡Œå¯¹åœ¨æŸå¤±å‡½æ•°ä¸­çš„å¤„ç†åˆ†åˆ«å–äº†æ ¹å·ï¼ŒåŸå› åœ¨äºï¼Œå¦‚æœä¸å–æ ¹å·ï¼ŒæŸå¤±å‡½æ•°å¾€å¾€æ›´å€¾å‘äºè°ƒæ•´å°ºå¯¸æ¯”è¾ƒå¤§çš„é¢„æµ‹æ¡†ã€‚ä¾‹å¦‚ï¼Œ20ä¸ªåƒç´ ç‚¹çš„åå·®ï¼Œå¯¹äº800ä¹˜600çš„é¢„æµ‹æ¡†å‡ ä¹æ²¡æœ‰å½±å“ï¼Œæ­¤æ—¶çš„IOUæ•°å€¼è¿˜æ˜¯å¾ˆå¤§ï¼Œä½†æ˜¯å¯¹äº30ä¹˜40çš„é¢„æµ‹æ¡†å½±å“å°±å¾ˆå¤§ã€‚å–æ ¹å·æ˜¯ä¸ºäº†å°½å¯èƒ½çš„æ¶ˆé™¤å¤§å°ºå¯¸æ¡†ä¸å°å°ºå¯¸æ¡†ä¹‹é—´çš„å·®å¼‚ã€‚<br>ï¼ˆ3ï¼‰ç¬¬ä¸‰è¡Œä¸ç¬¬å››è¡Œï¼Œéƒ½æ˜¯é¢„æµ‹æ¡†çš„ç½®ä¿¡åº¦Cã€‚å½“è¯¥æ ¼ç‚¹ä¸å«æœ‰ç‰©ä½“æ—¶ï¼Œè¯¥ç½®ä¿¡åº¦çš„æ ‡ç­¾ä¸º0ï¼›è‹¥å«æœ‰ç‰©ä½“æ—¶ï¼Œè¯¥ç½®ä¿¡åº¦çš„æ ‡ç­¾ä¸ºé¢„æµ‹æ¡†ä¸çœŸå®ç‰©ä½“æ¡†çš„IOUæ•°å€¼ï¼ˆIOUè®¡ç®—å…¬å¼ä¸ºï¼šä¸¤ä¸ªæ¡†äº¤é›†çš„é¢ç§¯é™¤ä»¥å¹¶é›†çš„é¢ç§¯ï¼‰ã€‚<br>ï¼ˆ4ï¼‰ç¬¬äº”è¡Œä¸ºç‰©ä½“ç±»åˆ«æ¦‚ç‡Pï¼Œå¯¹åº”çš„ç±»åˆ«ä½ç½®ï¼Œè¯¥æ ‡ç­¾æ•°å€¼ä¸º1ï¼Œå…¶ä½™ä½ç½®ä¸º0ï¼Œä¸åˆ†ç±»ç½‘ç»œç›¸åŒã€‚<br>æ­¤æ—¶å†æ¥çœ‹$\lambda_{coord}$ä¸$\lambda_{noobj}$ï¼ŒYoloé¢ä¸´çš„ç‰©ä½“æ£€æµ‹é—®é¢˜ï¼Œæ˜¯ä¸€ä¸ªå…¸å‹çš„ç±»åˆ«æ•°ç›®ä¸å‡è¡¡çš„é—®é¢˜ã€‚å…¶ä¸­49ä¸ªæ ¼ç‚¹ï¼Œå«æœ‰ç‰©ä½“çš„æ ¼ç‚¹å¾€å¾€åªæœ‰3ã€4ä¸ªï¼Œå…¶ä½™å…¨æ˜¯ä¸å«æœ‰ç‰©ä½“çš„æ ¼ç‚¹ã€‚æ­¤æ—¶å¦‚æœä¸é‡‡å–ç‚¹æªæ–½ï¼Œé‚£ä¹ˆç‰©ä½“æ£€æµ‹çš„mAPä¸ä¼šå¤ªé«˜ï¼Œå› ä¸ºæ¨¡å‹æ›´å€¾å‘äºä¸å«æœ‰ç‰©ä½“çš„æ ¼ç‚¹ã€‚$\lambda_{coord}$ä¸$\lambda_{noobj}$çš„ä½œç”¨ï¼Œå°±æ˜¯è®©å«æœ‰ç‰©ä½“çš„æ ¼ç‚¹ï¼Œåœ¨æŸå¤±å‡½æ•°ä¸­çš„æƒé‡æ›´å¤§ï¼Œè®©æ¨¡å‹æ›´åŠ â€œé‡è§†â€å«æœ‰ç‰©ä½“çš„æ ¼ç‚¹æ‰€é€ æˆçš„æŸå¤±ã€‚åœ¨è®ºæ–‡ä¸­ï¼Œ å–å€¼åˆ†åˆ«ä¸º5ä¸0.5ã€‚</p><p>ä¸€äº›æŠ€å·§ï¼š<br>ï¼ˆ1ï¼‰å›å½’offsetä»£æ›¿ç›´æ¥å›å½’åæ ‡<br>ä¸ç›´æ¥å›å½’ä¸­å¿ƒç‚¹åæ ‡æ•°å€¼ï¼Œè€Œæ˜¯å›å½’ç›¸å¯¹äºæ ¼ç‚¹å·¦ä¸Šè§’åæ ‡çš„ä½ç§»å€¼ã€‚ä¾‹å¦‚ï¼Œç¬¬ä¸€ä¸ªæ ¼ç‚¹ä¸­ç‰©ä½“åæ ‡ä¸º$(2.3, 3.6)$ï¼Œå¦ä¸€ä¸ªæ ¼ç‚¹ä¸­çš„ç‰©ä½“åæ ‡ä¸º$(5.4, 6.3)$ï¼Œè¿™å››ä¸ªæ•°å€¼è®©ç¥ç»ç½‘ç»œæš´åŠ›å›å½’ï¼Œæœ‰ä¸€å®šéš¾åº¦ã€‚æ‰€ä»¥è¿™é‡Œçš„offsetæ˜¯æŒ‡ï¼Œæ—¢ç„¶æ ¼ç‚¹å·²çŸ¥ï¼Œé‚£ä¹ˆç‰©ä½“ä¸­å¿ƒç‚¹çš„åæ ‡ä¸€å®šåœ¨æ ¼ç‚¹æ­£æ–¹å½¢é‡Œï¼Œç›¸å¯¹äºæ ¼ç‚¹å·¦ä¸Šè§’çš„ä½ç§»å€¼ä¸€å®šåœ¨åŒºé—´$[0, 1)$ä¸­ã€‚è®©ç¥ç»ç½‘ç»œå»é¢„æµ‹$(0.3, 0.6)$ä¸$(0.4, 0.3)$ä¼šæ›´åŠ å®¹æ˜“ï¼Œåœ¨ä½¿ç”¨æ—¶ï¼ŒåŠ ä¸Šæ ¼ç‚¹å·¦ä¸Šè§’åæ ‡$(2, 3)$ã€$(5, 6)$å³å¯ã€‚</p><p>ï¼ˆ2ï¼‰åŒä¸€æ ¼ç‚¹çš„ä¸åŒé¢„æµ‹æ¡†æœ‰ä¸åŒä½œç”¨<br>å‰æ–‡ä¸­æåˆ°ï¼Œæ¯ä¸ªæ ¼ç‚¹é¢„æµ‹ä¸¤ä¸ªæˆ–å¤šä¸ªçŸ©å½¢æ¡†ã€‚æ­¤æ—¶å‡è®¾æ¯ä¸ªæ ¼ç‚¹é¢„æµ‹ä¸¤ä¸ªçŸ©å½¢æ¡†ã€‚é‚£ä¹ˆåœ¨è®­ç»ƒæ—¶ï¼Œè§åˆ°ä¸€ä¸ªçœŸå®ç‰©ä½“ï¼Œæˆ‘ä»¬æ˜¯å¸Œæœ›ä¸¤ä¸ªæ¡†éƒ½å»é€¼è¿‘è¿™ä¸ªç‰©ä½“çš„çœŸå®çŸ©å½¢æ¡†ï¼Œè¿˜æ˜¯åªç”¨ä¸€ä¸ªå»é€¼è¿‘ï¼Ÿæˆ–è®¸é€šå¸¸æ¥æƒ³ï¼Œè®©ä¸¤ä¸ªäººä¸€èµ·å»åšåŒä¸€ä»¶äº‹ï¼Œæ¯”ä¸€ä¸ªäººåšä¸€ä»¶äº‹æˆåŠŸç‡è¦é«˜ï¼Œæ‰€ä»¥å¯èƒ½ä¼šè®©ä¸¤ä¸ªæ¡†éƒ½å»é€¼è¿‘è¿™ä¸ªçœŸå®ç‰©ä½“ã€‚ä½†æ˜¯ä½œè€…æ²¡æœ‰è¿™æ ·åšï¼Œåœ¨æŸå¤±å‡½æ•°è®¡ç®—ä¸­ï¼Œåªå¯¹å’ŒçœŸå®ç‰©ä½“æœ€æ¥è¿‘çš„æ¡†è®¡ç®—æŸå¤±ï¼Œå…¶ä½™æ¡†ä¸è¿›è¡Œä¿®æ­£ã€‚è¿™æ ·æ“ä½œä¹‹åä½œè€…å‘ç°ï¼Œä¸€ä¸ªæ ¼ç‚¹çš„ä¸¤ä¸ªæ¡†åœ¨å°ºå¯¸ã€é•¿å®½æ¯”ã€æˆ–è€…æŸäº›ç±»åˆ«ä¸Šé€æ¸æœ‰æ‰€åˆ†å·¥ï¼Œæ€»ä½“çš„å¬å›ç‡æœ‰æ‰€æå‡<br>ï¼ˆ3ï¼‰ä½¿ç”¨éæå¤§æŠ‘åˆ¶ç”Ÿæˆé¢„æµ‹æ¡†<br>é€šå¸¸æ¥è¯´ï¼Œåœ¨é¢„æµ‹çš„æ—¶å€™ï¼Œæ ¼ç‚¹ä¸æ ¼ç‚¹å¹¶ä¸ä¼šå†²çªï¼Œä½†æ˜¯åœ¨é¢„æµ‹ä¸€äº›å¤§ç‰©ä½“æˆ–è€…é‚»è¿‘ç‰©ä½“æ—¶ï¼Œä¼šæœ‰å¤šä¸ªæ ¼ç‚¹é¢„æµ‹äº†åŒä¸€ä¸ªç‰©ä½“ã€‚æ­¤æ—¶é‡‡ç”¨éæå¤§æŠ‘åˆ¶æŠ€å·§ï¼Œè¿‡æ»¤æ‰ä¸€äº›é‡å çš„çŸ©å½¢æ¡†ã€‚ä¸è¿‡æ­¤æ—¶mAPæå‡å¹¶æ²¡æœ‰åƒåœ¨RCNNæˆ–DPMä¸­é‚£æ ·æ˜¾è‘—æå‡ã€‚<br>ï¼ˆ4ï¼‰æ¨ç†æ—¶å°†ç±»åˆ«é¢„æµ‹æœ€å¤§å€¼ä¹˜ä»¥é¢„æµ‹æ¡†æœ€å¤§å€¼ä½œä¸ºè¾“å‡ºç½®ä¿¡åº¦<br>åœ¨æ¨ç†æ—¶ï¼Œä½¿ç”¨ç‰©ä½“çš„ç±»åˆ«é¢„æµ‹æœ€å¤§å€¼pä¹˜ä»¥é¢„æµ‹æ¡†çš„æœ€å¤§å€¼cï¼Œä½œä¸ºè¾“å‡ºé¢„æµ‹ç‰©ä½“çš„ç½®ä¿¡åº¦ã€‚è¿™æ ·ä¹Ÿå¯ä»¥è¿‡æ»¤æ‰ä¸€äº›å¤§éƒ¨åˆ†é‡å çš„çŸ©å½¢æ¡†ã€‚è¾“å‡ºæ£€æµ‹ç‰©ä½“çš„ç½®ä¿¡åº¦ï¼ŒåŒæ—¶è€ƒè™‘äº†çŸ©å½¢æ¡†ä¸ç±»åˆ«ï¼Œæ»¡è¶³é˜ˆå€¼çš„è¾“å‡ºæ›´åŠ å¯ä¿¡ã€‚</p><h2 id="YOLOv2"><a href="#YOLOv2" class="headerlink" title="YOLOv2"></a>YOLOv2</h2><p><a href="https://zhuanlan.zhihu.com/p/74540100">ã€è®ºæ–‡è§£è¯»ã€‘Yoloä¸‰éƒ¨æ›²è§£è¯»â€”â€”Yolov2</a><br>Yolov2è®ºæ–‡æ ‡é¢˜å°±æ˜¯æ›´å¥½ï¼Œæ›´å¿«ï¼Œæ›´å¼ºã€‚Yolov1å‘è¡¨ä¹‹åï¼Œè®¡ç®—æœºè§†è§‰é¢†åŸŸå‡ºç°äº†å¾ˆå¤štrickï¼Œä¾‹å¦‚æ‰¹å½’ä¸€åŒ–ã€å¤šå°ºåº¦è®­ç»ƒï¼Œv2ä¹Ÿå°è¯•å€Ÿé‰´äº†R-CNNä½“ç³»ä¸­çš„anchor boxï¼Œæ‰€æœ‰çš„æ”¹è¿›æå‡ï¼Œä¸‹é¢é€ä¸€ä»‹ç»ã€‚</p><ol><li>Batch Normalizationï¼ˆæ‰¹å½’ä¸€åŒ–ï¼‰<br>æ£€æµ‹ç³»åˆ—çš„ç½‘ç»œç»“æ„ä¸­ï¼ŒBNé€æ¸å˜æˆäº†æ ‡é…ã€‚åœ¨Yoloçš„æ¯ä¸ªå·ç§¯å±‚ä¸­åŠ å…¥BNä¹‹åï¼ŒmAPæå‡äº†2%ï¼Œå¹¶ä¸”å»é™¤äº†Dropoutã€‚</li><li>High Resolution Classifierï¼ˆåˆ†ç±»ç½‘ç»œé«˜åˆ†è¾¨ç‡é¢„è®­ç»ƒï¼‰<br>åœ¨Yolov1ä¸­ï¼Œç½‘ç»œçš„backboneéƒ¨åˆ†ä¼šåœ¨ImageNetæ•°æ®é›†ä¸Šè¿›è¡Œé¢„è®­ç»ƒï¼Œè®­ç»ƒæ—¶ç½‘ç»œè¾“å…¥å›¾åƒçš„åˆ†è¾¨ç‡ä¸º224ä¹˜224ã€‚åœ¨v2ä¸­ï¼Œå°†åˆ†ç±»ç½‘ç»œåœ¨è¾“å…¥å›¾ç‰‡åˆ†è¾¨ç‡ä¸º448ä¹˜448çš„ImageNetæ•°æ®é›†ä¸Šè®­ç»ƒ10ä¸ªepochï¼Œå†ä½¿ç”¨æ£€æµ‹æ•°æ®é›†ï¼ˆä¾‹å¦‚cocoï¼‰è¿›è¡Œå¾®è°ƒã€‚é«˜åˆ†è¾¨ç‡é¢„è®­ç»ƒä½¿mAPæé«˜äº†å¤§çº¦4%ã€‚</li><li>Convolutional With Anchor Boxesï¼ˆAnchor Boxæ›¿æ¢å…¨è¿æ¥å±‚ï¼‰<br>ç¬¬ä¸€ç¯‡è§£è¯»v1æ—¶æåˆ°ï¼Œæ¯ä¸ªæ ¼ç‚¹é¢„æµ‹ä¸¤ä¸ªçŸ©å½¢æ¡†ï¼Œåœ¨è®¡ç®—lossæ—¶ï¼Œåªè®©ä¸ground truthæœ€æ¥è¿‘çš„æ¡†äº§ç”Ÿlossæ•°å€¼ï¼Œè€Œå¦ä¸€ä¸ªæ¡†ä¸åšä¿®æ­£ã€‚è¿™æ ·è§„å®šä¹‹åï¼Œä½œè€…å‘ç°ä¸¤ä¸ªæ¡†åœ¨ç‰©ä½“çš„å¤§å°ã€é•¿å®½æ¯”ã€ç±»åˆ«ä¸Šé€æ¸æœ‰äº†åˆ†å·¥ã€‚åœ¨v2ä¸­ï¼Œç¥ç»ç½‘ç»œä¸å¯¹é¢„æµ‹çŸ©å½¢æ¡†çš„å®½é«˜çš„ç»å¯¹å€¼è¿›è¡Œé¢„æµ‹ï¼Œè€Œæ˜¯é¢„æµ‹ä¸Anchoræ¡†çš„åå·®ï¼ˆoffsetï¼‰ï¼Œæ¯ä¸ªæ ¼ç‚¹æŒ‡å®šnä¸ªAnchoræ¡†ã€‚åœ¨è®­ç»ƒæ—¶ï¼Œæœ€æ¥è¿‘ground truthçš„æ¡†äº§ç”Ÿlossï¼Œå…¶ä½™æ¡†ä¸äº§ç”Ÿlossã€‚åœ¨å¼•å…¥Anchor Boxæ“ä½œåï¼ŒmAPç”±69.5ä¸‹é™è‡³69.2ï¼ŒåŸå› åœ¨äºï¼Œæ¯ä¸ªæ ¼ç‚¹é¢„æµ‹çš„ç‰©ä½“å˜å¤šä¹‹åï¼Œå¬å›ç‡å¤§å¹…ä¸Šå‡ï¼Œå‡†ç¡®ç‡æœ‰æ‰€ä¸‹é™ï¼Œæ€»ä½“mAPç•¥æœ‰ä¸‹é™ã€‚<br>v2ä¸­ç§»é™¤äº†v1æœ€åçš„ä¸¤å±‚å…¨è¿æ¥å±‚ï¼Œå…¨è¿æ¥å±‚è®¡ç®—é‡å¤§ï¼Œè€—æ—¶ä¹…ã€‚æ–‡ä¸­æ²¡æœ‰è¯¦ç»†æè¿°å…¨è¿æ¥å±‚çš„æ›¿æ¢æ–¹æ¡ˆï¼Œè¿™é‡Œç¬”è€…çŒœæµ‹æ˜¯åˆ©ç”¨1ä¹˜1çš„å·ç§¯å±‚ä»£æ›¿ï¼ˆæ¬¢è¿æŒ‡æ­£ï¼‰ï¼Œå…·ä½“çš„ç½‘ç»œç»“æ„åŸæ–‡ä¸­æ²¡æœ‰æåŠï¼Œå®˜æ–¹ä»£ç ä¹Ÿè¢«yolo v3æ›¿ä»£äº†ã€‚v2ä¸»è¦æ˜¯å„ç§trickå¼•å…¥åçš„æ•ˆæœéªŒè¯ï¼Œå»ºè®®ä¸å¿…çº ç»“äºv2çš„ç½‘ç»œç»“æ„ã€‚</li><li>Dimension Clustersï¼ˆAnchor Boxçš„å®½é«˜ç”±èšç±»äº§ç”Ÿï¼‰<br>è¿™é‡Œç®—æ˜¯ä½œè€…çš„ä¸€ä¸ªåˆ›æ–°ç‚¹ã€‚Faster R-CNNä¸­çš„ä¹ä¸ªAnchor Boxçš„å®½é«˜æ˜¯äº‹å…ˆè®¾å®šå¥½çš„æ¯”ä¾‹å¤§å°ï¼Œä¸€å…±è®¾å®šä¸‰ä¸ªé¢ç§¯å¤§å°çš„çŸ©å½¢æ¡†ï¼Œæ¯ä¸ªçŸ©å½¢æ¡†æœ‰ä¸‰ä¸ªå®½é«˜æ¯”ï¼š1:1ï¼Œ2:1ï¼Œ1:2ï¼Œæ€»å…±ä¹ä¸ªæ¡†ã€‚è€Œåœ¨v2ä¸­ï¼ŒAnchor Boxçš„å®½é«˜ä¸ç»è¿‡äººä¸ºè·å¾—ï¼Œè€Œæ˜¯å°†è®­ç»ƒæ•°æ®é›†ä¸­çš„çŸ©å½¢æ¡†å…¨éƒ¨æ‹¿å‡ºæ¥ï¼Œç”¨kmeansèšç±»å¾—åˆ°å…ˆéªŒæ¡†çš„å®½å’Œé«˜ã€‚ä¾‹å¦‚ä½¿ç”¨5ä¸ªAnchor Box, é‚£ä¹ˆkmeansèšç±»çš„ç±»åˆ«ä¸­å¿ƒä¸ªæ•°è®¾ç½®ä¸º5ã€‚<br>åŠ å…¥äº†èšç±»æ“ä½œä¹‹åï¼Œå¼•å…¥Anchor Boxä¹‹åï¼ŒmAPä¸Šå‡ã€‚<br>éœ€è¦å¼ºè°ƒçš„æ˜¯ï¼Œèšç±»å¿…é¡»è¦å®šä¹‰èšç±»ç‚¹ï¼ˆçŸ©å½¢æ¡†ï¼‰ä¹‹é—´çš„è·ç¦»å‡½æ•°ï¼Œæ–‡ä¸­ä½¿ç”¨ï¼ˆ1-IOUï¼‰æ•°å€¼ä½œä¸ºä¸¤ä¸ªçŸ©å½¢æ¡†çš„çš„è·ç¦»å‡½æ•°ï¼Œè¿™é‡Œçš„è¿ç”¨ä¹Ÿæ˜¯éå¸¸çš„å·§å¦™ã€‚</li><li>Direct location predictionï¼ˆç»å¯¹ä½ç½®é¢„æµ‹ï¼‰<br>Yoloä¸­çš„ä½ç½®é¢„æµ‹æ–¹æ³•å¾ˆæ¸…æ™°ï¼Œå°±æ˜¯ç›¸å¯¹äºå·¦ä¸Šè§’çš„æ ¼ç‚¹åæ ‡é¢„æµ‹åç§»é‡ã€‚è¿™é‡Œçš„Directå…·ä½“å«ä¹‰ï¼Œåº”è¯¥æ˜¯å’Œå…¶ä»–ç®—æ³•æ¡†æ¶å¯¹æ¯”åå¾—åˆ°çš„ã€‚æ¯”å¦‚å…¶ä»–æµè¡Œçš„ä½ç½®é¢„æµ‹å…¬å¼æ˜¯å…ˆé¢„æµ‹ä¸€ä¸ªç³»æ•°ï¼Œç³»æ•°åˆéœ€è¦ä¸å…ˆéªŒæ¡†çš„å®½é«˜ç›¸ä¹˜æ‰èƒ½å¾—åˆ°ç›¸è¾ƒäºå‚è€ƒç‚¹çš„ä½ç½®åç§»ï¼Œè€Œåœ¨yolov2ä¸­ï¼Œç³»æ•°é€šè¿‡ä¸€ä¸ªæ¿€æ´»å‡½æ•°ç›´æ¥äº§ç”Ÿåç§»ä½ç½®æ•°å€¼ï¼Œä¸çŸ©å½¢æ¡†çš„å®½é«˜ç‹¬ç«‹å¼€ï¼Œå˜å¾—æ›´åŠ ç›´æ¥ã€‚</li><li>Fine-Grained Featuresï¼ˆç»†ç²’åº¦ç‰¹å¾ï¼‰<br>åœ¨26ä¹˜26çš„ç‰¹å¾å›¾ï¼Œç»è¿‡å·ç§¯å±‚ç­‰ï¼Œå˜ä¸º13ä¹˜13çš„ç‰¹å¾å›¾åï¼Œä½œè€…è®¤ä¸ºæŸå¤±äº†å¾ˆå¤šç»†ç²’åº¦çš„ç‰¹å¾ï¼Œå¯¼è‡´å°å°ºå¯¸ç‰©ä½“çš„è¯†åˆ«æ•ˆæœä¸ä½³ï¼Œæ‰€ä»¥åœ¨æ­¤åŠ å…¥äº†passthroughå±‚ã€‚passthroughå±‚å°±æ˜¯å°†26ä¹˜26ä¹˜1çš„ç‰¹å¾å›¾ï¼Œå˜æˆ13ä¹˜13ä¹˜4çš„ç‰¹å¾å›¾ï¼Œåœ¨è¿™ä¸€æ¬¡æ“ä½œä¸­ä¸æŸå¤±ç»†ç²’åº¦ç‰¹å¾ã€‚</li><li>Multi-Scale Trainingï¼ˆå¤šå°ºå¯¸è®­ç»ƒï¼‰<br>å¾ˆå…³é”®çš„ä¸€ç‚¹æ˜¯ï¼ŒYolo v2ä¸­åªæœ‰å·ç§¯å±‚ä¸æ± åŒ–å±‚ï¼Œæ‰€ä»¥å¯¹äºç½‘ç»œçš„è¾“å…¥å¤§å°ï¼Œå¹¶æ²¡æœ‰é™åˆ¶ï¼Œæ•´ä¸ªç½‘ç»œçš„é™é‡‡æ ·å€æ•°ä¸º32ï¼Œåªè¦è¾“å…¥çš„ç‰¹å¾å›¾å°ºå¯¸ä¸º32çš„å€æ•°å³å¯ï¼Œå¦‚æœç½‘ç»œä¸­æœ‰å…¨è¿æ¥å±‚ï¼Œå°±ä¸æ˜¯è¿™æ ·äº†ã€‚æ‰€ä»¥Yolo v2å¯ä»¥ä½¿ç”¨ä¸åŒå°ºå¯¸çš„è¾“å…¥å›¾ç‰‡è®­ç»ƒã€‚<br>ä½œè€…ä½¿ç”¨çš„è®­ç»ƒæ–¹æ³•æ˜¯ï¼Œåœ¨æ¯10ä¸ªbatchä¹‹åï¼Œå°±å°†å›¾ç‰‡resizeæˆ{320, 352, â€¦, 608}ä¸­çš„ä¸€ç§ã€‚ä¸åŒçš„è¾“å…¥ï¼Œæœ€åäº§ç”Ÿçš„æ ¼ç‚¹æ•°ä¸åŒï¼Œæ¯”å¦‚è¾“å…¥å›¾ç‰‡æ˜¯320ä¹˜320ï¼Œé‚£ä¹ˆè¾“å‡ºæ ¼ç‚¹æ˜¯10ä¹˜10ï¼Œå¦‚æœæ¯ä¸ªæ ¼ç‚¹çš„å…ˆéªŒæ¡†ä¸ªæ•°è®¾ç½®ä¸º5ï¼Œé‚£ä¹ˆæ€»å…±è¾“å‡º500ä¸ªé¢„æµ‹ç»“æœï¼›å¦‚æœè¾“å…¥å›¾ç‰‡å¤§å°æ˜¯608ä¹˜608ï¼Œè¾“å‡ºæ ¼ç‚¹å°±æ˜¯19ä¹˜19ï¼Œå…±1805ä¸ªé¢„æµ‹ç»“æœã€‚<br>åœ¨å¼•å…¥äº†å¤šå°ºå¯¸è®­ç»ƒæ–¹æ³•åï¼Œè¿«ä½¿å·ç§¯æ ¸å­¦ä¹ ä¸åŒæ¯”ä¾‹å¤§å°å°ºå¯¸çš„ç‰¹å¾ã€‚å½“è¾“å…¥è®¾ç½®ä¸º544ä¹˜544ç”šè‡³æ›´å¤§ï¼ŒYolo v2çš„mAPå·²ç»è¶…è¿‡äº†å…¶ä»–çš„ç‰©ä½“æ£€æµ‹ç®—æ³•ã€‚</li></ol><h2 id="YOLOv3"><a href="#YOLOv3" class="headerlink" title="YOLOv3"></a>YOLOv3</h2><p><a href="https://zhuanlan.zhihu.com/p/76802514">ã€è®ºæ–‡è§£è¯»ã€‘Yoloä¸‰éƒ¨æ›²è§£è¯»â€”â€”Yolov3</a><br><img src="https://user-images.githubusercontent.com/6218739/133880395-2f580763-b4fc-4aea-b36e-2d745834a1da.png" alt="yolov3"><br>Yolov3ä½¿ç”¨Darknet-53ä½œä¸ºæ•´ä¸ªç½‘ç»œçš„åˆ†ç±»éª¨å¹²éƒ¨åˆ†ï¼ˆè§ä¸Šå›¾è™šçº¿éƒ¨åˆ†ï¼‰ã€‚<br>Darknet-53çš„æ¶æ„å¦‚ä¸‹å›¾ï¼š<br><img src="https://user-images.githubusercontent.com/6218739/133880487-984b7259-6b63-42e4-8d6a-7ae420fb4591.png" alt="darknet53"><br>backboneéƒ¨åˆ†ç”±Yolov2æ—¶æœŸçš„Darknet-19è¿›åŒ–è‡³Darknet-53ï¼ŒåŠ æ·±äº†ç½‘ç»œå±‚æ•°ï¼Œå¼•å…¥äº†Resnetä¸­çš„è·¨å±‚åŠ å’Œæ“ä½œã€‚Darknet-53å¤„ç†é€Ÿåº¦æ¯ç§’78å¼ å›¾ï¼Œæ¯”Darknet-19æ…¢ä¸å°‘ï¼Œä½†æ˜¯æ¯”åŒç²¾åº¦çš„ResNetå¿«å¾ˆå¤šã€‚Yolov3ä¾ç„¶ä¿æŒäº†é«˜æ€§èƒ½ã€‚</p><p>ç½‘ç»œç»“æ„è§£æï¼š</p><ol><li>Yolov3ä¸­ï¼Œåªæœ‰å·ç§¯å±‚ï¼Œé€šè¿‡è°ƒèŠ‚å·ç§¯æ­¥é•¿æ§åˆ¶è¾“å‡ºç‰¹å¾å›¾çš„å°ºå¯¸ã€‚æ‰€ä»¥å¯¹äºè¾“å…¥å›¾ç‰‡å°ºå¯¸æ²¡æœ‰ç‰¹åˆ«é™åˆ¶ã€‚</li><li>Yolov3å€Ÿé‰´äº†é‡‘å­—å¡”ç‰¹å¾å›¾æ€æƒ³ï¼Œå°å°ºå¯¸ç‰¹å¾å›¾ç”¨äºæ£€æµ‹å¤§å°ºå¯¸ç‰©ä½“ï¼Œè€Œå¤§å°ºå¯¸ç‰¹å¾å›¾æ£€æµ‹å°å°ºå¯¸ç‰©ä½“ã€‚ç‰¹å¾å›¾çš„è¾“å‡ºç»´åº¦ä¸º$N \times N \times [3 \times (4+1+80)]$ï¼Œ $N \times N$ä¸ºè¾“å‡ºç‰¹å¾å›¾æ ¼ç‚¹æ•°ï¼Œä¸€å…±3ä¸ªAnchoræ¡†ï¼Œæ¯ä¸ªæ¡†æœ‰4ç»´é¢„æµ‹æ¡†æ•°å€¼å’Œ1ç»´é¢„æµ‹æ¡†ç½®ä¿¡åº¦ï¼Œ80ç»´ç‰©ä½“ç±»åˆ«æ•°ã€‚</li><li>Yolov3æ€»å…±è¾“å‡º3ä¸ªç‰¹å¾å›¾ï¼Œç¬¬ä¸€ä¸ªç‰¹å¾å›¾ä¸‹é‡‡æ ·32å€ï¼Œç¬¬äºŒä¸ªç‰¹å¾å›¾ä¸‹é‡‡æ ·16å€ï¼Œç¬¬ä¸‰ä¸ªä¸‹é‡‡æ ·8å€ã€‚è¾“å…¥å›¾åƒç»è¿‡Darknet-53ï¼ˆæ— å…¨è¿æ¥å±‚ï¼‰ï¼Œå†ç»è¿‡Yoloblockç”Ÿæˆçš„ç‰¹å¾å›¾è¢«å½“ä½œä¸¤ç”¨ï¼Œç¬¬ä¸€ç”¨ä¸ºç»è¿‡3ä¹˜3å·ç§¯å±‚ã€1ä¹˜1å·ç§¯ä¹‹åç”Ÿæˆç‰¹å¾å›¾ä¸€ï¼Œç¬¬äºŒç”¨ä¸ºç»è¿‡1ä¹˜1å·ç§¯å±‚åŠ ä¸Šé‡‡æ ·å±‚ï¼Œä¸Darnet-53ç½‘ç»œçš„ä¸­é—´å±‚è¾“å‡ºç»“æœè¿›è¡Œæ‹¼æ¥ï¼Œäº§ç”Ÿç‰¹å¾å›¾äºŒã€‚åŒæ ·çš„å¾ªç¯ä¹‹åäº§ç”Ÿç‰¹å¾å›¾ä¸‰ã€‚</li><li>concatæ“ä½œä¸åŠ å’Œæ“ä½œçš„åŒºåˆ«ï¼šåŠ å’Œæ“ä½œæ¥æºäºResNetæ€æƒ³ï¼Œå°†è¾“å…¥çš„ç‰¹å¾å›¾ï¼Œä¸è¾“å‡ºç‰¹å¾å›¾å¯¹åº”ç»´åº¦è¿›è¡Œç›¸åŠ ï¼Œå³$y=f(x)+x$ï¼›è€Œconcatæ“ä½œæºäºDenseNetç½‘ç»œçš„è®¾è®¡æ€è·¯ï¼Œå°†ç‰¹å¾å›¾æŒ‰ç…§é€šé“ç»´åº¦ç›´æ¥è¿›è¡Œæ‹¼æ¥ï¼Œä¾‹å¦‚8ä¹˜8ä¹˜16çš„ç‰¹å¾å›¾ä¸8ä¹˜8ä¹˜16çš„ç‰¹å¾å›¾æ‹¼æ¥åç”Ÿæˆ8ä¹˜8ä¹˜32çš„ç‰¹å¾å›¾ã€‚</li><li>ä¸Šé‡‡æ ·å±‚(upsample)ï¼šä½œç”¨æ˜¯å°†å°å°ºå¯¸ç‰¹å¾å›¾é€šè¿‡æ’å€¼ç­‰æ–¹æ³•ï¼Œç”Ÿæˆå¤§å°ºå¯¸å›¾åƒã€‚ä¾‹å¦‚ä½¿ç”¨æœ€è¿‘é‚»æ’å€¼ç®—æ³•ï¼Œå°†8ä¹˜8çš„å›¾åƒå˜æ¢ä¸º16ä¹˜16ã€‚ä¸Šé‡‡æ ·å±‚ä¸æ”¹å˜ç‰¹å¾å›¾çš„é€šé“æ•°ã€‚</li></ol><p>Yoloçš„æ•´ä¸ªç½‘ç»œï¼Œå¸å–äº†Resnetã€Densenetã€FPNçš„ç²¾é«“ï¼Œå¯ä»¥è¯´æ˜¯èåˆäº†ç›®æ ‡æ£€æµ‹å½“å‰ä¸šç•Œæœ€æœ‰æ•ˆçš„å…¨éƒ¨æŠ€å·§ã€‚</p><p>YOLOv3ä¸YOLOv2å’ŒYOLOv1ç›¸æ¯”æœ€å¤§çš„æ”¹å–„å°±æ˜¯å¯¹boundingboxè¿›è¡Œäº†è·¨å°ºåº¦é¢„æµ‹(Prediction Across Scales)ï¼Œæé«˜YOLOæ¨¡å‹å¯¹ä¸åŒå°ºåº¦å¯¹è±¡çš„é¢„æµ‹ç²¾åº¦ã€‚<br><img src="https://user-images.githubusercontent.com/6218739/133882919-4d3ede76-ff3d-4435-a4c0-a577c181bd2d.png" alt="yolov3-output"><br><a href="https://zhuanlan.zhihu.com/p/75811997">YOLO_v3è®ºæ–‡è§£è¯»</a></p><p>ç»“åˆä¸Šå›¾çœ‹ï¼Œå·ç§¯ç½‘ç»œåœ¨79å±‚åï¼Œç»è¿‡ä¸‹æ–¹å‡ ä¸ªé»„è‰²çš„å·ç§¯å±‚å¾—åˆ°ä¸€ç§å°ºåº¦çš„æ£€æµ‹ç»“æœã€‚ç›¸æ¯”è¾“å…¥å›¾åƒï¼Œè¿™é‡Œç”¨äºæ£€æµ‹çš„ç‰¹å¾å›¾æœ‰32å€çš„ä¸‹é‡‡æ ·ã€‚æ¯”å¦‚è¾“å…¥æ˜¯416ä¹˜416çš„è¯ï¼Œè¿™é‡Œçš„ç‰¹å¾å›¾å°±æ˜¯13ä¹˜13äº†ã€‚ç”±äºä¸‹é‡‡æ ·å€æ•°é«˜ï¼Œè¿™é‡Œç‰¹å¾å›¾çš„æ„Ÿå—é‡æ¯”è¾ƒå¤§ï¼Œå› æ­¤é€‚åˆæ£€æµ‹å›¾åƒä¸­å°ºå¯¸æ¯”è¾ƒå¤§çš„å¯¹è±¡ã€‚<br>ä¸ºäº†å®ç°ç»†ç²’åº¦çš„æ£€æµ‹ï¼Œç¬¬79å±‚çš„ç‰¹å¾å›¾åˆå¼€å§‹ä½œä¸Šé‡‡æ ·ï¼ˆä»79å±‚å¾€å³å¼€å§‹ä¸Šé‡‡æ ·å·ç§¯ï¼‰ï¼Œç„¶åä¸ç¬¬61å±‚ç‰¹å¾å›¾æ‹¼æ¥ï¼ˆConcatenationï¼‰ï¼Œè¿™æ ·å¾—åˆ°ç¬¬91å±‚è¾ƒç»†ç²’åº¦çš„ç‰¹å¾å›¾ï¼ŒåŒæ ·ç»è¿‡å‡ ä¸ªå·ç§¯å±‚åå¾—åˆ°ç›¸å¯¹è¾“å…¥å›¾åƒ16å€ä¸‹é‡‡æ ·çš„ç‰¹å¾å›¾ã€‚å®ƒå…·æœ‰ä¸­ç­‰å°ºåº¦çš„æ„Ÿå—é‡ï¼Œé€‚åˆæ£€æµ‹ä¸­ç­‰å°ºåº¦çš„å¯¹è±¡ã€‚<br>æœ€åï¼Œç¬¬91å±‚ç‰¹å¾å›¾å†æ¬¡ä¸Šé‡‡æ ·ï¼Œå¹¶ä¸ç¬¬36å±‚ç‰¹å¾å›¾æ‹¼æ¥ï¼ˆConcatenationï¼‰ï¼Œæœ€åå¾—åˆ°ç›¸å¯¹è¾“å…¥å›¾åƒ8å€ä¸‹é‡‡æ ·çš„ç‰¹å¾å›¾ã€‚å®ƒçš„æ„Ÿå—é‡æœ€å°ï¼Œé€‚åˆæ£€æµ‹å°å°ºå¯¸çš„å¯¹è±¡ã€‚<br>éšç€è¾“å‡ºçš„ç‰¹å¾å›¾çš„æ•°é‡å’Œå°ºåº¦çš„å˜åŒ–ï¼Œå…ˆéªŒæ¡†çš„å°ºå¯¸ä¹Ÿéœ€è¦ç›¸åº”çš„è°ƒæ•´ã€‚YOLO2å·²ç»å¼€å§‹é‡‡ç”¨K-meansèšç±»å¾—åˆ°å…ˆéªŒæ¡†çš„å°ºå¯¸ï¼ŒYOLO3å»¶ç»­äº†è¿™ç§æ–¹æ³•ï¼Œä¸ºæ¯ç§ä¸‹é‡‡æ ·å°ºåº¦è®¾å®š3ç§å…ˆéªŒæ¡†ï¼Œæ€»å…±èšç±»å‡º9ç§å°ºå¯¸çš„å…ˆéªŒæ¡†ã€‚åœ¨COCOæ•°æ®é›†è¿™9ä¸ªå…ˆéªŒæ¡†æ˜¯ï¼š</p><script type="math/tex; mode=display">(10 \times 13)ï¼Œ(16 \times 30)ï¼Œ(33 \times 23)ï¼Œ(30 \times 61)ï¼Œ(62 \times 45)ï¼Œ(59 \times 119)ï¼Œ(116 \times 90)ï¼Œ(156 \times 198)ï¼Œ(373 \times 326)</script><p>åˆ†é…ä¸Šï¼Œåœ¨æœ€å°çš„13ä¹˜13ç‰¹å¾å›¾ä¸Šï¼ˆæœ‰æœ€å¤§çš„æ„Ÿå—é‡ï¼‰åº”ç”¨è¾ƒå¤§çš„å…ˆéªŒæ¡†$(116 \times 90)ï¼Œ(156 \times 198)ï¼Œ(373 \times 326)$ï¼Œé€‚åˆæ£€æµ‹è¾ƒå¤§çš„å¯¹è±¡ã€‚ä¸­ç­‰çš„26ä¹˜26ç‰¹å¾å›¾ä¸Šï¼ˆä¸­ç­‰æ„Ÿå—é‡ï¼‰åº”ç”¨ä¸­ç­‰çš„å…ˆéªŒæ¡†$(30 \times 61)ï¼Œ(62 \times 45)ï¼Œ(59 \times 119)$ï¼Œé€‚åˆæ£€æµ‹ä¸­ç­‰å¤§å°çš„å¯¹è±¡ã€‚è¾ƒå¤§çš„52ä¹˜52ç‰¹å¾å›¾ä¸Šï¼ˆè¾ƒå°çš„æ„Ÿå—é‡ï¼‰åº”ç”¨è¾ƒå°çš„å…ˆéªŒæ¡†$(10 \times 13)ï¼Œ(16 \times 30)ï¼Œ(33 \times 23)$ï¼Œé€‚åˆæ£€æµ‹è¾ƒå°çš„å¯¹è±¡ã€‚</p><p>YOLOv3å‰å‘è§£ç è¿‡ç¨‹ï¼š<br>æ ¹æ®ä¸åŒçš„è¾“å…¥å°ºå¯¸ï¼Œä¼šå¾—åˆ°ä¸åŒå¤§å°çš„è¾“å‡ºç‰¹å¾å›¾ï¼Œä»¥å›¾äºŒä¸­è¾“å…¥å›¾ç‰‡$256 \times 256 \times 3$ä¸ºä¾‹ï¼Œè¾“å‡ºçš„ç‰¹å¾å›¾ä¸º$8 \times 8 \times 255$ã€$16 \times 16 \times 255$ã€$32 \times 32 \times 255$ã€‚åœ¨Yolov3çš„è®¾è®¡ä¸­ï¼Œæ¯ä¸ªç‰¹å¾å›¾çš„æ¯ä¸ªæ ¼å­ä¸­ï¼Œéƒ½é…ç½®3ä¸ªä¸åŒçš„å…ˆéªŒæ¡†ï¼ˆå°±æ˜¯ä¸‹é¢çš„é”šæ¡†ï¼‰ï¼Œæ‰€ä»¥æœ€åä¸‰ä¸ªç‰¹å¾å›¾ï¼Œè¿™é‡Œæš‚ä¸”reshapeä¸º$8 \times 8 \times 3 \times 85$ã€$16 \times 16 \times 3 \times 85$ã€$32 \times 32 \times 3 \times 85$ï¼Œè¿™æ ·æ›´å®¹æ˜“ç†è§£ï¼Œåœ¨ä»£ç ä¸­ä¹Ÿæ˜¯reshapeæˆè¿™æ ·ä¹‹åæ›´å®¹æ˜“æ“ä½œã€‚<br>ä¸‰å¼ ç‰¹å¾å›¾å°±æ˜¯æ•´ä¸ªYoloè¾“å‡ºçš„æ£€æµ‹ç»“æœï¼Œæ£€æµ‹æ¡†ä½ç½®ï¼ˆ4ç»´ï¼‰ã€æ£€æµ‹ç½®ä¿¡åº¦ï¼ˆ1ç»´ï¼‰ã€ç±»åˆ«ï¼ˆ80ç»´ï¼‰éƒ½åœ¨å…¶ä¸­ï¼ŒåŠ èµ·æ¥æ­£å¥½æ˜¯85ç»´ã€‚ç‰¹å¾å›¾æœ€åçš„ç»´åº¦85ï¼Œä»£è¡¨çš„å°±æ˜¯è¿™äº›ä¿¡æ¯ï¼Œè€Œç‰¹å¾å›¾å…¶ä»–ç»´åº¦$N \times N \times 3$ï¼Œ$N \times N$ä»£è¡¨äº†æ£€æµ‹æ¡†çš„å‚è€ƒä½ç½®ä¿¡æ¯ï¼Œ3æ˜¯3ä¸ªä¸åŒå°ºåº¦çš„å…ˆéªŒæ¡†ã€‚</p><p>ä¸‰ä¸ªç‰¹å¾å›¾ä¸€å…±å¯ä»¥è§£ç å‡º $8 Ã— 8 Ã— 3 + 16 Ã— 16 Ã— 3 + 32 Ã— 32 Ã— 3 = 4032$ ä¸ªboxä»¥åŠç›¸åº”çš„ç±»åˆ«ã€ç½®ä¿¡åº¦ã€‚è¿™4032ä¸ªboxï¼Œåœ¨è®­ç»ƒå’Œæ¨ç†æ—¶ï¼Œä½¿ç”¨æ–¹æ³•ä¸ä¸€æ ·ï¼š</p><ol><li>è®­ç»ƒæ—¶4032ä¸ªboxå…¨éƒ¨é€å…¥æ‰“æ ‡ç­¾å‡½æ•°ï¼Œè¿›è¡Œåä¸€æ­¥çš„æ ‡ç­¾ä»¥åŠæŸå¤±å‡½æ•°çš„è®¡ç®—ã€‚</li><li>æ¨ç†æ—¶ï¼Œé€‰å–ä¸€ä¸ªç½®ä¿¡åº¦é˜ˆå€¼ï¼Œè¿‡æ»¤æ‰ä½é˜ˆå€¼boxï¼Œå†ç»è¿‡nmsï¼ˆéæå¤§å€¼æŠ‘åˆ¶ï¼‰ï¼Œå°±å¯ä»¥è¾“å‡ºæ•´ä¸ªç½‘ç»œçš„é¢„æµ‹ç»“æœäº†ã€‚</li></ol><p>YOLOv3è®­ç»ƒç­–ç•¥ï¼ˆåå‘è¿‡ç¨‹ï¼‰ï¼š</p><ol><li>é¢„æµ‹æ¡†ä¸€å…±åˆ†ä¸ºä¸‰ç§æƒ…å†µï¼šæ­£ä¾‹ï¼ˆpositiveï¼‰ã€è´Ÿä¾‹ï¼ˆnegativeï¼‰ã€å¿½ç•¥æ ·ä¾‹ï¼ˆignoreï¼‰ã€‚</li><li>æ­£ä¾‹ï¼šä»»å–ä¸€ä¸ªground truthï¼Œä¸4032ä¸ªæ¡†å…¨éƒ¨è®¡ç®—IOUï¼ŒIOUæœ€å¤§çš„é¢„æµ‹æ¡†ï¼Œå³ä¸ºæ­£ä¾‹ã€‚å¹¶ä¸”ä¸€ä¸ªé¢„æµ‹æ¡†ï¼Œåªèƒ½åˆ†é…ç»™ä¸€ä¸ªground truthã€‚ä¾‹å¦‚ç¬¬ä¸€ä¸ªground truthå·²ç»åŒ¹é…äº†ä¸€ä¸ªæ­£ä¾‹æ£€æµ‹æ¡†ï¼Œé‚£ä¹ˆä¸‹ä¸€ä¸ªground truthï¼Œå°±åœ¨ä½™ä¸‹çš„4031ä¸ªæ£€æµ‹æ¡†ä¸­ï¼Œå¯»æ‰¾IOUæœ€å¤§çš„æ£€æµ‹æ¡†ä½œä¸ºæ­£ä¾‹ã€‚ground truthçš„å…ˆåé¡ºåºå¯å¿½ç•¥ã€‚æ­£ä¾‹äº§ç”Ÿç½®ä¿¡åº¦lossã€æ£€æµ‹æ¡†lossã€ç±»åˆ«lossã€‚é¢„æµ‹æ¡†ä¸ºå¯¹åº”çš„ground truth boxæ ‡ç­¾ï¼›ç±»åˆ«æ ‡ç­¾å¯¹åº”ç±»åˆ«ä¸º1ï¼Œå…¶ä½™ä¸º0ï¼›ç½®ä¿¡åº¦æ ‡ç­¾ä¸º1ã€‚</li><li>å¿½ç•¥æ ·ä¾‹ï¼šæ­£ä¾‹é™¤å¤–ï¼Œä¸ä»»æ„ä¸€ä¸ªground truthçš„IOUå¤§äºé˜ˆå€¼ï¼ˆè®ºæ–‡ä¸­ä½¿ç”¨0.5ï¼‰ï¼Œåˆ™ä¸ºå¿½ç•¥æ ·ä¾‹ã€‚å¿½ç•¥æ ·ä¾‹ä¸äº§ç”Ÿä»»ä½•lossã€‚</li><li>è´Ÿä¾‹ï¼šæ­£ä¾‹é™¤å¤–ï¼ˆä¸ground truthè®¡ç®—åIOUæœ€å¤§çš„æ£€æµ‹æ¡†ï¼Œä½†æ˜¯IOUå°äºé˜ˆå€¼ï¼Œä»ä¸ºæ­£ä¾‹ï¼‰ï¼Œä¸å…¨éƒ¨ground truthçš„IOUéƒ½å°äºé˜ˆå€¼ï¼ˆ0.5ï¼‰ï¼Œåˆ™ä¸ºè´Ÿä¾‹ã€‚è´Ÿä¾‹åªæœ‰ç½®ä¿¡åº¦äº§ç”Ÿlossï¼Œç½®ä¿¡åº¦æ ‡ç­¾ä¸º0ã€‚</li></ol><h1 id="YOLOv3æºç "><a href="#YOLOv3æºç " class="headerlink" title="YOLOv3æºç "></a>YOLOv3æºç </h1><p>ä»å¤´å®ç°YOLOv3çš„æºç è§ï¼š<br><a href="https://github.com/aladdinpersson/Machine-Learning-Collection/tree/master/ML/Pytorch/object_detection/YOLOv3">YOLOv3 in PyTorch</a><br>è¯¥æºç çš„è§†é¢‘è®²è§£è§ï¼š<br><a href="https://www.bilibili.com/video/BV1bo4y1X78v?spm_id_from=333.999.0.0">YOLOv3 from Scratch</a></p><h2 id="æ¨¡å‹æ¶æ„"><a href="#æ¨¡å‹æ¶æ„" class="headerlink" title="æ¨¡å‹æ¶æ„"></a>æ¨¡å‹æ¶æ„</h2><p>æ•´ä¸ªYOLOv3çš„æ¨¡å‹æ¶æ„å¦‚ä¸‹é…ç½®ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¯¹äºé‡Œé¢çš„å…ƒç´ </span></span><br><span class="line"><span class="comment"># å¦‚æœæ˜¯å…ƒç»„ï¼Œä»£è¡¨ï¼š(è¾“å‡ºé€šé“, å·ç§¯æ ¸å°ºå¯¸, æ­¥é•¿)</span></span><br><span class="line"><span class="comment"># YOLOv3ä¸­æ‰€æœ‰çš„å·ç§¯å—ï¼ˆæ³¨æ„æ˜¯å·ç§¯å—ï¼Œå®ƒç”±å·ç§¯å±‚+æ‰¹æ ‡å‡†åŒ–å±‚+LeakyReLUå±‚æ„æˆï¼‰éƒ½æ˜¯ç›¸åŒçš„ï¼Œåœ¨ä¸‹é¢çš„ä»£ç ä¸­ç”¨CNNBlockç±»å®ç°</span></span><br><span class="line"><span class="comment"># å¦‚æœæ˜¯åˆ—è¡¨ï¼Œ&quot;B&quot;ä»£è¡¨æ®‹å·®å—Residual Blockï¼Œåé¢çš„æ¬¡æ•°ä»£è¡¨é‡å¤æ¬¡æ•°ï¼Œåœ¨ä¸‹é¢ç”¨ResidualBlockç±»å®ç°</span></span><br><span class="line"><span class="comment"># å¦‚æœæ˜¯å­—ç¬¦ï¼Œé‚£ä¹ˆ&quot;S&quot;ä»£è¡¨Scaleä¸åŒå°ºåº¦é¢„æµ‹å—ï¼Œåœ¨æ­¤å¤„è®¡ç®—æŸå¤±ï¼Œåœ¨ä¸‹é¢ç”¨ScalePredictionç±»å®ç°</span></span><br><span class="line"><span class="comment"># &quot;U&quot;ä»£è¡¨Upsamplingä¸Šé‡‡æ ·ï¼Œä¸”ä¸ä¸Šä¸€å±‚è¿›è¡Œè¿æ¥ï¼Œç”Ÿæˆæ–°çš„å°ºåº¦é¢„æµ‹</span></span><br><span class="line">config = [</span><br><span class="line">    (<span class="number">32</span>, <span class="number">3</span>, <span class="number">1</span>),</span><br><span class="line">    (<span class="number">64</span>, <span class="number">3</span>, <span class="number">2</span>),</span><br><span class="line">    [<span class="string">&quot;B&quot;</span>, <span class="number">1</span>],</span><br><span class="line">    (<span class="number">128</span>, <span class="number">3</span>, <span class="number">2</span>),</span><br><span class="line">    [<span class="string">&quot;B&quot;</span>, <span class="number">2</span>],</span><br><span class="line">    (<span class="number">256</span>, <span class="number">3</span>, <span class="number">2</span>),</span><br><span class="line">    [<span class="string">&quot;B&quot;</span>, <span class="number">8</span>],</span><br><span class="line">    (<span class="number">512</span>, <span class="number">3</span>, <span class="number">2</span>),</span><br><span class="line">    [<span class="string">&quot;B&quot;</span>, <span class="number">8</span>],</span><br><span class="line">    (<span class="number">1024</span>, <span class="number">3</span>, <span class="number">2</span>),</span><br><span class="line">    [<span class="string">&quot;B&quot;</span>, <span class="number">4</span>],  <span class="comment"># åˆ°è¿™é‡Œå°±æ˜¯Darknet-53 backboneï¼Œ53æ˜¯å…¨éƒ¨å·ç§¯å±‚çš„ä¸ªæ•°ï¼Œå®ƒä¼šåœ¨imagenetä¸Šè¿›è¡Œé¢„è®­ç»ƒ</span></span><br><span class="line">    (<span class="number">512</span>, <span class="number">1</span>, <span class="number">1</span>),</span><br><span class="line">    (<span class="number">1024</span>, <span class="number">3</span>, <span class="number">1</span>),</span><br><span class="line">    <span class="string">&quot;S&quot;</span>,</span><br><span class="line">    (<span class="number">256</span>, <span class="number">1</span>, <span class="number">1</span>),</span><br><span class="line">    <span class="string">&quot;U&quot;</span>,</span><br><span class="line">    (<span class="number">256</span>, <span class="number">1</span>, <span class="number">1</span>),</span><br><span class="line">    (<span class="number">512</span>, <span class="number">3</span>, <span class="number">1</span>),</span><br><span class="line">    <span class="string">&quot;S&quot;</span>,</span><br><span class="line">    (<span class="number">128</span>, <span class="number">1</span>, <span class="number">1</span>),</span><br><span class="line">    <span class="string">&quot;U&quot;</span>,</span><br><span class="line">    (<span class="number">128</span>, <span class="number">1</span>, <span class="number">1</span>),</span><br><span class="line">    (<span class="number">256</span>, <span class="number">3</span>, <span class="number">1</span>),</span><br><span class="line">    <span class="string">&quot;S&quot;</span>,</span><br><span class="line">]</span><br></pre></td></tr></table></figure><br>é¦–å…ˆçœ‹ä¸€ä¸‹CNNå·ç§¯å—çš„å®ç°ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CNNBlock</span>(<span class="params">nn.Module</span>):</span></span><br><span class="line">    <span class="comment"># æ­¤å¤„ä¼šåŠ ä¸Šä¸€ä¸ªBNå±‚çš„å¼€å…³ï¼Œå¦‚æœå…³äº†BNå±‚ï¼Œå°±ç›¸å½“äºæ˜¯åªæœ‰å·ç§¯å±‚ï¼Œè€Œä¸æ˜¯å·ç§¯å—</span></span><br><span class="line">   <span class="comment"># ä¸åŠ BNå’ŒReLUå±‚çš„çº¯å·ç§¯å±‚æ˜¯ä¼šåœ¨å°ºåº¦é¢„æµ‹çš„åœ°æ–¹ç”¨åˆ°ï¼Œå³ç½‘ç»œæœ«ç«¯çš„å·ç§¯æ˜¯çº¯å·ç§¯å±‚</span></span><br><span class="line">   <span class="comment"># åŒæ—¶ä½¿ç”¨kwargså‚æ•°æ¥æ”¶å…¶ä»–å‚æ•°ï¼Œæ¯”å¦‚kerneal sizeï¼Œstrideï¼Œpaddingç­‰å‚æ•°</span></span><br><span class="line">   <span class="comment"># åœ¨æ•´ä¸ªç½‘ç»œä¸­å›¾åƒçš„å®½é«˜å˜åŒ–å³ç»´åº¦å‹ç¼©ï¼Œæ˜¯é€šè¿‡å·ç§¯å—çš„strideå‚æ•°æ¥å®ç°çš„</span></span><br><span class="line">   <span class="comment"># ç”±ä¸‹é¢çš„åˆ†æå¯çŸ¥ï¼Œåœ¨æ®‹å·®å—ä¸­å›¾åƒå®½é«˜ä¸å˜ï¼Œä½†ä¸¤ä¸ªæ®‹å·®å—ä¸­é—´çš„å·ç§¯å—çš„strideä¸º2ï¼Œæ­¤æ—¶ä¼šå¯¹å›¾åƒçš„å®½é«˜è¿›è¡Œå‹ç¼©å‡åŠ</span></span><br><span class="line">   <span class="comment"># æ•´ä¸ªç½‘ç»œä¸­å‹ç¼©æœ€å‰å®³çš„åˆ†æ”¯æ˜¯ä¸€å…±å‹ç¼©äº†5æ¬¡ï¼Œå³å‹ç¼©äº†32å€ï¼Œå¦å¤–ä¸¤æ”¯åˆ†åˆ«å‹ç¼©äº†16å€å’Œ8å€</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, in_channels, out_channels, bn_act=<span class="literal">True</span>, **kwargs</span>):</span></span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">       <span class="comment"># å¦‚æœä½¿ç”¨äº†BNï¼Œé‚£ä¹ˆåç½®è¿™ä¸ªå‚æ•°å°±æ²¡å¿…è¦äº†ï¼Œæ‰€ä»¥æ­¤å¤„ä¼šæ ¹æ®BNå±‚çš„æœ‰æ— è¿›è¡Œåç½®biaså‚æ•°çš„å¼€å…³</span></span><br><span class="line">        self.conv = nn.Conv2d(in_channels, out_channels, bias=<span class="keyword">not</span> bn_act, **kwargs)</span><br><span class="line">        self.bn = nn.BatchNorm2d(out_channels)</span><br><span class="line">        self.leaky = nn.LeakyReLU(<span class="number">0.1</span>)</span><br><span class="line">        self.use_bn_act = bn_act</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span>(<span class="params">self, x</span>):</span></span><br><span class="line">        <span class="keyword">if</span> self.use_bn_act:</span><br><span class="line">            <span class="keyword">return</span> self.leaky(self.bn(self.conv(x)))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> self.conv(x)</span><br></pre></td></tr></table></figure><br>å†çœ‹ä¸€ä¸‹æ®‹å·®å—çš„å®ç°ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ResidualBlock</span>(<span class="params">nn.Module</span>):</span></span><br><span class="line">    <span class="comment"># è¿™é‡Œç»™å‡ºäº†æ˜¯å¦ä½¿ç”¨æ®‹å·®è¿æ¥çš„å¼€å…³ï¼Œåœ¨darknet-53éƒ¨åˆ†éƒ½æ˜¯æ‰“å¼€æ®‹å·®è¿æ¥ï¼Œä½†åˆ°äº†å°ºåº¦é¢„æµ‹éƒ¨åˆ†ï¼Œè¯¥æ®‹å·®å—æ˜¯å…³é—­äº†æ®‹å·®è¿æ¥</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, channels, use_residual=<span class="literal">True</span>, num_repeats=<span class="number">1</span></span>):</span></span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        <span class="comment"># æ•´ä¸ªæ®‹å·®å—æ˜¯ä¸€ä¸ªModuleList</span></span><br><span class="line">        self.layers = nn.ModuleList()</span><br><span class="line">       <span class="comment"># æ ¹æ®é‡å¤æ¬¡æ•°è¿›è¡Œå¾ªç¯</span></span><br><span class="line">        <span class="keyword">for</span> repeat <span class="keyword">in</span> <span class="built_in">range</span>(num_repeats):</span><br><span class="line">            self.layers += [</span><br><span class="line">                <span class="comment"># æ¯ä¸ªæ®‹å·®å—ä¸­çš„ç¬¬ä¸€ä¸ªå·ç§¯å—éƒ½æ˜¯é€šé“æ•°å‡åŠï¼Œå·ç§¯æ ¸å°ºå¯¸ä¸º1ï¼Œæ­¥é•¿æ˜¯é»˜è®¤çš„1ï¼Œå¡«å……æ˜¯é»˜è®¤çš„0ï¼Œå› æ­¤å›¾åƒçš„è¾“å…¥å’Œè¾“å‡ºå®½é«˜ä¸å˜</span></span><br><span class="line">            <span class="comment"># ç¬¬äºŒä¸ªå·ç§¯å—é€šé“æ•°å˜ä¸ºä¸¤å€ï¼Œå·ç§¯æ ¸å°ºå¯¸ä¸º3ï¼Œå¡«å……ä¸º1ï¼Œæ­¥é•¿ä»æ˜¯é»˜è®¤çš„1ï¼Œå› æ­¤å›¾åƒçš„è¾“å…¥å’Œè¾“å‡ºå®½é«˜ä¸å˜</span></span><br><span class="line">            <span class="comment"># æ‰€ä»¥ï¼Œæ€»çš„æ¥è¯´ï¼Œç»è¿‡ä¸€ä¸ªæ®‹å·®å—åï¼Œå›¾åƒçš„é€šé“æ•°ã€å®½å’Œé«˜éƒ½ä¸ä¼šå˜</span></span><br><span class="line">                nn.Sequential(</span><br><span class="line">                    CNNBlock(channels, channels // <span class="number">2</span>, kernel_size=<span class="number">1</span>),</span><br><span class="line">                    CNNBlock(channels // <span class="number">2</span>, channels, kernel_size=<span class="number">3</span>, padding=<span class="number">1</span>),</span><br><span class="line">                )</span><br><span class="line">            ]</span><br><span class="line"></span><br><span class="line">        self.use_residual = use_residual</span><br><span class="line">        self.num_repeats = num_repeats</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span>(<span class="params">self, x</span>):</span></span><br><span class="line">        <span class="keyword">for</span> layer <span class="keyword">in</span> self.layers:</span><br><span class="line">            <span class="comment"># å¦‚æœå¯ç”¨æ®‹å·®è¿æ¥ï¼Œé‚£ä¹ˆå°±ç›´æ¥å°†xå’Œç»è¿‡å¤„ç†åçš„xç›¸åŠ </span></span><br><span class="line">            <span class="keyword">if</span> self.use_residual:</span><br><span class="line">                x = x + layer(x)</span><br><span class="line">            <span class="comment"># å¦‚æœæ²¡æœ‰å¯ç”¨æ®‹å·®è¿æ¥ï¼Œé‚£ä¹ˆå°±ç›´æ¥å¤„ç†xï¼Œä¸ç®¡ä½œä¸ºè¾“å…¥çš„x</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                x = layer(x)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> x</span><br></pre></td></tr></table></figure></p><p>å†æ¥çœ‹ä¸åŒå°ºåº¦é¢„æµ‹çš„ç±»å®ç°ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ScalePrediction</span>(<span class="params">nn.Module</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, in_channels, num_classes</span>):</span></span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        self.pred = nn.Sequential(</span><br><span class="line">            <span class="comment"># åœ¨æ¯ä¸ªå°ºåº¦é¢„æµ‹å—ä¸­ï¼Œå…ˆç”¨ä¸€ä¸ªå·ç§¯å—å°†é€šé“æ•°åŠ å€ï¼ŒåŒæ—¶é€šè¿‡è®¾ç½®å·ç§¯æ ¸å°ºå¯¸ä¸º3ï¼Œå¡«å……ä¸º1ï¼Œæ­¥é•¿æ˜¯é»˜è®¤çš„1ï¼Œæ¥ä¿æŒå®½é«˜ä¸å˜</span></span><br><span class="line">            CNNBlock(in_channels, <span class="number">2</span> * in_channels, kernel_size=<span class="number">3</span>, padding=<span class="number">1</span>),</span><br><span class="line">            <span class="comment"># ç„¶åå°†å¾—åˆ°çš„ç‰¹å¾å›¾é€šè¿‡ä¸€ä¸ªå·ç§¯å—è½¬åŒ–ä¸ºæœ€ç»ˆæƒ³è¦çš„å‘é‡çš„æ¨¡æ ·</span></span><br><span class="line">         <span class="comment"># 3æŒ‡çš„æ˜¯å¯¹äºå¯¹äºæ¯ä¸€ä¸ªgrid cellï¼Œéƒ½æœ‰3ä¸ªanchor boxes</span></span><br><span class="line">         <span class="comment"># å¯¹äºæ¯ä¸€ä¸ªanchor boxï¼Œéƒ½éœ€è¦æœ‰num_classes+5ä¸ªå…ƒç´ ï¼Œå‰é¢æ˜¯ç±»åˆ«æ•°ç›®ï¼Œæ¯”å¦‚20ï¼Œ5æ˜¯åŒ…å«äº†x, y, w, hå’Œç½®ä¿¡åº¦</span></span><br><span class="line">         <span class="comment"># æ³¨æ„è¿™é‡Œä¸ä½¿ç”¨BNå±‚ï¼ŒåŒæ—¶å·ç§¯æ ¸ä¸º1ï¼Œæ­¥é•¿æ˜¯é»˜è®¤çš„1ï¼Œå¡«å……æ˜¯é»˜è®¤çš„0ï¼Œå› æ­¤å®½é«˜ä¸å˜</span></span><br><span class="line">            CNNBlock(</span><br><span class="line">                <span class="number">2</span> * in_channels, (num_classes + <span class="number">5</span>) * <span class="number">3</span>, bn_act=<span class="literal">False</span>, kernel_size=<span class="number">1</span></span><br><span class="line">            ),</span><br><span class="line">        )</span><br><span class="line">        self.num_classes = num_classes</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span>(<span class="params">self, x</span>):</span></span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            self.pred(x)</span><br><span class="line">            <span class="comment"># å¯¹xè¿›è¡Œé¢„æµ‹åï¼Œéœ€è¦å¯¹ç»“æœè¿›è¡Œreshapeï¼Œå½¢çŠ¶ä¾æ¬¡ä¸ºbatch sizeã€3ã€ç±»åˆ«æ•°+5ã€ç‰¹å¾å›¾å®½åº¦ã€ç‰¹å¾å›¾é«˜åº¦</span></span><br><span class="line">            .reshape(x.shape[<span class="number">0</span>], <span class="number">3</span>, self.num_classes + <span class="number">5</span>, x.shape[<span class="number">2</span>], x.shape[<span class="number">3</span>])</span><br><span class="line">            <span class="comment"># å†äº¤æ¢ä¸€ä¸‹ç»´åº¦ï¼ŒæŠŠå®½ã€é«˜æåˆ°(ç±»åˆ«æ•°+5)çš„å‰é¢</span></span><br><span class="line">         <span class="comment"># æ¯”å¦‚æŸä¸€ä¸ªå°ºåº¦é¢„æµ‹åï¼Œå¾—åˆ°çš„å‘é‡å½¢çŠ¶ä¸ºN x 3 x 13 x 13 x (5+num_classes)ï¼Œgrid cellå°±æ˜¯13x13å¤§å°</span></span><br><span class="line">            .permute(<span class="number">0</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">2</span>)</span><br><span class="line">        )</span><br></pre></td></tr></table></figure></p><p>æœ€åçœ‹æ•´ä¸ªæ¨¡å‹çš„æ¶æ„ï¼Œå³å°†ä¸Šé¢çš„ç»„ä»¶ç»„åˆèµ·æ¥ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">YOLOv3</span>(<span class="params">nn.Module</span>):</span></span><br><span class="line">    <span class="comment"># è¾“å…¥é€šé“é»˜è®¤ä¸º3ï¼Œ ç±»åˆ«æ•°é»˜è®¤ä¸º80</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, in_channels=<span class="number">3</span>, num_classes=<span class="number">80</span></span>):</span></span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        self.num_classes = num_classes</span><br><span class="line">        self.in_channels = in_channels</span><br><span class="line">        self.layers = self._create_conv_layers()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_create_conv_layers</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="comment"># å°†æ‰€æœ‰æ¨¡å‹ç»„ä»¶éƒ½æ”¾åœ¨ModuleListä¸­</span></span><br><span class="line">        layers = nn.ModuleList()</span><br><span class="line">        in_channels = self.in_channels</span><br><span class="line"></span><br><span class="line">      <span class="comment"># å¼€å§‹è§£æä¸Šé¢çš„configé…ç½®</span></span><br><span class="line">        <span class="keyword">for</span> module <span class="keyword">in</span> config:</span><br><span class="line">            <span class="comment"># å¦‚æœå…ƒç´ æ˜¯ä¸ªå…ƒç»„ï¼Œä»£è¡¨å®ƒæ˜¯ä¸ªå·ç§¯å—</span></span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">isinstance</span>(module, <span class="built_in">tuple</span>):</span><br><span class="line">                <span class="comment"># å–å‡ºå·ç§¯å—çš„ç›¸åº”é…ç½®</span></span><br><span class="line">                out_channels, kernel_size, stride = module</span><br><span class="line">                <span class="comment"># å¾€æ•´ä¸ªç½‘ç»œé‡Œæ·»åŠ å·ç§¯å—</span></span><br><span class="line">                layers.append(</span><br><span class="line">                    CNNBlock(</span><br><span class="line">                        in_channels,</span><br><span class="line">                        out_channels,</span><br><span class="line">                        kernel_size=kernel_size,</span><br><span class="line">                        stride=stride,</span><br><span class="line">                        <span class="comment"># å¦‚æœå·ç§¯æ ¸ä¸º3ï¼Œåˆ™å¡«å……ä¸º1ï¼Œå¦åˆ™å°±å¡«å……ä¸º0ï¼Œè¿™æ ·æ˜¯ä¸ºäº†å½“å·ç§¯æ ¸ä¸º3ã€æ­¥é•¿ä¸º2æ—¶ï¼Œå¡«å……è®¾ä¸º1ï¼Œæ­¤æ—¶å®½é«˜å‡åŠ</span></span><br><span class="line">                  <span class="comment"># Pytorché»˜è®¤å·ç§¯å±‚çš„å°ºå¯¸è®¡ç®—æ˜¯å‘ä¸‹å–æ•´ï¼Œå³(k+2*1-3)/2+1=k/2+floor(-0.5)+1=k/2-1+1=k/2</span></span><br><span class="line">                        padding=<span class="number">1</span> <span class="keyword">if</span> kernel_size == <span class="number">3</span> <span class="keyword">else</span> <span class="number">0</span>,</span><br><span class="line">                    )</span><br><span class="line">                )</span><br><span class="line">                <span class="comment"># æ›´æ–°é€šé“æ•°</span></span><br><span class="line">                in_channels = out_channels</span><br><span class="line"></span><br><span class="line">         <span class="comment"># å¦‚æœå…ƒç´ æ˜¯ä¸ªåˆ—è¡¨ï¼Œä»£è¡¨æ˜¯æ®‹å·®å—</span></span><br><span class="line">            <span class="keyword">elif</span> <span class="built_in">isinstance</span>(module, <span class="built_in">list</span>):</span><br><span class="line">                <span class="comment"># å–å‡ºæ®‹å·®å—çš„ç›¸åº”é…ç½®</span></span><br><span class="line">                num_repeats = module[<span class="number">1</span>]</span><br><span class="line">                <span class="comment"># å¾€æ•´ä¸ªç½‘ç»œé‡Œæ·»åŠ æ®‹å·®å—</span></span><br><span class="line">                layers.append(ResidualBlock(in_channels, num_repeats=num_repeats,))</span><br><span class="line"></span><br><span class="line">         <span class="comment"># å¦‚æœå…ƒç´ æ˜¯ä¸ªå­—ç¬¦ï¼Œé‚£ä¹ˆå°±è¿›å…¥å°ºåº¦é¢„æµ‹æ¨¡å—</span></span><br><span class="line">            <span class="keyword">elif</span> <span class="built_in">isinstance</span>(module, <span class="built_in">str</span>):</span><br><span class="line">                <span class="comment"># å¦‚æœæ˜¯Sï¼Œä»£è¡¨è¦è¿›è¡Œåœ¨æŸä¸€å°ºåº¦ä¸Šçš„é¢„æµ‹äº†</span></span><br><span class="line">                <span class="keyword">if</span> module == <span class="string">&quot;S&quot;</span>:</span><br><span class="line">                    layers += [</span><br><span class="line">                        <span class="comment"># ä¸‹é¢è¿™ä¸‰å—çš„ç½‘ç»œæ¶æ„å‚è€ƒä¸‹é¢é‚£å¼ YOLOv3çš„æ¶æ„å›¾</span></span><br><span class="line">                  <span class="comment"># åŸç ä¸­æ®‹å·®å—åªé‡å¤äº†1æ¬¡ï¼Œä¸ºäº†ä¸ä¸‹é¢æ¶æ„å›¾ä¸­çš„YoloBlockç›¸å¯¹åº”ï¼Œè¿™é‡Œæ”¹ä¸ºé‡å¤2æ¬¡ï¼Œå½±å“ä¸å¤§ï¼Œå› ä¸ºåœ¨æ®‹å·®å—ä¸­ä¸æ”¹å˜å›¾åƒå¤§å°</span></span><br><span class="line">                  <span class="comment"># åŒæ—¶æ³¨æ„æ­¤æ—¶æ®‹å·®å—å…³é—­äº†æ®‹å·®è¿æ¥</span></span><br><span class="line">                        ResidualBlock(in_channels, use_residual=<span class="literal">False</span>, num_repeats=<span class="number">2</span>),</span><br><span class="line">                        CNNBlock(in_channels, in_channels // <span class="number">2</span>, kernel_size=<span class="number">1</span>),</span><br><span class="line">                        ScalePrediction(in_channels // <span class="number">2</span>, num_classes=self.num_classes),</span><br><span class="line">                    ]</span><br><span class="line">                    <span class="comment"># æ›´æ–°ä¸€ä¸‹é€šé“æ•°</span></span><br><span class="line">                    in_channels = in_channels // <span class="number">2</span></span><br><span class="line"></span><br><span class="line">             <span class="comment"># å¦‚æœæ˜¯Uï¼Œåˆ™è¿›å…¥ä¸Šé‡‡æ ·</span></span><br><span class="line">                <span class="keyword">elif</span> module == <span class="string">&quot;U&quot;</span>:</span><br><span class="line">                    layers.append(nn.Upsample(scale_factor=<span class="number">2</span>),)</span><br><span class="line">                    <span class="comment"># é€šé“æ•°å˜ä¸º3å€ï¼ŒåŸå› æ˜¯è¿™ä¸ªåœ°æ–¹è¿›è¡Œäº†é€šé“è¿æ¥concatenationæ“ä½œ</span></span><br><span class="line">               <span class="comment"># ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼Œä¸è¦åœ¨è¿™ä¸ªåœ°æ–¹æ¨å¯¼å›¾åƒåœ¨æ•´ä¸ªæ¨¡å‹ä¸­çš„å¤„ç†è¿‡ç¨‹ï¼Œå› ä¸ºæ­¤æ—¶ä¼šå‘ç°å‰åé€šé“æ•°æ˜¯ä¸ç¬¦çš„ï¼Œå› ä¸ºé€šé“ä¸€ä¸‹ä»256è·³åˆ°äº†768</span></span><br><span class="line">               <span class="comment"># è¿™ä¸ªåœ°æ–¹ä¸æ˜¯forwardå‡½æ•°ï¼Œå¹¶ä¸æ˜¯çœŸæ­£çš„æ•°æ®å¤„ç†è¿‡ç¨‹ï¼Œå¯ä»¥ç†è§£æˆè¿™ä¸ªåœ°æ–¹ä»…æ˜¯æ¨¡å‹æ¶æ„å®šä¹‰</span></span><br><span class="line">                    in_channels = in_channels * <span class="number">3</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> layers</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span>(<span class="params">self, x</span>):</span></span><br><span class="line">        <span class="comment"># æ¯ä¸€ä¸ªå°ºåº¦ä¸‹éƒ½æœ‰ä¸€ä¸ªoutputï¼Œè¿™é‡Œç”¨ä¸€ä¸ªåˆ—è¡¨æ¥æ‰¿è½½ä¸‰ä¸ªoutput</span></span><br><span class="line">        outputs = []</span><br><span class="line">        <span class="comment"># å­˜æ”¾è¿›å…¥ä¸åŒé¢„æµ‹åˆ†æ”¯çš„ä¸­é—´è®¡ç®—ç»“æœ</span></span><br><span class="line">        route_connections = []</span><br><span class="line">        <span class="comment"># å¯¹ç½‘ç»œä¸­çš„æ¯ä¸€å±‚è¿›è¡Œéå†</span></span><br><span class="line">        <span class="keyword">for</span> layer <span class="keyword">in</span> self.layers:</span><br><span class="line">            <span class="comment"># å¦‚æœæ˜¯å°ºåº¦é¢„æµ‹å±‚ï¼Œè¡¨ç¤ºè¿›å…¥æŸä¸€å°ºåº¦çš„é¢„æµ‹é˜¶æ®µï¼Œå³è¿›å…¥æŸä¸€ä¸ªé¢„æµ‹åˆ†æ”¯</span></span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">isinstance</span>(layer, ScalePrediction):</span><br><span class="line">                <span class="comment"># å°†é¢„æµ‹ç»“æœæ·»åŠ è¿›outputsä¸­ï¼Œæ³¨æ„è¿™ä¸ªåœ°æ–¹æ˜¯å¯¹xçš„ä¸€ä¸ªåˆ†å‰è®¡ç®—</span></span><br><span class="line">            <span class="comment"># å³xåœ¨è¿™é‡Œèµ°äº†ä¸¤æ¡è·¯ï¼Œä¸€æ¡è·¯æ˜¯è¿›å…¥å°ºåº¦é¢„æµ‹æ¨¡å—è¿›è¡Œè®¡ç®—ï¼Œå¦ä¸€æ¡è·¯æ˜¯ç»§ç»­å‘†åœ¨ä¸»åˆ†æ”¯ä¸­ï¼Œç”¨äºåç»­è®¡ç®—</span></span><br><span class="line">                outputs.append(layer(x))</span><br><span class="line">                <span class="comment"># è¿”å›åˆ°ä¸»åˆ†æ”¯ä¸­</span></span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">         <span class="comment"># å¯¹å¸¸è§„çš„ç½‘ç»œå±‚è¿›è¡Œè®¡ç®—ï¼ŒåŒ…å«å·ç§¯å—å’Œé‡å¤æ¬¡æ•°ä¸ä¸º8çš„æ®‹å·®å—</span></span><br><span class="line">            x = layer(x)</span><br><span class="line"></span><br><span class="line">         <span class="comment"># å¯¹äºé‡å¤æ¬¡æ•°ä¸º8çš„æ®‹å·®å—ï¼Œç”±æ¶æ„å›¾å¯çŸ¥ï¼Œéƒ½æ˜¯åœ¨è¿™é‡Œè¿›å…¥ä¸åŒçš„å°ºåº¦é¢„æµ‹åˆ†æ”¯</span></span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">isinstance</span>(layer, ResidualBlock) <span class="keyword">and</span> layer.num_repeats == <span class="number">8</span>:</span><br><span class="line">                <span class="comment"># å°†éœ€è¦è¿›å…¥æŸåˆ†æ”¯çš„ç»“æœå­˜æ”¾èµ·æ¥</span></span><br><span class="line">                route_connections.append(x)</span><br><span class="line"></span><br><span class="line">         <span class="comment"># å¦‚æœæ˜¯é‡åˆ°ä¸Šé‡‡æ ·æ¨¡å—</span></span><br><span class="line">            <span class="keyword">elif</span> <span class="built_in">isinstance</span>(layer, nn.Upsample):</span><br><span class="line">                <span class="comment"># å°±ä¼šå°†å½“å‰xä¸å­˜æ”¾ä¸­é—´ç»“æœçš„routeä¸­çš„æœ€åä¸€ä¸ªä¸­é—´ç»“æœè¿›è¡Œè¿æ¥concatenation</span></span><br><span class="line">            <span class="comment"># è¿™ä¸ªåœ°æ–¹ä¼šå°†é€šé“æ•°å˜ä¸º3å€ï¼Œå› ä¸ºä¸Šé‡‡æ ·åçš„å›¾åƒä¸ºn_channelï¼ŒåŸä¸»åˆ†æ”¯ä¸­çš„å›¾åƒä¸º2*n_channelï¼Œè¿æ¥åå°±å˜ä¸º3*n_channel</span></span><br><span class="line">                x = torch.cat([x, route_connections[-<span class="number">1</span>]], dim=<span class="number">1</span>)</span><br><span class="line">                <span class="comment"># ç”¨å®Œæœ€åä¸€ä¸ªå…ƒç´ å°±æŠŠå®ƒä¸¢äº†ï¼Œè¿™æ ·å°±èƒ½åœ¨ä¸‹ä¸€æ¬¡å–åˆ°ä¸Šä¸€ä¸ªå­˜å‚¨çš„ä¸­é—´ç»“æœ</span></span><br><span class="line">                route_connections.pop()</span><br><span class="line"></span><br><span class="line">      <span class="comment"># æœ€ç»ˆoutputsé‡Œæ˜¯å­˜æ”¾äº†ä¸‰ä¸ªå°ºåº¦çš„é¢„æµ‹æ¨¡å‹</span></span><br><span class="line">        <span class="keyword">return</span> outputs</span><br></pre></td></tr></table></figure><br>YOLOv3æ¶æ„å›¾é‡æ–°è´´ä¸€ä¸‹ï¼š<br><img src="https://user-images.githubusercontent.com/6218739/133880395-2f580763-b4fc-4aea-b36e-2d745834a1da.png" alt="yolov3"></p><h2 id="æ•°æ®é›†"><a href="#æ•°æ®é›†" class="headerlink" title="æ•°æ®é›†"></a>æ•°æ®é›†</h2><p>ä½œè€…æä¾›äº†YOLOæ ¼å¼çš„PASCAL VOCå’ŒMS COCOæ•°æ®é›†çš„ä¸‹è½½ï¼Œåˆ†åˆ«åœ¨ä¸‹é¢é“¾æ¥ï¼š<br><a href="https://www.kaggle.com/aladdinpersson/pascal-voc-dataset-used-in-yolov3-video">Pascal voc dataset used in YOLOv3 video</a><br><a href="https://www.kaggle.com/dataset/79abcc2659dc745fddfba1864438afb2fac3fabaa5f37daa8a51e36466db101e">MS-COCO-YOLOv3</a><br>å…³äºæ•°æ®é›†çš„æ ¼å¼å¯ä»¥å‚è§ä¸‹é¢çš„ä»‹ç»ï¼š<br><a href="https://github.com/ultralytics/yolov5/wiki/Train-Custom-Data">Train Custom Data</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">YOLODataset</span>(<span class="params">Dataset</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">        self,</span></span></span><br><span class="line"><span class="function"><span class="params">        csv_file, <span class="comment"># csvæ–‡ä»¶è·¯å¾„</span></span></span></span><br><span class="line"><span class="function"><span class="params">        img_dir, <span class="comment"># å›¾åƒæ–‡ä»¶è·¯å¾„</span></span></span></span><br><span class="line"><span class="function"><span class="params">        label_dir, <span class="comment"># æ ‡ç­¾æ–‡ä»¶è·¯å¾„</span></span></span></span><br><span class="line"><span class="function"><span class="params">        anchors, <span class="comment"># ä¹ä¸ªé”šæ¡†</span></span></span></span><br><span class="line"><span class="function"><span class="params">        image_size=<span class="number">416</span>, <span class="comment"># å›¾åƒå°ºå¯¸</span></span></span></span><br><span class="line"><span class="function"><span class="params">        S=[<span class="number">13</span>, <span class="number">26</span>, <span class="number">52</span>], <span class="comment"># ä¸‰ä¸ªç‰¹å¾å›¾å¤§å°</span></span></span></span><br><span class="line"><span class="function"><span class="params">        C=<span class="number">20</span>, <span class="comment"># ç±»åˆ«æ•°</span></span></span></span><br><span class="line"><span class="function"><span class="params">        transform=<span class="literal">None</span>, <span class="comment"># å›¾åƒå˜æ¢</span></span></span></span><br><span class="line"><span class="function"><span class="params">    </span>):</span></span><br><span class="line">        self.annotations = pd.read_csv(csv_file) <span class="comment"># å›¾åƒå’Œæ ‡ç­¾æˆå¯¹å‡ºç°</span></span><br><span class="line">        self.img_dir = img_dir</span><br><span class="line">        self.label_dir = label_dir</span><br><span class="line">        self.image_size = image_size</span><br><span class="line">        self.transform = transform</span><br><span class="line">        self.S = S</span><br><span class="line">        self.anchors = torch.tensor(anchors[<span class="number">0</span>] + anchors[<span class="number">1</span>] + anchors[<span class="number">2</span>])  <span class="comment"># å°†ä¸‰ä¸ªå°ºåº¦ä¸‹çš„ä¸‰ä¸ªé”šæ¡†è¿èµ·æ¥ï¼Œæ³¨æ„ä¸¤ä¸ªlistç›¸åŠ å°±æ˜¯joinçš„æ•ˆæœ</span></span><br><span class="line">        self.num_anchors = self.anchors.shape[<span class="number">0</span>]</span><br><span class="line">        self.num_anchors_per_scale = self.num_anchors // <span class="number">3</span></span><br><span class="line">        self.C = C</span><br><span class="line">        self.ignore_iou_thresh = <span class="number">0.5</span> <span class="comment"># è¿™ä¸ªé˜ˆå€¼ç”¨æ¥åŒºåˆ†å¿½ç•¥æ ·ä¾‹å’Œè´Ÿä¾‹ï¼Œè¯¦è§ä¸Šé¢çš„è§£æ</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__len__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">len</span>(self.annotations)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getitem__</span>(<span class="params">self, index</span>):</span></span><br><span class="line">        label_path = os.path.join(self.label_dir, self.annotations.iloc[index, <span class="number">1</span>]) <span class="comment"># 1å°±æ˜¯ä»£è¡¨ç¬¬äºŒåˆ—ï¼Œå³æ ‡ç­¾åˆ—</span></span><br><span class="line">        bboxes = np.roll(np.loadtxt(fname=label_path, delimiter=<span class="string">&quot; &quot;</span>, ndmin=<span class="number">2</span>), <span class="number">4</span>, axis=<span class="number">1</span>).tolist() <span class="comment"># å¾—åˆ°çš„è¾¹ç•Œæ¡†æ ¼å¼ä¸º(x, y, w, h, ç±»åˆ«)</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># è¯»å…¥å›¾åƒæ–‡ä»¶</span></span><br><span class="line">        img_path = os.path.join(self.img_dir, self.annotations.iloc[index, <span class="number">0</span>])</span><br><span class="line">        image = np.array(Image.<span class="built_in">open</span>(img_path).convert(<span class="string">&quot;RGB&quot;</span>))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># å›¾åƒå¢å¼ºå˜æ¢</span></span><br><span class="line">        <span class="keyword">if</span> self.transform:</span><br><span class="line">            augmentations = self.transform(image=image, bboxes=bboxes)</span><br><span class="line">            image = augmentations[<span class="string">&quot;image&quot;</span>]</span><br><span class="line">            bboxes = augmentations[<span class="string">&quot;bboxes&quot;</span>]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># æœ€ç»ˆç›®æ ‡æ˜¯åœ¨ä¸‰ä¸ªç‰¹å¾å›¾å°ºåº¦ä¸Šï¼Œæ¯ä¸ªå°ºåº¦çš„æ¯ä¸ªæ ¼ç‚¹ä¸Šéƒ½æœ‰(self.num_anchors // 3)ä¸ªé¢„æµ‹æ¡†ï¼Œæ¯ä¸ªé¢„æµ‹æ¡†ä¸Šéƒ½æœ‰6ä¸ªåˆ†é‡ï¼Œå³[ç½®ä¿¡åº¦æ ‡ç­¾, x, y, w, h, ç±»åˆ«]</span></span><br><span class="line">        <span class="comment"># ç½®ä¿¡åº¦æ ‡ç­¾ä¸º1ï¼Œä»£è¡¨æ­£ä¾‹ï¼›æ ‡ç­¾ä¸º-1ï¼Œä»£è¡¨å¿½ç•¥æ ·ä¾‹ï¼›æ ‡ç­¾ä¸º0ï¼Œä»£è¡¨è´Ÿä¾‹ã€‚</span></span><br><span class="line">        targets = [torch.zeros((self.num_anchors // <span class="number">3</span>, S, S, <span class="number">6</span>)) <span class="keyword">for</span> S <span class="keyword">in</span> self.S]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># å¯¹è¯¥å›¾åƒä¸­çš„æ‰€æœ‰çš„è¾¹ç•Œæ¡†è¿›è¡Œå¾ªç¯ï¼Œç›®çš„æ˜¯ä¸ºäº†ç¡®å®šå“ªä¸ªé”šæ¡†ã€å“ªä¸ªæ ¼ç‚¹ä¸å…¶å¯¹åº”</span></span><br><span class="line">        <span class="keyword">for</span> box <span class="keyword">in</span> bboxes: </span><br><span class="line">            <span class="comment"># ç¡®å®šä¸è¾¹ç•Œæ¡†å¯¹åº”çš„é”šæ¡†æ˜¯é€šè¿‡è®¡ç®—ä¸¤è€…ä¹‹é—´çš„IoU</span></span><br><span class="line">            <span class="comment"># boxçš„ç¬¬2ã€3å…ƒç´ å°±æ˜¯å®½åº¦å’Œé«˜åº¦</span></span><br><span class="line">            <span class="comment"># è¿™é‡Œçš„IoUè®¡ç®—ç›¸å½“äºå°†é”šæ¡†å’Œè¾¹ç•Œæ¡†çš„ä¸­å¿ƒæ”¾åœ¨ä¸€å—ï¼Œç„¶åæ ¹æ®å®ƒä»¬çš„å®½é«˜æ¥è®¡ç®—</span></span><br><span class="line">            <span class="comment"># å³ä¸ºäº†ç¡®å®šå“ªä¸€ç§å½¢çŠ¶çš„é”šæ¡†ä¸è¯¥è¾¹ç•Œæ¡†æœ€ç›¸è¿‘</span></span><br><span class="line">            iou_anchors = iou(torch.tensor(box[<span class="number">2</span>:<span class="number">4</span>]), self.anchors)</span><br><span class="line">            <span class="comment"># æ‰¾å‡ºé‡åˆåº¦æœ€å¤§çš„å³æœ€å¥½çš„é”šæ¡†</span></span><br><span class="line">            anchor_indices = iou_anchors.argsort(descending=<span class="literal">True</span>, dim=<span class="number">0</span>)</span><br><span class="line">            <span class="comment"># å–å‡ºè¯¥è¾¹ç•Œæ¡†çš„x, y, w, h</span></span><br><span class="line">            x, y, width, height, class_label = box</span><br><span class="line">            <span class="comment"># ä¸‹é¢è¿™ä¸ªåˆ—è¡¨åˆå§‹åŒ–ä¸ºFalseï¼Œä½†æœ€ç»ˆç›®çš„æ˜¯å˜ä¸ºTrueï¼Œå³ä¿è¯åœ¨æ¯ä¸ªå°ºåº¦ä¸‹è¯¥è¾¹ç•Œæ¡†éƒ½æœ‰å¯¹åº”çš„é”šæ¡†</span></span><br><span class="line">            has_anchor = [<span class="literal">False</span>] * <span class="number">3</span>  <span class="comment"># each scale should have one anchor</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># å› ä¸ºä¸€å…±æœ‰9ä¸ªé”šæ¡†ï¼Œä½†åˆ†å¸ƒåœ¨3ä¸ªå°ºåº¦ä¸‹ï¼Œä¸‹é¢å°±æ˜¯å°†å…·ä½“çš„é”šæ¡†ä¸å®ƒæ‰€å±çš„å°ºåº¦å¯¹åº”èµ·æ¥ï¼Œå³æ‰¾åˆ°åœ¨æ¯ä¸ªå°ºåº¦ä¸‹çš„æœ€å¥½çš„é”šæ¡†æ˜¯å“ªä¸ªï¼Œå°†å…¶åˆ¤æ–­ä¸ºæ­£ä¾‹ï¼Œå…¶ä»–ä¸å¥½çš„é”šæ¡†è¿›ä¸€æ­¥åˆ¤æ–­ä¸ºè´Ÿä¾‹è¿˜æ˜¯å¿½ç•¥æ ·ä¾‹</span></span><br><span class="line">            <span class="comment"># å³å¯¹æ‰€æœ‰çš„é”šæ¡†éƒ½ä¼šåšåˆ¤æ–­ï¼Œæ­£ä¾‹çš„é”šæ¡†å°±ä¼šè®¡ç®—ç½®ä¿¡åº¦lossã€æ£€æµ‹æ¡†lossã€ç±»åˆ«lossï¼Œè´Ÿä¾‹åªä¼šè®¡ç®—ç½®ä¿¡åº¦lossï¼Œå¿½ç•¥æ ·ä¾‹åˆ™ä»€ä¹ˆlosséƒ½ä¸è®¡ç®—</span></span><br><span class="line">            <span class="comment"># å…ˆä»9ä¸ªé”šæ¡†ä¸­é‡åˆåº¦æœ€å¤§çš„é”šæ¡†å¼€å§‹è¿›è¡Œå¾ªç¯</span></span><br><span class="line">            <span class="keyword">for</span> anchor_idx <span class="keyword">in</span> anchor_indices:</span><br><span class="line">                <span class="comment"># æ ¹æ®é”šæ¡†çš„ç´¢å¼•å’Œæ¯ä¸ªå°ºåº¦ä¸‹æ‹¥æœ‰çš„é”šæ¡†æ•°é‡ï¼Œå°±å¯ä»¥ç¡®å®šé”šæ¡†æ‰€åœ¨çš„å°ºåº¦</span></span><br><span class="line">                <span class="comment"># æ¯”å¦‚å¦‚æœé”šæ¡†ç´¢å¼•ä¸º8ï¼Œä¸”æ¯ä¸ªå°ºåº¦ä¸‹æœ‰3ä¸ªé”šæ¡†ï¼Œé‚£ä¹ˆscale_idxå°±æ˜¯2ï¼Œå³ç¬¬3ä¸ªå°ºåº¦ï¼Œå› æ­¤scale_idxå°±æ˜¯è¯¥é”šæ¡†æ‰€å±çš„å°ºåº¦çš„ç´¢å¼•</span></span><br><span class="line">                scale_idx = anchor_idx // self.num_anchors_per_scale</span><br><span class="line">                <span class="comment"># ä¸Šè¿°é”šæ¡†ç´¢å¼•ä¸º8ï¼ŒæŒ‡çš„æ˜¯è¯¥é”šæ¡†åœ¨æ‰€æœ‰é”šæ¡†ä¸­çš„ç´¢å¼•ï¼Œä¸‹é¢å°±æ˜¯è®¡ç®—è¯¥é”šæ¡†åœ¨è¯¥å°ºåº¦ä¸‹çš„ç´¢å¼•ï¼Œå³anchor_on_scaleå°±æ˜¯2ï¼Œä¹Ÿå°±æ˜¯è¯¥å°ºåº¦ä¸‹è¯¥é”šæ¡†æ˜¯ç¬¬3ä¸ª</span></span><br><span class="line">                anchor_on_scale = anchor_idx % self.num_anchors_per_scale</span><br><span class="line">                <span class="comment"># è·å–è¯¥å°ºåº¦ä¸‹çš„grid cellçš„ä¸ªæ•°ï¼Œå³æ ¼ç‚¹ä¸ªæ•°</span></span><br><span class="line">                S = self.S[scale_idx]</span><br><span class="line">                <span class="comment"># æé†’ä¸€ä¸‹ï¼šè¾¹ç•Œæ¡†çš„xå’Œyåæ ‡æ˜¯å…¶ä¸­å¿ƒç›¸å¯¹äºæ•´å¼ å›¾åƒçš„ä½ç½®</span></span><br><span class="line">                <span class="comment"># ä¸‹é¢å°±æ˜¯è®¡ç®—è¾¹ç•Œæ¡†å±äºå›¾åƒä¸­çš„å“ªä¸ªæ ¼ç‚¹</span></span><br><span class="line">                <span class="comment"># æ¯”å¦‚å‡è®¾æ•´ä¸ªå›¾åƒå®½ä¸ºWï¼Œé‚£ä¹ˆè¾¹ç•Œæ¡†ç»å¯¹ä½ç½®å°±åœ¨W*xï¼Œè€Œæ¯ä¸ªæ ¼ç‚¹çš„å®½åº¦ä¸ºW/Sï¼Œé‚£ä¹ˆåœ¨å“ªä¸ªæ ¼ç‚¹å°±æ˜¯W*x/(W/S)=S*x</span></span><br><span class="line">                <span class="comment"># è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯xæ˜¯å®½ï¼Œä½†åœ¨çŸ©é˜µä¸­æ˜¯åˆ—ï¼Œå³j,</span></span><br><span class="line">                <span class="comment"># è€Œyæ˜¯é«˜ï¼Œåœ¨çŸ©é˜µä¸­æ˜¯è¡Œï¼Œå³i</span></span><br><span class="line">                i, j = <span class="built_in">int</span>(S * y), <span class="built_in">int</span>(S * x)  <span class="comment"># which cell</span></span><br><span class="line">                <span class="comment"># ä¸‹é¢è¿™ä¸€è¡Œå°±æ˜¯å¯¹äºè¿™ä¸€è¾¹ç•Œæ¡†ï¼Œå–å‡ºæŸä¸€å°ºåº¦ä¸‹çš„é”šæ¡†ã€æ ¼ç‚¹åŠç½®ä¿¡åº¦ï¼ˆ0å…ƒç´ å°±æ˜¯ä»£è¡¨æ˜¯ä¸€ä¸ªç‰©ä½“çš„å¯èƒ½æ€§å³ç½®ä¿¡åº¦ï¼‰</span></span><br><span class="line">                <span class="comment"># åˆšå¼€å§‹anchor_takenéƒ½æ˜¯0ï¼Œè¡¨æ˜åœ¨è¯¥å°ºåº¦çš„è¯¥é”šæ¡†æ²¡æœ‰è¢«å–èµ°æˆ–è¯´æ²¡æœ‰è¢«åˆ¤æ–­ï¼Œé0çš„è¯åˆæœ‰ä¸¤ç§ï¼Œ1æ˜¯ä»£è¡¨æ˜¯æ­£ä¾‹ï¼Œ-1ä»£è¡¨æ˜¯å¿½ç•¥æ ·ä¾‹</span></span><br><span class="line">                anchor_taken = targets[scale_idx][anchor_on_scale, i, j, <span class="number">0</span>]</span><br><span class="line">                <span class="comment"># å¦‚æœè¯¥å°ºåº¦ä¸‹ï¼ˆæˆ–ç§°è¯¥æ ¼ç‚¹ï¼‰çš„è¯¥é”šæ¡†æ²¡æœ‰è¢«åˆ¤æ–­ï¼Œä¸”è¯¥å°ºåº¦ä¸Šä¹‹å‰æ²¡æœ‰ç¡®å®šé”šæ¡†ï¼ˆå³è¿˜æ²¡æœ‰å‡ºç°æ­£ä¾‹ï¼‰</span></span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> anchor_taken <span class="keyword">and</span> <span class="keyword">not</span> has_anchor[scale_idx]:</span><br><span class="line">                    <span class="comment"># å°±æŠŠç¬¬0ä¸ªå…ƒç´ ï¼Œå³æ˜¯ä¸€ä¸ªç‰©ä½“çš„ç½®ä¿¡åº¦ç½®ä¸º1</span></span><br><span class="line">                    targets[scale_idx][anchor_on_scale, i, j, <span class="number">0</span>] = <span class="number">1</span></span><br><span class="line">                    <span class="comment"># è®¡ç®—è¾¹ç•Œæ¡†çš„ä¸­å¿ƒåœ¨æ ¼ç‚¹ä¸­çš„ç›¸å¯¹ä½ç½®</span></span><br><span class="line">                    x_cell, y_cell = S * x - j, S * y - i  <span class="comment"># both between [0,1]</span></span><br><span class="line">                    <span class="comment"># è®¡ç®—è¾¹ç•Œæ¡†çš„å®½é«˜ç›¸å¯¹äºæ ¼ç‚¹çš„å¤§å°</span></span><br><span class="line">                    <span class="comment"># ä»ç„¶å‡è®¾æ•´å¼ å›¾åƒå®½ä¸ºWï¼Œè¾¹ç•Œæ¡†çš„ç»å¯¹å®½åº¦å°±æ˜¯W*widthï¼Œé‚£ä¹ˆå®ƒç›¸å¯¹äºæ ¼ç‚¹çš„å¤§å°å°±æ˜¯W*width/(W/S)=width*S</span></span><br><span class="line">                    width_cell, height_cell = (</span><br><span class="line">                        width * S,</span><br><span class="line">                        height * S,</span><br><span class="line">                    )  <span class="comment"># can be greater than 1 since it&#x27;s relative to cell</span></span><br><span class="line">                    box_coordinates = torch.tensor(</span><br><span class="line">                        [x_cell, y_cell, width_cell, height_cell]</span><br><span class="line">                    )</span><br><span class="line">                    <span class="comment"># ç„¶åæŠŠä¸Šé¢çš„è¾¹ç•Œæ¡†ç›¸å¯¹äºæ ¼ç‚¹çš„ç›¸å¯¹ä½ç½®å’Œç›¸å¯¹å¤§å°ä¿¡æ¯éƒ½å­˜å‚¨åˆ°targetsç›¸åº”å…ƒç´ ä¸­ï¼Œä¸å…·ä½“çš„å°ºåº¦ã€é”šæ¡†å’Œæ ¼ç‚¹è¿›è¡ŒåŒ¹é…ã€‚</span></span><br><span class="line">                    targets[scale_idx][anchor_on_scale, i, j, <span class="number">1</span>:<span class="number">5</span>] = box_coordinates</span><br><span class="line">                    <span class="comment"># å°†ç‰©ä½“ç±»åˆ«ä¹Ÿå­˜å‚¨åˆ°ç›¸åº”å…ƒç´ </span></span><br><span class="line">                    targets[scale_idx][anchor_on_scale, i, j, <span class="number">5</span>] = <span class="built_in">int</span>(class_label)</span><br><span class="line">                    <span class="comment"># å°†è¯¥å°ºåº¦ä¸‹æ˜¯å¦ç¡®å®šäº†é”šæ¡†ç½®ä¸ºTrueï¼Œå³è¯¥é”šæ¡†ä¸ºæ­£ä¾‹</span></span><br><span class="line">                    has_anchor[scale_idx] = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">                <span class="comment"># å¦‚æœå·²ç»å‡ºç°äº†æ­£ä¾‹ï¼Œä½†è¯¥é”šæ¡†è¿˜æ²¡æœ‰è¢«åˆ¤æ–­ï¼Œå³anchor_taken=0</span></span><br><span class="line">                <span class="comment"># æ­¤æ—¶å†åˆ¤æ–­è¯¥é”šæ¡†ä¸è¾¹ç•Œæ¡†çš„IoUæ˜¯å¦å¤§äºé˜ˆå€¼ï¼Œå¦‚æœå¤§äºé˜ˆå€¼ï¼Œä¸”å› ä¸ºå…¶ä¸æ˜¯æ­£ä¾‹ï¼Œé‚£ä¹ˆå°±å°†å…¶ç½®ä¿¡åº¦æ ‡ç­¾ç½®ä¸º-1ï¼Œå³å®ƒä¸ºå¿½ç•¥æ ·ä¾‹ï¼Œä¸å‚ä¸æŸå¤±è®¡ç®—</span></span><br><span class="line">                <span class="comment"># è¿™ç§æƒ…å†µå‡ºç°åœ¨åœ¨è¯¥å°ºåº¦ä¸Šï¼ˆæˆ–ç§°åœ¨è¯¥æ ¼ç‚¹ä¸Šï¼‰ï¼Œæœ‰å¤šä¸ªé”šæ¡†éƒ½èƒ½ä¸è¾¹ç•Œæ¡†å»åˆè¾ƒå¥½ï¼Œä½†åªå–æœ€å¥½çš„é‚£ä¸ª</span></span><br><span class="line">                <span class="comment"># ä½†å¦‚æœIoUå°äºé˜ˆå€¼ï¼Œé‚£ä¹ˆå…¶ç½®ä¿¡åº¦æ ‡ç­¾ä»ä¸º0ï¼Œä»£è¡¨è´Ÿä¾‹ï¼Œä¼šäº§ç”Ÿç½®ä¿¡åº¦lossï¼Œä½†ä¸ä¼šäº§ç”Ÿå…¶ä»–ç±»å‹çš„æŸå¤±</span></span><br><span class="line">                <span class="keyword">elif</span> <span class="keyword">not</span> anchor_taken <span class="keyword">and</span> iou_anchors[anchor_idx] &gt; self.ignore_iou_thresh:</span><br><span class="line">                    targets[scale_idx][anchor_on_scale, i, j, <span class="number">0</span>] = -<span class="number">1</span>  <span class="comment"># ignore prediction</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> image, <span class="built_in">tuple</span>(targets)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="æŸå¤±è®¡ç®—"><a href="#æŸå¤±è®¡ç®—" class="headerlink" title="æŸå¤±è®¡ç®—"></a>æŸå¤±è®¡ç®—</h2><p>YOLOv3ä¸­çš„æŸå¤±æœ‰ä¸‰ç§ï¼Œä¸€ç§æ˜¯xywhå¸¦æ¥çš„è¯¯å·®ï¼Œå³æ£€æµ‹æ¡†lossï¼›ä¸€ç§æ˜¯ç½®ä¿¡åº¦å¸¦æ¥çš„è¯¯å·®ï¼Œå³æ˜¯å¦æ˜¯ä¸ªç‰©ä½“objå¸¦æ¥çš„lossï¼Œç§°ä¸ºç½®ä¿¡åº¦lossï¼›ä¸€ç§æ˜¯ç±»åˆ«å¸¦æ¥çš„è¯¯å·®ï¼Œç§°ä¸ºç±»åˆ«lossã€‚<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">YoloLoss</span>(<span class="params">nn.Module</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        self.mse = nn.MSELoss() <span class="comment"># å‡æ–¹å·®æŸå¤±è®¡ç®—</span></span><br><span class="line">        self.bce = nn.BCEWithLogitsLoss() <span class="comment"># åŠ äº†Sigmoidçš„äºŒè¿›åˆ¶äº¤å‰ç†µæŸå¤±</span></span><br><span class="line">        self.entropy = nn.CrossEntropyLoss() <span class="comment"># äº¤å‰ç†µæŸå¤±</span></span><br><span class="line">        self.sigmoid = nn.Sigmoid() </span><br><span class="line"></span><br><span class="line">        <span class="comment"># ç¡®å®šæŸå¤±å‡½æ•°ä¸­çš„å„ä¸ªæƒé‡å¸¸æ•°ï¼Œç”¨æ¥æ§åˆ¶ä¸åŒlossä¹‹é—´çš„æ¯”ä¾‹</span></span><br><span class="line">        self.lambda_class = <span class="number">1</span> <span class="comment"># ç±»åˆ«æŸå¤±æƒé‡å¸¸æ•°</span></span><br><span class="line">        self.lambda_noobj = <span class="number">10</span> <span class="comment"># è´Ÿä¾‹æŸå¤±æƒé‡å¸¸æ•°</span></span><br><span class="line">        self.lambda_obj = <span class="number">1</span> <span class="comment"># æ­£ä¾‹æŸå¤±æƒé‡å¸¸æ•°</span></span><br><span class="line">        self.lambda_box = <span class="number">10</span> <span class="comment"># æ£€æµ‹æ¡†æŸå¤±æƒé‡å¸¸æ•°</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span>(<span class="params">self, predictions, target, anchors</span>):</span></span><br><span class="line">        <span class="comment"># åˆ¤æ–­æ¯ä¸ªå°ºåº¦ä¸Šçš„æ ¼ç‚¹ä¸Šæ˜¯å¦æ˜¯ç‰©ä½“ï¼Œå³æ­£ä¾‹è¿˜æ˜¯è´Ÿä¾‹</span></span><br><span class="line">        <span class="comment"># 1ä¸ºæ­£ä¾‹ï¼Œ0ä¸ºè´Ÿä¾‹ï¼Œ-1åˆ™ä¸ºå¿½ç•¥æ ·ä¾‹</span></span><br><span class="line">        obj = target[..., <span class="number">0</span>] == <span class="number">1</span>  <span class="comment"># in paper this is Iobj_i</span></span><br><span class="line">        noobj = target[..., <span class="number">0</span>] == <span class="number">0</span>  <span class="comment"># in paper this is Inoobj_i</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># ======================= #</span></span><br><span class="line">        <span class="comment">#   è´Ÿä¾‹é€ æˆçš„ç½®ä¿¡åº¦æŸå¤±    #</span></span><br><span class="line">        <span class="comment"># ======================= #</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># ä½¿ç”¨äºŒè¿›åˆ¶äº¤å‰ç†µè®¡ç®—æŸå¤±</span></span><br><span class="line">        no_object_loss = self.bce(</span><br><span class="line">            <span class="comment"># å–å‡ºç½®ä¿¡åº¦æ•°å€¼ï¼Œå³ç¬¬0ä¸ªå…ƒç´ </span></span><br><span class="line">            <span class="comment"># è¿™é‡Œä½¿ç”¨0:1çš„å½¢å¼ï¼Œè€Œä¸æ˜¯ç›´æ¥ä½¿ç”¨0æ¥å–å¾—å…ƒç´ ï¼Œæ˜¯ä¸ºäº†ä¿æŒç»´åº¦ä¸å˜</span></span><br><span class="line">            <span class="comment"># [noobj] æ˜¯ä½¿ç”¨äº†numpyçš„å¸ƒå°”ç´¢å¼•ï¼Œä»è€Œå–å‡ºé‚£äº›è´Ÿä¾‹</span></span><br><span class="line">            (predictions[..., <span class="number">0</span>:<span class="number">1</span>][noobj]), (target[..., <span class="number">0</span>:<span class="number">1</span>][noobj]),</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        <span class="comment"># ==================== #</span></span><br><span class="line">        <span class="comment">#   æ­£ä¾‹é€ æˆçš„ç½®ä¿¡åº¦æŸå¤± #</span></span><br><span class="line">        <span class="comment"># ==================== #</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># è¿™ä¸ªåœ°æ–¹æ­£ä¾‹æŸå¤±æŒ‰ä¸Šé¢çš„è§£æåº”è¯¥ä½¿ç”¨ä¸€ä¸ªç®€å•çš„bceå³å¯ï¼ŒåŒæ—¶ç½®ä¿¡åº¦æ ‡ç­¾åœ¨yolov3ä¸­æ˜¯1å’Œ0äºŒåˆ†ç±»ï¼Œè€Œè¿™é‡ŒåŸä½œè€…ä½¿ç”¨çš„æ˜¯IoUæ¥ä½œä¸ºç½®ä¿¡åº¦æ ‡ç­¾ï¼Œå³å¦‚ä¸‹å½¢å¼ï¼š</span></span><br><span class="line">        object_loss = self.bce(</span><br><span class="line">            (predictions[..., <span class="number">0</span>:<span class="number">1</span>][obj]), (target[..., <span class="number">0</span>:<span class="number">1</span>][obj]),</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        <span class="comment"># # åŸæ¥çš„ä»£ç ä¸­æ˜¯å¦‚ä¸‹å½¢å¼ï¼Œè¿™é‡Œå…ˆä¸ä»”ç»†ç ”ç©¶å¼‚åŒäº†</span></span><br><span class="line">        <span class="comment"># anchors = anchors.reshape(1, 3, 1, 1, 2)</span></span><br><span class="line">        <span class="comment"># box_preds = torch.cat([self.sigmoid(predictions[..., 1:3]), torch.exp(predictions[..., 3:5]) * anchors], dim=-1)</span></span><br><span class="line">        <span class="comment"># ious = intersection_over_union(box_preds[obj], target[..., 1:5][obj]).detach()</span></span><br><span class="line">        <span class="comment"># object_loss = self.mse(self.sigmoid(predictions[..., 0:1][obj]), ious * target[..., 0:1][obj])</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># ======================== #</span></span><br><span class="line">        <span class="comment">#  æ£€æµ‹æ¡†æŸå¤±               #</span></span><br><span class="line">        <span class="comment"># ======================== #</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># è¿™ä¸ªåœ°æ–¹æ¶‰åŠæ£€æµ‹æ¡†çš„è§£ç éƒ¨åˆ†</span></span><br><span class="line">        <span class="comment"># æ³¨æ„åªå–å‡ºæ­£ä¾‹é€ æˆçš„æŸå¤±</span></span><br><span class="line">        predictions[..., <span class="number">1</span>:<span class="number">3</span>] = self.sigmoid(predictions[..., <span class="number">1</span>:<span class="number">3</span>])  <span class="comment"># x, yåæ ‡</span></span><br><span class="line">        target[..., <span class="number">3</span>:<span class="number">5</span>] = torch.log(</span><br><span class="line">            (<span class="number">1e-16</span> + target[..., <span class="number">3</span>:<span class="number">5</span>] / anchors)</span><br><span class="line">        )  <span class="comment"># width, height coordinates</span></span><br><span class="line">        box_loss = self.mse(predictions[..., <span class="number">1</span>:<span class="number">5</span>][obj], target[..., <span class="number">1</span>:<span class="number">5</span>][obj])</span><br><span class="line"></span><br><span class="line">        <span class="comment"># ================== #</span></span><br><span class="line">        <span class="comment">#   ç±»åˆ«æŸå¤±   #</span></span><br><span class="line">        <span class="comment"># ================== #</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># è®¡ç®—äº¤å‰ç†µæŸå¤±ï¼Œæ³¨æ„åªå–å‡ºæ­£ä¾‹é€ æˆçš„æŸå¤±</span></span><br><span class="line">        class_loss = self.entropy(</span><br><span class="line">            (predictions[..., <span class="number">5</span>:][obj]), (target[..., <span class="number">5</span>][obj].long()),</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        <span class="comment">#print(&quot;__________________________________&quot;)</span></span><br><span class="line">        <span class="comment">#print(self.lambda_box * box_loss)</span></span><br><span class="line">        <span class="comment">#print(self.lambda_obj * object_loss)</span></span><br><span class="line">        <span class="comment">#print(self.lambda_noobj * no_object_loss)</span></span><br><span class="line">        <span class="comment">#print(self.lambda_class * class_loss)</span></span><br><span class="line">        <span class="comment">#print(&quot;\n&quot;)</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            self.lambda_box * box_loss</span><br><span class="line">            + self.lambda_obj * object_loss</span><br><span class="line">            + self.lambda_noobj * no_object_loss</span><br><span class="line">            + self.lambda_class * class_loss</span><br><span class="line">        )</span><br></pre></td></tr></table></figure></p><h2 id="è¶…å‚æ•°é…ç½®æ–‡ä»¶"><a href="#è¶…å‚æ•°é…ç½®æ–‡ä»¶" class="headerlink" title="è¶…å‚æ•°é…ç½®æ–‡ä»¶"></a>è¶…å‚æ•°é…ç½®æ–‡ä»¶</h2><p>æ­¤å¤„å°±æ˜¯å°†è¶…å‚æ•°é…ç½®éƒ½æ‘˜å‡ºæ¥æ”¾åœ¨ä¸€ä¸ªç»Ÿä¸€çš„é…ç½®æ–‡ä»¶ä¸­ã€‚<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">DATASET = <span class="string">&#x27;PASCAL_VOC&#x27;</span></span><br><span class="line">DEVICE = <span class="string">&quot;cuda&quot;</span> <span class="keyword">if</span> torch.cuda.is_available() <span class="keyword">else</span> <span class="string">&quot;cpu&quot;</span></span><br><span class="line"><span class="comment"># seed_everything()  # If you want deterministic behavior</span></span><br><span class="line">NUM_WORKERS = <span class="number">4</span></span><br><span class="line">BATCH_SIZE = <span class="number">32</span></span><br><span class="line">IMAGE_SIZE = <span class="number">416</span></span><br><span class="line">NUM_CLASSES = <span class="number">20</span> <span class="comment">#ç±»åˆ«æ•°</span></span><br><span class="line">LEARNING_RATE = <span class="number">1e-5</span></span><br><span class="line">WEIGHT_DECAY = <span class="number">1e-4</span></span><br><span class="line">NUM_EPOCHS = <span class="number">100</span></span><br><span class="line">CONF_THRESHOLD = <span class="number">0.05</span></span><br><span class="line">MAP_IOU_THRESH = <span class="number">0.5</span></span><br><span class="line">NMS_IOU_THRESH = <span class="number">0.45</span></span><br><span class="line">S = [IMAGE_SIZE // <span class="number">32</span>, IMAGE_SIZE // <span class="number">16</span>, IMAGE_SIZE // <span class="number">8</span>]</span><br><span class="line">PIN_MEMORY = <span class="literal">True</span></span><br><span class="line">LOAD_MODEL = <span class="literal">True</span></span><br><span class="line">SAVE_MODEL = <span class="literal">True</span></span><br><span class="line">CHECKPOINT_FILE = <span class="string">&quot;checkpoint.pth.tar&quot;</span></span><br><span class="line">IMG_DIR = DATASET + <span class="string">&quot;/images/&quot;</span></span><br><span class="line">LABEL_DIR = DATASET + <span class="string">&quot;/labels/&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é€šè¿‡åœ¨è®­ç»ƒé›†ä¸Škmeansèšç±»å¾—åˆ°çš„é”šæ¡†çš„å¤§å°</span></span><br><span class="line">ANCHORS = [</span><br><span class="line">    [(<span class="number">0.28</span>, <span class="number">0.22</span>), (<span class="number">0.38</span>, <span class="number">0.48</span>), (<span class="number">0.9</span>, <span class="number">0.78</span>)],</span><br><span class="line">    [(<span class="number">0.07</span>, <span class="number">0.15</span>), (<span class="number">0.15</span>, <span class="number">0.11</span>), (<span class="number">0.14</span>, <span class="number">0.29</span>)],</span><br><span class="line">    [(<span class="number">0.02</span>, <span class="number">0.03</span>), (<span class="number">0.04</span>, <span class="number">0.07</span>), (<span class="number">0.08</span>, <span class="number">0.06</span>)],</span><br><span class="line">]  <span class="comment"># Note these have been rescaled to be between [0, 1]</span></span><br></pre></td></tr></table></figure></p><h2 id="è®­ç»ƒå‡½æ•°"><a href="#è®­ç»ƒå‡½æ•°" class="headerlink" title="è®­ç»ƒå‡½æ•°"></a>è®­ç»ƒå‡½æ•°</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">train_fn</span>(<span class="params">train_loader, model, optimizer, loss_fn, scaler, scaled_anchors</span>):</span></span><br><span class="line">    <span class="comment"># æ˜¾ç¤ºè¿›åº¦æ¡</span></span><br><span class="line">    loop = tqdm(train_loader, leave=<span class="literal">True</span>)</span><br><span class="line">    losses = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> batch_idx, (x, y) <span class="keyword">in</span> <span class="built_in">enumerate</span>(loop):</span><br><span class="line">        x = x.to(config.DEVICE)</span><br><span class="line">        <span class="comment"># ä¸‰ä¸ªä¸åŒå°ºåº¦ä¸‹çš„ç›®æ ‡</span></span><br><span class="line">        y0, y1, y2 = (</span><br><span class="line">            y[<span class="number">0</span>].to(config.DEVICE),</span><br><span class="line">            y[<span class="number">1</span>].to(config.DEVICE),</span><br><span class="line">            y[<span class="number">2</span>].to(config.DEVICE),</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        <span class="keyword">with</span> torch.cuda.amp.autocast():</span><br><span class="line">            out = model(x)</span><br><span class="line">            <span class="comment"># å‰é¢çš„æŸå¤±å‡½æ•°éœ€è¦åœ¨ä¸‰ä¸ªå°ºåº¦ä¸‹éƒ½è¦è®¡ç®—ä¸€é</span></span><br><span class="line">            loss = (</span><br><span class="line">                loss_fn(out[<span class="number">0</span>], y0, scaled_anchors[<span class="number">0</span>])</span><br><span class="line">                + loss_fn(out[<span class="number">1</span>], y1, scaled_anchors[<span class="number">1</span>])</span><br><span class="line">                + loss_fn(out[<span class="number">2</span>], y2, scaled_anchors[<span class="number">2</span>])</span><br><span class="line">            )</span><br><span class="line"></span><br><span class="line">        losses.append(loss.item())</span><br><span class="line">        optimizer.zero_grad()</span><br><span class="line">        scaler.scale(loss).backward()</span><br><span class="line">        scaler.step(optimizer)</span><br><span class="line">        scaler.update()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># update progress bar</span></span><br><span class="line">        mean_loss = <span class="built_in">sum</span>(losses) / <span class="built_in">len</span>(losses)</span><br><span class="line">        loop.set_postfix(loss=mean_loss)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    <span class="comment"># å®šä¹‰æ¨¡å‹</span></span><br><span class="line">    model = YOLOv3(num_classes=config.NUM_CLASSES).to(config.DEVICE)</span><br><span class="line">    <span class="comment"># ä¼˜åŒ–å™¨</span></span><br><span class="line">    optimizer = optim.Adam(</span><br><span class="line">        model.parameters(), lr=config.LEARNING_RATE, weight_decay=config.WEIGHT_DECAY</span><br><span class="line">    )</span><br><span class="line">    <span class="comment"># æŸå¤±å‡½æ•°</span></span><br><span class="line">    loss_fn = YoloLoss()</span><br><span class="line">    scaler = torch.cuda.amp.GradScaler()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ•°æ®åŠ è½½å™¨</span></span><br><span class="line">    train_loader, test_loader, train_eval_loader = get_loaders(</span><br><span class="line">        train_csv_path=config.DATASET + <span class="string">&quot;/train.csv&quot;</span>, test_csv_path=config.DATASET + <span class="string">&quot;/test.csv&quot;</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å¯ä»¥åŠ è½½å·²è®­ç»ƒå¥½çš„æ¨¡å‹</span></span><br><span class="line">    <span class="keyword">if</span> config.LOAD_MODEL:</span><br><span class="line">        load_checkpoint(</span><br><span class="line">            config.CHECKPOINT_FILE, model, optimizer, config.LEARNING_RATE</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    scaled_anchors = (</span><br><span class="line">        torch.tensor(config.ANCHORS)</span><br><span class="line">        * torch.tensor(config.S).unsqueeze(<span class="number">1</span>).unsqueeze(<span class="number">1</span>).repeat(<span class="number">1</span>, <span class="number">3</span>, <span class="number">2</span>)</span><br><span class="line">    ).to(config.DEVICE)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å¼€å§‹è¿­ä»£è®­ç»ƒ</span></span><br><span class="line">    <span class="keyword">for</span> epoch <span class="keyword">in</span> <span class="built_in">range</span>(config.NUM_EPOCHS):</span><br><span class="line">        <span class="comment">#plot_couple_examples(model, test_loader, 0.6, 0.5, scaled_anchors)</span></span><br><span class="line">        train_fn(train_loader, model, optimizer, loss_fn, scaler, scaled_anchors)</span><br><span class="line"></span><br><span class="line">        <span class="comment">#if config.SAVE_MODEL:</span></span><br><span class="line">        <span class="comment">#    save_checkpoint(model, optimizer, filename=f&quot;checkpoint.pth.tar&quot;)</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#print(f&quot;Currently epoch &#123;epoch&#125;&quot;)</span></span><br><span class="line">        <span class="comment">#print(&quot;On Train Eval loader:&quot;)</span></span><br><span class="line">        <span class="comment">#print(&quot;On Train loader:&quot;)</span></span><br><span class="line">        <span class="comment">#check_class_accuracy(model, train_loader, threshold=config.CONF_THRESHOLD)</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> epoch &gt; <span class="number">0</span> <span class="keyword">and</span> epoch % <span class="number">3</span> == <span class="number">0</span>:</span><br><span class="line">            check_class_accuracy(model, test_loader, threshold=config.CONF_THRESHOLD)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># å¾—åˆ°é¢„æµ‹æ¡†å’ŒçœŸå®çš„è¾¹ç•Œæ¡†çš„å¯¹æ¯”</span></span><br><span class="line">            <span class="comment"># å› ä¸ºå¯¹äºä¸€å¼ å›¾åƒï¼Œåœ¨ä¸‰ä¸ªå°ºåº¦ä¸Šä¼šæœ‰å¤šä¸ªé¢„æµ‹æ¡†ä¸ä¹‹å»åˆæŒºå¥½ï¼Œè¿™é‡Œä½¿ç”¨äº†NMSéæå¤§å€¼æŠ‘åˆ¶æ¥é€‰æ‹©å‡ºæœ€å¥½çš„ä¸€ä¸ªé¢„æµ‹æ¡†</span></span><br><span class="line">            pred_boxes, true_boxes = get_evaluation_bboxes(</span><br><span class="line">                test_loader,</span><br><span class="line">                model,</span><br><span class="line">                iou_threshold=config.NMS_IOU_THRESH,</span><br><span class="line">                anchors=config.ANCHORS,</span><br><span class="line">                threshold=config.CONF_THRESHOLD,</span><br><span class="line">            )</span><br><span class="line">            <span class="comment"># è®¡ç®—mAP</span></span><br><span class="line">            mapval = mean_average_precision(</span><br><span class="line">                pred_boxes,</span><br><span class="line">                true_boxes,</span><br><span class="line">                iou_threshold=config.MAP_IOU_THRESH,</span><br><span class="line">                box_format=<span class="string">&quot;midpoint&quot;</span>,</span><br><span class="line">                num_classes=config.NUM_CLASSES,</span><br><span class="line">            )</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;MAP: <span class="subst">&#123;mapval.item()&#125;</span>&quot;</span>)</span><br><span class="line">            model.train()</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">ä»‹ç»
ç‰©ä½“æ£€æµ‹çš„ä¸¤ä¸ªæ­¥éª¤å¯ä»¥æ¦‚æ‹¬ä¸ºï¼š
æ­¥éª¤ä¸€ï¼šæ£€æµ‹ç›®æ ‡ä½ç½®ï¼ˆç”ŸæˆçŸ©å½¢æ¡†ï¼‰
æ­¥éª¤äºŒï¼šå¯¹ç›®æ ‡ç‰©ä½“è¿›è¡Œåˆ†ç±»
ç‰©ä½“æ£€æµ‹ä¸»æµçš„ç®—æ³•æ¡†æ¶å¤§è‡´åˆ†ä¸ºone-stageä¸two-stageã€‚two-stageç®—æ³•ä»£è¡¨æœ‰R-CNNç³»åˆ—ï¼Œone-stageç®—æ³•ä»£è¡¨æœ‰Yoloç³»åˆ—ã€‚two-stageç®—æ³•å°†æ­¥éª¤ä¸€ä¸æ­¥éª¤äºŒåˆ†å¼€æ‰§è¡Œï¼Œè¾“å…¥å›¾åƒå…ˆç»è¿‡å€™é€‰æ¡†ç”Ÿæˆç½‘ç»œï¼ˆä¾‹å¦‚faster rcnnä¸­çš„RPNç½‘ç»œï¼‰ï¼Œå†ç»è¿‡åˆ†ç±»ç½‘ç»œï¼›one-stageç®—æ³•å°†æ­¥éª¤ä¸€ä¸æ­¥éª¤äºŒåŒæ—¶æ‰§è¡Œï¼Œè¾“å…¥å›¾åƒåªç»è¿‡ä¸€ä¸ªç½‘ç»œï¼Œç”Ÿæˆçš„ç»“æœä¸­åŒæ—¶åŒ…å«ä½ç½®ä¸ç±»åˆ«ä¿¡æ¯ã€‚two-stageä¸one-stageç›¸æ¯”ï¼Œç²¾åº¦é«˜ï¼Œä½†æ˜¯è®¡ç®—é‡æ›´å¤§ï¼Œæ‰€ä»¥è¿ç®—è¾ƒæ…¢ã€‚

YOLO
</summary>
    
    
    
    <category term="machine learning" scheme="http://qixinbo.github.io/categories/machine-learning/"/>
    
    
    <category term="YOLO" scheme="http://qixinbo.github.io/tags/YOLO/"/>
    
  </entry>
  
</feed>
